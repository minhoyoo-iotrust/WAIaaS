# 마일스톤 v2.0.3: Admin UI 기능별 메뉴 재구성

## 목표

Admin UI의 메뉴 구조를 기능별로 재구성하여, WAIaaS를 처음 접하는 사용자도 관련 기능(조회 + 설정)을 한 곳에서 찾을 수 있는 상태. 기존 Settings 페이지(13개 항목 몰빵)를 해체하고 각 기능 페이지에 탭으로 분산한다.

> **핵심 원칙**: "기능을 찾으려면 한 페이지만 보면 된다." 조회와 설정이 같은 페이지에 탭으로 공존.

---

## 배경

현재 Admin UI는 조회/관리 페이지(Wallets, Sessions 등)와 Settings 페이지가 분리되어 있어 관련 설정을 찾으려면 두 곳을 확인해야 한다. Security Parameters에는 세션·정책·인프라 설정이 혼재되어 있다.

### 현재 구조 (7 메뉴)

```
Dashboard | Wallets | Sessions | Policies | Notifications | WalletConnect | Settings(13개)
```

### 변경 구조 (8 메뉴)

```
Dashboard | Wallets | Sessions | Policies | Notifications | WalletConnect | Security | System
```

---

## 산출물

### 1. 메뉴 구조 변경

| 현재 | 변경 | 비고 |
|------|------|------|
| Dashboard | Dashboard | 변경 없음 |
| Wallets | Wallets (3탭) | + RPC Endpoints, Balance Monitoring |
| Sessions | Sessions (2탭) | + Session/Rate Limit 설정 |
| Policies | Policies (2탭) | + Policy Defaults, Default Deny |
| Notifications | Notifications (3탭) | + 알림 설정, Telegram Bot |
| WalletConnect | WalletConnect (2탭) | + Project ID 설정 |
| Settings | **삭제** | 13개 항목을 6개 페이지로 분산 |
| — | **Security** (신규) | Kill Switch, AutoStop, JWT Rotation |
| — | **System** (신규) | API Keys, Display, IP Rate Limit, Daemon, Danger Zone |

### 2. Settings 항목 분산 매핑

| Settings 항목 | → 이동 대상 |
|--------------|------------|
| Notifications 설정 | Notifications > Settings 탭 |
| RPC Endpoints | Wallets > RPC Endpoints 탭 |
| Security Parameters > session_ttl | Sessions > Settings 탭 |
| Security Parameters > max_sessions_per_wallet | Sessions > Settings 탭 |
| Security Parameters > rate_limit_session_rpm | Sessions > Settings 탭 |
| Security Parameters > rate_limit_tx_rpm | Sessions > Settings 탭 |
| Security Parameters > max_pending_tx | Sessions > Settings 탭 |
| Security Parameters > rate_limit_global_ip_rpm | System |
| Security Parameters > policy_defaults_delay_seconds | Policies > Defaults 탭 |
| Security Parameters > policy_defaults_approval_timeout | Policies > Defaults 탭 |
| Security Parameters > default_deny_tokens | Policies > Defaults 탭 |
| Security Parameters > default_deny_contracts | Policies > Defaults 탭 |
| Security Parameters > default_deny_spenders | Policies > Defaults 탭 |
| WalletConnect (Project ID) | WalletConnect > Settings 탭 |
| Telegram Bot | Notifications > Settings 탭 |
| Display Currency | System |
| API Keys | System |
| Daemon (Log Level) | System |
| AutoStop Rules | Security |
| Balance Monitoring | Wallets > Balance Monitoring 탭 |
| Kill Switch | Security |
| JWT Rotation | Security |
| Danger Zone | System |

### 3. 페이지별 구조 + 항목 설명

각 페이지 상단에 페이지 설명을, 개별 항목마다 컨텍스트 설명을 표시한다.

#### Dashboard

> Overview of your WAIaaS daemon — system health, wallet metrics, and recent transactions.

항목별 설명 불필요 (StatCard + 테이블 조회 전용)

#### Wallets

> Create and manage AI agent wallets. Each wallet holds keys for autonomous blockchain operations on behalf of an AI agent. Configure RPC endpoints and balance monitoring.

| 탭 | 항목 | 설명 |
|----|------|------|
| **Wallets** | Create Wallet | Provision a new wallet for an AI agent. Choose chain and environment. |
| | Wallet Detail | View wallet address, balance, owner state, and recent transactions. |
| | Terminate | Permanently deactivate this wallet. Active sessions will be revoked. |
| | Owner Address | Link an external owner wallet for transaction approval and fund recovery. |
| | MCP Setup | Generate a session token and config for Claude Desktop integration. |
| **RPC Endpoints** | Solana RPC URLs | JSON-RPC endpoints for Solana networks (mainnet, devnet, testnet). |
| | EVM RPC URLs | JSON-RPC endpoints for EVM networks (Ethereum, Base, Polygon, Arbitrum, Optimism). |
| | Connection Test | Verify RPC connectivity and measure response latency. |
| **Balance Monitoring** | Enabled | Enable periodic balance checks for all wallets. |
| | Check Interval | How often to check balances (seconds). |
| | Low Balance Threshold (SOL/ETH) | Trigger a notification when native balance falls below this amount. |
| | Cooldown Hours | Minimum hours between repeated low-balance alerts for the same wallet. |

#### Sessions

> Issue and manage JWT session tokens for AI agents. Each token grants scoped access to a wallet. Set session limits and rate controls.

| 탭 | 항목 | 설명 |
|----|------|------|
| **Sessions** | Create Session | Issue a new JWT token bound to a specific wallet. |
| | Revoke | Immediately invalidate a session token. The agent loses wallet access. |
| | Status | Active, expired, or revoked state of each token. |
| **Settings** | Session TTL | Default lifetime for new session tokens (seconds). |
| | Max Sessions per Wallet | Maximum concurrent active sessions per wallet. |
| | Max Pending Transactions | Maximum unconfirmed transactions allowed per session. |
| | Session Rate Limit (RPM) | Maximum API requests per minute per session token. |
| | Transaction Rate Limit (RPM) | Maximum transaction submissions per minute per session. |

#### Policies

> Define spending limits, whitelists, and security rules that govern what AI agents can do. Configure default deny behaviors for tokens, contracts, and spenders.

| 탭 | 항목 | 설명 |
|----|------|------|
| **Policies** | Create Policy | Add a new rule (global or per-wallet). 12 types available. |
| | Type | Rule category — spending limit, whitelist, time restriction, rate limit, etc. |
| | Scope | Global (all wallets) or bound to a specific wallet. |
| | Network | Optional network restriction. Leave empty to apply across all networks. |
| | Priority | Evaluation order (0 = highest). Higher priority rules are checked first. |
| | Enabled | Toggle a policy on/off without deleting it. |
| **Defaults** | Delay Seconds | Mandatory wait time before executing approved transactions. |
| | Approval Timeout | How long an approval request stays valid before auto-rejection (seconds). |
| | Default Deny Tokens | When enabled, token transfers are blocked unless an ALLOWED_TOKENS policy exists. |
| | Default Deny Contracts | When enabled, contract calls are blocked unless a CONTRACT_WHITELIST policy exists. |
| | Default Deny Spenders | When enabled, approve operations are blocked unless an APPROVED_SPENDERS policy exists. |

#### Notifications

> Monitor alert delivery across channels. Manage Telegram user approvals and configure notification settings.

| 탭 | 항목 | 설명 |
|----|------|------|
| **Channels & Logs** | Channel Status | Connection state for each configured channel (Telegram, Discord, ntfy, Slack). |
| | Test | Send a test message to verify channel connectivity. |
| | Delivery Log | History of all sent notifications with status and message details. |
| **Telegram Users** | Pending Users | Users who messaged the bot but await admin approval. |
| | Approve | Grant a Telegram user access as Admin (full control) or Read-only (alerts only). |
| | Delete | Remove a Telegram user's access. |
| **Settings** | Telegram Bot Token | Bot API token from @BotFather. Required for Telegram notifications and commands. |
| | Telegram Chat ID | Default chat for system-level alerts (not per-user). |
| | Telegram Bot Enabled | Start/stop the Telegram bot polling service. |
| | Telegram Locale | Bot response language (en/ko). |
| | Discord Webhook URL | Incoming webhook URL for Discord channel alerts. |
| | ntfy Server / Topic | Self-hosted or ntfy.sh server URL and subscription topic. |
| | Slack Webhook URL | Incoming webhook URL for Slack channel alerts. |
| | Notification Rate Limit | Maximum notification messages per minute (prevents flood). |

#### WalletConnect

> Connect an external owner wallet (e.g. D'CENT, MetaMask) for transaction approval via QR pairing. Required for owner-signed operations.

| 탭 | 항목 | 설명 |
|----|------|------|
| **Sessions** | Connect | Generate a QR code to pair an owner wallet via WalletConnect v2. |
| | Disconnect | End the pairing session. Owner approval falls back to Telegram or REST. |
| | Status | Connection state, peer wallet name, chain, and session expiry. |
| **Settings** | Project ID | WalletConnect Cloud project ID. Required to enable QR pairing. Get one at cloud.walletconnect.com. |

#### Security (신규)

> Emergency controls and automatic protection rules. Manage kill switch state, auto-stop triggers, and JWT secret rotation.

| 항목 | 설명 |
|------|------|
| **Kill Switch** | Emergency system halt. SUSPENDED blocks all wallet operations; LOCKED requires dual-auth recovery. |
| Activate | Immediately suspend all wallet operations. Use in case of compromise or anomaly. |
| Recover | Restore normal operations from SUSPENDED or LOCKED state. LOCKED recovery has a 5-second delay. |
| Escalate to LOCKED | Upgrade from SUSPENDED to LOCKED. Requires owner + master auth to recover. |
| **AutoStop Rules** | Automatic suspension triggers based on anomaly detection. |
| Enabled | Enable or disable automatic stop rules. |
| Consecutive Failures | Suspend after N consecutive transaction failures (default: 5). |
| Unusual Activity Threshold | Maximum transactions within a time window before suspension. |
| Idle Timeout | Suspend wallet after N seconds of inactivity (0 = disabled). |
| **JWT Rotation** | Rotate the JWT signing secret. All existing session tokens become invalid immediately. |

#### System (신규)

> API keys, display preferences, daemon configuration, and server management.

| 항목 | 설명 |
|------|------|
| **API Keys** | Manage third-party API credentials (CoinGecko, etc.). Keys are stored encrypted. |
| **Display Currency** | Default fiat currency for USD-equivalent display (43 currencies supported). |
| **Global IP Rate Limit** | Maximum API requests per minute from a single IP address. |
| **Log Level** | Daemon logging verbosity (debug, info, warn, error). Changes apply immediately. |
| **Danger Zone** | |
| Shutdown Daemon | Gracefully stop the daemon process. Requires typing "SHUTDOWN" to confirm. |

---

## 기술 결정 사항

| # | 결정 항목 | 선택지 | 결정 근거 |
|---|----------|--------|----------|
| 1 | 탭 구현 방식 | 기존 Notifications 탭 패턴 재사용 | 이미 탭 컴포넌트가 구현되어 있음. 일관된 UX |
| 2 | 페이지 설명 위치 | 페이지 헤더 하단 (subtitle) | 사이드바 호버 대비 항상 보임. 레이아웃 변경 최소화 |
| 3 | 항목 설명 표시 | FormField 하위 description prop | 기존 settings-description 클래스 활용. 필드별 help text |
| 4 | Settings 페이지 | 완전 삭제 (라우트 제거) | 리다이렉트 없이 삭제. 모든 항목이 각 페이지로 이동 완료 |
| 5 | URL 구조 | 기존 해시 라우팅 유지 (#/wallets, #/security 등) | 신규 페이지만 추가. 기존 URL 호환성 유지 |

---

## E2E 검증 시나리오

**자동화 비율: 88% -- `[HUMAN]` 2건**

### 자동 검증 (14건)

| # | 시나리오 | 검증 방법 | 태그 |
|---|---------|----------|------|
| 1 | 사이드바 메뉴 8개 표시 | NAV_ITEMS 배열 길이 === 8 assert | [L0] |
| 2 | Settings 라우트 제거 | #/settings 접근 시 Dashboard로 리다이렉트 또는 404 | [L0] |
| 3 | Wallets 3탭 존재 | Wallets 페이지에 탭 3개 (Wallets, RPC Endpoints, Balance Monitoring) 렌더 assert | [L0] |
| 4 | Sessions 2탭 존재 | Sessions 페이지에 탭 2개 (Sessions, Settings) 렌더 assert | [L0] |
| 5 | Policies 2탭 존재 | Policies 페이지에 탭 2개 (Policies, Defaults) 렌더 assert | [L0] |
| 6 | Notifications 3탭 유지 | Notifications 페이지에 탭 3개 (Channels & Logs, Telegram Users, Settings) assert | [L0] |
| 7 | WalletConnect 2탭 존재 | WalletConnect 페이지에 탭 2개 (Sessions, Settings) assert | [L0] |
| 8 | Security 페이지 렌더 | #/security 접근 시 Kill Switch + AutoStop + JWT Rotation 섹션 렌더 assert | [L0] |
| 9 | System 페이지 렌더 | #/system 접근 시 API Keys + Display + Log Level + Danger Zone 렌더 assert | [L0] |
| 10 | RPC 설정 Wallets에서 동작 | Wallets > RPC Endpoints 탭에서 설정 변경 + 저장 → API 반영 assert | [L1] |
| 11 | Policy Defaults 동작 | Policies > Defaults 탭에서 default_deny_tokens 토글 → API 반영 assert | [L1] |
| 12 | Session Settings 동작 | Sessions > Settings 탭에서 session_ttl 변경 → API 반영 assert | [L1] |
| 13 | 페이지 설명 존재 | 모든 8개 페이지 헤더에 description 텍스트 존재 assert | [L0] |
| 14 | 항목 설명 존재 | Settings 탭의 FormField에 description prop 렌더 assert (샘플 3개 이상) | [L0] |

### 수동 검증 [HUMAN]

| # | 시나리오 | 검증 방법 | 태그 |
|---|---------|----------|------|
| 15 | 초보 사용자 탐색성 | WAIaaS를 처음 접한 사람이 원하는 기능을 3클릭 이내에 찾을 수 있는지 확인 | [HUMAN] |
| 16 | 페이지/항목 설명 품질 | 설명 문구가 명확하고 기술 용어에 대한 충분한 컨텍스트를 제공하는지 검토 | [HUMAN] |

---

## 의존

| 의존 대상 | 이유 |
|----------|------|
| v2.0 (릴리스) | Admin UI 기본 구현이 완료된 상태에서 재구성 |
| v2.0.2 (커버리지) | 재구성 후 기존 admin 테스트 수정 필요. 커버리지 임계값 복원과 병행 |

---

## 리스크

| # | 리스크 | 영향 | 대응 방안 |
|---|--------|------|----------|
| 1 | 기존 Settings 테스트 대량 수정 | settings.test.tsx가 Settings 페이지 기준으로 작성됨 | 페이지별 테스트로 분할 |
| 2 | Save bar 동작 변경 | 현재 Settings 전용 dirty tracking을 탭별로 분리 필요 | 각 탭에 독립 save bar 적용 또는 페이지 단위 유지 |
| 3 | 북마크/URL 호환 | #/settings URL을 사용하던 사용자 | 리다이렉트 또는 안내 메시지 |

---

*최종 업데이트: 2026-02-18 — 초안 작성*
