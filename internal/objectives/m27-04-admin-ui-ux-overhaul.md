# 마일스톤 m27-04: Admin UI UX 개선

- **Status:** PLANNED
- **Milestone:** TBD

## 목표

Admin UI에 부재한 핵심 기능(트랜잭션 페이지, 토큰 레지스트리 관리, 수신 트랜잭션 모니터링)을 추가하고, 기존 페이지의 UX를 전반적으로 개선하여 운영자가 단일 UI에서 모든 지갑 운영 상태를 파악하고 관리할 수 있는 상태.

---

## 배경

### 현재 한계

Admin UI는 v2.3(메뉴 재구성) 이후 기능 확장은 이루어졌으나, 운영자 관점의 핵심 워크플로우에 여전히 갭이 존재한다:

| 영역 | 현재 상태 | 영향 |
|------|----------|------|
| 트랜잭션 | 독립 페이지 없음. 대시보드 Recent Activity + 지갑 상세에만 분산 | 크로스 지갑 트랜잭션 검색/필터 불가. "최근 FAILED 건 전체 보기" 같은 기본 운영 작업 불가 |
| 토큰 레지스트리 | Admin UI 없음. REST API (`GET/POST/DELETE /v1/tokens`)만 존재 | ALLOWED_TOKENS 정책 설정 시 커스텀 토큰 등록을 CLI/curl로만 가능 |
| 수신 트랜잭션 | `IncomingSettings`가 데드코드(삭제된 `/settings` 라우트). 수신 TX 뷰어 없음 | v27.1에서 구현한 수신 모니터링 기능을 UI에서 확인/설정 불가 |
| 지갑 목록 | 검색/필터 없음, 잔액 컬럼 없음 | 지갑 수가 많아지면 원하는 지갑 찾기 어려움 |
| 지갑 상세 | 트랜잭션 페이지네이션 없음, txHash 미표시, USD 가치 미표시, 긴 단일 스크롤 | 활성 지갑의 트랜잭션 이력 탐색 비효율적 |
| 대시보드 | 승인 대기 건수 없음, Failed Txns 클릭 불가 | 운영자가 즉시 대응해야 할 건을 놓칠 수 있음 |
| 알림 로그 | 이벤트/채널/상태 필터 없음 | 특정 이벤트 로그 추적이 어려움 |

---

## 구현 대상

### 1. 트랜잭션 페이지 신규

독립 `/transactions` 라우트 추가. 전체 지갑의 트랜잭션을 단일 페이지에서 조회.

| 기능 | 설명 |
|------|------|
| 테이블 | 시간, 지갑명, 타입(5-type 배지), 수신자, 금액(+USD), 네트워크, 상태(배지), txHash(익스플로러 링크) |
| 필터 | 지갑, 타입(TRANSFER/TOKEN_TRANSFER/...), 상태(PENDING/CONFIRMED/FAILED/...), 네트워크, 날짜 범위 |
| 페이지네이션 | 서버사이드 페이지네이션 (기존 API의 `offset`/`limit` 활용) |
| 검색 | txHash 또는 수신자 주소로 검색 |
| 행 클릭 | 트랜잭션 상세 확장 (전체 필드 표시) |

의존: 크로스 지갑 트랜잭션 조회 API가 필요할 수 있음 (`GET /v1/admin/transactions` 존재 여부 확인 필요).

### 2. 토큰 레지스트리 관리 UI

지갑 페이지 또는 독립 탭으로 토큰 레지스트리 관리 기능 추가.

| 기능 | 설명 |
|------|------|
| 토큰 목록 | 네트워크별 빌트인 + 커스텀 토큰 테이블 (심볼, 이름, 주소, decimals, source 배지) |
| 토큰 추가 | 네트워크 선택 → 컨트랙트 주소 입력 → 온체인 메타데이터 자동 조회 → 확인 후 등록 |
| 토큰 삭제 | 커스텀 토큰만 삭제 가능 (빌트인은 삭제 불가 표시) |
| 네트워크 필터 | EVM 네트워크 선택 드롭다운 |

### 3. 수신 트랜잭션 모니터링 UI

v27.1에서 구현한 수신 트랜잭션 모니터링의 Admin UI 연동.

| 기능 | 설명 |
|------|------|
| 설정 패널 | 데드코드 `IncomingSettings`를 활성 페이지로 이전 (enabled, poll_interval, retention_days, suspicious 임계값 등) |
| 수신 TX 뷰어 | `GET /v1/wallet/incoming` 데이터를 테이블로 표시 (시간, 지갑, 발신자, 금액, 체인, 상태, 의심 여부 배지) |
| 필터 | 지갑, 체인, 상태(DETECTED/CONFIRMED), suspicious 여부 |
| 지갑별 토글 | 개별 지갑의 수신 모니터링 활성화/비활성화 (설계 문서 76의 per-wallet opt-in) |

의존: 크로스 지갑 수신 트랜잭션 조회 admin API 필요 여부 확인.

### 4. 지갑 목록 개선

| 기능 | 설명 |
|------|------|
| 검색 | 지갑 이름, 공개키로 실시간 필터링 |
| 필터 | 체인(Solana/Ethereum), 환경(mainnet/testnet), 상태(ACTIVE/SUSPENDED/TERMINATED) |
| 잔액 컬럼 | 기본 네트워크의 네이티브 토큰 잔액 + USD 가치 표시 |

### 5. 지갑 상세 개선

| 기능 | 설명 |
|------|------|
| 탭 구조 | 긴 단일 스크롤 → Overview / Transactions / Owner / MCP 탭으로 분리 |
| 트랜잭션 탭 | 페이지네이션 추가, txHash 컬럼 + 익스플로러 링크, 상태/타입 필터 |
| 잔액 USD 표시 | 각 네트워크 잔액 옆에 USD 환산 가치 표시 |
| 잔액 새로고침 | 수동 새로고침 버튼 추가 |

### 6. 대시보드 개선

| 기능 | 설명 |
|------|------|
| 승인 대기 카드 | APPROVAL 티어 대기 중인 트랜잭션 건수 표시 + 클릭 시 트랜잭션 페이지 필터링 |
| 클릭 가능 카드 | Failed Txns, Recent Txns 카드 클릭 시 트랜잭션 페이지로 이동 (해당 필터 적용) |
| 네트워크 컬럼 | Recent Activity 테이블에 네트워크 컬럼 추가 |
| txHash 링크 | Recent Activity에 txHash 컬럼 + 익스플로러 링크 추가 |

### 7. 알림 로그 필터

| 기능 | 설명 |
|------|------|
| 필터 바 | 이벤트 타입, 채널(Telegram/Discord/Slack/ntfy), 상태(sent/failed), 날짜 범위 |
| 지갑 링크 | Wallet ID 클릭 시 지갑 상세 페이지로 이동 |

---

## 파일/모듈 구조

```
packages/admin/src/
  pages/
    transactions.tsx           # 신규: 트랜잭션 페이지
    tokens.tsx                 # 신규: 토큰 레지스트리 페이지
    incoming.tsx               # 신규: 수신 트랜잭션 페이지 (또는 기존 페이지 탭으로)
    wallets.tsx                # 수정: 검색/필터/잔액 컬럼
    wallet-detail.tsx          # 수정: 탭 구조, 페이지네이션, txHash, USD
    dashboard.tsx              # 수정: 승인 대기, 클릭 가능 카드, 네트워크/txHash
    notifications.tsx          # 수정: 로그 필터 바, 지갑 링크
    settings.tsx               # 정리: IncomingSettings 코드 이전 후 데드코드 제거
  components/
    layout.tsx                 # 수정: 신규 라우트 추가 (/transactions, /tokens 등)
    explorer-link.tsx          # 신규: 블록 익스플로러 링크 공용 컴포넌트
    filter-bar.tsx             # 신규: 재사용 가능 필터 바 컴포넌트
    search-input.tsx           # 신규: 실시간 검색 입력 컴포넌트
  api/
    endpoints.ts               # 수정: 토큰 레지스트리, 크로스 지갑 트랜잭션 엔드포인트 추가
  styles/
    global.css                 # 수정: 필터/검색/탭 스타일

packages/daemon/src/
  api/routes/
    admin.ts                   # 수정 가능: 크로스 지갑 트랜잭션/수신 TX admin API (필요 시)

packages/core/src/
  utils/
    explorer-urls.ts           # 신규: 네트워크 → 익스플로러 URL 매핑 (#148과 공유)
```

---

## 기술 결정 사항

| # | 결정 항목 | 선택지 | 결정 근거 |
|---|----------|--------|----------|
| 1 | 트랜잭션 페이지 라우트 | `/transactions` 독립 페이지 | 크로스 지갑 조회가 핵심. 지갑 상세와 별개 맥락 |
| 2 | 토큰 레지스트리 위치 | 독립 `/tokens` 페이지 vs 지갑 탭 | 토큰은 네트워크 단위(지갑 단위 아님)이므로 독립 페이지가 적합 |
| 3 | 수신 TX 뷰어 위치 | 독립 `/incoming` vs 지갑 상세 탭 | 크로스 지갑 조회가 필요하면 독립 페이지, 지갑별이면 탭. 리서치 필요 |
| 4 | 익스플로러 URL 매핑 | `packages/core` 공용 모듈 | #148 이슈와 공유. 알림/Admin UI 양쪽에서 사용 |
| 5 | 크로스 지갑 admin API | 기존 API 활용 vs 신규 API | `GET /v1/admin/transactions` 존재 여부에 따라 결정. 리서치 필요 |
| 6 | 지갑 상세 탭 구조 | 4탭 (Overview/Transactions/Owner/MCP) | 현재 단일 스크롤이 너무 길어 탐색 비효율적 |
| 7 | 필터 상태 관리 | URL query params vs signals | URL params 사용 시 필터 상태가 공유/북마크 가능. 권장 |
| 8 | 서버사이드 페이지네이션 | offset/limit 기반 | 기존 API 패턴과 일치. cursor 기반은 오버엔지니어링 |

---

## E2E 검증 시나리오

**자동화 비율: 90%** (일부 UI 인터랙션은 수동 확인)

| # | 시나리오 | 검증 방법 | 태그 |
|---|---------|----------|------|
| 1 | 트랜잭션 페이지 렌더링 | `/transactions` 라우트 접근 → 테이블 렌더 assert | [L0] |
| 2 | 트랜잭션 상태 필터 | FAILED 필터 적용 → FAILED 건만 표시 assert | [L0] |
| 3 | 트랜잭션 페이지네이션 | 2페이지 이동 → offset 반영된 API 호출 assert | [L0] |
| 4 | 트랜잭션 txHash 링크 | txHash 셀에 올바른 익스플로러 URL assert | [L0] |
| 5 | 토큰 목록 조회 | `/tokens` 페이지 → 네트워크별 토큰 테이블 렌더 assert | [L0] |
| 6 | 커스텀 토큰 추가 | 폼 제출 → POST /v1/tokens 호출 → 목록 갱신 assert | [L0] |
| 7 | 커스텀 토큰 삭제 | 삭제 버튼 → DELETE /v1/tokens 호출 → 목록 반영 assert | [L0] |
| 8 | 수신 TX 설정 접근 | 설정 패널이 활성 페이지에서 렌더링 assert | [L0] |
| 9 | 수신 TX 뷰어 | 수신 트랜잭션 테이블 렌더 + 상태 배지 assert | [L0] |
| 10 | 지갑 목록 검색 | 이름 입력 → 필터링된 목록 assert | [L0] |
| 11 | 지갑 목록 잔액 컬럼 | 잔액 + USD 값 렌더링 assert | [L0] |
| 12 | 지갑 상세 탭 전환 | Overview → Transactions 탭 클릭 → 해당 컨텐츠 렌더 assert | [L0] |
| 13 | 지갑 상세 트랜잭션 페이지네이션 | 페이지 이동 → 새 데이터 로드 assert | [L0] |
| 14 | 대시보드 승인 대기 카드 | APPROVAL 대기 건 존재 시 카운트 표시 assert | [L0] |
| 15 | 대시보드 카드 클릭 | Failed Txns 카드 클릭 → `/transactions?status=FAILED` 이동 assert | [L0] |
| 16 | 알림 로그 필터 | 채널 필터 적용 → 해당 채널 로그만 표시 assert | [L0] |
| 17 | 알림 로그 지갑 링크 | 지갑 ID 클릭 → `/wallets/:id` 이동 assert | [L0] |
| 18 | 익스플로러 링크 정확성 | 13개 네트워크 각각의 URL 패턴 assert | [L0] |
| 19 | 하위 호환 | 기존 페이지 기능이 변경 없이 동작 assert | [L0] |

---

## 의존

| 의존 대상 | 이유 |
|----------|------|
| #148 블록 익스플로러 링크 | 익스플로러 URL 매핑 모듈을 공유. #148이 먼저 또는 동시 구현 |
| v27.1 수신 TX 모니터링 | 수신 TX 뷰어가 `GET /v1/wallet/incoming` API에 의존 |

---

## 리스크

| # | 리스크 | 영향 | 대응 방안 |
|---|--------|------|----------|
| 1 | 크로스 지갑 트랜잭션 admin API 부재 | 트랜잭션 페이지 구현 불가 | 기존 API 확인 후, 없으면 신규 API 추가를 페이즈에 포함 |
| 2 | 크로스 지갑 수신 TX admin API 부재 | 수신 TX 뷰어 구현 불가 | 동일. 현재 API가 세션 스코프라면 admin 전용 엔드포인트 필요 |
| 3 | 지갑 잔액 일괄 조회 성능 | 지갑 목록에 잔액 표시 시 N개 RPC 호출 | 캐시된 잔액 사용 또는 비동기 로딩으로 대응 |
| 4 | 페이지 수 증가로 번들 크기 증가 | Admin UI 로딩 속도 저하 | Vite 코드 스플리팅 + lazy import로 대응 |
| 5 | 필터 상태 URL 동기화 복잡도 | query param 파싱/직렬화 코드 증가 | 공용 useFilterParams 훅으로 추상화 |

---

## 예상 규모

| 항목 | 예상 |
|------|------|
| 페이즈 | 5개 (아래 매핑 참조) |
| 신규 파일 | 8-12개 |
| 수정 파일 | 10-15개 |
| 테스트 | 19-30개 |
| DB 마이그레이션 | 없음 |

### 페이즈 ↔ 구현 대상 매핑

| 페이즈 | 내용 | 구현 대상 |
|--------|------|----------|
| Phase 1 | 공용 컴포넌트 + API 기반 | 익스플로러 링크, 필터 바, 검색 입력, admin API 확인/추가 |
| Phase 2 | 트랜잭션 페이지 + 대시보드 개선 | 구현 #1 (트랜잭션), #6 (대시보드) |
| Phase 3 | 토큰 레지스트리 + 알림 로그 필터 | 구현 #2 (토큰), #7 (알림 로그) |
| Phase 4 | 수신 TX 모니터링 UI | 구현 #3 (수신 TX 설정 + 뷰어) |
| Phase 5 | 지갑 목록/상세 개선 | 구현 #4 (지갑 목록), #5 (지갑 상세 탭/페이지네이션) |

---

*생성일: 2026-02-22*
*선행: #148 (익스플로러 링크), v27.1 (수신 TX)*
