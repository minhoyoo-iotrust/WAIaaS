# 커스터디 모델 비교 분석 (CUST-01)

**문서 ID:** CUST-01
**작성일:** 2026-02-04
**상태:** 완료
**참조:** 02-RESEARCH.md, 02-CONTEXT.md

---

## 1. 개요

### 1.1 분석 목적

본 문서는 WAIaaS(Wallet AI as a Service) 프로젝트에서 AI 에이전트 지갑에 적합한 커스터디 모델을 선정하기 위한 기초 분석 자료를 제공한다. 분석의 핵심 관점은 다음과 같다:

1. **AI 에이전트 특화 요구사항**: 자율적 트랜잭션 실행 능력과 소유자 통제권 유지의 균형
2. **보안성 최우선**: 키 유출 위험, 단일 장애점, 복구 가능성을 최우선 기준으로 평가
3. **직접 구축 전제**: 외부 프로바이더 의존 없이 자체 구축 가능한 옵션 중심 분석

### 1.2 커스터디 모델 분류

암호화폐 지갑의 커스터디 모델은 **키 소유권**에 따라 세 가지로 분류된다:

| 모델 | 키 소유권 | 대표 사례 |
|------|----------|----------|
| **Custodial (수탁형)** | 제3자 (거래소, 서비스 제공자) | Coinbase Custody, BitGo |
| **Non-Custodial (비수탁형)** | 사용자 본인 | MetaMask, Phantom |
| **MPC-TSS (다자간 연산)** | 분산 (N개 당사자) | Fireblocks, Dfns |

---

## 2. 모델별 상세 분석

### 2.1 Custodial (수탁형)

#### 2.1.1 키 소유권 구조

```
┌─────────────────────────────────────────┐
│         Custodian (수탁자)              │
│   - 모든 개인키 소유                    │
│   - 서명 권한 독점                      │
│   - 트랜잭션 대행                       │
└─────────────────────────────────────────┘
              │
              ▼
┌─────────────────────────────────────────┐
│           사용자                        │
│   - API/UI를 통한 요청만 가능           │
│   - 키에 대한 직접 접근 없음            │
└─────────────────────────────────────────┘
```

#### 2.1.2 장점

| 장점 | 설명 |
|------|------|
| **사용 편의성** | 키 관리 부담 없음, 복구 용이 |
| **규제 준수** | 기존 금융 규제 프레임워크 적용 가능 |
| **보험 가능** | 자산 손실에 대한 보험 상품 존재 |
| **운영 단순화** | 보안 인프라 직접 구축 불필요 |

#### 2.1.3 단점

| 단점 | 설명 |
|------|------|
| **신뢰 집중** | 수탁자에 대한 전적인 신뢰 필요 |
| **단일 장애점** | 수탁자 해킹 시 대규모 자산 손실 |
| **검열 위험** | 수탁자가 거래 거부 가능 |
| **서비스 의존** | 수탁자 파산/서비스 중단 시 접근 불가 |
| **수수료** | 지속적인 커스터디 비용 발생 |

#### 2.1.4 규제 적합성

- **한국**: 가상자산이용자보호법에 따른 수탁업 등록 필요
- **미국**: SEC/FinCEN 규제 대상, 자격 요건 충족 필요
- **EU**: MiCA에 따른 커스터디 서비스 라이선스 필수

#### 2.1.5 AI 에이전트 적합성: **낮음**

```
적합성 점수: ★★☆☆☆ (2/5)

부적합 이유:
1. 수탁 규제로 인해 AI 에이전트 자율 운영 제약
2. API 호출 한도 및 지연으로 실시간 거래 제한
3. 수탁자 정책에 따른 서비스 제한 가능
4. AI 에이전트의 "자율성"과 수탁 모델의 "통제"가 상충
```

---

### 2.2 Non-Custodial (비수탁형)

#### 2.2.1 키 소유권 구조

```
┌─────────────────────────────────────────┐
│           사용자 (또는 시스템)          │
│   - 개인키 직접 소유                    │
│   - 서명 권한 보유                      │
│   - 완전한 자산 통제                    │
└─────────────────────────────────────────┘
              │
              ▼
┌─────────────────────────────────────────┐
│         블록체인 네트워크               │
│   - 서명된 트랜잭션 직접 제출           │
│   - 중개자 없음                         │
└─────────────────────────────────────────┘
```

#### 2.2.2 장점

| 장점 | 설명 |
|------|------|
| **완전한 통제** | 자산에 대한 100% 소유권 |
| **검열 저항** | 제3자의 거래 거부 불가 |
| **프라이버시** | KYC 없이 사용 가능 |
| **낮은 비용** | 커스터디 수수료 없음 |
| **즉시성** | API 제한 없이 즉시 거래 가능 |

#### 2.2.3 단점

| 단점 | 설명 |
|------|------|
| **키 분실 위험** | 시드 분실 시 자산 영구 손실 |
| **보안 책임** | 해킹, 피싱 방어 책임 전적으로 사용자에게 |
| **복잡성** | 기술적 이해 필요 |
| **단일 장애점** | 키 저장 위치가 단일 장애점 |

#### 2.2.4 위험 요소

```
┌─────────────────────────────────────────────────────────┐
│                     위험 요소 매트릭스                  │
├─────────────────────────────────────────────────────────┤
│ 내부 위협                                               │
│   - 키 저장 서버 침해                                   │
│   - 내부자에 의한 키 유출                               │
│   - 메모리 덤프를 통한 키 탈취                          │
│                                                         │
│ 외부 위협                                               │
│   - 피싱 공격                                           │
│   - 악성 스마트 컨트랙트                                │
│   - API 엔드포인트 공격                                 │
│                                                         │
│ 운영 위험                                               │
│   - 시드 문구 백업 부재                                 │
│   - 하드웨어 장애                                       │
│   - 복구 절차 미비                                      │
└─────────────────────────────────────────────────────────┘
```

#### 2.2.5 AI 에이전트 적합성: **중간**

```
적합성 점수: ★★★☆☆ (3/5)

적합 이유:
1. 자율적 트랜잭션 실행 가능
2. 실시간 거래에 제약 없음
3. 규제 의무 최소화

부적합 이유:
1. AI 에이전트가 키를 직접 보유 시 보안 위험
2. 에이전트 침해 시 전체 자산 손실 위험
3. 소유자가 에이전트를 즉시 중지하기 어려움
```

---

### 2.3 MPC-TSS (Multi-Party Computation - Threshold Signature Scheme)

#### 2.3.1 키 분산 방식

```
┌─────────────────────────────────────────────────────────┐
│                    MPC-TSS 아키텍처                     │
├─────────────────────────────────────────────────────────┤
│                                                         │
│   ┌─────────┐   ┌─────────┐   ┌─────────┐             │
│   │ Party 1 │   │ Party 2 │   │ Party 3 │   ...       │
│   │ Share 1 │   │ Share 2 │   │ Share 3 │             │
│   └────┬────┘   └────┬────┘   └────┬────┘             │
│        │             │             │                   │
│        └──────┬──────┴──────┬──────┘                   │
│               │             │                          │
│               ▼             ▼                          │
│        ┌─────────────────────────┐                     │
│        │   협력 서명 프로토콜    │                     │
│        │   (CGGMP21: 4라운드)    │                     │
│        └───────────┬────────────┘                      │
│                    │                                   │
│                    ▼                                   │
│        ┌─────────────────────────┐                     │
│        │     유효한 서명 생성    │                     │
│        │  (개인키 재구성 없이)   │                     │
│        └─────────────────────────┘                     │
│                                                         │
└─────────────────────────────────────────────────────────┘

Threshold 예시:
- 2-of-3: 3개 파티 중 2개 협력 시 서명 가능
- 3-of-5: 5개 파티 중 3개 협력 시 서명 가능
```

#### 2.3.2 장점

| 장점 | 설명 |
|------|------|
| **단일 장애점 제거** | 개인키가 단일 위치에 존재하지 않음 |
| **키 유출 방지** | 전체 키가 재구성되지 않고 서명 |
| **유연한 거버넌스** | threshold 조정으로 정책 변경 가능 |
| **복구 가능** | 일부 share 분실 시에도 복구 가능 (threshold 이상 보유 시) |
| **프라이버시** | 서명 과정에서 개인키 노출 없음 |

#### 2.3.3 단점

| 단점 | 설명 |
|------|------|
| **운영 복잡도** | 다수 파티 간 통신 및 조율 필요 |
| **지연** | 서명에 여러 라운드 필요 (CGGMP21: 4라운드) |
| **인프라 비용** | 다중 노드 운영 비용 |
| **구현 난이도** | 암호학적 프로토콜 구현 복잡 |

#### 2.3.4 MPC 프로토콜 비교

| 프로토콜 | 라운드 수 | 보안 수준 | 상태 |
|----------|----------|----------|------|
| GG18 | 9 | 취약 (BitForge) | **사용 금지** |
| GG20 | 6 | 취약 (BitForge) | **사용 금지** |
| **CGGMP21** | 4 | 안전 | **권장** |

> **중요**: GG18/GG20 프로토콜은 2023년 발견된 BitForge 취약점으로 인해 더 이상 사용해서는 안 된다. CGGMP21만 사용할 것.

#### 2.3.5 운영 복잡도 분석

```
운영 복잡도 요소:

1. 키 생성 (Key Generation)
   - 모든 파티가 동시에 참여해야 함
   - 네트워크 지연에 민감
   - 예상 시간: 1-5초

2. 서명 (Signing)
   - threshold 수 이상의 파티 협력 필요
   - 4라운드 통신 (CGGMP21)
   - 예상 시간: 0.5-2초

3. 키 갱신 (Key Refresh)
   - 정기적 갱신 권장 (share 노출 대비)
   - 기존 share 무효화, 새 share 생성
   - 서비스 중단 없이 가능

4. 장애 복구
   - 1개 파티 장애: 서비스 지속 (threshold 이상 시)
   - 다수 파티 장애: 복구 절차 필요
```

#### 2.3.6 AI 에이전트 적합성: **높음**

```
적합성 점수: ★★★★☆ (4/5)

적합 이유:
1. 에이전트 침해 시에도 단독 서명 불가 (share만 보유)
2. Owner와 Agent 간 share 분리로 권한 분리 가능
3. threshold 조정으로 정책 유연하게 적용

부적합 이유:
1. 서명 지연 (2-5초)이 실시간 거래에 제약
2. 직접 구현 시 높은 복잡도
3. 네트워크 장애 시 서명 불가
```

---

## 3. 직접 구축 옵션 비교 (중점 분석)

WAIaaS는 외부 프로바이더 의존 없이 직접 구축하는 방향을 전제로 한다. 이 섹션에서는 직접 구축 시 사용 가능한 키 관리 옵션을 분석한다.

### 3.1 HSM (Hardware Security Module)

#### 3.1.1 개요

HSM은 암호화 키를 안전하게 저장하고 암호화 연산을 수행하는 전용 하드웨어 장치다.

```
┌─────────────────────────────────────────────────────────┐
│                    AWS CloudHSM                         │
├─────────────────────────────────────────────────────────┤
│  ┌─────────────────┐                                    │
│  │  FIPS 140-2     │                                    │
│  │  Level 3 검증   │                                    │
│  └─────────────────┘                                    │
│                                                         │
│  - 전용 하드웨어 격리                                   │
│  - 키가 HSM 외부로 절대 유출되지 않음                   │
│  - 탬퍼 방지 (물리적 침입 시 자동 삭제)                 │
│  - PKCS#11, JCE, OpenSSL 인터페이스                     │
│                                                         │
│  제약사항:                                              │
│  - ED25519 지원 제한적 (ECDSA 중심)                     │
│  - Solana 직접 서명 어려움                              │
└─────────────────────────────────────────────────────────┘
```

#### 3.1.2 특성 분석

| 항목 | 상세 |
|------|------|
| **보안 수준** | 최고 (FIPS 140-2 Level 3) |
| **ED25519 지원** | 제한적 - AWS CloudHSM은 ED25519 미지원 |
| **Solana 적합성** | **낮음** - ED25519 필수인 Solana에 부적합 |
| **비용** | $1.6/시간 (~$1,168/월) |
| **운영 복잡도** | 높음 - 클러스터 관리, 백업 설정 필요 |

#### 3.1.3 WAIaaS 적합성 평가

```
적합성: ★★☆☆☆ (2/5)

부적합 이유:
- ED25519 미지원으로 Solana 트랜잭션 서명 불가
- 높은 비용 (월 $1,168+)
- KMS ED25519 지원으로 HSM 필요성 감소

사용 가능 시나리오:
- EVM 체인(Ethereum 등) 지원 확장 시
- 규제 요건으로 FIPS Level 3 필수인 경우
```

---

### 3.2 KMS (Key Management Service)

#### 3.2.1 개요

AWS KMS는 관리형 키 관리 서비스로, 2025년 11월 ED25519 지원을 발표하여 Solana 트랜잭션 서명에 직접 활용 가능해졌다.

```
┌─────────────────────────────────────────────────────────┐
│                    AWS KMS (ED25519)                    │
├─────────────────────────────────────────────────────────┤
│  ┌─────────────────┐                                    │
│  │  FIPS 140-2     │                                    │
│  │  Level 2 검증   │                                    │
│  └─────────────────┘                                    │
│                                                         │
│  지원 키 타입:                                          │
│  - ECC_NIST_EDWARDS25519 (신규, 2025-11)               │
│  - RSA_2048, RSA_4096                                   │
│  - ECC_NIST_P256, ECC_NIST_P384                        │
│                                                         │
│  장점:                                                  │
│  - Solana ED25519 직접 서명 가능                        │
│  - CloudTrail 감사 로그 자동화                          │
│  - IAM 기반 접근 제어                                   │
│  - Nitro Enclave attestation 조건 지원                  │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### 3.2.2 특성 분석

| 항목 | 상세 |
|------|------|
| **보안 수준** | 높음 (FIPS 140-2 Level 2) |
| **ED25519 지원** | **완전 지원** (2025-11 공식 발표) |
| **Solana 적합성** | **높음** - 직접 서명 가능 |
| **비용** | ~$1/10,000 요청 (매우 경제적) |
| **운영 복잡도** | 낮음 - 완전 관리형 |

#### 3.2.3 사용 예시

```typescript
// AWS KMS ED25519를 활용한 Solana 서명
import { SolanaKmsSigner } from 'solana-kms-signer';

const signer = new SolanaKmsSigner({
  region: 'ap-northeast-2',
  keyId: 'arn:aws:kms:ap-northeast-2:123456789:key/xxx'
});

// Solana 공개키 획득
const publicKey = await signer.getPublicKey();

// 트랜잭션 서명
const signedTx = await signer.signTransaction(transaction);
```

#### 3.2.4 WAIaaS 적합성 평가

```
적합성: ★★★★★ (5/5)

권장 사용처:
- Owner Key 관리 (마스터 권한)
- 소유자 서명이 필요한 고액 거래
- 에이전트 중지, 권한 변경 등 관리 작업

장점:
- ED25519 완전 지원
- 매우 낮은 비용 ($1/10,000 요청)
- IAM + Enclave attestation 조건으로 강력한 접근 제어
- 완전한 감사 로그 (CloudTrail)
```

---

### 3.3 자체 MPC 구현

#### 3.3.1 개요

CGGMP21 프로토콜을 활용하여 자체 MPC 시스템을 구축하는 옵션이다.

```
┌─────────────────────────────────────────────────────────┐
│                 자체 MPC 구현 (CGGMP21)                 │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  권장 라이브러리:                                       │
│  - Dfns CGGMP21 (Rust) - Kudelski Security 감사 완료   │
│  - MIT/Apache 라이선스                                  │
│                                                         │
│  구현 요구사항:                                         │
│  - MPC 노드 인프라 (최소 3개)                          │
│  - 노드 간 보안 통신 채널                               │
│  - 키 생성/서명/갱신 프로토콜 구현                      │
│  - 장애 복구 메커니즘                                   │
│                                                         │
│  복잡도:                                                │
│  - 구현: 매우 높음                                      │
│  - 운영: 높음                                           │
│  - 보안 검증: 필수 (외부 감사 권장)                     │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### 3.3.2 특성 분석

| 항목 | 상세 |
|------|------|
| **보안 수준** | 높음 (구현에 따라 달라짐) |
| **ED25519 지원** | 가능 (라이브러리 의존) |
| **Solana 적합성** | 중간 - 서명 지연이 제약 |
| **비용** | 인프라 비용 (다중 노드 운영) |
| **운영 복잡도** | 매우 높음 |

#### 3.3.3 WAIaaS 적합성 평가

```
적합성: ★★☆☆☆ (2/5)

권장하지 않는 이유:
1. 구현 복잡도가 매우 높음
2. 보안 취약점 발생 위험 (자체 구현)
3. 서명 지연 (4라운드, 2-5초)이 AI 에이전트 실시간 운영에 부적합
4. KMS + TEE 조합으로 동등한 보안 수준 달성 가능

사용 가능 시나리오:
- 고액 거래에 대한 추가 보안 레이어 필요 시
- 다중 조직 간 공동 관리 지갑 필요 시
```

---

### 3.4 TEE (Trusted Execution Environment)

#### 3.4.1 개요

AWS Nitro Enclaves는 격리된 실행 환경을 제공하여 민감한 데이터 처리에 최적화된 TEE 구현이다.

```
┌─────────────────────────────────────────────────────────┐
│                  AWS Nitro Enclaves                     │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │              EC2 Host Instance                   │   │
│  │  ┌─────────────────────────────────────────┐    │   │
│  │  │           Nitro Enclave                  │    │   │
│  │  │  ┌──────────────────────────────────┐   │    │   │
│  │  │  │     격리된 메모리                │   │    │   │
│  │  │  │  - 호스트 접근 차단              │   │    │   │
│  │  │  │  - 암호화된 메모리               │   │    │   │
│  │  │  │  - Agent Key 보관               │   │    │   │
│  │  │  └──────────────────────────────────┘   │    │   │
│  │  │                                          │    │   │
│  │  │  - vsock 통신만 허용                     │    │   │
│  │  │  - 네트워크 직접 접근 불가               │    │   │
│  │  │  - 영구 저장소 없음                      │    │   │
│  │  └─────────────────────────────────────────┘    │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  검증된 사용 사례:                                      │
│  - Coinbase: 수십억 달러 자산 보호                      │
│  - Fireblocks: 기관급 키 관리                           │
│  - Turnkey: WaaS 프로바이더 핵심 인프라                 │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

#### 3.4.2 특성 분석

| 항목 | 상세 |
|------|------|
| **보안 수준** | 매우 높음 (하드웨어 격리) |
| **ED25519 지원** | 완전 지원 (Enclave 내 서명) |
| **Solana 적합성** | **높음** - 빠른 서명 가능 |
| **비용** | EC2 비용만 (추가 비용 없음) |
| **운영 복잡도** | 중간 - Enclave 이미지 관리 필요 |

#### 3.4.3 보안 특성

```
Nitro Enclaves 보안 특성:

1. 격리 (Isolation)
   - 호스트 OS에서 Enclave 메모리 접근 불가
   - root 권한으로도 접근 불가
   - 디버거 연결 불가

2. 암호화 (Encryption)
   - 메모리 전체 암호화
   - Enclave 종료 시 메모리 자동 소거

3. 인증 (Attestation)
   - PCR (Platform Configuration Register) 검증
   - KMS 키 정책에 attestation 조건 추가 가능
   - Enclave 이미지 무결성 검증

4. 통신 (Communication)
   - vsock만 허용 (가상 소켓)
   - 네트워크 직접 접근 불가
   - 호스트를 통한 프록시 필수
```

#### 3.4.4 WAIaaS 적합성 평가

```
적합성: ★★★★★ (5/5)

권장 사용처:
- Agent Key 생성 및 보관
- 정책 기반 자율 서명
- 민감한 연산 격리

장점:
- 하드웨어 수준 격리로 최고 보안
- 빠른 서명 (지연 최소)
- Coinbase, Fireblocks 등 실제 검증
- KMS와 조합으로 이중 보안
```

---

## 4. 비교 매트릭스

### 4.1 커스터디 모델 비교

| 기준 | Custodial | Non-Custodial | MPC-TSS |
|------|-----------|---------------|---------|
| **키 소유권** | 제3자 | 사용자 | 분산 |
| **단일 장애점** | 있음 (제3자) | 있음 (사용자) | 없음 |
| **복구 가능성** | 높음 | 낮음 | 중간 |
| **운영 복잡도** | 낮음 | 중간 | 높음 |
| **비용** | 높음 (수수료) | 낮음 | 중간 |
| **규제 준수** | 쉬움 | 어려움 | 중간 |
| **AI 에이전트 적합성** | **낮음** | **중간** | **높음** |

### 4.2 직접 구축 옵션 비교

| 기준 | HSM (CloudHSM) | KMS | 자체 MPC | TEE (Nitro) |
|------|----------------|-----|----------|-------------|
| **보안 수준** | FIPS L3 | FIPS L2 | 구현 의존 | 하드웨어 격리 |
| **ED25519** | 미지원 | **지원** | 가능 | **지원** |
| **Solana 적합성** | 낮음 | **높음** | 중간 | **높음** |
| **서명 지연** | - | 50-100ms | 2-5초 | 10-50ms |
| **비용 (월)** | ~$1,168 | ~$10 | $500+ | EC2 비용 |
| **운영 복잡도** | 높음 | 낮음 | 매우 높음 | 중간 |
| **WAIaaS 적합성** | ★★☆☆☆ | ★★★★★ | ★★☆☆☆ | ★★★★★ |

### 4.3 종합 비교 (AI 에이전트 관점)

| 요구사항 | HSM | KMS | MPC | TEE | **KMS+TEE** |
|----------|-----|-----|-----|-----|-------------|
| 자율적 트랜잭션 | - | O | O | O | **O** |
| 실시간 서명 (<100ms) | - | O | X | O | **O** |
| 소유자 즉시 통제 | - | O | X | X | **O** |
| 키 분리 (Owner/Agent) | - | O | O | O | **O** |
| 침해 시 단독 서명 방지 | - | X | O | X | **O** |
| 운영 복잡도 | 높 | 낮 | 매우 높 | 중 | **중** |
| 비용 효율성 | 낮 | 높 | 중 | 높 | **높** |

---

## 5. 하이브리드 접근법

### 5.1 권장 아키텍처: KMS + TEE + 온체인 멀티시그

WAIaaS에 가장 적합한 아키텍처는 **KMS + TEE + Squads Protocol** 조합의 하이브리드 접근법이다.

```
┌─────────────────────────────────────────────────────────────┐
│               WAIaaS 권장 아키텍처                           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                    ┌─────────────────────────┐              │
│                    │   Squads Smart Wallet   │              │
│                    │   (Solana 멀티시그)     │              │
│                    └────────────┬────────────┘              │
│                                 │                           │
│              ┌──────────────────┼──────────────────┐        │
│              │                  │                  │        │
│              ▼                  │                  ▼        │
│    ┌─────────────────┐         │        ┌─────────────────┐ │
│    │   Owner Key     │         │        │   Agent Key     │ │
│    │   (AWS KMS)     │         │        │(Nitro Enclave)  │ │
│    ├─────────────────┤         │        ├─────────────────┤ │
│    │ 마스터 권한     │         │        │ 일상 운영       │ │
│    │ 자금 회수       │         │        │ 정책 범위 내    │ │
│    │ 에이전트 중지   │         │        │ 자율적 서명     │ │
│    │ 키 교체         │         │        │ TEE 격리        │ │
│    └─────────────────┘         │        └─────────────────┘ │
│                                 │                           │
│                    ┌────────────▼────────────┐              │
│                    │     WAIaaS API 서버     │              │
│                    │  - 정책 평가            │              │
│                    │  - 트랜잭션 검증        │              │
│                    │  - 서명 조율            │              │
│                    └─────────────────────────┘              │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 5.2 각 구성 요소의 역할

#### 5.2.1 Owner Key (AWS KMS)

| 역할 | 설명 |
|------|------|
| **마스터 권한** | 모든 자산에 대한 최종 통제권 |
| **에이전트 관리** | Agent Key 등록, 교체, 해제 |
| **긴급 대응** | 에이전트 즉시 중지, 자금 회수 |
| **고액 거래 승인** | threshold 초과 거래에 대한 공동 서명 |

#### 5.2.2 Agent Key (Nitro Enclave)

| 역할 | 설명 |
|------|------|
| **자율 운영** | 정책 범위 내 트랜잭션 자동 서명 |
| **정책 강제** | Enclave 내부에서 정책 검증 후 서명 |
| **키 보호** | TEE 격리로 키 유출 방지 |
| **빠른 응답** | 실시간 거래에 적합한 지연 시간 |

#### 5.2.3 Squads Smart Wallet (온체인 멀티시그)

| 역할 | 설명 |
|------|------|
| **권한 분리** | Owner/Agent 권한을 온체인에서 강제 |
| **지출 한도** | 금액 기반 threshold 적용 |
| **시간 잠금** | 고액 거래에 대한 지연 실행 |
| **투명성** | 모든 정책이 온체인에 기록 |

### 5.3 하이브리드 접근법의 이점

```
┌─────────────────────────────────────────────────────────────┐
│                      이점 분석                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ 1. 단일 장애점 제거                                         │
│    - Agent 침해 → Owner가 즉시 중지                         │
│    - Owner 분실 → Time-locked recovery                      │
│    - 서버 장애 → 온체인 정책으로 안전 모드                  │
│                                                             │
│ 2. 계층적 보안                                              │
│    - 1차: Enclave 하드웨어 격리                             │
│    - 2차: KMS 암호화 + IAM 접근 제어                        │
│    - 3차: 온체인 멀티시그 정책                              │
│                                                             │
│ 3. 유연한 정책 적용                                         │
│    - 소액: Agent 단독 서명 (빠른 실행)                      │
│    - 고액: Owner + Agent 공동 서명 (추가 검증)              │
│    - 긴급: Owner 단독으로 에이전트 중지                     │
│                                                             │
│ 4. 규제 대응                                                │
│    - 비수탁 모델로 규제 적용 최소화                         │
│    - 완전한 감사 로그 (CloudTrail + 온체인)                 │
│    - 필요시 정책 조정으로 규제 준수                         │
│                                                             │
│ 5. 비용 효율성                                              │
│    - KMS: ~$10/월 (10만 요청 기준)                          │
│    - Nitro: EC2 비용만 (추가 비용 없음)                     │
│    - Squads: 온체인 트랜잭션 비용만                         │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 5.4 위험 완화 전략

| 위험 | 완화 전략 |
|------|----------|
| **Agent Key 유출** | TEE 격리 + 단독 서명 불가 (Squads threshold) |
| **Owner Key 분실** | IAM 역할 분리 + Time-locked recovery |
| **서버 장애** | 다중 AZ 배포 + 온체인 안전 모드 |
| **Enclave 침해** | Attestation 검증 + PCR 화이트리스트 |
| **정책 우회** | 서버 + 온체인 이중 검증 |

---

## 6. 결론 및 권장사항

### 6.1 커스터디 모델 권장

| 순위 | 모델 | AI 에이전트 적합성 | 권장 이유 |
|------|------|-------------------|----------|
| **1** | **하이브리드 (KMS+TEE+멀티시그)** | ★★★★★ | 보안, 자율성, 통제의 균형 |
| 2 | MPC-TSS | ★★★★☆ | 단일 장애점 제거, 단 운영 복잡 |
| 3 | Non-Custodial | ★★★☆☆ | 자율성 높음, 단 보안 위험 |
| 4 | Custodial | ★★☆☆☆ | 규제 준수 용이, 단 자율성 제한 |

### 6.2 직접 구축 옵션 권장

| 구성 요소 | 권장 기술 | 역할 |
|----------|----------|------|
| **Owner Key** | AWS KMS (ED25519) | 마스터 권한, 긴급 대응 |
| **Agent Key** | AWS Nitro Enclaves | 자율 운영, 정책 강제 |
| **온체인 정책** | Squads Protocol v4 | 권한 분리, 지출 한도 |

### 6.3 향후 단계

1. **Phase 3**: Dual Key 아키텍처 상세 설계
2. **Phase 4**: 정책 엔진 구현 (금액 한도, 화이트리스트, 시간 제어)
3. **PoC**: KMS + Nitro Enclave 통합 프로토타입

---

## 7. 참조 문서

- [02-RESEARCH.md](../phases/02-custody-model/02-RESEARCH.md): 커스터디 모델 리서치 결과
- [02-CONTEXT.md](../phases/02-custody-model/02-CONTEXT.md): Phase 2 컨텍스트 및 결정 사항
- [AWS KMS ED25519 발표](https://aws.amazon.com/about-aws/whats-new/2025/11/aws-kms-edwards-curve-digital-signature-algorithm/)
- [Squads Protocol v4](https://github.com/Squads-Protocol/v4)
- [AWS Nitro Enclaves Coinbase 사례](https://aws.amazon.com/blogs/web3/powering-programmable-crypto-wallets-at-coinbase-with-aws-nitro-enclaves/)

---

*문서 ID: CUST-01*
*작성: 2026-02-04*
*Phase: 02-custody-model*
