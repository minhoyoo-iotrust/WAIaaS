# AI Agent Wallet-as-a-Service 도메인 함정 분석

**프로젝트:** WAIaaS (AI Agent Wallet-as-a-Service)
**연구 일자:** 2026-02-04
**신뢰도:** MEDIUM (WebSearch 및 공식 문서 교차 검증)

---

## 개요

이 문서는 AI 에이전트 지갑 서비스 개발 시 흔히 범하는 실수와 치명적인 함정을 분석합니다. 각 함정에 대해 경고 신호, 예방 전략, 관련 개발 단계를 명시합니다.

---

## 치명적 함정 (Critical Pitfalls)

재작성이나 심각한 보안 사고를 유발하는 실수들입니다.

### 함정 1: 프롬프트 인젝션을 통한 비인가 트랜잭션

**문제 설명:**
AI 에이전트는 프롬프트 인젝션 공격에 취약합니다. 공격자가 악의적인 프롬프트를 통해 에이전트의 로직과 명령을 변경하여 비인가 거래를 실행할 수 있습니다. 2025-2026년 기준, "salami slicing" 공격처럼 단계적으로 에이전트의 제약 모델을 왜곡시키는 정교한 다단계 공격이 등장했습니다.

**왜 발생하는가:**
- LLM의 본질적 특성: 수신된 모든 콘텐츠가 모델에 의해 명령으로 해석될 수 있음
- "치명적 삼중주(Lethal Trifecta)": 개인 데이터 접근 + 신뢰할 수 없는 토큰 노출 + 유출 벡터의 조합
- 에이전트 프레임워크의 취약점 (예: LangChain CVE-2025-68664 "LangGrinch")

**결과:**
- 에이전트가 사용자 동의 없이 자금 전송
- 환경 변수 및 API 키 탈취
- 전체 지갑 잔고 손실

**경고 신호:**
- 에이전트가 예상치 못한 트랜잭션을 생성
- 로그에서 비정상적인 외부 데이터 소스 접근 패턴
- 에이전트 응답에서 정책 우회 시도 흔적

**예방 전략:**
1. LLM 출력을 절대 신뢰하지 않음 - 모든 트랜잭션 요청에 대해 독립적 검증
2. 트랜잭션 서명 전 화이트리스트 기반 명령어 필터링
3. 중요 작업에 대한 Human-in-the-loop 필수화
4. AI 방화벽 및 런타임 보안 도구 도입

**관련 단계:** Phase 1 (핵심 아키텍처), Phase 2 (에이전트 인증)

---

### 함정 2: 개인 키 노출 및 중앙화된 키 저장

**문제 설명:**
2025년 1분기 손실의 88%가 개인 키 침해로 인한 것이었습니다. DEXX 사건에서는 중앙화된 키 관리와 부적절한 키 관리로 인해 $3천만 이상이 탈취되었고, 8,620개 이상의 Solana 지갑이 영향을 받았습니다.

**왜 발생하는가:**
- 온라인 지갑의 개인 키가 제공자 서버에 저장
- 클라우드 스토리지에 개인 키 업로드
- Trust Wallet 사건처럼 내부 코드 변조를 통한 백도어 삽입
- 평문으로 개인 키 표시/전송

**결과:**
- 전체 자산 손실
- 복구 불가능한 피해
- 신뢰 붕괴

**경고 신호:**
- 키가 암호화되지 않은 상태로 저장/전송되는 코드
- 단일 서버/서비스에 키 집중
- 키 로테이션 메커니즘 부재

**예방 전략:**
1. MPC(다자간 계산) 또는 TEE(신뢰 실행 환경) 기반 키 관리 도입
2. 키 샤드 자동 갱신(Key Refresh) 구현 - 수 분 간격
3. HSM(하드웨어 보안 모듈) 연동
4. 절대로 평문 키 저장/전송 금지
5. 다중 서명(Multi-sig) 구현

**관련 단계:** Phase 1 (키 관리 아키텍처)

---

### 함정 3: API 키 및 자격 증명 탈취

**문제 설명:**
Trust Wallet 크롬 익스텐션 침해 사건에서 유출된 Chrome Web Store API 키를 통해 악성 익스텐션이 배포되었습니다. LangChain "LangGrinch" 취약점은 환경 변수 전체 탈취, 클라우드 자격 증명, 데이터베이스 연결 문자열, LLM API 키 등을 유출시킬 수 있습니다.

**왜 발생하는가:**
- 정적 자격 증명 사용
- API 키의 불충분한 스코핑
- 공급망 침해를 통한 악성 코드 주입
- 의존성 라이브러리의 보안 취약점

**결과:**
- 무제한 API 남용
- 재정적 손실
- 데이터 유출

**경고 신호:**
- 장기간 변경되지 않는 API 키
- 광범위한 권한을 가진 단일 API 키
- 비정상적인 API 호출 패턴

**예방 전략:**
1. OAuth 2.1 + PKCE 채택 (MCP 표준)
2. 단기 수명 액세스 토큰 사용
3. JIT(Just-In-Time) 자격 증명 발급
4. HashiCorp Vault 등 동적 시크릿 관리 도입
5. 에이전트별 고유 자격 증명 할당
6. 자동 키 로테이션 구현

**관련 단계:** Phase 1 (인프라), Phase 2 (인증 시스템)

---

### 함정 4: 과도하게 광범위한 권한 부여

**문제 설명:**
대부분의 현재 구현에서 OAuth 토큰에 `gmail.readonly`나 `gmail.compose` 같은 광범위한 스코프가 부여됩니다. 에이전트가 "지난 주 이메일 요약"을 요청받아도 기술적으로 3년 전 기밀 HR 폴더의 이메일까지 읽을 수 있습니다.

**왜 발생하는가:**
- 편의성을 위한 광범위한 권한 부여
- 세분화된 권한 모델 설계의 복잡성
- 최소 권한 원칙 미적용

**결과:**
- 에이전트의 의도치 않은 자산 접근
- 데이터 유출
- 규정 위반

**경고 신호:**
- 단일 권한으로 모든 작업 수행 가능
- 권한 요청 시 구체적 범위 미지정
- 작업별 권한 분리 없음

**예방 전략:**
1. 최소 권한 원칙 엄격 적용
2. 작업별 세분화된 권한 스코프 정의
3. 트랜잭션 금액/수신자/시간 제한 설정
4. RAR(Rich Authorization Requests) 활용
5. 정책 기반 권한 시스템 구현
6. 즉각적인 권한 해제 메커니즘

**관련 단계:** Phase 2 (권한 모델), Phase 3 (정책 엔진)

---

### 함정 5: 트랜잭션 제어 부재

**문제 설명:**
AI 에이전트의 작은 오정렬이 수천 번의 반복적인 API 호출, 업데이트, 이메일, 데이터 쓰기로 확대될 수 있습니다. 명확한 제한 없이 자율 루프가 파괴적으로 변할 수 있습니다.

**왜 발생하는가:**
- 속도 제한(Rate Limiting) 미구현
- 지출 한도 미설정
- 트랜잭션 검증 단계 생략

**결과:**
- 의도치 않은 대량 자금 이동
- 리소스 고갈
- 서비스 중단

**경고 신호:**
- 단시간 내 비정상적으로 많은 트랜잭션
- 점진적으로 증가하는 트랜잭션 금액
- 검증 없는 자동 승인 로직

**예방 전략:**
1. 지출 한도 구현 (일일/주간/월간)
2. 트랜잭션별 금액 제한
3. 토큰 버킷 알고리즘 기반 속도 제한
4. 중간 규모 트랜잭션에 대한 확인 요구
5. 되돌릴 수 없는 작업에 Human-in-the-loop 필수
6. 비용 기반 추적으로 리소스 고갈 방지
7. Google AP2 프로토콜 같은 "Mandate" 기반 승인 체계 검토

**관련 단계:** Phase 2 (트랜잭션 정책), Phase 3 (제어 시스템)

---

### 함정 6: 주인(Owner) 자금 회수 메커니즘 부재

**문제 설명:**
AI 에이전트가 자율적으로 지갑을 소유할 때, 주인(사람)이 언제든지 자금을 안전하게 회수할 수 있는 메커니즘이 없으면 자금이 영구적으로 잠길 수 있습니다.

**왜 발생하는가:**
- 에이전트 자율성에만 집중하고 소유자 권한 설계 누락
- 비상 복구 시나리오 미고려
- 에이전트 오작동/중단 시나리오 미대비

**결과:**
- 에이전트 장애 시 자금 영구 손실
- 법적 분쟁
- 사용자 신뢰 상실

**경고 신호:**
- 소유자 전용 회수 함수 부재
- 비상 탈출 메커니즘 미설계
- 에이전트 키만으로 모든 작업 가능

**예방 전략:**
1. 소유자 전용 회수(withdraw) 함수 구현
2. 타임락(Timelock) 기반 비상 회수 메커니즘
3. 다중 서명 기반 회수 경로
4. 에이전트 키와 별개의 소유자 키 체계
5. 스마트 컨트랙트에 "pause" 및 "emergency withdraw" 기능 내장

**관련 단계:** Phase 1 (핵심 컨트랙트), Phase 2 (소유자 권한)

---

## 중대한 함정 (Moderate Pitfalls)

지연이나 기술 부채를 유발하는 실수들입니다.

### 함정 7: Solana 계정 검증 실패

**문제 설명:**
Solana의 163개 보안 감사 분석 결과, 심각한 이슈의 85.5%가 비즈니스 로직, 권한, 검증 오류에서 발생했습니다. Solana에서는 어떤 계정이든 프로그램 함수에 전달될 수 있어, 엄격한 검증 없이는 악의적 입력에 취약합니다.

**왜 발생하는가:**
- EVM 개발자가 Solana 특성 미숙지
- 계정 소유권 검증 누락
- PDA(Program Derived Address) 오용

**결과:**
- 비인가 계정 접근
- 프로토콜 조작
- 자금 탈취

**예방 전략:**
1. 모든 계정에 대해 소유권, 타입, 주소, 관계 검증
2. 서명자 검사 필수
3. `get_associated_token_address`로 ATA 검증
4. Anchor 프레임워크의 제약 시스템 활용
5. Soteria 같은 보안 분석 도구 사용

**관련 단계:** Phase 1 (Solana 프로그램 개발)

---

### 함정 8: SPL 토큰 및 ATA 처리 오류

**문제 설명:**
Solana의 Associated Token Account(ATA) 시스템은 EVM과 완전히 다릅니다. ATA를 토큰 계정의 소유자로 설정하면 토큰을 영구 손실할 수 있으며, 중첩 ATA 문제로 자금이 잠길 수 있습니다.

**왜 발생하는가:**
- "사용자당 민트당 하나의 계정" 모델 미이해
- ATA가 PDA라서 개인 키가 없다는 점 간과
- 닫힌 ATA로 토큰 전송

**결과:**
- 토큰 영구 손실
- 복구 불가능한 자금
- 사용자 불만

**예방 전략:**
1. ATA를 절대 토큰 계정의 소유자로 설정 금지
2. 토큰 전송 시 동일 민트 주소 확인
3. ATA 존재 여부 확인 후 생성
4. 시스템 프로그램 주소만 지갑 주소로 수용
5. RecoverNested 명령어 이해 및 활용

**관련 단계:** Phase 1 (토큰 처리 로직)

---

### 함정 9: MPC 구현 실수

**문제 설명:**
MPC 프로토콜은 복잡하며, 구현, 오케스트레이션, 무작위성의 엔지니어링 실수가 보안을 훼손할 수 있습니다. 복구 복잡성, 지연 시간, 벤더 종속 문제도 존재합니다.

**왜 발생하는가:**
- MPC가 단일 시드 구문과 달리 다자간 조정 필요
- 고지연/불안정 네트워크에서 다중 라운드 프로토콜 문제
- 벤더 간 상호 운용성 부재

**결과:**
- 보안 약화
- 운영 지연 (트랜잭션당 100-500ms 추가)
- 벤더 변경 시 재키잉 필요

**예방 전략:**
1. 프로덕션 시스템 철저한 감사
2. 첫날부터 다중 복구 경로 구축
3. 지역별 서명자 배치로 지연 최소화
4. 보안 임계값과 운영 연속성 균형
5. 키 갱신(Key Refresh) 메커니즘 구현

**관련 단계:** Phase 1 (키 관리), Phase 2 (복구 시스템)

---

### 함정 10: 에이전트 프레임워크 공급망 공격

**문제 설명:**
Barracuda Security 보고서(2025년 11월)에서 공급망 침해로 취약점이 내장된 43개의 에이전트 프레임워크 컴포넌트가 확인되었습니다. 악의적 기여자가 인기 있는 MCP 서버 라이브러리에 백도어를 삽입하면, 해당 라이브러리를 사용하는 모든 에이전트가 은밀한 데이터 유출 채널을 갖게 됩니다.

**왜 발생하는가:**
- 오픈소스 의존성의 광범위한 사용
- 의존성 버전 고정 미실시
- 제3자 라이브러리 보안 검토 부재

**결과:**
- 시크릿 유출
- 명령어 주입
- 원격 코드 실행

**예방 전략:**
1. 의존성 버전 고정 및 정기 감사
2. langchain-core 즉시 업그레이드 (1.2.5 또는 0.3.81)
3. 스트리밍/로그의 역직렬화 감사
4. 입력 검증 없이 시크릿 해결 비활성화
5. SBOM(소프트웨어 자재 명세서) 관리

**관련 단계:** Phase 1 (의존성 관리), 전 단계 (지속적 모니터링)

---

### 함정 11: 감사 추적 부재

**문제 설명:**
에이전트 행동이 일반 시스템 활동과 섞이면, 문제 조사가 추측에 의존하게 됩니다. 각 행동을 올바른 사람이나 에이전트에 명확하게 귀속시키는 로그가 필요합니다.

**왜 발생하는가:**
- 로깅 시스템 설계 시 에이전트 행위자 미고려
- 사용자와 에이전트 행동 미구분
- 불충분한 메타데이터 기록

**결과:**
- 사고 조사 불가
- 규정 준수 실패
- 책임 소재 불명확

**예방 전략:**
1. 전용 에이전트 ID 및 감사 로그 구현
2. 모든 트랜잭션에 행위자 귀속 메타데이터 포함
3. 불변 로그 저장소 사용
4. 실시간 모니터링 대시보드 구축

**관련 단계:** Phase 2 (로깅 시스템), Phase 3 (규정 준수)

---

## 경미한 함정 (Minor Pitfalls)

불편을 유발하지만 수정 가능한 실수들입니다.

### 함정 12: 규정 준수 지연

**문제 설명:**
2026년까지 EU MiCA가 활성 시행되며, 디지털 자산 서비스 제공자는 전통 은행과 동일한 AML/KYC 표준을 충족해야 합니다. 규정 위반 시 평균 380만 달러의 벌금이 부과됩니다.

**왜 발생하는가:**
- "나중에 하자" 태도
- 규제 환경의 빠른 변화 미추적
- 지갑 제공자의 자금 세탁 방지 의무 인식 부족

**예방 전략:**
1. 초기 단계부터 KYC/AML 통합 계획
2. Chainalysis, TRM Labs 등 블록체인 분석 플랫폼 연동
3. Travel Rule 준수 체계 구축
4. 법률 자문 조기 확보

**관련 단계:** Phase 3 (규정 준수), Phase 1 (아키텍처 계획)

---

### 함정 13: 사용자 복구 경험 복잡성

**문제 설명:**
사용자는 기기를 잃어버리고 자격 증명을 잊어버립니다. MPC의 경우 키 샤드 복구가 여러 당사자 또는 복구 서비스 조정을 필요로 합니다.

**왜 발생하는가:**
- 복구 시나리오 사용자 테스트 부족
- 단일 복구 경로만 제공
- 복구 과정의 UX 미고려

**예방 전략:**
1. 다중 복구 경로 제공 (소셜 복구, 백업 키 등)
2. 복구 과정 단계별 안내 UX
3. TEE 기반 정교한 복구 흐름 검토
4. 정기적인 복구 테스트 권장

**관련 단계:** Phase 2 (복구 시스템), Phase 3 (UX 개선)

---

### 함정 14: 멀티 에이전트 신뢰 악용

**문제 설명:**
에이전트 간 신뢰를 악용하여 공격자가 AI 피드백 루프를 생성할 수 있습니다. Agent A가 Agent B에게 더 많은 권한을 부여하고, 그 반대도 마찬가지로 발생하여 둘 다 안전 제약에서 벗어날 수 있습니다.

**왜 발생하는가:**
- 에이전트 간 통신의 암묵적 신뢰
- 권한 상승 검증 부재
- 피드백 루프 감지 메커니즘 없음

**예방 전략:**
1. 에이전트 간 제로 트러스트 원칙 적용
2. 권한 상승 요청 독립 검증
3. 순환 참조 및 피드백 루프 감지 로직
4. 에이전트별 격리된 권한 경계

**관련 단계:** Phase 3 (멀티 에이전트 시나리오)

---

## 단계별 함정 경고

| 개발 단계 | 주요 함정 | 완화 전략 |
|-----------|-----------|-----------|
| Phase 1: 핵심 인프라 | 키 노출, Solana 계정 검증, ATA 오류 | MPC/TEE 키 관리, 철저한 계정 검증, ATA 처리 규칙 준수 |
| Phase 2: 에이전트 인증 | 프롬프트 인젝션, 과도한 권한, API 키 탈취 | OAuth 2.1, 세분화된 권한, 동적 시크릿 관리 |
| Phase 3: 트랜잭션 제어 | 제어 부재, 감사 추적 부재, 자율 루프 | 지출 한도, 속도 제한, 포괄적 로깅 |
| Phase 4: 소유자 기능 | 자금 회수 불가, 복구 복잡성 | 비상 회수 메커니즘, 다중 복구 경로 |
| Phase 5: 규정 준수 | KYC/AML 미준수, Travel Rule 위반 | 조기 규정 준수 계획, 블록체인 분석 도구 연동 |
| 전 단계 | 공급망 공격, 프레임워크 취약점 | 의존성 감사, 버전 고정, 보안 패치 즉시 적용 |

---

## 핵심 교훈 요약

1. **아무것도 신뢰하지 마라**: LLM 출력, 전달된 계정, 서명자, 데이터 모두 명시적으로 검증
2. **최소 권한 원칙**: 에이전트에게 필요한 최소한의 권한만 부여
3. **다층 방어**: 단일 보안 계층에 의존하지 말고 여러 계층의 보호 구현
4. **소유자 우선**: 에이전트 자율성보다 소유자의 자금 통제권 우선
5. **조기 규정 준수**: 규정 준수를 나중으로 미루지 말고 초기부터 계획
6. **지속적 감시**: 에이전트 행동에 대한 실시간 모니터링 및 이상 탐지
7. **복구 우선 설계**: 장애 시나리오를 먼저 고려하고 복구 메커니즘 설계

---

## 출처

### 고신뢰도 (HIGH Confidence)
- [Solana Security Ecosystem Review 2025](https://solanasec25.sec3.dev/)
- [Helius - Hitchhiker's Guide to Solana Program Security](https://www.helius.dev/blog/a-hitchhikers-guide-to-solana-program-security)
- [Sec3 - Two Caveats of SPL Associated Token Account](https://www.sec3.dev/blog/two-caveats-spl)
- [Cantina - Securing Solana Developer Guide](https://cantina.xyz/blog/securing-solana-a-developers-guide)

### 중신뢰도 (MEDIUM Confidence)
- [Cointelegraph - AI agents crypto vulnerability](https://cointelegraph.com/news/ai-agents-poised-crypto-major-vulnerability)
- [Airia - AI Security 2026 Prompt Injection](https://airia.com/ai-security-in-2026-prompt-injection-the-lethal-trifecta-and-how-to-defend/)
- [OWASP AI Agent Security Top 10 2026](https://medium.com/@oracle_43885/owasps-ai-agent-security-top-10-agent-security-risks-2026-fc5c435e86eb)
- [Stytch - Agent-to-agent OAuth Guide](https://stytch.com/blog/agent-to-agent-oauth-guide/)
- [WorkOS - OAuth for AI Agents 2025](https://workos.com/blog/best-oauth-oidc-providers-for-authenticating-ai-agents-2025)
- [Alchemy - MPC Wallets Guide 2025](https://www.alchemy.com/overviews/what-is-a-multi-party-computation-mpc-wallet)
- [Google Cloud - Agent Payments Protocol AP2](https://cloud.google.com/blog/products/ai-machine-learning/announcing-agents-to-payments-ap2-protocol)
- [LangChain LangGrinch CVE-2025-68664](https://cyata.ai/blog/langgrinch-langchain-core-cve-2025-68664/)
- [TRM Labs - Crypto AML Compliance 2026](https://www.trmlabs.com/resources/blog/what-is-the-best-crypto-aml-and-compliance-solution-in-2026)
- [KYC Chain - 2026 Compliance Trends](https://kyc-chain.com/kyc-aml-trends-2026/)

### 저신뢰도 (LOW Confidence - 추가 검증 필요)
- [Medium - AI Agents Want Your Crypto Wallet](https://medium.com/@casi.borg/ai-agents-want-your-crypto-wallet-but-can-you-trust-them-46cdef42134a)
- [AInvest - Crypto 2025 Security Collapse](https://www.ainvest.com/news/crypto-2025-security-collapse-lessons-opportunities-2026-2512/)
