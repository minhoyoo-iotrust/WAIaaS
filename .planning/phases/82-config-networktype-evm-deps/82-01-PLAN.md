---
phase: 82-config-networktype-evm-deps
plan: 01
type: tdd
wave: 1
depends_on: []
files_modified:
  - packages/core/src/enums/chain.ts
  - packages/core/src/enums/index.ts
  - packages/core/src/__tests__/enums.test.ts
  - packages/adapters/evm/src/evm-chain-map.ts
  - packages/adapters/evm/src/index.ts
  - packages/adapters/evm/src/__tests__/evm-chain-map.test.ts
autonomous: true

must_haves:
  truths:
    - "NETWORK_TYPES contains 13 values (3 Solana + 10 EVM)"
    - "EVM_NETWORK_TYPES contains exactly 10 EVM network values"
    - "EvmNetworkTypeEnum validates EVM networks and rejects Solana values"
    - "EVM_CHAIN_MAP maps all 10 EVM networks to viem Chain + chainId + nativeSymbol + nativeName"
    - "validateChainNetwork rejects invalid cross-chain combos with descriptive error"
    - "validateChainNetwork accepts all valid chain+network pairs"
  artifacts:
    - path: "packages/core/src/enums/chain.ts"
      provides: "NETWORK_TYPES (13), EVM_NETWORK_TYPES (10), EvmNetworkTypeEnum, SOLANA_NETWORK_TYPES, validateChainNetwork"
      contains: "EVM_NETWORK_TYPES"
    - path: "packages/adapters/evm/src/evm-chain-map.ts"
      provides: "EVM_CHAIN_MAP constant + EvmChainEntry type"
      contains: "EVM_CHAIN_MAP"
    - path: "packages/core/src/__tests__/enums.test.ts"
      provides: "Updated enum count + validateChainNetwork tests"
    - path: "packages/adapters/evm/src/__tests__/evm-chain-map.test.ts"
      provides: "EVM_CHAIN_MAP completeness + nativeSymbol tests"
  key_links:
    - from: "packages/core/src/enums/chain.ts"
      to: "packages/core/src/enums/index.ts"
      via: "re-export EVM_NETWORK_TYPES, EvmNetworkTypeEnum, SOLANA_NETWORK_TYPES, validateChainNetwork"
      pattern: "export.*EVM_NETWORK_TYPES"
    - from: "packages/adapters/evm/src/evm-chain-map.ts"
      to: "packages/adapters/evm/src/index.ts"
      via: "re-export EVM_CHAIN_MAP"
      pattern: "export.*EVM_CHAIN_MAP"
---

<objective>
Extend NetworkType enum with 10 EVM networks, create EVM_CHAIN_MAP mapping table, and implement validateChainNetwork cross-validation function.

Purpose: Foundation enums and mappings that all subsequent Phase 82 work depends on. NetworkType is the SSoT that flows into DB CHECK constraints, Zod schemas, config validation, and agent creation. EVM_CHAIN_MAP provides viem Chain objects needed by AdapterPool in Phase 84.

Output: Extended chain.ts with 13 NetworkTypes + validation function, evm-chain-map.ts with 10-network mapping, comprehensive tests.
</objective>

<execution_context>
@/Users/minho.yoo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/minho.yoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@packages/core/src/enums/chain.ts
@packages/core/src/enums/index.ts
@packages/core/src/__tests__/enums.test.ts
@packages/adapters/evm/src/index.ts
@packages/adapters/evm/src/adapter.ts
@objectives/v1.4.1-evm-wallet-infrastructure.md (section 4: NetworkType extension, EVM chain list)
</context>

<tasks>

<task type="auto">
  <name>Task 1: NetworkType enum extension + validateChainNetwork TDD</name>
  <files>
    packages/core/src/enums/chain.ts
    packages/core/src/enums/index.ts
    packages/core/src/__tests__/enums.test.ts
  </files>
  <action>
**RED phase -- write tests first in enums.test.ts:**

1. Update existing `NetworkType has 3 values` test to `NetworkType has 13 values` and verify all 13 values are present (3 Solana: mainnet, devnet, testnet + 10 EVM: ethereum-mainnet, ethereum-sepolia, polygon-mainnet, polygon-amoy, arbitrum-mainnet, arbitrum-sepolia, optimism-mainnet, optimism-sepolia, base-mainnet, base-sepolia).

2. Add new test block `EVM NetworkType subset`:
   - `EVM_NETWORK_TYPES has 10 values` -- verify exact 10 EVM network values
   - `EvmNetworkTypeEnum validates EVM networks` -- test parse succeeds for 'ethereum-sepolia', fails for 'devnet'
   - `SOLANA_NETWORK_TYPES has 3 values` -- verify mainnet, devnet, testnet
   - `every EVM network is in NETWORK_TYPES` -- confirm EVM_NETWORK_TYPES is a subset

3. Add test block `validateChainNetwork`:
   - Valid pairs pass: `('solana', 'devnet')`, `('solana', 'mainnet')`, `('ethereum', 'ethereum-sepolia')`, `('ethereum', 'polygon-mainnet')`, `('ethereum', 'base-mainnet')`
   - Invalid cross-chain combos throw/return error: `('solana', 'ethereum-sepolia')`, `('ethereum', 'devnet')`, `('ethereum', 'mainnet')`, `('ethereum', 'testnet')`
   - Invalid network values throw: `('solana', 'polygon-mainnet')`, `('ethereum', 'nonexistent')`

Run tests -- they MUST fail (RED).

**GREEN phase -- implement in chain.ts:**

1. Extend `NETWORK_TYPES` to 13 values:
```typescript
export const NETWORK_TYPES = [
  // Solana
  'mainnet', 'devnet', 'testnet',
  // EVM Tier 1
  'ethereum-mainnet', 'ethereum-sepolia',
  'polygon-mainnet', 'polygon-amoy',
  'arbitrum-mainnet', 'arbitrum-sepolia',
  'optimism-mainnet', 'optimism-sepolia',
  'base-mainnet', 'base-sepolia',
] as const;
```

2. Add EVM and Solana subsets:
```typescript
export const SOLANA_NETWORK_TYPES = ['mainnet', 'devnet', 'testnet'] as const;
export type SolanaNetworkType = (typeof SOLANA_NETWORK_TYPES)[number];

export const EVM_NETWORK_TYPES = [
  'ethereum-mainnet', 'ethereum-sepolia',
  'polygon-mainnet', 'polygon-amoy',
  'arbitrum-mainnet', 'arbitrum-sepolia',
  'optimism-mainnet', 'optimism-sepolia',
  'base-mainnet', 'base-sepolia',
] as const;
export type EvmNetworkType = (typeof EVM_NETWORK_TYPES)[number];
export const EvmNetworkTypeEnum = z.enum(EVM_NETWORK_TYPES);
```

3. Implement `validateChainNetwork()`:
```typescript
/**
 * Cross-validate chain + network combination.
 * Solana agents must use Solana networks (mainnet/devnet/testnet).
 * Ethereum agents must use EVM networks (ethereum-mainnet etc).
 * Throws WAIaaSError('VALIDATION_ERROR') on mismatch.
 */
export function validateChainNetwork(chain: ChainType, network: NetworkType): void {
  if (chain === 'solana') {
    if (!(SOLANA_NETWORK_TYPES as readonly string[]).includes(network)) {
      throw new Error(`Invalid network '${network}' for chain 'solana'. Valid: ${SOLANA_NETWORK_TYPES.join(', ')}`);
    }
  } else if (chain === 'ethereum') {
    if (!(EVM_NETWORK_TYPES as readonly string[]).includes(network)) {
      throw new Error(`Invalid network '${network}' for chain 'ethereum'. Valid EVM networks: ${EVM_NETWORK_TYPES.join(', ')}`);
    }
  }
}
```

Note: Use plain `Error` (not WAIaaSError) to keep @waiaas/core free of circular deps. The caller (daemon route) converts to WAIaaSError('VALIDATION_ERROR').

4. Update `enums/index.ts` to re-export: `EVM_NETWORK_TYPES`, `EvmNetworkType`, `EvmNetworkTypeEnum`, `SOLANA_NETWORK_TYPES`, `SolanaNetworkType`, `validateChainNetwork`.

Run tests -- they MUST pass (GREEN).
  </action>
  <verify>
Run `cd packages/core && npx vitest run src/__tests__/enums.test.ts` -- all tests pass including new NetworkType 13 count, EVM subset, and validateChainNetwork tests.
  </verify>
  <done>
NETWORK_TYPES has 13 values, EVM_NETWORK_TYPES has 10 values, SOLANA_NETWORK_TYPES has 3 values, EvmNetworkTypeEnum validates correctly, validateChainNetwork rejects invalid combos and accepts valid ones.
  </done>
</task>

<task type="auto">
  <name>Task 2: EVM_CHAIN_MAP mapping table TDD</name>
  <files>
    packages/adapters/evm/src/evm-chain-map.ts
    packages/adapters/evm/src/index.ts
    packages/adapters/evm/src/__tests__/evm-chain-map.test.ts
  </files>
  <action>
**RED phase -- write tests first in evm-chain-map.test.ts:**

1. Import from `../evm-chain-map.js` (will not exist yet).

2. Test `EVM_CHAIN_MAP completeness`:
   - Has exactly 10 entries (one per EVM network)
   - Keys match EVM_NETWORK_TYPES exactly (import from @waiaas/core to compare)

3. Test `each entry has required fields`:
   - For each entry: `viemChain` is defined and has `id` property (number), `chainId` is positive number, `nativeSymbol` is non-empty string, `nativeName` is non-empty string

4. Test `specific chain values`:
   - `ethereum-mainnet`: chainId=1, nativeSymbol='ETH', nativeName='Ether'
   - `polygon-mainnet`: chainId=137, nativeSymbol='POL', nativeName='POL'
   - `polygon-amoy`: chainId=80002, nativeSymbol='POL', nativeName='POL'
   - `arbitrum-mainnet`: chainId=42161, nativeSymbol='ETH', nativeName='Ether'
   - `optimism-mainnet`: chainId=10, nativeSymbol='ETH', nativeName='Ether'
   - `base-mainnet`: chainId=8453, nativeSymbol='ETH', nativeName='Ether'
   - `ethereum-sepolia`: chainId=11155111, nativeSymbol='ETH', nativeName='Ether'
   - `arbitrum-sepolia`: chainId=421614, nativeSymbol='ETH', nativeName='Ether'
   - `optimism-sepolia`: chainId=11155420, nativeSymbol='ETH', nativeName='Ether'
   - `base-sepolia`: chainId=84532, nativeSymbol='ETH', nativeName='Ether'

5. Test `viemChain.id matches chainId`:
   - For each entry: `entry.viemChain.id === entry.chainId`

Run tests -- they MUST fail (RED).

**GREEN phase -- implement in evm-chain-map.ts:**

```typescript
import type { Chain } from 'viem';
import {
  mainnet, sepolia,
  polygon, polygonAmoy,
  arbitrum, arbitrumSepolia,
  optimism, optimismSepolia,
  base, baseSepolia,
} from 'viem/chains';
import type { EvmNetworkType } from '@waiaas/core';

export interface EvmChainEntry {
  viemChain: Chain;
  chainId: number;
  nativeSymbol: string;
  nativeName: string;
}

export const EVM_CHAIN_MAP: Record<EvmNetworkType, EvmChainEntry> = {
  'ethereum-mainnet': { viemChain: mainnet, chainId: 1, nativeSymbol: 'ETH', nativeName: 'Ether' },
  'ethereum-sepolia': { viemChain: sepolia, chainId: 11155111, nativeSymbol: 'ETH', nativeName: 'Ether' },
  'polygon-mainnet': { viemChain: polygon, chainId: 137, nativeSymbol: 'POL', nativeName: 'POL' },
  'polygon-amoy': { viemChain: polygonAmoy, chainId: 80002, nativeSymbol: 'POL', nativeName: 'POL' },
  'arbitrum-mainnet': { viemChain: arbitrum, chainId: 42161, nativeSymbol: 'ETH', nativeName: 'Ether' },
  'arbitrum-sepolia': { viemChain: arbitrumSepolia, chainId: 421614, nativeSymbol: 'ETH', nativeName: 'Ether' },
  'optimism-mainnet': { viemChain: optimism, chainId: 10, nativeSymbol: 'ETH', nativeName: 'Ether' },
  'optimism-sepolia': { viemChain: optimismSepolia, chainId: 11155420, nativeSymbol: 'ETH', nativeName: 'Ether' },
  'base-mainnet': { viemChain: base, chainId: 8453, nativeSymbol: 'ETH', nativeName: 'Ether' },
  'base-sepolia': { viemChain: baseSepolia, chainId: 84532, nativeSymbol: 'ETH', nativeName: 'Ether' },
};
```

**IMPORTANT:** Polygon recently rebranded MATIC to POL. Use 'POL' for both nativeSymbol and nativeName on Polygon networks. Verify viem exports `polygonAmoy` (not `polygonMumbai` which is deprecated). If viem version doesn't export `polygonAmoy`, use `defineChain` with chainId 80002.

Update `packages/adapters/evm/src/index.ts` to add:
```typescript
export { EVM_CHAIN_MAP, type EvmChainEntry } from './evm-chain-map.js';
```

Run tests -- they MUST pass (GREEN).
  </action>
  <verify>
Run `cd packages/adapters/evm && npx vitest run src/__tests__/evm-chain-map.test.ts` -- all tests pass.
Also run `cd packages/core && npx vitest run` to confirm no regressions in core package.
  </verify>
  <done>
EVM_CHAIN_MAP has 10 entries mapping each EVM network to viem Chain + chainId + nativeSymbol + nativeName. All chainIds match viem Chain.id values. Polygon uses 'POL' nativeSymbol. Module is exported from @waiaas/adapter-evm.
  </done>
</task>

</tasks>

<verification>
1. `cd packages/core && npx vitest run` -- all core tests pass including updated enum counts
2. `cd packages/adapters/evm && npx vitest run` -- all adapter-evm tests pass including new EVM_CHAIN_MAP tests
3. NETWORK_TYPES.length === 13
4. EVM_NETWORK_TYPES.length === 10
5. validateChainNetwork('solana', 'ethereum-sepolia') throws
6. validateChainNetwork('ethereum', 'devnet') throws
7. validateChainNetwork('ethereum', 'polygon-mainnet') passes
8. EVM_CHAIN_MAP['polygon-mainnet'].nativeSymbol === 'POL'
</verification>

<success_criteria>
- NetworkType SSoT extended with 10 EVM networks (13 total)
- EVM/Solana subsets exported with Zod enum
- validateChainNetwork cross-validates all combinations
- EVM_CHAIN_MAP provides viem Chain + metadata for all 10 networks
- All existing tests pass (no regressions from enum extension)
</success_criteria>

<output>
After completion, create `.planning/phases/82-config-networktype-evm-deps/82-01-SUMMARY.md`
</output>
