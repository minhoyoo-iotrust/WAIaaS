---
phase: 114-cli-quickstart-dx-integration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/quickstart.skill.md
  - skills/wallet.skill.md
  - skills/transactions.skill.md
  - skills/policies.skill.md
autonomous: true

must_haves:
  truths:
    - "quickstart.skill.md가 environment 파라미터 기반 월렛 생성을 반영한다"
    - "wallet.skill.md가 environment/defaultNetwork 기반 스키마 + 신규 엔드포인트를 반영한다"
    - "transactions.skill.md가 network optional 파라미터를 반영한다"
    - "policies.skill.md가 ALLOWED_NETWORKS 11번째 정책 타입과 network 스코프를 반영한다"
    - "4개 스킬 파일의 version이 1.4.6으로 업데이트된다"
  artifacts:
    - path: "skills/quickstart.skill.md"
      provides: "환경 모델 기반 quickstart 가이드"
      contains: "environment"
    - path: "skills/wallet.skill.md"
      provides: "환경 모델 기반 월렛 관리 가이드"
      contains: "default-network"
    - path: "skills/transactions.skill.md"
      provides: "network 파라미터 포함 트랜잭션 가이드"
      contains: "network"
    - path: "skills/policies.skill.md"
      provides: "ALLOWED_NETWORKS 포함 정책 가이드"
      contains: "ALLOWED_NETWORKS"
  key_links:
    - from: "skills/quickstart.skill.md"
      to: "POST /v1/wallets"
      via: "environment parameter in request body"
      pattern: "environment.*testnet"
    - from: "skills/wallet.skill.md"
      to: "GET /v1/wallets/:id/networks"
      via: "new endpoint documentation"
      pattern: "networks"
    - from: "skills/policies.skill.md"
      to: "ALLOWED_NETWORKS policy type"
      via: "11th policy type documentation"
      pattern: "ALLOWED_NETWORKS"
---

<objective>
4개 스킬 파일(quickstart, wallet, transactions, policies)을 v1.4.6 멀티체인 환경 모델에 맞춰 동기화하고, 하위호환성이 유지되는지 검증한다.

Purpose: CLAUDE.md Interface Sync 규칙 준수 + AI 에이전트가 최신 API를 정확히 사용할 수 있어야 한다.
Output: 4개 스킬 파일 업데이트
</objective>

<execution_context>
@/Users/minho.yoo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/minho.yoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@skills/quickstart.skill.md
@skills/wallet.skill.md
@skills/transactions.skill.md
@skills/policies.skill.md
@packages/core/src/enums/chain.ts
@packages/core/src/schemas/wallet.schema.ts
@packages/daemon/src/api/routes/openapi-schemas.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: quickstart + wallet 스킬 파일 환경 모델 동기화</name>
  <files>
    skills/quickstart.skill.md
    skills/wallet.skill.md
  </files>
  <action>
    **skills/quickstart.skill.md 업데이트:**

    1. version: "1.4.4" -> "1.4.6"
    2. Step 2 (Create a Wallet) 전면 수정:
       - `network` 파라미터 대신 `environment` 파라미터 사용
       - Solana 예시: `{"name": "my-first-wallet", "chain": "solana", "environment": "testnet"}`
       - EVM 예시: `{"name": "my-eth-wallet", "chain": "ethereum", "environment": "testnet"}`
       - Parameters 설명:
         - `name` (required): 1-100 characters
         - `chain` (optional): `"solana"` (default) or `"ethereum"`
         - `environment` (optional): `"testnet"` (default) or `"mainnet"` -- determines available networks
       - 기존 `network` 파라미터 + 네트워크 목록 설명 제거
       - 응답 예시에 `environment` 필드 추가, `network` -> `defaultNetwork` 표현
    3. Step 4 (Check Balance) + Step 5 (Assets):
       - `?network=devnet` optional query parameter 추가 설명
       - "Optional: Append `?network=<network>` to query a specific network (defaults to the wallet's default network)"
    4. Step 6 (Send Transfer):
       - `network` optional parameter 추가: "Specify target network (defaults to wallet's default network)"
       - 예시 body에 `"network": "devnet"` 추가 (optional이므로 별도 예시 또는 주석)
    5. CLI Quickstart 섹션 추가 (기존 Error Handling 전에):
       ```
       ## CLI Quickstart (Alternative)

       If you have the CLI installed, create wallets in one step:

       ```bash
       waiaas quickstart --mode testnet
       ```

       This creates Solana + EVM wallets and prints MCP configuration.
       ```

    **skills/wallet.skill.md 업데이트:**

    1. version: "1.4.4" -> "1.4.6"
    2. Section 1 (Wallet CRUD):
       - POST /v1/wallets 파라미터: `network` 제거, `environment` 추가
         - `environment` (optional): `"testnet"` (default) or `"mainnet"`
       - 모든 요청/응답 예시에서 `"network": "devnet"` -> `"environment": "testnet"`, `"network"` -> 코어 응답의 `"network"` 유지 (응답에는 defaultNetwork 표시 용도로 network 필드 존재)
       - 응답 스키마에 `environment` 필드 추가 설명
    3. GET /v1/wallet/balance, GET /v1/wallet/assets (Section 2):
       - `?network=<network>` optional query parameter 추가 설명
       - "Query a specific network by appending `?network=devnet`. Defaults to the wallet's default network."
    4. Section 7 (Multi-Chain Notes) 확장:
       - Network Reference 테이블에 Environment 컬럼 추가:
         | Chain | Environment | Default Network | Available Networks |
         - solana:testnet -> default:devnet, available: devnet, testnet
         - solana:mainnet -> default:mainnet, available: mainnet
         - ethereum:testnet -> default:ethereum-sepolia, available: ethereum-sepolia, polygon-amoy, arbitrum-sepolia, optimism-sepolia, base-sepolia
         - ethereum:mainnet -> default:ethereum-mainnet, available: ethereum-mainnet, polygon-mainnet, arbitrum-mainnet, optimism-mainnet, base-mainnet
    5. 신규 엔드포인트 2개 추가 (Section 1 또는 별도 Section):
       - **PUT /v1/wallets/{id}/default-network** -- 기본 네트워크 변경 (masterAuth)
         - body: `{"network": "polygon-mainnet"}`
         - 환경-네트워크 교차 검증 포함
       - **GET /v1/wallets/{id}/networks** -- 사용 가능 네트워크 목록 조회 (masterAuth)
         - 응답: `{"networks": [{"network": "ethereum-sepolia", "isDefault": true}, ...]}`
    6. Error Reference에 추가:
       - `ENVIRONMENT_NETWORK_MISMATCH` | 400 | Network not valid for wallet's environment
  </action>
  <verify>
    skills/quickstart.skill.md에 "environment" 키워드가 포함되어 있고 "network" 파라미터가 생성 요청에서 제거됨.
    skills/wallet.skill.md에 "default-network" 엔드포인트와 "networks" 엔드포인트가 문서화됨.
    두 파일 모두 version: "1.4.6" 포함.
  </verify>
  <done>
    quickstart.skill.md와 wallet.skill.md가 v1.4.6 환경 모델을 정확히 반영하고, 기존 내용과 일관성 유지
  </done>
</task>

<task type="auto">
  <name>Task 2: transactions + policies 스킬 파일 네트워크 파라미터 동기화</name>
  <files>
    skills/transactions.skill.md
    skills/policies.skill.md
  </files>
  <action>
    **skills/transactions.skill.md 업데이트:**

    1. version: "1.4.4" -> "1.4.6"
    2. 모든 5개 트랜잭션 타입 섹션에 `network` optional 파라미터 추가:
       - TRANSFER (Section 2): Parameters에 `network` (optional): string 추가
         - "Target network for this transaction. Defaults to wallet's default network. Must be valid for the wallet's environment."
       - TOKEN_TRANSFER (Section 3): 동일
       - CONTRACT_CALL (Section 4): 동일
       - APPROVE (Section 5): 동일
       - BATCH (Section 6): 동일
    3. 요청 예시에 `"network": "devnet"` optional 필드 주석 추가 (모든 예시에 추가하면 혼란, 하나의 대표 예시만)
    4. Section 7 (Transaction Lifecycle):
       - GET /v1/transactions/{id} 응답에 `"network": "devnet"` 필드 추가
       - GET /v1/transactions 응답 items에 `"network": "devnet"` 필드 추가
    5. Error Reference (Section 9)에 추가:
       - `ENVIRONMENT_NETWORK_MISMATCH` | 400 | Specified network does not belong to wallet's environment

    **skills/policies.skill.md 업데이트:**

    1. version: "1.4.4" -> "1.4.6"
    2. Policy Types를 "10 Types" -> "11 Types"로 변경
    3. Section 2에 11번째 정책 타입 추가 (기존 j. APPROVE_TIER_OVERRIDE 뒤에):
       ```
       ### k. ALLOWED_NETWORKS (v1.4.6)

       Restrict which networks a wallet can use for transactions. Permissive by default: if no ALLOWED_NETWORKS policy exists, all networks valid for the wallet's environment are allowed.

       **Rules schema:**
       ```json
       {
         "networks": [
           {"network": "ethereum-sepolia"},
           {"network": "polygon-amoy", "name": "Polygon Testnet"}
         ]
       }
       ```

       | Field      | Type   | Required | Description                            |
       | ---------- | ------ | -------- | -------------------------------------- |
       | `networks` | array  | Yes      | At least 1 network entry.              |
       | `network`  | string | Yes      | Network identifier (e.g., "ethereum-sepolia"). |
       | `name`     | string | No       | Display name for the network.          |
       ```
    4. POST /v1/policies 파라미터 테이블에 `network` optional 필드 추가:
       - `network` | string | No | Network scope. When set, policy applies only to transactions on this network. Omit for all networks.
    5. Section 3 (Policy Evaluation Flow):
       - Step 1에 "네트워크 스코프 필터링" 추가: 정책의 network 필드가 설정된 경우 해당 네트워크에서만 적용
       - Override 우선순위 설명: wallet+network > wallet+null > global+network > global+null
    6. Section 4 (Common Workflows)에 ALLOWED_NETWORKS 예시 추가:
       ```
       ### Restrict wallet to specific networks

       ```bash
       curl -s -X POST http://localhost:3100/v1/policies \
         -H 'Content-Type: application/json' \
         -H 'Authorization: Bearer <token>' \
         -d '{"walletId":"<uuid>","type":"ALLOWED_NETWORKS","rules":{"networks":[{"network":"ethereum-sepolia"},{"network":"polygon-amoy"}]}}'
       ```
       Transactions to unlisted networks will be blocked with POLICY_VIOLATION.
       ```
    7. Default Deny Policy Types 테이블은 변경하지 않음 -- ALLOWED_NETWORKS는 permissive default이므로 (미설정 시 전체 허용). 별도 참고 문구 추가: "Note: ALLOWED_NETWORKS is permissive by default (all networks allowed until the first ALLOWED_NETWORKS policy is created)."
  </action>
  <verify>
    skills/transactions.skill.md에 "network" optional 파라미터가 5개 타입 모두에 포함됨.
    skills/policies.skill.md에 "ALLOWED_NETWORKS" 정책 타입이 문서화됨.
    두 파일 모두 version: "1.4.6" 포함.
  </verify>
  <done>
    transactions.skill.md에 network 파라미터가 추가되고, policies.skill.md에 ALLOWED_NETWORKS 11번째 정책 타입이 추가되어 v1.4.6 기능을 완전히 반영
  </done>
</task>

</tasks>

<verification>
1. 4개 스킬 파일 모두 version: "1.4.6" 확인
2. quickstart.skill.md: "environment" 검색 -> 존재, 월렛 생성 요청에 network 파라미터 부재
3. wallet.skill.md: "default-network" 및 "networks" 엔드포인트 검색 -> 존재
4. transactions.skill.md: 5개 타입 모두 "network" optional 파라미터 존재
5. policies.skill.md: "ALLOWED_NETWORKS" 및 "11 Types" 검색 -> 존재
6. 모든 스킬 파일의 curl 예시가 유효한 JSON 형식
</verification>

<success_criteria>
- 4개 스킬 파일이 v1.4.6 환경/네트워크 모델을 정확히 반영한다
- quickstart.skill.md에 CLI quickstart 대안 섹션이 추가된다
- wallet.skill.md에 PUT /default-network + GET /networks 엔드포인트가 문서화된다
- transactions.skill.md에 5개 타입 모두 network optional 파라미터가 추가된다
- policies.skill.md에 ALLOWED_NETWORKS 타입 + network 스코프가 문서화된다
- 모든 version이 1.4.6으로 업데이트된다
</success_criteria>

<output>
After completion, create `.planning/phases/114-cli-quickstart-dx-integration/114-02-SUMMARY.md`
</output>
