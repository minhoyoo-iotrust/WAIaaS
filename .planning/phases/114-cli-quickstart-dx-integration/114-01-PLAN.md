---
phase: 114-cli-quickstart-dx-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/cli/src/commands/quickstart.ts
  - packages/cli/src/index.ts
  - packages/cli/src/__tests__/quickstart.test.ts
autonomous: true

must_haves:
  truths:
    - "waiaas quickstart --mode testnet 실행 시 Solana + EVM 2개 월렛이 생성된다"
    - "waiaas quickstart --mode mainnet 실행 시 메인넷 환경의 2개 월렛이 생성된다"
    - "quickstart 출력에 체인별 네트워크 목록 + 주소 + MCP 설정 스니펫이 표시된다"
    - "기본값(--mode 미지정)은 testnet 환경으로 동작한다"
  artifacts:
    - path: "packages/cli/src/commands/quickstart.ts"
      provides: "quickstart 명령 구현"
      min_lines: 80
    - path: "packages/cli/src/index.ts"
      provides: "quickstart 명령 등록"
      contains: "quickstart"
    - path: "packages/cli/src/__tests__/quickstart.test.ts"
      provides: "quickstart 명령 테스트"
      min_lines: 50
  key_links:
    - from: "packages/cli/src/commands/quickstart.ts"
      to: "/v1/wallets"
      via: "POST fetch with environment parameter"
      pattern: "environment.*mode"
    - from: "packages/cli/src/commands/quickstart.ts"
      to: "/v1/wallets/:id/networks"
      via: "GET fetch for network listing"
      pattern: "networks"
    - from: "packages/cli/src/index.ts"
      to: "packages/cli/src/commands/quickstart.ts"
      via: "import and command registration"
      pattern: "quickstartCommand"
---

<objective>
CLI quickstart --mode testnet/mainnet 명령을 구현하여 Solana + EVM 2개 월렛을 일괄 생성하고, 체인별 네트워크/주소 목록 + MCP 설정 스니펫을 출력한다.

Purpose: AI 에이전트 사용자가 단일 명령으로 멀티체인 환경을 원스톱 셋업할 수 있어야 한다.
Output: quickstart.ts 명령 파일, index.ts 등록, 테스트 파일
</objective>

<execution_context>
@/Users/minho.yoo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/minho.yoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@packages/cli/src/index.ts
@packages/cli/src/commands/init.ts
@packages/cli/src/commands/mcp-setup.ts
@packages/cli/src/utils/password.js
@packages/cli/src/utils/slug.js
@packages/core/src/enums/chain.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: quickstart 명령 구현 + CLI 등록</name>
  <files>
    packages/cli/src/commands/quickstart.ts
    packages/cli/src/index.ts
  </files>
  <action>
    **packages/cli/src/commands/quickstart.ts 신규 생성:**

    QuickstartOptions 인터페이스 정의:
    - dataDir: string
    - baseUrl?: string (default: 'http://127.0.0.1:3100')
    - mode?: 'testnet' | 'mainnet' (default: 'testnet')
    - masterPassword?: string
    - expiresIn?: number (default: 86400)

    quickstartCommand(opts: QuickstartOptions) async 함수 구현:

    1. daemon 헬스체크 (GET /health, AbortSignal.timeout(5000))
       - 실패 시: "Error: Cannot reach WAIaaS daemon. Make sure the daemon is running: waiaas start" 출력 후 exit(1)

    2. masterPassword 해결: opts.masterPassword ?? await resolvePassword() (기존 mcp-setup.ts 패턴 재사용)

    3. Solana + EVM 두 체인에 대해 순차적으로 월렛 생성:
       ```
       const chains = [
         { chain: 'solana', name: `solana-${mode}` },
         { chain: 'ethereum', name: `evm-${mode}` },
       ] as const;
       ```
       각 체인에 대해:
       - POST /v1/wallets 호출: body = { name, chain, environment: mode }
       - 응답에서 id, name, chain, environment, publicKey, network 추출
       - GET /v1/wallets/{id}/networks (masterAuth) 호출하여 사용 가능 네트워크 목록 조회
         - 실패 시 빈 배열로 fallback (graceful degradation, 113-01 패턴)
       - MCP 세션 생성: POST /v1/sessions (walletId, ttl: expiresIn)
       - mcp-tokens 파일 쓰기: mcp-setup.ts의 setupWallet 패턴 재사용 (atomic write)

    4. 결과 출력 형식:
       ```
       WAIaaS Quickstart Complete!

       Mode: testnet

       Solana Wallet:
         Name: solana-testnet
         Address: 7xKXtg2CW87d97TXJSDpbD5jBkheTqA83TZRuJosgAsU
         Environment: testnet
         Default Network: devnet
         Available Networks: devnet, testnet

       EVM Wallet:
         Name: evm-testnet
         Address: 0x1234...abcd
         Environment: testnet
         Default Network: ethereum-sepolia
         Available Networks: ethereum-sepolia, polygon-amoy, arbitrum-sepolia, optimism-sepolia, base-sepolia

       MCP Configuration:
       (claude_desktop_config.json에 추가하세요)
       ```
       그 후 두 월렛의 mcpServers config snippet을 JSON.stringify(configSnippet, null, 2)로 출력.
       buildConfigEntry 패턴은 mcp-setup.ts에서 추출하거나 동일 로직을 인라인으로 구현.

       마지막에 printConfigPath() 호출 (플랫폼별 Claude Desktop 설정 파일 경로).

    5. 에러 처리:
       - 월렛 생성 실패 시: "Error: Failed to create {chain} wallet (HTTP {status}): {message}" 출력 후 exit(1)
       - 이미 같은 이름의 월렛이 존재하는 경우: name에 UUID 짧은 접미사 추가하여 충돌 방지 (optional, 에러 메시지로 충분할 수도)

    **packages/cli/src/index.ts 수정:**

    quickstartCommand import 추가:
    ```
    import { quickstartCommand } from './commands/quickstart.js';
    ```

    program에 quickstart 명령 등록:
    ```
    program
      .command('quickstart')
      .description('Create Solana + EVM wallets for quick setup')
      .option('--data-dir <path>', 'Data directory path')
      .option('--base-url <url>', 'Daemon base URL', 'http://127.0.0.1:3100')
      .option('--mode <mode>', 'Environment mode: testnet or mainnet', 'testnet')
      .option('--expires-in <seconds>', 'Session expiration in seconds', '86400')
      .option('--password <password>', 'Master password')
      .action(async (opts) => {
        const dataDir = resolveDataDir(opts);
        await quickstartCommand({
          dataDir,
          baseUrl: opts.baseUrl,
          mode: opts.mode,
          expiresIn: parseInt(opts.expiresIn ?? '86400', 10),
          masterPassword: opts.password,
        });
      });
    ```

    mode는 'testnet' | 'mainnet' 중 하나만 수용. 잘못된 값이면 "Error: --mode must be 'testnet' or 'mainnet'" 출력 후 exit(1).
  </action>
  <verify>
    cd packages/cli && npx tsc --noEmit 으로 타입 체크 통과
  </verify>
  <done>
    quickstart.ts 파일이 존재하고, index.ts에 quickstart 명령이 등록되어 있으며, 빌드 에러 없이 타입 체크 통과
  </done>
</task>

<task type="auto">
  <name>Task 2: quickstart 명령 단위 테스트</name>
  <files>
    packages/cli/src/__tests__/quickstart.test.ts
  </files>
  <action>
    vitest로 quickstart 명령 단위 테스트 작성. global fetch를 vi.fn()으로 모킹.

    기존 mcp-setup.test.ts의 패턴을 따른다 (fetch mock, response 생성 헬퍼 등).

    테스트 케이스:

    1. **testnet 모드 기본 동작**: mode='testnet'으로 호출 시:
       - /health GET 1회
       - POST /v1/wallets 2회 (solana chain + environment:testnet, ethereum chain + environment:testnet)
       - GET /v1/wallets/:id/networks 2회
       - POST /v1/sessions 2회
       - 호출 순서와 파라미터 검증

    2. **mainnet 모드**: mode='mainnet'으로 호출 시:
       - POST /v1/wallets body에 environment:'mainnet' 전달 검증

    3. **mode 미지정 시 testnet 기본값**: mode 없이 호출 → environment:'testnet'으로 월렛 생성

    4. **daemon 미실행 시 에러**: health check fetch reject → exit(1) + 에러 메시지

    5. **월렛 생성 실패 시 에러**: POST /v1/wallets 응답 400/500 → exit(1)

    6. **networks API 실패 시 graceful degradation**: GET /v1/wallets/:id/networks 응답 500 → 빈 배열로 계속 진행

    각 테스트에서:
    - vi.spyOn(global, 'fetch') 또는 globalThis.fetch = vi.fn()
    - console.log / console.error를 vi.spyOn으로 캡처
    - process.exit를 vi.spyOn으로 모킹 (throw로 전환)
    - tmpdir로 임시 dataDir 생성, afterEach에서 정리

    mcp-tokens 파일 쓰기 검증: 테스트 후 파일이 생성되었는지 existsSync로 확인.
  </action>
  <verify>
    cd packages/cli && npx vitest run src/__tests__/quickstart.test.ts 으로 전체 테스트 통과
  </verify>
  <done>
    quickstart.test.ts에 6개 이상의 테스트 케이스가 존재하고 모두 통과
  </done>
</task>

</tasks>

<verification>
1. `cd packages/cli && npx tsc --noEmit` -- 타입 체크 통과
2. `cd packages/cli && npx vitest run src/__tests__/quickstart.test.ts` -- 모든 테스트 통과
3. `cd packages/cli && npx vitest run` -- 기존 CLI 테스트 회귀 없음
</verification>

<success_criteria>
- quickstart.ts가 mode testnet/mainnet을 수용하고 Solana + EVM 2개 월렛을 생성한다
- 출력에 체인별 네트워크/주소 목록 + MCP 설정 스니펫이 포함된다
- index.ts에 quickstart 명령이 등록되어 있다
- 6개 이상의 테스트가 통과한다
- 기존 CLI 테스트 회귀 없음
</success_criteria>

<output>
After completion, create `.planning/phases/114-cli-quickstart-dx-integration/114-01-SUMMARY.md`
</output>
