---
phase: 41-policy-engine-completion
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/deliverables/34-owner-wallet-connection.md
  - .planning/deliverables/33-time-lock-approval-mechanism.md
autonomous: true

must_haves:
  truths:
    - "34-owner §10에 GRACE 기간이 무기한(시간 제한 없음)이고 타이머/크론 기반 자동 전이가 없음이 명시되어 있다"
    - "34-owner §10에 GRACE->LOCKED 전이 트리거가 ownerAuth 미들웨어 Step 8.5 markOwnerVerified() 단일이며, 다른 전이 경로가 존재하지 않음이 명시되어 있다"
    - "34-owner §10과 33-time-lock §11.6 간 SSoT 우선순위가 테이블로 명확히 정의되어 있다 (Owner 상태 전이 SSoT=34-owner, 다운그레이드 SSoT=33-time-lock)"
    - "33-time-lock §11.6에 Owner 상태 전이의 SSoT가 34-owner §10임이 역방향 참조로 명시되어 있다"
  artifacts:
    - path: ".planning/deliverables/34-owner-wallet-connection.md"
      provides: "GRACE 기간 정책 + SSoT 우선순위 테이블"
      contains: "GRACE 기간.*무기한"
    - path: ".planning/deliverables/33-time-lock-approval-mechanism.md"
      provides: "34-owner 역방향 참조"
      contains: "Owner 상태 전이.*SSoT.*34-owner"
  key_links:
    - from: ".planning/deliverables/34-owner-wallet-connection.md"
      to: ".planning/deliverables/33-time-lock-approval-mechanism.md"
      via: "SSoT 우선순위 테이블 (다운그레이드 -> 33-time-lock §11.6)"
      pattern: "정책 평가.*다운그레이드.*SSoT.*33-time-lock"
    - from: ".planning/deliverables/33-time-lock-approval-mechanism.md"
      to: ".planning/deliverables/34-owner-wallet-connection.md"
      via: "역방향 참조 (Owner 상태 전이 -> 34-owner §10)"
      pattern: "Owner 상태 전이.*SSoT.*34-owner"
---

<objective>
34-owner §10에 GRACE 기간 정책(무기한)과 배타적 전이 트리거를 명시하고, 33-time-lock §11.6과의 SSoT 우선순위를 양방향으로 확정한다 (PLCY-02).

Purpose: 구현자가 GRACE 기간 관련 로직(타이머 불필요, 유일한 전이 트리거, 다운그레이드 SSoT 위치)을 추측 없이 구현할 수 있게 한다.
Output: 34-owner-wallet-connection.md §10에 2개 블록 추가, 33-time-lock-approval-mechanism.md §11.6에 역방향 참조 1개 추가
</objective>

<execution_context>
@/Users/minho.yoo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/minho.yoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/deliverables/34-owner-wallet-connection.md
@.planning/deliverables/33-time-lock-approval-mechanism.md
@.planning/phases/41-policy-engine-completion/41-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: 34-owner §10에 GRACE 기간 정책 + SSoT 우선순위 테이블 추가 (PLCY-02)</name>
  <files>.planning/deliverables/34-owner-wallet-connection.md</files>
  <action>
34-owner-wallet-connection.md §10 Owner 생명주기에 두 블록을 추가한다.

**추가 1 -- §10.1 상태별 상세 테이블 직후 (1719행 이후, resolveOwnerState() 직전):**

1719행의 테이블 (`| LOCKED (잠금) | ... |`) 바로 아래에 다음 블록을 삽입한다:

```markdown

**[v0.10] GRACE 기간 정책:**

- GRACE 기간은 **무기한**이다 (시간 제한 없음, 타이머/크론 기반 자동 전이 없음)
- GRACE -> LOCKED 전이 트리거는 **ownerAuth 미들웨어 Step 8.5 markOwnerVerified() 단일**이다
  - approve 또는 recover 엔드포인트에서 ownerAuth 서명 검증 성공 시 자동 전이
  - 이 외의 전이 경로는 존재하지 않음 (타이머, 크론, 수동 CLI 명령 등 없음)
- GRACE 상태에서 APPROVAL 티어 거래는 DELAY로 다운그레이드된다 (**SSoT: 33-time-lock-approval-mechanism.md §11.6 Step 9.5**)
- **정책 평가 로직(다운그레이드 포함)의 SSoT: 33-time-lock-approval-mechanism.md §11.6**
```

**추가 2 -- §10.2 상태 전이 조건표 이후, "중요 설계 결정" 블록(1752행) 직전에:**

1751행의 테이블 마지막 행 (`| 6 | LOCKED -> NONE | **불가** | ...`) 바로 아래, "**중요 설계 결정:**" 직전에 다음 블록을 삽입한다:

```markdown

**[v0.10] 33-time-lock §11.6 다운그레이드와의 SSoT 우선순위:**

| 관심사 | SSoT 문서 | 섹션 |
|--------|----------|------|
| Owner 상태 전이 (NONE/GRACE/LOCKED) | 34-owner-wallet-connection.md | §10 |
| 정책 평가 내 다운그레이드 로직 | 33-time-lock-approval-mechanism.md | §11.6 (Step 9.5) |
| resolveOwnerState() 함수 정의 | 34-owner-wallet-connection.md | §10.1 |
| evaluate() 알고리즘 | 33-time-lock-approval-mechanism.md | §3.2, §3.3 |

> 34-owner §10은 Owner 상태 전이(NONE/GRACE/LOCKED)와 전이 인증 요건을 정의한다. 33-time-lock §11.6 Step 9.5는 evaluate() 내부에서 resolveOwnerState() 결과를 사용하여 APPROVAL -> DELAY 다운그레이드를 결정한다. **다운그레이드 정책 결정의 SSoT는 33-time-lock §11.6이다.**
```

**주의:** 기존 "중요 설계 결정" 블록(전이 #3, #5, #6 설명)은 변경하지 않는다. 새 블록은 그 직전에 삽입한다.
  </action>
  <verify>
grep -n "GRACE 기간.*무기한\|GRACE.*무기한" .planning/deliverables/34-owner-wallet-connection.md 결과가 1건 이상이어야 한다.
grep -n "markOwnerVerified.*단일\|markOwnerVerified().*단일" .planning/deliverables/34-owner-wallet-connection.md 결과가 1건 이상이어야 한다.
grep -n "다운그레이드.*SSoT.*33-time-lock" .planning/deliverables/34-owner-wallet-connection.md 결과가 1건 이상이어야 한다.
grep -n "SSoT 우선순위" .planning/deliverables/34-owner-wallet-connection.md 결과가 1건 이상이어야 한다.
  </verify>
  <done>
34-owner §10에 GRACE 기간 무기한 정책, markOwnerVerified() 배타적 전이 트리거, APPROVAL 다운그레이드 SSoT 참조, SSoT 우선순위 테이블이 모두 명시되어 있다.
  </done>
</task>

<task type="auto">
  <name>Task 2: 33-time-lock §11.6에 34-owner 역방향 SSoT 참조 추가 (PLCY-02)</name>
  <files>.planning/deliverables/33-time-lock-approval-mechanism.md</files>
  <action>
33-time-lock-approval-mechanism.md §11.6의 "핵심 설계 사항" 테이블(2460-2471행 부근) 직후에 역방향 참조 블록을 추가한다.

2471행의 테이블 마지막 행 (`| PolicyDecision 확장 필드 | ... |`) 바로 아래, "안티패턴 주의사항" 섹션(2473행) 직전에 다음을 삽입한다:

```markdown

**[v0.10] Owner 상태 전이 SSoT 참조:**

> Owner 상태 전이(NONE/GRACE/LOCKED)의 정의, resolveOwnerState() 함수, 전이 조건표(6가지)의 **SSoT는 34-owner-wallet-connection.md §10**이다. 본 섹션(11.6)은 evaluate() 내부에서 resolveOwnerState() 결과를 소비하여 다운그레이드 여부를 결정하는 역할만 담당한다. Owner 상태 자체의 정의나 전이 규칙을 변경할 때는 34-owner §10을 수정해야 한다.
```

**주의:** §11.6의 기존 코드, 테이블, 안티패턴 섹션은 변경하지 않는다. 역방향 참조만 적절한 위치에 삽입한다.
  </action>
  <verify>
grep -n "Owner 상태 전이.*SSoT.*34-owner" .planning/deliverables/33-time-lock-approval-mechanism.md 결과가 1건 이상이어야 한다.
grep -n "v0.10.*Owner 상태 전이" .planning/deliverables/33-time-lock-approval-mechanism.md 결과가 1건 이상이어야 한다.
  </verify>
  <done>
33-time-lock §11.6에 Owner 상태 전이의 SSoT가 34-owner §10임이 명시적 역방향 참조로 추가되어 있다. 양방향 SSoT 참조가 완성되어 구현자가 어느 문서에서든 SSoT를 추적할 수 있다.
  </done>
</task>

</tasks>

<verification>
1. 34-owner-wallet-connection.md §10에 "GRACE 기간.*무기한" 패턴 1건 이상
2. 34-owner-wallet-connection.md §10에 "markOwnerVerified().*단일" 패턴 1건 이상
3. 34-owner-wallet-connection.md에 SSoT 우선순위 테이블 존재 (4행)
4. 33-time-lock-approval-mechanism.md §11.6에 "Owner 상태 전이.*SSoT.*34-owner" 패턴 1건 이상
5. 양방향 참조: 34-owner가 33-time-lock을 참조하고, 33-time-lock이 34-owner를 참조
</verification>

<success_criteria>
- PLCY-02 충족: GRACE 기간 무기한 정책, 배타적 전이 트리거, SSoT 우선순위 모두 명시
- Phase 41 Success Criteria 2 충족 (GRACE 무기한 + markOwnerVerified() 단일 트리거)
- Phase 41 Success Criteria 3 충족 (33-time-lock §11.6 Step 9.5가 다운그레이드 SSoT)
</success_criteria>

<output>
After completion, create `.planning/phases/41-policy-engine-completion/41-02-SUMMARY.md`
</output>
