---
phase: 108-api-interface-dx-design
plan: 02
type: execute
wave: 2
depends_on: ["108-01"]
files_modified:
  - docs/72-api-interface-dx-design.md
autonomous: true

must_haves:
  truths:
    - "MCP 6개 도구(send_token, call_contract, approve_token, send_batch, get_balance, get_assets)의 network optional 파라미터가 Zod 스키마 + 설명 텍스트까지 정의되어 있다"
    - "TS SDK의 SendTokenParams.network + getBalance(network?) + getAssets(network?) 확장이 HTTP 메서드별 파라미터 전달 위치(body vs query)와 함께 설계되어 있다"
    - "Python SDK의 SendTokenRequest.network + get_balance(network?) + get_assets(network?) 확장이 Pydantic 모델 수준으로 설계되어 있다"
    - "3개 인터페이스(REST/MCP/SDK)의 하위호환 전략이 일관된 3-Layer 원칙으로 통합 정의되어 있다"
    - "quickstart --mode testnet/mainnet 워크플로우의 5단계 흐름(health check -> 2월렛 생성 -> 세션 생성 -> MCP 토큰 -> 설정 스니펫)이 CLI 의사코드로 설계되어 있다"
  artifacts:
    - path: "docs/72-api-interface-dx-design.md"
      provides: "MCP/SDK 확장 + 하위호환 전략 + Quickstart 워크플로우 설계 (섹션 6~10)"
      contains: "quickstart --mode"
  key_links:
    - from: "docs/72 (MCP 도구 network 파라미터)"
      to: "docs/72 섹션 1 (REST API network 파라미터)"
      via: "MCP -> REST API 전달 경로"
      pattern: "apiClient.post.*network"
    - from: "docs/72 (SDK 메서드 확장)"
      to: "docs/72 섹션 1-3 (REST API 스키마)"
      via: "SDK -> REST API 파라미터 매핑"
      pattern: "network.*query"
    - from: "docs/72 (Quickstart CLI)"
      to: "docs/72 섹션 2 (POST /v1/wallets)"
      via: "월렛 생성 API 호출"
      pattern: "createWallet.*environment"
---

<objective>
MCP 6개 도구와 TS/Python SDK 메서드의 network 파라미터 추가, 3개 인터페이스 통합 하위호환 전략, quickstart --mode 워크플로우를 설계한다.

Purpose: REST API 설계(108-01)를 MCP/SDK/CLI 인터페이스에 일관되게 전파하여 구현자가 전체 인터페이스 스택을 하위호환 유지하면서 변경할 수 있도록 한다.
Output: docs/72-api-interface-dx-design.md 섹션 6~10 (MCP/SDK/DX 설계)
</objective>

<execution_context>
@/Users/minho.yoo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/minho.yoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# 108-01 결과 참조 (REST API 스키마 확정)
@.planning/phases/108-api-interface-dx-design/108-01-SUMMARY.md
@docs/72-api-interface-dx-design.md

# Phase 105-107 설계 문서 (순수 함수 참조)
@docs/68-environment-model-design.md
@docs/70-pipeline-network-resolve-design.md

# 리서치 결과 (MCP/SDK/Quickstart 의사코드)
@.planning/phases/108-api-interface-dx-design/108-RESEARCH.md

# 현재 MCP/SDK/CLI 코드 (변경 전 기준)
@packages/mcp/src/tools/send-token.ts
@packages/mcp/src/tools/call-contract.ts
@packages/mcp/src/tools/get-balance.ts
@packages/mcp/src/tools/get-assets.ts
@packages/sdk/src/types.ts
@packages/sdk/src/client.ts
@python-sdk/waiaas/models.py
@python-sdk/waiaas/client.py
@packages/cli/src/commands/mcp-setup.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: MCP 도구 + TS/Python SDK network 파라미터 확장 설계 (docs/72 섹션 6~8)</name>
  <files>docs/72-api-interface-dx-design.md</files>
  <action>
docs/72-api-interface-dx-design.md에 섹션 6~8을 추가한다.

**섹션 6: MCP 도구 network 파라미터 추가 (API-04)**

- 변경 대상 6개 도구: send_token, call_contract, approve_token, send_batch, get_balance, get_assets
- 변경 없는 4개 도구: get_address, get_wallets, get_wallet, create_wallet (또는 변경이 필요한 경우 명시)
- 각 도구의 Zod 입력 스키마에 network 추가:
  ```
  network: z.string().optional().describe(
    'Target network (e.g., devnet, ethereum-sepolia). Omit to use wallet default.'
  )
  ```
- 트랜잭션 도구(send_token, call_contract, approve_token, send_batch): body에 network 포함하여 POST /v1/transactions/send 전달
- 조회 도구(get_balance, get_assets): query parameter로 GET /v1/wallet/balance?network=X, GET /v1/wallet/assets?network=X 전달
- MCP 리소스로 wallet environment/defaultNetwork 정보 노출 설계 (LLM이 현재 컨텍스트 파악)
- network description 가이드: LLM이 올바르게 사용하도록 "If omitted, uses wallet's default network" 명시

**섹션 7: TS SDK 확장 설계 (API-04)**

- SendTokenParams 인터페이스: `network?: string` 추가
- WAIaaSClient.sendToken(): body에 network 포함 (POST 엔드포인트이므로)
- WAIaaSClient.getBalance(network?: string): query parameter 처리 (`?network=${network}`)
- WAIaaSClient.getAssets(network?: string): query parameter 처리
- 타입 확장: WalletResponse에 environment, defaultNetwork 필드 추가
- 하위호환: 기존 `sendToken({ to, amount })` 호출이 network 없이 동일하게 동작

**섹션 8: Python SDK 확장 설계 (API-04)**

- SendTokenRequest Pydantic 모델: `network: Optional[str] = None` 추가
- WAIaaSClient.send_token(): body에 network 포함
- WAIaaSClient.get_balance(network: Optional[str] = None): query parameter 처리
- WAIaaSClient.get_assets(network: Optional[str] = None): query parameter 처리
- WalletResponse 모델 확장: environment, default_network 필드 추가
- 하위호환: 기존 `client.send_token(to="...", amount="...")` 호출이 동일 동작
  </action>
  <verify>
docs/72에 섹션 6(MCP 6개 도구 network 파라미터), 섹션 7(TS SDK 3개 메서드 확장), 섹션 8(Python SDK 3개 메서드 확장)이 코드 수준으로 정의되어 있다.
  </verify>
  <done>
- MCP 6개 도구의 network 파라미터 + description 텍스트가 Zod 스키마로 정의됨
- TS SDK의 SendTokenParams.network + getBalance/getAssets 파라미터 확장이 HTTP 전달 위치와 함께 설계됨
- Python SDK의 Pydantic 모델 + 메서드 확장이 동일 패턴으로 설계됨
  </done>
</task>

<task type="auto">
  <name>Task 2: 통합 하위호환 전략 + Quickstart 워크플로우 + 설계 결정 (docs/72 섹션 9~10)</name>
  <files>docs/72-api-interface-dx-design.md</files>
  <action>
docs/72-api-interface-dx-design.md에 섹션 9~10 + 부록을 추가한다.

**섹션 9: 통합 하위호환 전략 + Quickstart 워크플로우 (API-05, DX-01, DX-02)**

하위호환 통합:
- 3-Layer 하위호환 원칙이 REST/MCP/SDK 3개 인터페이스에 동일하게 적용되는 매트릭스:
  | 인터페이스 | network 미지정 | environment 미지정 | 응답 변경 |
  |-----------|--------------|-------------------|----------|
  | REST API  | resolveNetwork fallback | deriveEnvironment 역추론 | 필드 추가 only |
  | MCP       | 동일 (REST로 전달) | N/A (wallet bound) | 동일 |
  | TS SDK    | 동일 (REST로 전달) | 동일 | 타입 확장 only |
  | Python SDK| 동일 (REST로 전달) | 동일 | 모델 확장 only |

Quickstart 워크플로우 (DX-01 + DX-02):
- CLI 명령: `waiaas quickstart --mode testnet` (또는 mainnet)
- QuickstartOptions 인터페이스 정의: { dataDir, baseUrl?, mode: 'testnet'|'mainnet', masterPassword? }
- 5단계 흐름 의사코드:
  1. Health check (GET /v1/health) - 실패 시 "Run 'waiaas start' first" 안내 후 종료
  2. Solana 월렛 생성 (POST /v1/wallets { name: "solana-{mode}", chain: "solana", environment: mode })
  3. Ethereum 월렛 생성 (POST /v1/wallets { name: "eth-{mode}", chain: "ethereum", environment: mode })
  4. 각 월렛에 세션 생성 + MCP 토큰 생성 (기존 mcp-setup 패턴 재사용)
  5. Claude Desktop config.json 스니펫 출력 (2개 MCP 서버 설정)
- 에러 처리: 각 단계 실패 시 정리(rollback) 없이 에러 메시지 출력 후 종료 (멱등성: 재실행 시 중복 이름 → 기존 월렛 사용 또는 에러)
- CLI 등록: commander에 quickstart 서브커맨드 추가

**섹션 10: 설계 결정 요약 + Phase 105-108 통합 참조**

설계 결정 (API-D01~D06 + DX-D01~D03):
- API-D01: environment optional + deriveEnvironment fallback (breaking change 방지)
- API-D02: 멀티네트워크 잔액을 별도 masterAuth 엔드포인트로 분리
- API-D03: 트랜잭션 응답에 network 필드 추가 (실행 네트워크 추적)
- API-D04: GET -> query parameter, POST -> body로 network 전달
- API-D05: WalletResponse에 기존 network 유지 + environment, defaultNetwork 추가
- API-D06: MCP network description에 "omit for default" 명시 (LLM 혼란 방지)
- DX-D01: quickstart는 daemon 미실행 시 안내 메시지 출력 후 종료 (자동 시작 안 함)
- DX-D02: quickstart는 Solana + EVM 2월렛 일괄 생성 (단일 체인 옵션 없음)
- DX-D03: quickstart 에러 시 rollback 없음 (멱등성으로 해결)

Phase 105-108 통합 참조 다이어그램:
- docs/68 -> docs/69 -> docs/70 -> docs/71 -> docs/72 참조 관계
- v1.4.6 구현 시 5개 문서 참조 순서 가이드

부록: Skill Files 변경 사항 (4개 파일 변경 내용 요약)
- quickstart.skill.md, wallet.skill.md, transactions.skill.md, policies.skill.md 변경 포인트
  </action>
  <verify>
docs/72에 섹션 9(하위호환 매트릭스 + Quickstart 5단계 의사코드), 섹션 10(설계 결정 9개 + 통합 참조 다이어그램)이 있다.
  </verify>
  <done>
- 3개 인터페이스 통합 하위호환 매트릭스가 존재
- quickstart --mode 5단계 흐름이 CLI 의사코드로 완성됨
- 설계 결정 9개(API-D01~D06 + DX-D01~D03)가 근거와 함께 기록됨
- Phase 105-108 통합 참조 다이어그램이 존재
  </done>
</task>

</tasks>

<verification>
1. docs/72-api-interface-dx-design.md에 섹션 6~10이 존재한다
2. 섹션 6에 MCP 6개 도구의 network 파라미터가 Zod 스키마로 정의되어 있다
3. 섹션 7에 TS SDK의 타입/메서드 확장이 HTTP 전달 위치와 함께 설계되어 있다
4. 섹션 8에 Python SDK의 Pydantic 모델/메서드 확장이 설계되어 있다
5. 섹션 9에 통합 하위호환 매트릭스 + Quickstart 5단계 의사코드가 있다
6. 섹션 10에 설계 결정 9개 + Phase 105-108 통합 참조 다이어그램이 있다
</verification>

<success_criteria>
- MCP/TS SDK/Python SDK의 network 파라미터 확장이 REST API 설계와 일관되게 정의됨
- 3개 인터페이스의 하위호환 전략이 동일한 3-Layer 원칙으로 통합됨
- quickstart --mode 워크플로우가 5단계 CLI 의사코드로 완성됨
- 전체 설계 결정이 Phase 105-108 통합 참조와 함께 정리됨
- v1.4.6 구현자가 docs/72만으로 전체 인터페이스 변경을 수행할 수 있을 정도의 구체성
</success_criteria>

<output>
After completion, create `.planning/phases/108-api-interface-dx-design/108-02-SUMMARY.md`
</output>
