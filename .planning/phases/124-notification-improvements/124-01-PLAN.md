---
phase: 124-notification-improvements
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/admin/src/pages/notifications.tsx
  - packages/admin/src/pages/settings.tsx
  - packages/admin/src/__tests__/notifications.test.tsx
autonomous: true

must_haves:
  truths:
    - "Admin UI에서 알림 Send Test가 SYSTEM_LOCKED 에러 없이 정상 동작한다"
    - "채널별 개별 [Test] 버튼으로 특정 채널만 테스트할 수 있다"
    - "비활성 채널에는 [Test] 버튼이 표시되지 않는다"
    - "Test All Channels 버튼으로 전체 채널 일괄 테스트가 가능하다"
  artifacts:
    - path: "packages/admin/src/pages/notifications.tsx"
      provides: "채널별 테스트 버튼 UI + 빈 body 버그 수정"
      contains: "apiPost.*ADMIN_NOTIFICATIONS_TEST.*\\{\\}"
    - path: "packages/admin/src/pages/settings.tsx"
      provides: "settings 페이지 알림 테스트 빈 body 버그 수정"
      contains: "apiPost.*ADMIN_NOTIFICATIONS_TEST.*\\{\\}"
    - path: "packages/admin/src/__tests__/notifications.test.tsx"
      provides: "채널별 테스트 + 빈 body 수정 테스트"
  key_links:
    - from: "packages/admin/src/pages/notifications.tsx"
      to: "/v1/admin/notifications/test"
      via: "apiPost with { channel } body"
      pattern: "apiPost.*channel"
---

<objective>
알림 테스트 SYSTEM_LOCKED 버그 수정 + 채널별 테스트 UI 구현 (NOTF-01, NOTF-02)

Purpose: Admin UI에서 알림 채널 테스트가 정상 동작하고, 개별 채널을 선택적으로 테스트할 수 있게 한다
Output: notifications.tsx 채널별 테스트 UI + settings.tsx 버그 수정 + 테스트
</objective>

<execution_context>
@/Users/minho.yoo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/minho.yoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@objectives/issues/v1.4.6-028-notification-test-system-locked-error.md
@objectives/issues/v1.4.6-029-notification-test-channel-visibility.md
@packages/admin/src/pages/notifications.tsx
@packages/admin/src/pages/settings.tsx
@packages/admin/src/api/client.ts
@packages/admin/src/api/endpoints.ts
@packages/admin/src/components/form.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: apiPost 빈 body 버그 수정 + 채널별 테스트 UI</name>
  <files>
    packages/admin/src/pages/notifications.tsx
    packages/admin/src/pages/settings.tsx
  </files>
  <action>
**1. notifications.tsx 수정:**

(a) apiPost 빈 body 버그 수정 (이슈 028):
- 87행: `apiPost<{ results: TestResult[] }>(API.ADMIN_NOTIFICATIONS_TEST)` -> `apiPost<{ results: TestResult[] }>(API.ADMIN_NOTIFICATIONS_TEST, {})` — 빈 객체 전송으로 유효한 JSON body 보장

(b) 채널별 개별 [Test] 버튼 추가 (이슈 029):
- `testChannelLoading` 시그널 추가: `useSignal<string | null>(null)` — 어떤 채널이 테스트 중인지 추적
- `handleTestChannel` 함수 추가: 특정 채널명을 받아 `apiPost(API.ADMIN_NOTIFICATIONS_TEST, { channel: channelName })` 호출 후 결과를 testResults에 설정
- Channel Status 카드(`channel-grid` 내부)에서 각 `ch.enabled === true`인 채널 카드에 `[Test]` 버튼 추가 (Button variant="secondary" size="sm")
- 비활성 채널(`ch.enabled === false`)에는 [Test] 버튼 미표시
- 테스트 중인 채널 버튼은 `loading={testChannelLoading.value === ch.name}` 표시

(c) 기존 "Send Test" 버튼을 "Test All Channels" 로 텍스트 변경:
- `handleTestSend` 내부 apiPost도 빈 객체 전달: `apiPost(API.ADMIN_NOTIFICATIONS_TEST, {})`
- 버튼 텍스트: "Test All Channels"

(d) 테스트 결과 표시 영역을 "Test Notification" 섹션에서 Channel Status 섹션 하단으로 이동 — 채널별 테스트와 Test All 모두의 결과가 같은 위치에 표시

**2. settings.tsx 수정:**

- 259행: `apiPost<{ results: NotifTestResult[] }>(API.ADMIN_NOTIFICATIONS_TEST)` -> `apiPost<{ results: NotifTestResult[] }>(API.ADMIN_NOTIFICATIONS_TEST, {})` — 동일한 빈 body 버그 수정
  </action>
  <verify>
`pnpm --filter @waiaas/admin build` 성공 (타입 에러 없음)
  </verify>
  <done>
- notifications.tsx: apiPost에 빈 객체 `{}` 전달, Channel Status 카드에 활성 채널별 [Test] 버튼, "Test All Channels" 버튼, 비활성 채널에 [Test] 미표시
- settings.tsx: apiPost에 빈 객체 `{}` 전달
  </done>
</task>

<task type="auto">
  <name>Task 2: 알림 테스트 UI 테스트 업데이트</name>
  <files>
    packages/admin/src/__tests__/notifications.test.tsx
  </files>
  <action>
기존 `notifications.test.tsx`를 읽고 다음 테스트를 추가/수정:

1. **T-1: 채널별 [Test] 버튼 렌더링** — 활성 채널(telegram: enabled=true)에 "Test" 버튼이 렌더링되는지 확인
2. **T-2: 비활성 채널에 [Test] 미표시** — 비활성 채널(discord: enabled=false)의 카드에 "Test" 버튼이 없는지 확인
3. **T-3: 채널별 테스트 클릭 시 올바른 body 전송** — telegram [Test] 클릭 시 `{ channel: 'telegram' }` body로 POST 호출되는지 확인
4. **T-4: "Test All Channels" 버튼 존재** — 기존 "Send Test" 대신 "Test All Channels" 텍스트 확인
5. **T-5: Test All Channels 클릭 시 `{}` body 전송** — 빈 객체가 body로 POST 호출되는지 확인 (SYSTEM_LOCKED 방지)

기존 테스트 패턴(fetchMock, render, waitFor 등)을 따른다. 기존 "Send Test" 관련 테스트는 "Test All Channels"로 텍스트를 수정한다.
  </action>
  <verify>
`pnpm --filter @waiaas/admin test` 통과
  </verify>
  <done>
- 채널별 테스트 버튼 렌더링/비렌더링 테스트 통과
- 채널별 테스트 API 호출 body 검증 통과
- Test All Channels 버튼 텍스트 + body 검증 통과
  </done>
</task>

</tasks>

<verification>
1. `pnpm --filter @waiaas/admin build` 성공
2. `pnpm --filter @waiaas/admin test` 전체 통과
3. notifications.tsx에서 `apiPost`가 빈 body 없이 호출되는 곳이 없음
4. settings.tsx에서 `apiPost`가 빈 body 없이 호출되는 곳이 없음
</verification>

<success_criteria>
- apiPost(ADMIN_NOTIFICATIONS_TEST)가 모두 apiPost(ADMIN_NOTIFICATIONS_TEST, {})로 수정됨
- Channel Status 카드에서 활성 채널에 [Test] 버튼이 표시되고 클릭 시 해당 채널만 테스트됨
- 비활성 채널에는 [Test] 버튼이 없음
- "Test All Channels" 버튼이 모든 활성 채널에 일괄 테스트 전송
- Admin UI 빌드 + 테스트 통과
</success_criteria>

<output>
After completion, create `.planning/phases/124-notification-improvements/124-01-SUMMARY.md`
</output>
