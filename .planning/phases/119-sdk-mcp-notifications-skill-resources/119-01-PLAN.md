---
phase: 119-sdk-mcp-notifications-skill-resources
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/sdk/src/types.ts
  - packages/sdk/src/client.ts
  - packages/sdk/src/index.ts
  - packages/sdk/src/__tests__/client.test.ts
  - python-sdk/waiaas/models.py
  - python-sdk/waiaas/client.py
  - python-sdk/waiaas/__init__.py
  - python-sdk/tests/test_models.py
  - packages/mcp/src/tools/sign-transaction.ts
  - packages/mcp/src/server.ts
  - packages/mcp/src/__tests__/server.test.ts
autonomous: true

must_haves:
  truths:
    - "TS SDK signTransaction({ transaction, network? })이 POST /v1/transactions/sign을 호출하고 SignTransactionResponse를 반환한다"
    - "Python SDK sign_transaction(transaction, chain?, network?)이 POST /v1/transactions/sign을 호출하고 SignTransactionResponse를 반환한다"
    - "MCP sign_transaction 도구가 transaction + optional network 파라미터로 POST /v1/transactions/sign을 호출한다"
  artifacts:
    - path: "packages/sdk/src/types.ts"
      provides: "SignTransactionParams, SignTransactionOperation, SignTransactionResponse 타입"
      contains: "SignTransactionParams"
    - path: "packages/sdk/src/client.ts"
      provides: "signTransaction() 메서드"
      contains: "signTransaction"
    - path: "python-sdk/waiaas/models.py"
      provides: "SignTransactionRequest, SignTransactionOperation, PolicyResult, SignTransactionResponse Pydantic 모델"
      contains: "SignTransactionRequest"
    - path: "python-sdk/waiaas/client.py"
      provides: "sign_transaction() async 메서드"
      contains: "sign_transaction"
    - path: "packages/mcp/src/tools/sign-transaction.ts"
      provides: "registerSignTransaction MCP 도구"
      contains: "registerSignTransaction"
  key_links:
    - from: "packages/sdk/src/client.ts"
      to: "/v1/transactions/sign"
      via: "this.http.post"
      pattern: "post.*transactions/sign"
    - from: "packages/mcp/src/tools/sign-transaction.ts"
      to: "/v1/transactions/sign"
      via: "apiClient.post"
      pattern: "apiClient\\.post.*transactions/sign"
    - from: "packages/mcp/src/server.ts"
      to: "packages/mcp/src/tools/sign-transaction.ts"
      via: "registerSignTransaction import + 호출"
      pattern: "registerSignTransaction"
---

<objective>
TS SDK signTransaction() + Python SDK sign_transaction() + MCP sign_transaction 도구를 추가하여 sign-only REST API(POST /v1/transactions/sign)를 3개 클라이언트 인터페이스에서 사용할 수 있게 한다.

Purpose: Phase 117에서 구현된 sign-only REST API를 SDK/MCP 소비자에게 노출
Output: TS SDK 메서드 1개, Python SDK 메서드 1개, MCP 도구 1개 (13번째)
</objective>

<execution_context>
@/Users/minho.yoo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/minho.yoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/118-evm-calldata-encoding/118-02-SUMMARY.md

@packages/sdk/src/client.ts
@packages/sdk/src/types.ts
@packages/sdk/src/index.ts
@packages/mcp/src/server.ts
@packages/mcp/src/tools/encode-calldata.ts
@python-sdk/waiaas/client.py
@python-sdk/waiaas/models.py
@python-sdk/waiaas/__init__.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: TS SDK signTransaction + MCP sign_transaction 도구</name>
  <files>
    packages/sdk/src/types.ts
    packages/sdk/src/client.ts
    packages/sdk/src/index.ts
    packages/sdk/src/__tests__/client.test.ts
    packages/mcp/src/tools/sign-transaction.ts
    packages/mcp/src/server.ts
    packages/mcp/src/__tests__/server.test.ts
  </files>
  <action>
**TS SDK 타입 추가** (`packages/sdk/src/types.ts`):
- `SignTransactionParams` 인터페이스: `transaction: string`, `network?: string`
- `SignTransactionOperation` 인터페이스: `type: string`, `to?: string | null`, `amount?: string | null`, `token?: string | null`, `programId?: string | null`, `method?: string | null`
- `SignTransactionResponse` 인터페이스: `id: string`, `signedTransaction: string`, `txHash: string | null`, `operations: SignTransactionOperation[]`, `policyResult: { tier: string }`
- Utils 섹션(EncodeCalldata 바로 아래)에 추가

**TS SDK 메서드 추가** (`packages/sdk/src/client.ts`):
- `async signTransaction(params: SignTransactionParams): Promise<SignTransactionResponse>` 메서드
- `encodeCalldata()` 바로 뒤에 위치
- `withRetry(() => this.http.post<SignTransactionResponse>('/v1/transactions/sign', params, this.authHeaders()), this.retryOptions)` 패턴 (encodeCalldata와 동일)
- import에 `SignTransactionParams, SignTransactionResponse` 추가
- JSDoc 주석 갱신: 10 -> 11 메서드

**TS SDK exports** (`packages/sdk/src/index.ts`):
- `type` export에 `SignTransactionParams`, `SignTransactionOperation`, `SignTransactionResponse` 추가
- 기존 `EncodeCalldataParams`, `EncodeCalldataResponse`도 export에 없으면 함께 추가

**TS SDK 테스트** (`packages/sdk/src/__tests__/client.test.ts`):
- `signTransaction()` describe 블록 추가
- 성공 케이스: `fetchSpy`가 `POST /v1/transactions/sign` 호출 + 올바른 body + Bearer 토큰 + SignTransactionResponse 반환 검증
- 에러 케이스: 403 응답 시 WAIaaSError 발생 검증

**MCP sign_transaction 도구** (`packages/mcp/src/tools/sign-transaction.ts` -- NEW):
- `registerSignTransaction(server, apiClient, walletContext?)` 함수 export
- `server.tool('sign_transaction', withWalletPrefix('Sign an unsigned transaction...', walletContext?.walletName), { transaction: z.string().describe('...'), network: z.string().optional().describe('...') }, async (args) => { ... })`
- handler: `apiClient.post('/v1/transactions/sign', body)` -> `toToolResult(result)`
- `encode-calldata.ts` 패턴을 정확히 따름 (import 구조, z import, ApiClient/toToolResult import, WalletContext/withWalletPrefix import)
- chain 파라미터는 노출하지 않음 (wallet에서 자동 추론)

**MCP server.ts 등록**:
- `import { registerSignTransaction } from './tools/sign-transaction.js';` 추가
- `registerEncodeCalldata` 뒤에 `registerSignTransaction(server, apiClient, walletContext);` 호출
- 주석 갱신: "Register 12 tools" -> "Register 13 tools"

**MCP 테스트** (`packages/mcp/src/__tests__/server.test.ts`):
- `mockTool.toHaveBeenCalledTimes(12)` -> `toHaveBeenCalledTimes(13)` 갱신
  </action>
  <verify>
    cd /Users/minho.yoo/dev/wallet/WAIaaS && npx turbo run build --filter=@waiaas/sdk --filter=@waiaas/mcp 2>&1 | tail -5
    npx vitest run packages/sdk/src/__tests__/client.test.ts --reporter=verbose 2>&1 | tail -20
    npx vitest run packages/mcp/src/__tests__/server.test.ts --reporter=verbose 2>&1 | tail -20
  </verify>
  <done>
    TS SDK signTransaction() 메서드가 POST /v1/transactions/sign을 호출하고 SignTransactionResponse를 반환하며, MCP sign_transaction 도구가 13번째 도구로 등록되어 동일 엔드포인트를 호출한다. 빌드 성공 + 테스트 통과.
  </done>
</task>

<task type="auto">
  <name>Task 2: Python SDK sign_transaction + 모델 테스트</name>
  <files>
    python-sdk/waiaas/models.py
    python-sdk/waiaas/client.py
    python-sdk/waiaas/__init__.py
    python-sdk/tests/test_models.py
  </files>
  <action>
**Python SDK 모델 추가** (`python-sdk/waiaas/models.py`):
- `SignTransactionRequest(BaseModel)`: `transaction: str`, `chain: Optional[str] = None`, `network: Optional[str] = None`, `model_config = {"populate_by_name": True}`
- `SignTransactionOperation(BaseModel)`: `type: str`, `to: Optional[str] = None`, `amount: Optional[str] = None`, `token: Optional[str] = None`, `program_id: Optional[str] = Field(default=None, alias="programId")`, `method: Optional[str] = None`, `model_config = {"populate_by_name": True}`
- `PolicyResult(BaseModel)`: `tier: str`
- `SignTransactionResponse(BaseModel)`: `id: str`, `signed_transaction: str = Field(alias="signedTransaction")`, `tx_hash: Optional[str] = Field(default=None, alias="txHash")`, `operations: list[SignTransactionOperation]`, `policy_result: PolicyResult = Field(alias="policyResult")`, `model_config = {"populate_by_name": True}`
- 기존 EncodeCalldataResponse 아래 (파일 끝)에 추가

**Python SDK 메서드 추가** (`python-sdk/waiaas/client.py`):
- `encode_calldata()` 뒤에 `sign_transaction()` 메서드 추가
- `async def sign_transaction(self, transaction: str, *, chain: Optional[str] = None, network: Optional[str] = None) -> SignTransactionResponse:`
- body: `SignTransactionRequest(transaction=transaction, chain=chain, network=network).model_dump(exclude_none=True, by_alias=True)`
- `resp = await self._request("POST", "/v1/transactions/sign", json_body=body)`
- `return SignTransactionResponse.model_validate(resp.json())`
- import에 `SignTransactionRequest, SignTransactionResponse` 추가

**Python SDK exports** (`python-sdk/waiaas/__init__.py`):
- import에 `SignTransactionRequest`, `SignTransactionResponse` 추가
- `__all__`에 추가

**Python SDK 테스트** (`python-sdk/tests/test_models.py`):
- `SignTransactionResponse` 역직렬화 테스트: camelCase JSON -> snake_case 필드 매핑 검증
- `SignTransactionRequest` 직렬화 테스트: `model_dump(exclude_none=True, by_alias=True)` 결과 검증
- `PolicyResult` 중첩 모델 파싱 검증
  </action>
  <verify>
    cd /Users/minho.yoo/dev/wallet/WAIaaS/python-sdk && python -m pytest tests/test_models.py -v 2>&1 | tail -20
  </verify>
  <done>
    Python SDK sign_transaction() 메서드가 POST /v1/transactions/sign을 호출하고 SignTransactionResponse를 반환한다. Pydantic 모델 직렬화/역직렬화 테스트 통과.
  </done>
</task>

</tasks>

<verification>
- `npx turbo run build --filter=@waiaas/sdk --filter=@waiaas/mcp` 성공 (타입 에러 없음)
- `npx vitest run packages/sdk/src/__tests__/client.test.ts` 통과 (signTransaction 테스트 포함)
- `npx vitest run packages/mcp/src/__tests__/server.test.ts` 통과 (13 tools 검증)
- `cd python-sdk && python -m pytest tests/test_models.py` 통과
- grep 확인: `signTransaction` in client.ts, `sign_transaction` in client.py, `registerSignTransaction` in server.ts
</verification>

<success_criteria>
1. TS SDK `signTransaction()` 메서드가 `POST /v1/transactions/sign`을 호출하고 `SignTransactionResponse`를 반환한다
2. Python SDK `sign_transaction()` 메서드가 동일 엔드포인트를 호출하고 typed response를 반환한다
3. MCP `sign_transaction` 도구가 13번째 도구로 등록되어 `apiClient.post('/v1/transactions/sign')`을 호출한다
4. 빌드 성공 + 모든 테스트 통과
</success_criteria>

<output>
After completion, create `.planning/phases/119-sdk-mcp-notifications-skill-resources/119-01-SUMMARY.md`
</output>
