---
phase: 125-design-docs-oracle-interfaces
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/61-price-oracle-spec.md
  - docs/62-action-provider-architecture.md
  - .planning/deliverables/38-sdk-mcp-interface.md
autonomous: true

must_haves:
  truths:
    - "설계 문서 61이 Pyth Primary + CoinGecko Fallback 2단계 구조를 기술하고 Chainlink 참조가 전혀 없다"
    - "설계 문서 61의 PriceInfoSchema.source가 ['pyth', 'coingecko', 'cache'] 3가지만 포함한다"
    - "설계 문서 61의 PriceCache maxEntries가 128이다"
    - "설계 문서 61의 교차 검증 편차 임계값이 5%이고 CoinGecko 키 설정 시에만 활성화 조건이 명시되어 있다"
    - "설계 문서 62의 핵심 원칙 #4에 '16개 상한'이 없고 mcpExpose 플래그 제어만 기술한다"
    - "설계 문서 62에 McpToolLimitExceededError/MCP_TOOL_LIMIT_EXCEEDED 관련 코드/에러가 없다"
    - "설계 문서 62/38이 기존 MCP 도구를 '14개'로 정확히 기술한다"
    - "설계 문서 38에 MCP_TOOL_MAX=16 상수와 상한 검사 의사코드가 없다"
  artifacts:
    - path: "docs/61-price-oracle-spec.md"
      provides: "v1.5 Oracle architecture (Pyth Primary + CoinGecko Fallback)"
      contains: "Pyth.*Primary"
    - path: "docs/62-action-provider-architecture.md"
      provides: "Action Provider architecture without MCP tool limit"
      contains: "기존 14개"
    - path: ".planning/deliverables/38-sdk-mcp-interface.md"
      provides: "SDK/MCP interface without tool limit"
      contains: "14"
  key_links:
    - from: "docs/61-price-oracle-spec.md"
      to: "objectives/v1.5-defi-price-oracle.md"
      via: "v1.5 architecture decisions"
      pattern: "Pyth.*Primary.*CoinGecko.*Fallback"
---

<objective>
설계 문서 61/62/38을 v1.5 아키텍처 결정에 맞게 수정한다.

Purpose: v1.5 구현 전에 설계 문서가 현행 아키텍처를 정확히 반영해야 구현자(Phase 125-02, 126, 127)가 올바른 설계를 참조할 수 있다. Chainlink 제거, MCP 16개 상한 제거, MCP 14개 도구 현행화가 핵심이다.
Output: 3개 설계 문서 수정 완료
</objective>

<execution_context>
@/Users/minho.yoo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/minho.yoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@objectives/v1.5-defi-price-oracle.md
@docs/61-price-oracle-spec.md
@docs/62-action-provider-architecture.md
@.planning/deliverables/38-sdk-mcp-interface.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: 설계 문서 61 v1.5 수정 (Oracle 아키텍처 변경)</name>
  <files>docs/61-price-oracle-spec.md</files>
  <action>
설계 문서 61을 v1.5 아키텍처 결정에 맞게 수정한다. 목표 문서 `objectives/v1.5-defi-price-oracle.md`의 "선행 작업: 설계 문서 수정" 섹션과 125-RESEARCH.md의 수정 포인트 목록을 참조한다.

**수정 항목 (12개):**

1. **섹션 1.2 요구사항 매핑**: `CoinGecko/Pyth/Chainlink 3개 구현체` → `Pyth/CoinGecko 2개 구현체 + OracleChain 2단계 fallback`으로 수정
2. **섹션 1.5 아키텍처 다이어그램**: CoinGecko(기본)/Pyth(Solana대안)/Chainlink(EVM대안) 3-box 다이어그램 → Pyth(Primary, Zero-config)/CoinGecko(Opt-in Fallback) 2-box 다이어그램으로 변경. "Chainlink RPC" 박스 제거
3. **섹션 2.2 PriceInfoSchema.source**: `z.enum(['coingecko', 'pyth', 'chainlink', 'jupiter', 'cache'])` → `z.enum(['pyth', 'coingecko', 'cache'])`. 주석에서 Chainlink/Jupiter 참조도 제거. CoinGecko confidence 설명에서 "Chainlink는 confidence를 제공하지 않으므로" → "CoinGecko는 confidence를 제공하지 않으므로"로 수정
4. **섹션 2.4 IPriceOracle 주석**: Chainlink 관련 주석 제거
5. **섹션 3.1 CoinGeckoOracle**: "기본(Primary)" 역할 → "Opt-in Fallback" 역할로 변경. "Demo API 키 설정 시에만 활성화" 명시 추가
6. **섹션 3.2 PythOracle**: "Solana 전용 대안" → "Zero-config Primary" 역할로 승격. "380+ 피드, 체인 무관(Solana/EVM 공통), API 키 불필요" 명시
7. **섹션 3.3 ChainlinkOracle**: 전체 섹션 제거 (인터페이스, 구현 의사코드, Aggregator 매핑 테이블 포함). 제거 이유를 별도 NOTE로 추가: "v1.5에서 제거됨: EVM 전용으로 커버리지 편향, Aggregator 주소 매핑 유지 부담, Pyth가 이미 체인 무관 380+ 피드를 제공"
8. **섹션 3.4 구현체 비교표**: Chainlink 행 제거, Pyth를 Primary로, CoinGecko를 Fallback으로 수정
9. **섹션 3.5 기본 조합 권장**: CoinGecko→Pyth→Chainlink 3단계 → Pyth→CoinGecko 2단계로 변경
10. **섹션 3.6 OracleChain 의사코드**: 교차 검증 편차 임계값 `10%` → `5%`로 변경. CoinGecko 키 설정 시에만 교차 검증 활성화 조건 추가
11. **섹션 4.3 PriceCache maxEntries**: `1,000` → `128`로 변경
12. **섹션 5.1 fallback 경로**: 3단계(CoinGecko→Pyth→Chainlink) → 2단계(Pyth→CoinGecko)로 변경. CoinGecko 키 미설정 시 Pyth 단독 사용 명시

**수정 시 주의사항:**
- 섹션 번호 체계는 유지한다 (3.3 제거 시 후속 섹션 번호를 변경하지 않고, "3.3 [제거됨]" NOTE로 처리하여 기존 참조가 깨지지 않도록 한다)
- 문서 상단의 **작성일**을 유지하되 하단에 "v1.5 업데이트: 2026-02-15" 이력을 추가한다
- `source` enum 변경 시 문서 전체에서 `chainlink`/`jupiter` 문자열을 검색하여 누락 없이 제거한다
  </action>
  <verify>
다음을 확인한다:
- `grep -i chainlink docs/61-price-oracle-spec.md`로 Chainlink 참조가 NOTE(제거 이유 설명)에만 존재하고 구현 의사코드에는 없음을 확인
- `grep -i jupiter docs/61-price-oracle-spec.md`로 Jupiter 참조가 없음을 확인
- `grep "maxEntries" docs/61-price-oracle-spec.md`로 128이 설정되어 있음을 확인
- `grep "10%" docs/61-price-oracle-spec.md`로 10% 편차 임계값이 남아있지 않음을 확인
- `grep "'pyth', 'coingecko', 'cache'" docs/61-price-oracle-spec.md`로 source enum이 3가지임을 확인
  </verify>
  <done>
설계 문서 61이 Pyth Primary + CoinGecko Opt-in Fallback 2단계 구조를 기술하고, Chainlink 구현체/매핑 테이블이 제거되어 있으며, source enum이 ['pyth', 'coingecko', 'cache'] 3가지이고, maxEntries가 128이고, 교차 검증 편차가 5%이다
  </done>
</task>

<task type="auto">
  <name>Task 2: 설계 문서 62/38 v1.5 수정 (MCP Tool 상한 제거 + 14개 현행화)</name>
  <files>docs/62-action-provider-architecture.md, .planning/deliverables/38-sdk-mcp-interface.md</files>
  <action>
두 설계 문서에서 MCP 16개 상한을 제거하고 기존 MCP 도구를 14개로 현행화한다.

**설계 문서 62 수정 항목 (8개):**

1. **섹션 1.3 핵심 원칙 #4**: `"기존 6개 + Action 최대 10개 = 16개 상한"` → `"mcpExpose 플래그로 MCP 노출 범위를 제어한다. 기존 14개 내장 도구는 항상 포함, Action 도구는 mcpExpose=true인 프로바이더만 노출. 도구 수 상한 없음"` 으로 변경
2. **섹션 2.5 에러 타입** (ActionProviderErrorCode): `MCP_TOOL_LIMIT_EXCEEDED` 에러 코드 행 제거
3. **McpToolLimitExceededError 클래스 의사코드**: 전체 제거. 해당 클래스가 정의된 위치를 찾아 제거
4. **ActionProviderRegistry 의사코드**: `MCP_TOOL_MAX` 상수 정의/참조 제거, `MCP_BUILTIN_TOOLS` 상수(= 6)를 14로 변경하거나 상한 검사 자체를 제거, 등록 시 상한 초과 검사 분기 제거
5. **섹션 9 테스트 시나리오**: "MCP Tool이 16개를 초과하면 McpToolLimitExceededError" 테스트 시나리오 제거
6. **에러 코드 표**: `MCP_TOOL_LIMIT_EXCEEDED` 행 제거
7. **부록 C.3 "MCP Tool 16개 상한 근거"**: 섹션 전체 제거. "[제거됨] v1.5에서 MCP 프로토콜에 도구 수 상한이 없으므로 mcpExpose 플래그로 대체" NOTE 추가
8. **문서 전체에서 "기존 6개"**: → "기존 14개"로 변경. 현행 14개 도구 목록을 명시:
   send_token, get_balance, get_address, get_assets, list_transactions, get_transaction, get_nonce, call_contract, approve_token, send_batch, get_wallet_info, encode_calldata, sign_transaction, set_default_network

**설계 문서 38 수정 항목 (5개):**

1. **MCP_TOOL_MAX = 16 상수**: 상수 정의 및 참조하는 모든 의사코드 제거
2. **BUILT_IN_TOOL_COUNT = 6**: → `14`로 변경 (상수명이 다를 수 있으므로 "내장 Tool 6개", "기존 6개" 등의 표현도 검색하여 변경)
3. **MCP Tool 현황 표**: "최대 16" 행 또는 "상한 16" 관련 행 제거, 기존 내장 Tool 14개 목록으로 갱신
4. **변환 프로세스 의사코드**: `if (total > MCP_TOOL_MAX) throw ...` 류의 상한 검사 분기 제거. mcpExpose 필터링만 유지
5. **문서 전체에서 "기존 6개"**: → "기존 14개"로 변경

**수정 시 주의사항:**
- 설계 문서 38의 파일 경로는 `.planning/deliverables/38-sdk-mcp-interface.md`이다 (docs/ 아님)
- 문서 하단에 "v1.5 업데이트: 2026-02-15 — MCP Tool 16개 상한 제거, 기존 도구 14개 현행화" 이력 추가
- "SDK-MCP Pitfall 4 대응" 같은 다른 섹션에서 16개 상한을 참조하는 곳도 검색하여 수정
  </action>
  <verify>
다음을 확인한다:
- `grep -i "16개\|MCP_TOOL_MAX\|MCP_TOOL_LIMIT\|McpToolLimit" docs/62-action-provider-architecture.md`로 16개 상한 참조가 없음을 확인
- `grep "기존 6개" docs/62-action-provider-architecture.md`로 "기존 6개" 표현이 없음을 확인
- `grep "기존 14개" docs/62-action-provider-architecture.md`로 14개로 현행화되었음을 확인
- `grep -i "MCP_TOOL_MAX\|16개 상한" .planning/deliverables/38-sdk-mcp-interface.md`로 상한 참조가 없음을 확인
- `grep "BUILT_IN_TOOL_COUNT.*6\|내장.*Tool.*6개\|기존 6개" .planning/deliverables/38-sdk-mcp-interface.md`로 6개 참조가 없음을 확인
  </verify>
  <done>
설계 문서 62/38에서 MCP 16개 상한이 제거되고, McpToolLimitExceededError/MCP_TOOL_LIMIT_EXCEEDED 관련 코드와 에러가 없고, 기존 MCP 도구가 14개로 정확히 기술되어 있다
  </done>
</task>

</tasks>

<verification>
1. 설계 문서 61: Chainlink 참조가 제거 NOTE에만 존재, source enum이 ['pyth', 'coingecko', 'cache'], maxEntries=128, 교차검증 편차=5%
2. 설계 문서 62: MCP 16개 상한 관련 모든 코드/에러/테스트/부록이 제거, 기존 도구=14개
3. 설계 문서 38: MCP_TOOL_MAX 상수/의사코드 제거, BUILT_IN_TOOL_COUNT=14, 기존 도구=14개
</verification>

<success_criteria>
- grep으로 Chainlink 구현 코드, Jupiter 참조, 10% 편차, MCP_TOOL_MAX, McpToolLimitExceededError, "기존 6개" 표현이 문서에서 검출되지 않는다
- grep으로 ['pyth', 'coingecko', 'cache'], maxEntries=128, 5% 편차, "기존 14개" 표현이 정확히 검출된다
</success_criteria>

<output>
After completion, create `.planning/phases/125-design-docs-oracle-interfaces/125-01-SUMMARY.md`
</output>
