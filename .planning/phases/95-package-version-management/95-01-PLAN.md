---
phase: 95-package-version-management
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/tag-release.sh
  - packages/core/package.json
  - packages/daemon/package.json
  - packages/admin/package.json
  - packages/cli/package.json
  - packages/sdk/package.json
  - packages/mcp/package.json
  - packages/adapters/evm/package.json
  - packages/adapters/solana/package.json
  - python-sdk/pyproject.toml
  - packages/admin/src/__tests__/dashboard.test.tsx
autonomous: true

must_haves:
  truths:
    - "scripts/tag-release.sh <version> 실행 시 모든 package.json과 pyproject.toml의 version 필드가 지정된 버전으로 갱신된다"
    - "스크립트가 git commit + git tag를 생성한다"
    - "현재 코드베이스의 모든 패키지 버전이 v1.4.3으로 표시된다"
    - "Admin UI 대시보드 Version 카드와 GET /doc OpenAPI 문서에 1.4.3이 노출된다"
  artifacts:
    - path: "scripts/tag-release.sh"
      provides: "릴리스 태그 생성 + 버전 일괄 갱신 스크립트"
      contains: "pnpm -r exec"
    - path: "packages/daemon/package.json"
      provides: "데몬 버전 (Admin Status + OpenAPI에 노출)"
      contains: '"version": "1.4.3"'
    - path: "packages/core/package.json"
      provides: "코어 패키지 버전"
      contains: '"version": "1.4.3"'
  key_links:
    - from: "scripts/tag-release.sh"
      to: "packages/*/package.json"
      via: "pnpm -r exec -- npm version"
      pattern: "pnpm -r exec"
    - from: "packages/daemon/src/api/server.ts"
      to: "packages/daemon/package.json"
      via: "require('../../package.json')"
      pattern: "DAEMON_VERSION"
---

<objective>
버전 일괄 갱신 스크립트를 생성하고 현재 코드베이스의 모든 패키지 버전을 v1.4.3으로 갱신한다.

Purpose: 모든 패키지 버전이 0.0.0으로 표시되는 BUG-016을 해결하고, 향후 릴리스에서 `scripts/tag-release.sh`로 일관된 버전 관리가 가능하게 한다.
Output: `scripts/tag-release.sh` 스크립트 + 모든 패키지 버전 1.4.3 갱신
</objective>

<execution_context>
@/Users/minho.yoo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/minho.yoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@objectives/bug-reports/v1.4.1-BUG-016-package-version-zero.md
@packages/daemon/src/api/server.ts (lines 29-30, 290-305 -- DAEMON_VERSION 사용)
@packages/daemon/src/api/routes/health.ts (lines 12-13, 34 -- DAEMON_VERSION 사용)
@pnpm-workspace.yaml (packages/* + packages/adapters/*)
</context>

<tasks>

<task type="auto">
  <name>Task 1: tag-release.sh 스크립트 생성 + 현재 버전 갱신</name>
  <files>
    scripts/tag-release.sh
    packages/core/package.json
    packages/daemon/package.json
    packages/admin/package.json
    packages/cli/package.json
    packages/sdk/package.json
    packages/mcp/package.json
    packages/adapters/evm/package.json
    packages/adapters/solana/package.json
    python-sdk/pyproject.toml
  </files>
  <action>
1. `mkdir -p scripts` (디렉토리 생성)

2. `scripts/tag-release.sh` 생성 (BUG-016 수정안 기반):
```bash
#!/bin/bash
set -euo pipefail

if [ $# -eq 0 ]; then
  echo "Usage: ./scripts/tag-release.sh v1.4.3"
  exit 1
fi

TAG="$1"
VERSION="${TAG#v}"  # v1.4.3 -> 1.4.3

# Validate semver format
if ! [[ "$VERSION" =~ ^[0-9]+\.[0-9]+\.[0-9]+$ ]]; then
  echo "ERROR: Invalid version format '$VERSION'. Expected: X.Y.Z"
  exit 1
fi

echo "Bumping all packages to $VERSION..."

# Update all Node.js packages (packages/* and packages/adapters/*)
pnpm -r exec -- npm version "$VERSION" --no-git-tag-version

# Update Python SDK version in pyproject.toml
if [ -f python-sdk/pyproject.toml ]; then
  sed -i '' "s/^version = \".*\"/version = \"$VERSION\"/" python-sdk/pyproject.toml
  echo "Updated python-sdk/pyproject.toml to $VERSION"
fi

# Stage all version changes
git add packages/*/package.json packages/adapters/*/package.json python-sdk/pyproject.toml

# Commit and tag
git commit -m "chore: bump version to $VERSION"
git tag "$TAG"

echo ""
echo "Done: package.json + pyproject.toml -> $VERSION, tag -> $TAG"
echo "To push: git push && git push origin $TAG"
```

3. `chmod +x scripts/tag-release.sh`

4. 모든 패키지 버전을 1.4.3으로 즉시 갱신:
   - 8개 package.json: `"version": "0.0.0"` -> `"version": "1.4.3"`
   - python-sdk/pyproject.toml: `version = "0.1.0"` -> `version = "1.4.3"`

   수동으로 각 파일의 version 필드를 변경한다 (스크립트 자체는 향후 릴리스용).
   커밋과 태그 생성은 이 플랜의 범위 밖 -- 실행기가 gsd-tools commit으로 처리.

주의: macOS sed는 `-i ''` 구문을 사용. 스크립트도 macOS 호환으로 작성.
  </action>
  <verify>
    - `cat scripts/tag-release.sh` 확인 (semver 검증, pnpm -r exec, pyproject.toml sed, git add/commit/tag)
    - `ls -la scripts/tag-release.sh` 실행 권한 확인 (chmod +x)
    - `grep '"version"' packages/*/package.json packages/adapters/*/package.json` -- 모두 "1.4.3"
    - `grep 'version' python-sdk/pyproject.toml` -- "1.4.3"
  </verify>
  <done>
    - scripts/tag-release.sh가 존재하고 실행 가능하며, semver 검증 + pnpm 일괄 갱신 + pyproject.toml 갱신 + git commit/tag 기능을 포함한다
    - 8개 package.json의 version이 "1.4.3"이다
    - python-sdk/pyproject.toml의 version이 "1.4.3"이다
  </done>
</task>

<task type="auto">
  <name>Task 2: Dashboard 테스트 픽스 + 버전 노출 검증</name>
  <files>
    packages/admin/src/__tests__/dashboard.test.tsx
  </files>
  <action>
1. `packages/admin/src/__tests__/dashboard.test.tsx` 수정:
   - 라인 51: `version: '0.1.0'` -> `version: '1.4.3'`
   - 라인 74, 124: `'0.1.0'` -> `'1.4.3'`

   mock 데이터의 버전을 현재 패키지 버전과 일치시킨다.

2. 테스트 실행으로 검증:
   - `pnpm --filter @waiaas/admin test` -- dashboard 테스트 통과 확인

3. 데몬 버전 노출 경로 확인 (코드 변경 불필요, 검증만):
   - `packages/daemon/src/api/server.ts` 라인 30: `require('../../package.json')` -> DAEMON_VERSION = "1.4.3"
   - `packages/daemon/src/api/routes/health.ts` 라인 13: `require('../../../package.json')` -> DAEMON_VERSION = "1.4.3"
   - Admin Status 응답의 `version` 필드와 OpenAPI 스키마의 `info.version`이 자동으로 1.4.3을 반환하게 됨

참고: 데몬의 server.ts와 health.ts는 코드 변경이 필요 없다. 이미 package.json에서 동적으로 version을 읽는 구조이므로 package.json 갱신만으로 충분하다.
  </action>
  <verify>
    - `pnpm --filter @waiaas/admin test` 통과 (dashboard 테스트 포함)
    - `grep '1.4.3' packages/admin/src/__tests__/dashboard.test.tsx` -- 3곳 일치
  </verify>
  <done>
    - Dashboard 테스트의 mock 버전이 "1.4.3"으로 갱신되어 테스트가 통과한다
    - 데몬의 DAEMON_VERSION이 package.json에서 동적으로 "1.4.3"을 읽는 것이 확인된다
  </done>
</task>

</tasks>

<verification>
1. `grep '"version"' packages/*/package.json packages/adapters/*/package.json` -- 모든 패키지가 "1.4.3"
2. `grep 'version' python-sdk/pyproject.toml` -- "1.4.3"
3. `test -x scripts/tag-release.sh` -- 실행 가능
4. `pnpm --filter @waiaas/admin test` -- dashboard 테스트 통과
5. DAEMON_VERSION 동적 로딩 확인: packages/daemon/src/api/server.ts 라인 30에서 package.json 읽기
</verification>

<success_criteria>
- scripts/tag-release.sh가 실행 가능하고 semver 검증/pnpm 일괄 갱신/git commit+tag를 수행한다
- 8개 Node.js 패키지 + Python SDK의 version이 "1.4.3"이다
- Admin UI Dashboard 테스트가 통과한다
- GET /v1/admin/status의 version 필드가 자동으로 "1.4.3"을 반환하는 구조가 확인된다
</success_criteria>

<output>
After completion, create `.planning/phases/95-package-version-management/95-01-SUMMARY.md`
</output>
