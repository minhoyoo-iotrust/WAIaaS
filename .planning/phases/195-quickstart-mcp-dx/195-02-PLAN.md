---
phase: 195-quickstart-mcp-dx
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/cli/src/commands/mcp-setup.ts
  - packages/cli/src/__tests__/mcp-setup.test.ts
autonomous: true
requirements: [DAEMON-04, MCP-01]

must_haves:
  truths:
    - "mcp setup에서 지갑이 없을 때 'Run waiaas quickstart first'로 안내한다"
    - "mcp setup 성공 시 기본 만료 기간(24h) 경고와 --expires-in 옵션이 안내된다"
  artifacts:
    - path: "packages/cli/src/commands/mcp-setup.ts"
      provides: "MCP setup with quickstart guidance and expiry warning"
      contains: "Run waiaas quickstart first"
    - path: "packages/cli/src/__tests__/mcp-setup.test.ts"
      provides: "Tests for quickstart guidance and expiry warning"
  key_links:
    - from: "packages/cli/src/commands/mcp-setup.ts"
      to: "console.error('Run waiaas quickstart first')"
      via: "no-wallets error path"
      pattern: "quickstart first"
    - from: "packages/cli/src/commands/mcp-setup.ts"
      to: "24h expiry warning output"
      via: "success path post-session-creation"
      pattern: "expires-in"
---

<objective>
mcp setup 명령의 에러 메시지와 성공 안내를 개선한다: (1) 지갑 미존재 시 "Run waiaas quickstart first" 안내, (2) 성공 시 기본 만료(24h) 경고와 --expires-in 옵션 안내.

Purpose: MCP 설정 과정에서 사용자가 막히지 않도록 명확한 안내를 제공한다.
Output: 수정된 mcp-setup.ts + 업데이트된 테스트
</objective>

<execution_context>
@/Users/minho.yoo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/minho.yoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@packages/cli/src/commands/mcp-setup.ts
@packages/cli/src/__tests__/mcp-setup.test.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: mcp-setup 에러 메시지 + 만료 안내 수정</name>
  <files>packages/cli/src/commands/mcp-setup.ts</files>
  <action>
2가지 수정을 mcp-setup.ts에 적용한다:

**DAEMON-04 (에러 메시지 변경):** "Run waiaas init first" -> "Run waiaas quickstart first"
- Line 161: `console.error('Error: No wallets found. Run waiaas init first.');`
  -> `console.error('Error: No wallets found. Run waiaas quickstart first.');`
- Line 209: `console.error('Error: No wallets found. Run waiaas init first.');`
  -> `console.error('Error: No wallets found. Run waiaas quickstart first.');`

**MCP-01 (만료 안내):** 세션 생성 성공 후 기본 만료 경고 + --expires-in 옵션을 안내한다.
- 단일 지갑 플로우 (약 line 265-268, Step 6 Output result 영역):
  현재 출력 후에 다음을 추가한다:
  ```
  console.log('');
  console.log('Note: Session expires in 24 hours by default.');
  console.log('  Use --expires-in <seconds> to customize (e.g., --expires-in 604800 for 7 days).');
  ```
  단, expiresIn이 기본값(86400)인 경우에만 경고를 표시한다. 사용자가 명시적으로 --expires-in을 지정한 경우(expiresIn !== 86400)에는 경고하지 않는다.
  이를 위해 `mcpSetupCommand` 함수에 기본값 여부를 판별할 수 있도록 한다. 현재 `expiresIn`은 기본값 86400으로 설정되어 있다. 사용자가 명시적으로 값을 전달했는지 여부는 `opts.expiresIn`이 undefined인지로 판별한다:
  - `const isDefaultExpiry = opts.expiresIn === undefined;`
  - 또는 단순히 `expiresIn === 86400`일 때 경고를 표시하는 방식도 가능 (사용자가 명시적으로 86400을 전달한 경우도 포함하지만 실용적으로 문제 없음).
  - 간단한 접근: `expiresIn === 86400`일 때 경고 표시.

- --all 플로우 (약 line 192-196, combined config 출력 후):
  동일한 경고 메시지를 추가한다. 역시 `expiresIn === 86400`일 때만.
  </action>
  <verify>
`pnpm turbo run typecheck --filter=@waiaas/cli` -- 타입 에러 없음.
`grep 'waiaas init first' packages/cli/src/commands/mcp-setup.ts` -- 결과 없음 (quickstart first로 교체됨).
`grep 'quickstart first' packages/cli/src/commands/mcp-setup.ts` -- 2건 확인.
`grep 'expires-in' packages/cli/src/commands/mcp-setup.ts` -- 안내 문구 확인.
  </verify>
  <done>
mcp-setup.ts에서 (1) 지갑 미존재 시 "Run waiaas quickstart first" 안내, (2) 성공 시 기본 만료(24h) 경고와 --expires-in 옵션 안내가 표시된다.
  </done>
</task>

<task type="auto">
  <name>Task 2: mcp-setup 테스트 업데이트</name>
  <files>packages/cli/src/__tests__/mcp-setup.test.ts</files>
  <action>
기존 테스트를 수정하고 새 테스트를 추가한다:

**기존 테스트 수정:**
1. 'no wallets -> error' 테스트 (약 line 187-208): assertion을 `'No wallets found. Run waiaas init first'`에서 `'No wallets found. Run waiaas quickstart first'`로 수정한다.
   - 현재: `expect(mockStderr).toHaveBeenCalledWith(expect.stringContaining('No wallets found'))`
   - 이 assertion은 이미 부분 매칭이므로 통과하겠지만, "quickstart first"를 명시적으로 검증하도록 더 specific하게 변경한다:
   - `expect(mockStderr).toHaveBeenCalledWith(expect.stringContaining('Run waiaas quickstart first'))`
2. 'CLIP-05: --all + 0 wallets -> error' 테스트도 동일하게 수정한다.

**새 테스트 추가:**
1. **DAEMON-04 테스트 (no wallets -> quickstart guidance):**
   지갑이 0개일 때 에러 메시지에 "Run waiaas quickstart first"가 포함되고 "Run waiaas init first"가 포함되지 않음을 명시적으로 검증한다.

2. **MCP-01 테스트 (default expiry warning):**
   기본 expiresIn(86400, 즉 opts.expiresIn 미지정)으로 mcp setup을 실행하면:
   - `'Session expires in 24 hours by default'` 문자열이 출력됨을 검증.
   - `'--expires-in'` 옵션 안내가 출력됨을 검증.

3. **MCP-01 테스트 (custom expiry -> no warning):**
   expiresIn을 7200(2시간)으로 지정하면:
   - `'Session expires in 24 hours by default'` 문자열이 출력되지 않음을 검증.

4. **MCP-01 + --all 테스트:**
   `--all` 모드에서도 기본 만료 경고가 출력됨을 검증한다. 기존 CLIP-04 테스트와 유사한 fetch mock을 사용하되, 출력에 만료 경고가 포함되는지 확인한다.

**테스트 mock 패턴:** 기존 파일의 패턴을 유지한다 (`vi.stubGlobal('fetch')`, `mockStdout`/`mockStderr`, `process.exit` mock 등).
  </action>
  <verify>
`cd /Users/minho.yoo/dev/wallet/WAIaaS && pnpm turbo run test --filter=@waiaas/cli` -- 모든 테스트 통과.
  </verify>
  <done>
mcp-setup 테스트에서 (1) "Run waiaas quickstart first" 에러 메시지 검증, (2) 기본 만료 경고 출력 검증, (3) 커스텀 만료 시 경고 미출력 검증, (4) --all 모드 만료 경고 검증이 모두 통과한다.
  </done>
</task>

</tasks>

<verification>
1. `pnpm turbo run typecheck --filter=@waiaas/cli` 통과
2. `pnpm turbo run test --filter=@waiaas/cli` 전체 통과
3. `pnpm turbo run lint --filter=@waiaas/cli` 통과
4. mcp-setup.ts에 "waiaas init first" 문자열이 없음 ("waiaas quickstart first"만 존재)
5. 기본 만료(86400) 사용 시 경고 메시지 출력됨
</verification>

<success_criteria>
- mcp setup에서 지갑 미존재 시 "Run waiaas quickstart first"로 안내
- mcp setup 성공 시 기본 만료(24h) 경고 + --expires-in 옵션 안내 표시
- 사용자가 명시적으로 --expires-in을 지정한 경우 경고 미표시
- 모든 기존 테스트 + 4개 이상 신규 테스트 통과
</success_criteria>

<output>
After completion, create `.planning/phases/195-quickstart-mcp-dx/195-02-SUMMARY.md`
</output>
