---
phase: 195-quickstart-mcp-dx
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/cli/src/commands/quickstart.ts
  - packages/cli/src/__tests__/quickstart.test.ts
autonomous: true
requirements: [QS-01, QS-02, QS-03, QS-04]

must_haves:
  truths:
    - "quickstart 출력에 한글이 포함되지 않는다 (전체 영문)"
    - "토큰 발급 후 만료 시점이 Expires at: YYYY-MM-DD HH:mm 형식으로 표시된다"
    - "동일 이름 지갑이 이미 존재(409)하면 에러 대신 기존 지갑을 재사용하고 세션만 재발급한다"
    - "네트워크 목록을 API 응답의 availableNetworks 필드로 정확히 읽는다"
  artifacts:
    - path: "packages/cli/src/commands/quickstart.ts"
      provides: "Quickstart command with English output, idempotent wallet creation, correct field reading"
      contains: "availableNetworks"
    - path: "packages/cli/src/__tests__/quickstart.test.ts"
      provides: "Tests for English output, idempotency, expires display, availableNetworks"
  key_links:
    - from: "packages/cli/src/commands/quickstart.ts"
      to: "GET /v1/wallets/:id/networks"
      via: "fetch response parsing"
      pattern: "availableNetworks"
    - from: "packages/cli/src/commands/quickstart.ts"
      to: "POST /v1/wallets (409 handling)"
      via: "fetch walletRes.status === 409"
      pattern: "409"
---

<objective>
quickstart 명령의 4가지 DX 문제를 수정한다: (1) 한글 출력을 영문으로 전환, (2) 세션 토큰 만료 시점 표시, (3) 동일 지갑 존재 시 멱등 재사용, (4) availableNetworks 필드명 수정.

Purpose: 사용자가 quickstart를 반복 실행해도 에러 없이 진행되고, 출력이 전체 영문이며, 토큰 만료와 네트워크 정보가 정확히 표시된다.
Output: 수정된 quickstart.ts + 업데이트된 테스트
</objective>

<execution_context>
@/Users/minho.yoo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/minho.yoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@packages/cli/src/commands/quickstart.ts
@packages/cli/src/__tests__/quickstart.test.ts
@packages/daemon/src/api/routes/openapi-schemas.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: quickstart 영문화 + 만료 표시 + availableNetworks 필드 수정</name>
  <files>packages/cli/src/commands/quickstart.ts</files>
  <action>
4가지 수정 사항을 quickstart.ts에 적용한다:

**QS-01 (영문화):** 다음 한글 문자열을 영문으로 교체한다.
- Line 264: `'(claude_desktop_config.json에 추가하세요)'` -> `'(Add to your claude_desktop_config.json)'`
- Line 284: `'\uC138\uC158\uC774 \uB9CC\uB8CC\uB418\uBA74(401 Unauthorized)'` -> `'If the session expires (401 Unauthorized),'`
- Line 285: `'POST /v1/wallets/{walletId}/sessions/{sessionId}/renew \uC73C\uB85C \uAC31\uC2E0\uD558\uC138\uC694.'` -> `'renew it via POST /v1/wallets/{walletId}/sessions/{sessionId}/renew'`
- Line 287: `'\uC704 \uC815\uBCF4\uB85C WAIaaS \uC9C0\uAC11\uC5D0 \uC5F0\uACB0\uD558\uC5EC \uC794\uC561\uC744 \uD655\uC778\uD558\uACE0 \uAD00\uB9AC\uD574\uC8FC\uC138\uC694.'` -> `'Use the above info to connect to WAIaaS wallets, check balances, and manage transactions.'`

**QS-02 (만료 시점 표시):** 세션 토큰 발급 후 만료 시점을 출력한다.
- `createSessionAndWriteToken` 함수의 반환값에 이미 `expiresAt`이 포함되어 있다.
- 지갑 정보를 출력하는 Step 5 영역(약 line 246-258)에서 각 지갑별로, 또는 모든 지갑 출력 후에 `Expires at: YYYY-MM-DD HH:mm` 형식으로 만료 시점을 출력한다.
- `CreatedWallet` 인터페이스에 `expiresAt: number | null` 필드를 추가한다.
- 지갑 생성 시 `walletData.session?.expiresAt`을 저장하고, fallback 세션 생성 시에도 expiresAt을 저장한다.
- 만료 시점 포맷: `new Date(expiresAt * 1000).toLocaleString('en-US', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', hour12: false })` 형태를 사용하되, 단순히 `YYYY-MM-DD HH:mm` 형식이면 된다. 예: `Expires at: 2026-02-20 14:30`

**QS-03 (멱등성 - 409 처리):** wallet 생성 시 409(Conflict) 응답을 처리한다.
- `POST /v1/wallets`가 409를 반환하면(동일 이름 존재), 기존 지갑을 가져온다.
- 409 수신 시: `GET /v1/wallets` 목록에서 동일 이름의 지갑을 찾아 재사용한다.
- 기존 지갑을 찾으면 해당 지갑의 id, name, chain, environment, publicKey를 사용한다.
- 기존 지갑의 session은 null이므로 fallback 경로(createSessionAndWriteToken)로 세션을 새로 발급한다.
- 로그: `console.log(\`Reusing existing wallet: \${wallet.name} (\${wallet.id})\`)` 출력.

**QS-04 (availableNetworks 필드):** 네트워크 API 응답 파싱을 수정한다.
- Line 191: `const networksData = await networksRes.json() as { networks: NetworkInfo[] };`
  -> `const networksData = await networksRes.json() as { availableNetworks: NetworkInfo[] };`
- Line 192: `availableNetworks = (networksData.networks ?? []).map((n) => n.network);`
  -> `availableNetworks = (networksData.availableNetworks ?? []).map((n) => n.network);`
  </action>
  <verify>
`pnpm turbo run typecheck --filter=@waiaas/cli` -- 타입 에러 없음.
`grep -rn '한글패턴\|추가하세요\|갱신하세요\|확인하고\|만료되면' packages/cli/src/commands/quickstart.ts` -- 한글 없음 확인.
`grep 'networksData.networks' packages/cli/src/commands/quickstart.ts` -- 결과 없음 (availableNetworks로 교체됨).
  </verify>
  <done>
quickstart.ts에서 (1) 모든 출력이 영문, (2) 만료 시점이 Expires at: 형식으로 표시, (3) 409 응답 시 기존 지갑 재사용, (4) availableNetworks 필드로 올바르게 읽음.
  </done>
</task>

<task type="auto">
  <name>Task 2: quickstart 테스트 업데이트</name>
  <files>packages/cli/src/__tests__/quickstart.test.ts</files>
  <action>
기존 테스트를 수정하고 새 테스트를 추가한다:

**기존 테스트 수정:**
1. `createQuickstartFetchMock` 함수에서 `POST /v1/wallets` 응답에 `session` 필드를 추가한다 (현재 누락됨).
   - `session: { id: 'session-N', token: 'jwt.token.N', expiresAt: Math.floor(Date.now() / 1000) + 86400 }`
   - 이렇게 하면 quickstart가 fallback 세션 생성을 건너뛰므로 fetch 호출 횟수가 변경될 수 있다. 이 경우 기존 테스트의 `expect(calls.length).toBe(7)` 같은 assertion을 조정한다 (7 -> 5: health + 2 wallet POST + 2 networks GET).
2. 'testnet mode' 테스트에서 `Expires at:` 출력이 포함되는지 검증을 추가한다.
3. `'(claude_desktop_config.json에 추가하세요)'` -> 새 영문 문자열로 assertion을 교체한다.

**새 테스트 추가:**
1. **QS-01 영문 전용 테스트:** quickstart 실행 후 console.log/console.error의 모든 출력을 순회하여 한글(정규식 `/[\uAC00-\uD7AF\u1100-\u11FF]/`)이 포함되지 않음을 검증한다.
2. **QS-02 만료 시점 테스트:** quickstart 실행 후 `Expires at:` 문자열이 `YYYY-MM-DD HH:mm` 패턴으로 출력되는지 검증한다.
3. **QS-03 멱등성 테스트 (409 handling):** wallet creation이 409를 반환하면 `GET /v1/wallets`로 기존 지갑 목록을 조회하고, 동일 이름 지갑을 재사용하며, 세션만 새로 발급하는 흐름을 검증한다. `Reusing existing wallet:` 로그가 출력되는지 확인한다. 기존 지갑 재사용 후 MCP 토큰 파일이 정상 생성되는지 확인한다.
4. **QS-04 availableNetworks 필드 테스트:** fetch mock의 networks 응답을 `{ availableNetworks: [...] }` 형태로만 반환하게 하고(`networks` 키 없음), quickstart가 정확히 파싱하는지 검증한다. 이 테스트는 기존 'testnet mode' 테스트에서 이미 간접 검증되지만, 명시적으로 `networks` 키가 없는 응답도 처리됨을 확인한다.

**테스트 mock 패턴:** 기존 파일의 `vi.stubGlobal('fetch')` + `vi.doMock('../utils/password.js')` + `vi.spyOn(process, 'exit')` 패턴을 유지한다.
  </action>
  <verify>
`cd /Users/minho.yoo/dev/wallet/WAIaaS && pnpm turbo run test --filter=@waiaas/cli` -- 모든 테스트 통과.
  </verify>
  <done>
quickstart 테스트에서 (1) 한글 미포함 검증, (2) 만료 시점 출력 검증, (3) 409 멱등성 검증, (4) availableNetworks 필드 파싱 검증이 모두 통과한다.
  </done>
</task>

</tasks>

<verification>
1. `pnpm turbo run typecheck --filter=@waiaas/cli` 통과
2. `pnpm turbo run test --filter=@waiaas/cli` 전체 통과
3. `pnpm turbo run lint --filter=@waiaas/cli` 통과
4. quickstart.ts에 한글 문자열이 없음
5. quickstart.ts에서 `networksData.networks` 참조가 없음 (`availableNetworks`만 사용)
</verification>

<success_criteria>
- quickstart 출력이 전체 영문 (한글 0건)
- 토큰 발급 후 `Expires at: YYYY-MM-DD HH:mm` 형식 만료 시점 표시
- 동일 이름 지갑 존재(409) 시 기존 지갑 재사용 + 세션만 재발급
- availableNetworks 필드를 올바르게 읽어 네트워크 목록 표시
- 모든 기존 테스트 + 4개 이상 신규 테스트 통과
</success_criteria>

<output>
After completion, create `.planning/phases/195-quickstart-mcp-dx/195-01-SUMMARY.md`
</output>
