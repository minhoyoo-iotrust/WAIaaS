---
phase: 234-mcp-sdk-skills-integration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/sdk/src/types.ts
  - python-sdk/waiaas/models.py
  - skills/transactions.skill.md
  - skills/policies.skill.md
  - skills/quickstart.skill.md
autonomous: true
requirements: [MCPS-03, MCPS-04, SKIL-01, SKIL-02]

must_haves:
  truths:
    - "TypeScript SDK TokenInfo interface includes optional assetId field"
    - "TypeScript SDK AssetInfo interface includes optional assetId field"
    - "Python SDK TokenInfo model includes optional asset_id field with alias assetId"
    - "Python SDK AssetInfo model includes optional asset_id field with alias assetId"
    - "Python SDK SendTokenRequest model includes assetId support via nested TokenInfo"
    - "transactions.skill.md documents CAIP-19 assetId usage in TOKEN_TRANSFER and APPROVE requests"
    - "policies.skill.md documents CAIP-19 assetId in ALLOWED_TOKENS token entries"
    - "quickstart.skill.md introduces CAIP-19 asset identification concept"
  artifacts:
    - path: "packages/sdk/src/types.ts"
      provides: "TokenInfo and AssetInfo with optional assetId field"
      contains: "assetId"
    - path: "python-sdk/waiaas/models.py"
      provides: "TokenInfo and AssetInfo with optional asset_id field"
      contains: "asset_id"
    - path: "skills/transactions.skill.md"
      provides: "CAIP-19 assetId documentation section"
      contains: "CAIP-19"
    - path: "skills/policies.skill.md"
      provides: "CAIP-19 assetId in ALLOWED_TOKENS documentation"
      contains: "assetId"
    - path: "skills/quickstart.skill.md"
      provides: "CAIP-19 introduction section"
      contains: "CAIP-19"
  key_links:
    - from: "packages/sdk/src/types.ts"
      to: "packages/sdk/src/client.ts"
      via: "TokenInfo used in SendTokenParams.token"
      pattern: "token\\?: TokenInfo"
    - from: "python-sdk/waiaas/models.py"
      to: "python-sdk/waiaas/client.py"
      via: "TokenInfo used in SendTokenRequest.token"
      pattern: "token: Optional\\[TokenInfo\\]"
---

<objective>
Add optional CAIP-19 assetId fields to TypeScript SDK types and Python SDK Pydantic models, then document CAIP-19 asset identification in 3 skill files so AI agents and developers can use standard asset URIs.

Purpose: SDK consumers need type-level support for assetId to get autocompletion and type-safety. Skill files provide AI-readable documentation that teaches agents about the CAIP-19 format for cross-chain token identification.

Output: 2 updated SDK type files + 3 updated skill files with CAIP-19 documentation.
</objective>

<execution_context>
@/Users/minho.yoo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/minho.yoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/234-mcp-sdk-skills-integration/234-RESEARCH.md
@packages/sdk/src/types.ts
@python-sdk/waiaas/models.py
@skills/transactions.skill.md
@skills/policies.skill.md
@skills/quickstart.skill.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add assetId to TypeScript and Python SDK types</name>
  <files>
    packages/sdk/src/types.ts
    python-sdk/waiaas/models.py
  </files>
  <action>
**TypeScript SDK (packages/sdk/src/types.ts):**

1. Add `assetId` to `TokenInfo` interface (line ~98-102):
   ```typescript
   export interface TokenInfo {
     address: string;
     decimals: number;
     symbol: string;
     /** CAIP-19 asset identifier (e.g., "eip155:1/erc20:0xa0b8..."). Optional -- daemon cross-validates against address when provided. */
     assetId?: string;
   }
   ```

2. Add `assetId` to `AssetInfo` interface (line ~77-85):
   ```typescript
   export interface AssetInfo {
     mint: string;
     symbol: string;
     name: string;
     balance: string;
     decimals: number;
     isNative: boolean;
     usdValue?: number;
     /** CAIP-19 asset identifier. Present in daemon responses for registered tokens. */
     assetId?: string;
   }
   ```

Note: `SendTokenParams` already has `token?: TokenInfo`, so it automatically inherits assetId via the TokenInfo reference. No separate change needed.

**IMPORTANT:** Do NOT add any validation logic to the SDK. The SDK is zero-dependency; all validation happens in the daemon.

**Python SDK (python-sdk/waiaas/models.py):**

1. Add `asset_id` to `TokenInfo` class (line ~138-143). TokenInfo currently has NO `model_config`, so it must be added:
   ```python
   class TokenInfo(BaseModel):
       """Token identification for TOKEN_TRANSFER/APPROVE transactions."""

       address: str
       decimals: int
       symbol: str
       asset_id: Optional[str] = Field(default=None, alias="assetId")

       model_config = {"populate_by_name": True}
   ```

2. Add `asset_id` to `AssetInfo` class (line ~36-45). AssetInfo already has `model_config`:
   ```python
   class AssetInfo(BaseModel):
       mint: str
       symbol: str
       name: str
       balance: str
       decimals: int
       is_native: bool = Field(alias="isNative")
       usd_value: Optional[float] = Field(default=None, alias="usdValue")
       asset_id: Optional[str] = Field(default=None, alias="assetId")

       model_config = {"populate_by_name": True}
   ```

3. `SendTokenRequest` already has `token: Optional[TokenInfo] = None`, so it inherits assetId via the nested TokenInfo model. No separate change needed.

**Pitfall avoidance:** TokenInfo MUST get `model_config = {"populate_by_name": True}` when adding the aliased field, otherwise `TokenInfo(asset_id="...")` constructor would fail.
  </action>
  <verify>
    Run `pnpm turbo run typecheck --filter=@waiaas/sdk` to verify TS types compile.
    Run `cd python-sdk && python -c "from waiaas.models import TokenInfo, AssetInfo; t = TokenInfo(address='0x1', decimals=6, symbol='T', asset_id='eip155:1/erc20:0x1'); print(t.model_dump(by_alias=True))"` to verify Python model works with both snake_case and alias.
  </verify>
  <done>
    TypeScript TokenInfo and AssetInfo include optional assetId field with JSDoc comments. Python TokenInfo and AssetInfo include optional asset_id field with alias="assetId" and model_config. SendTokenParams/SendTokenRequest inherit assetId via nested TokenInfo.
  </done>
</task>

<task type="auto">
  <name>Task 2: Document CAIP-19 assetId in skill files</name>
  <files>
    skills/transactions.skill.md
    skills/policies.skill.md
    skills/quickstart.skill.md
  </files>
  <action>
**transactions.skill.md:**

1. Add a new section "## 13. CAIP-19 Asset Identification" at the end of the file (after section 12):

```markdown
## 13. CAIP-19 Asset Identification

WAIaaS supports [CAIP-19](https://github.com/ChainAgnostic/CAIPs/blob/main/CAIPs/caip-19.md) standard asset identifiers for cross-chain token identification. The `assetId` field is an optional addition to token objects in TOKEN_TRANSFER and APPROVE requests.

### Format

```
{CAIP-2 chain ID}/{asset namespace}:{asset reference}
```

### Examples by Chain

| Chain | Type | assetId | Description |
|-------|------|---------|-------------|
| Ethereum | ERC-20 | `eip155:1/erc20:0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48` | USDC on Ethereum Mainnet |
| Polygon | ERC-20 | `eip155:137/erc20:0x3c499c542cef5e3811e1192ce70d8cc03d5c3359` | USDC on Polygon |
| Solana | SPL | `solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp/token:EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v` | USDC on Solana Mainnet |
| Ethereum | Native | `eip155:1/slip44:60` | ETH (native) |
| Solana | Native | `solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp/slip44:501` | SOL (native) |
| Polygon | Native | `eip155:137/slip44:966` | POL (native) |

**Important:** EVM addresses in CAIP-19 must be **lowercase** (not checksummed).

### Usage in TOKEN_TRANSFER

```bash
curl -s -X POST http://localhost:3100/v1/transactions/send \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer wai_sess_eyJ...' \
  -d '{
    "type": "TOKEN_TRANSFER",
    "to": "0x742d35Cc6634C0532925a3b844Bc9e7595f2bD16",
    "amount": "5000000",
    "token": {
      "address": "0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48",
      "decimals": 6,
      "symbol": "USDC",
      "assetId": "eip155:1/erc20:0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48"
    }
  }'
```

### Usage in APPROVE

```bash
curl -s -X POST http://localhost:3100/v1/transactions/send \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer wai_sess_eyJ...' \
  -d '{
    "type": "APPROVE",
    "spender": "0xE592427A0AEce92De3Edee1F18E0157C05861564",
    "token": {
      "address": "0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48",
      "decimals": 6,
      "symbol": "USDC",
      "assetId": "eip155:1/erc20:0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48"
    },
    "amount": "1000000000"
  }'
```

### Cross-Validation

When both `address` and `assetId` are provided, the daemon extracts the address from the CAIP-19 URI and validates it matches `token.address` (case-insensitive for EVM). If they don't match, the request is rejected with `ACTION_VALIDATION_FAILED`.

### Backward Compatibility

`assetId` is fully optional. Existing requests without `assetId` continue to work unchanged. You can gradually adopt CAIP-19 identifiers without breaking existing integrations.
```

2. Add `assetId` to the token parameter list in section 3 (TOKEN_TRANSFER) parameters. After the existing `symbol` bullet, add:
   ```
   - `assetId` (optional): CAIP-19 asset identifier (e.g., `"eip155:1/erc20:0xa0b8..."`). Cross-validated against `address` when provided.
   ```

3. Add `assetId` to the token parameter list in section 5 (APPROVE) parameters. After the existing `symbol` bullet, add:
   ```
   - `assetId` (optional): CAIP-19 asset identifier. Cross-validated against `address` when provided.
   ```

**policies.skill.md:**

1. Update section "### e. ALLOWED_TOKENS" to show assetId in token entries. Update the rules schema JSON example to include assetId:
   ```json
   {
     "tokens": [
       {"address": "<mint-or-contract>", "symbol": "USDC", "chain": "solana"},
       {"address": "<erc20-address>", "symbol": "USDT", "chain": "ethereum", "assetId": "eip155:1/erc20:<erc20-address>"}
     ]
   }
   ```

2. Add `assetId` to the ALLOWED_TOKENS field table after `chain`:
   ```
   | `assetId` | string | No       | CAIP-19 asset identifier. Enables cross-chain matching. |
   ```

3. Add a brief note after the field table:
   ```
   **CAIP-19 matching:** When `assetId` is present in both the policy token entry and the transaction's token object, exact CAIP-19 matching is used (highest confidence). When only one side has `assetId`, the daemon extracts and compares addresses. When neither has `assetId`, legacy address-only matching is used. All 4 scenarios are backward compatible.
   ```

4. Update the "Allow USDC token transfers" workflow example in section 4 to optionally show assetId.

**quickstart.skill.md:**

1. Add a new section "## Asset Identification (CAIP-19)" after the "Next Steps" section (at the end of the file):

```markdown
## Asset Identification (CAIP-19)

WAIaaS supports CAIP-19 standard asset identifiers for unambiguous cross-chain token identification. When sending token transfers, you can include an optional `assetId` field in the token object:

```bash
curl -s -X POST http://localhost:3100/v1/transactions/send \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer wai_sess_eyJ...' \
  -d '{
    "type": "TOKEN_TRANSFER",
    "to": "9aE476sH92Vz7DMPyq5WLPkrKWivxeuTKEFKd2sZZcde",
    "amount": "5000000",
    "token": {
      "address": "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",
      "decimals": 6,
      "symbol": "USDC",
      "assetId": "solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp/token:EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"
    }
  }'
```

CAIP-19 format: `{chain_id}/{asset_namespace}:{asset_reference}`
- EVM tokens: `eip155:{chainId}/erc20:{lowercase_address}`
- Solana tokens: `solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp/token:{base58_address}`
- Native assets: `{chain_id}/slip44:{coin_type}` (ETH=60, SOL=501, POL=966)

The `assetId` field is optional and backward compatible. See **transactions.skill.md** section 13 for full CAIP-19 reference.
```
  </action>
  <verify>
    Run `pnpm turbo run typecheck --filter=@waiaas/sdk` to verify TS types still compile.
    Grep for "CAIP-19" in skills/*.skill.md to confirm all 3 files contain the documentation.
    Grep for "assetId" in skills/transactions.skill.md and skills/policies.skill.md to confirm parameter documentation.
  </verify>
  <done>
    TypeScript SDK TokenInfo and AssetInfo include optional assetId. Python SDK TokenInfo and AssetInfo include optional asset_id with alias. transactions.skill.md has full CAIP-19 section (section 13) + assetId in TOKEN_TRANSFER and APPROVE parameter lists. policies.skill.md ALLOWED_TOKENS section shows assetId with 4-scenario matching note. quickstart.skill.md introduces CAIP-19 concept with example.
  </done>
</task>

</tasks>

<verification>
1. `pnpm turbo run typecheck --filter=@waiaas/sdk` passes with 0 errors
2. Python SDK models import and instantiate correctly with assetId field
3. All 3 skill files contain "CAIP-19" documentation
4. transactions.skill.md has section 13 with CAIP-19 format table and examples
5. policies.skill.md ALLOWED_TOKENS section includes assetId field and matching note
6. quickstart.skill.md has CAIP-19 intro section
7. No existing content broken in any skill file
</verification>

<success_criteria>
- TypeScript SDK TokenInfo has `assetId?: string` with JSDoc
- TypeScript SDK AssetInfo has `assetId?: string` with JSDoc
- Python SDK TokenInfo has `asset_id: Optional[str] = Field(default=None, alias="assetId")` with model_config
- Python SDK AssetInfo has `asset_id: Optional[str] = Field(default=None, alias="assetId")`
- transactions.skill.md documents CAIP-19 in new section 13 + parameter lists in sections 3 and 5
- policies.skill.md documents assetId in ALLOWED_TOKENS with 4-scenario matching
- quickstart.skill.md introduces CAIP-19 with example
</success_criteria>

<output>
After completion, create `.planning/phases/234-mcp-sdk-skills-integration/234-02-SUMMARY.md`
</output>
