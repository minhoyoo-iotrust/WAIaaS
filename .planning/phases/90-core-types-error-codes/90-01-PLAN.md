---
phase: 90-core-types-error-codes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/core/src/enums/agent.ts
  - packages/core/src/enums/wallet.ts
  - packages/core/src/enums/audit.ts
  - packages/core/src/enums/notification.ts
  - packages/core/src/enums/index.ts
  - packages/core/src/schemas/agent.schema.ts
  - packages/core/src/schemas/wallet.schema.ts
  - packages/core/src/schemas/session.schema.ts
  - packages/core/src/schemas/transaction.schema.ts
  - packages/core/src/schemas/policy.schema.ts
  - packages/core/src/schemas/index.ts
  - packages/core/src/errors/error-codes.ts
  - packages/core/src/index.ts
autonomous: true

must_haves:
  truths:
    - "WalletSchema, CreateWalletRequestSchema, WalletStatusEnum Zod schemas exist"
    - "Agent-prefixed Zod schemas (AgentSchema, AgentStatusEnum) are 0 in codebase"
    - "WALLET_NOT_FOUND, WALLET_SUSPENDED, WALLET_TERMINATED error codes exist with domain WALLET"
    - "AGENT_* error codes are 0 in error-codes.ts"
    - "AuditAction enum has WALLET_CREATED/ACTIVATED/SUSPENDED/TERMINATED (no AGENT_*)"
    - "NotificationEvent has WALLET_SUSPENDED (no AGENT_SUSPENDED)"
    - "SessionSchema, TransactionSchema, PolicySchema use walletId (no agentId)"
  artifacts:
    - path: "packages/core/src/enums/wallet.ts"
      provides: "WALLET_STATUSES, WalletStatus, WalletStatusEnum"
      contains: "WALLET_STATUSES"
    - path: "packages/core/src/schemas/wallet.schema.ts"
      provides: "WalletSchema, CreateWalletRequestSchema"
      contains: "WalletSchema"
    - path: "packages/core/src/errors/error-codes.ts"
      provides: "WALLET_NOT_FOUND, WALLET_SUSPENDED, WALLET_TERMINATED with domain WALLET"
      contains: "WALLET_NOT_FOUND"
  key_links:
    - from: "packages/core/src/schemas/wallet.schema.ts"
      to: "packages/core/src/enums/wallet.ts"
      via: "import WalletStatusEnum"
      pattern: "import.*WalletStatusEnum.*from.*wallet"
    - from: "packages/core/src/index.ts"
      to: "packages/core/src/schemas/index.ts"
      via: "re-export WalletSchema"
      pattern: "WalletSchema"
    - from: "packages/core/src/index.ts"
      to: "packages/core/src/enums/index.ts"
      via: "re-export WALLET_STATUSES"
      pattern: "WALLET_STATUSES"
---

<objective>
Rename all agent-related Zod schemas, enums, and error codes in @waiaas/core to wallet terminology. This is the SSoT layer that all downstream packages (daemon, SDK, MCP, admin) depend on.

Purpose: After this plan, every type/schema/enum/error-code import from @waiaas/core uses wallet terminology, enabling clean downstream migration in Phases 91-93.
Output: Renamed source files (wallet.ts, wallet.schema.ts), updated barrel exports, updated error codes.
</objective>

<execution_context>
@/Users/minho.yoo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/minho.yoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/89-db-migration/89-01-SUMMARY.md
@packages/core/src/enums/agent.ts
@packages/core/src/enums/audit.ts
@packages/core/src/enums/notification.ts
@packages/core/src/enums/index.ts
@packages/core/src/schemas/agent.schema.ts
@packages/core/src/schemas/session.schema.ts
@packages/core/src/schemas/transaction.schema.ts
@packages/core/src/schemas/policy.schema.ts
@packages/core/src/schemas/index.ts
@packages/core/src/errors/error-codes.ts
@packages/core/src/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename enum + schema source files and update content</name>
  <files>
    packages/core/src/enums/agent.ts
    packages/core/src/enums/wallet.ts
    packages/core/src/enums/audit.ts
    packages/core/src/enums/notification.ts
    packages/core/src/enums/index.ts
    packages/core/src/schemas/agent.schema.ts
    packages/core/src/schemas/wallet.schema.ts
    packages/core/src/schemas/session.schema.ts
    packages/core/src/schemas/transaction.schema.ts
    packages/core/src/schemas/policy.schema.ts
    packages/core/src/schemas/index.ts
  </files>
  <action>
    **Step 1: Rename enums/agent.ts -> enums/wallet.ts**
    - Create `enums/wallet.ts` with identical content but renamed:
      - `AGENT_STATUSES` -> `WALLET_STATUSES`
      - `AgentStatus` -> `WalletStatus`
      - `AgentStatusEnum` -> `WalletStatusEnum`
    - Delete `enums/agent.ts` using `git rm`

    **Step 2: Update enums/audit.ts**
    - Rename 4 audit action values in the AUDIT_ACTIONS array:
      - `'AGENT_CREATED'` -> `'WALLET_CREATED'`
      - `'AGENT_ACTIVATED'` -> `'WALLET_ACTIVATED'`
      - `'AGENT_SUSPENDED'` -> `'WALLET_SUSPENDED'`
      - `'AGENT_TERMINATED'` -> `'WALLET_TERMINATED'`
    - The array still has 23 values total. Only the first 4 entries change.

    **Step 3: Update enums/notification.ts**
    - In `NOTIFICATION_EVENT_TYPES` array, rename:
      - `'AGENT_SUSPENDED'` -> `'WALLET_SUSPENDED'`
    - Still 21 values total. Only 1 entry changes.

    **Step 4: Update enums/index.ts**
    - Change the agent export block to import from `'./wallet.js'` instead of `'./agent.js'`:
      ```
      export {
        WALLET_STATUSES,
        type WalletStatus,
        WalletStatusEnum,
      } from './wallet.js';
      ```

    **Step 5: Rename schemas/agent.schema.ts -> schemas/wallet.schema.ts**
    - Create `schemas/wallet.schema.ts` with content from agent.schema.ts but renamed:
      - Import `WalletStatusEnum` from `'../enums/index.js'` (was AgentStatusEnum)
      - `AgentSchema` -> `WalletSchema`
      - `type Agent` -> `type Wallet`
      - `CreateAgentRequestSchema` -> `CreateWalletRequestSchema`
      - `type CreateAgentRequest` -> `type CreateWalletRequest`
    - Delete `schemas/agent.schema.ts` using `git rm`

    **Step 6: Update schemas/session.schema.ts**
    - Rename `agentId` field to `walletId` in both `SessionSchema` and `CreateSessionRequestSchema`

    **Step 7: Update schemas/transaction.schema.ts**
    - Rename `agentId` field to `walletId` in `TransactionSchema`

    **Step 8: Update schemas/policy.schema.ts**
    - Rename `agentId` field to `walletId` in both `PolicySchema` and `CreatePolicyRequestSchema`
    - Update the JSDoc comment for CreatePolicyRequestSchema: "walletId is optional (null = global policy)"

    **Step 9: Update schemas/index.ts**
    - Change import from `'./agent.schema.js'` to `'./wallet.schema.js'`
    - Rename exports: `AgentSchema` -> `WalletSchema`, `Agent` -> `Wallet`, `CreateAgentRequestSchema` -> `CreateWalletRequestSchema`, `CreateAgentRequest` -> `CreateWalletRequest`

    Important: Keep the `as const` pattern on arrays. Keep all Zod `.enum()` wrapping intact. The VALUES of WALLET_STATUSES remain identical (CREATING, ACTIVE, SUSPENDED, TERMINATING, TERMINATED) -- only the const/type/enum NAMES change.
  </action>
  <verify>
    - `ls packages/core/src/enums/wallet.ts` exists
    - `ls packages/core/src/enums/agent.ts` does NOT exist
    - `ls packages/core/src/schemas/wallet.schema.ts` exists
    - `ls packages/core/src/schemas/agent.schema.ts` does NOT exist
    - `grep -r 'AgentSchema\|AgentStatusEnum\|AGENT_STATUSES\|CreateAgentRequest' packages/core/src/enums/ packages/core/src/schemas/` returns 0 matches
    - `grep 'WALLET_STATUSES' packages/core/src/enums/wallet.ts` returns a match
    - `grep 'WalletSchema' packages/core/src/schemas/wallet.schema.ts` returns a match
    - `grep 'walletId' packages/core/src/schemas/session.schema.ts` returns matches
    - `grep 'walletId' packages/core/src/schemas/transaction.schema.ts` returns a match
    - `grep 'walletId' packages/core/src/schemas/policy.schema.ts` returns matches
  </verify>
  <done>
    - wallet.ts enum file exists with WALLET_STATUSES, WalletStatus, WalletStatusEnum
    - wallet.schema.ts exists with WalletSchema, CreateWalletRequestSchema
    - agent.ts and agent.schema.ts are deleted
    - audit.ts has WALLET_CREATED/ACTIVATED/SUSPENDED/TERMINATED
    - notification.ts has WALLET_SUSPENDED
    - session/transaction/policy schemas use walletId
    - All barrel exports updated
  </done>
</task>

<task type="auto">
  <name>Task 2: Update error codes + barrel export + tsc verify</name>
  <files>
    packages/core/src/errors/error-codes.ts
    packages/core/src/index.ts
  </files>
  <action>
    **Step 1: Update error-codes.ts**

    In the `ErrorDomain` type, rename `'AGENT'` to `'WALLET'`:
    ```typescript
    export type ErrorDomain =
      | 'AUTH'
      | 'SESSION'
      | 'TX'
      | 'POLICY'
      | 'OWNER'
      | 'SYSTEM'
      | 'WALLET'    // was 'AGENT'
      | 'WITHDRAW'
      | 'ACTION'
      | 'ADMIN';
    ```

    In the `ERROR_CODES` object, rename the AGENT domain section (3 codes):
    ```typescript
    // --- WALLET domain (3) ---
    WALLET_NOT_FOUND: {
      code: 'WALLET_NOT_FOUND',
      domain: 'WALLET',
      httpStatus: 404,
      retryable: false,
      message: 'Wallet not found',
    },
    WALLET_SUSPENDED: {
      code: 'WALLET_SUSPENDED',
      domain: 'WALLET',
      httpStatus: 409,
      retryable: false,
      message: 'Wallet is suspended',
    },
    WALLET_TERMINATED: {
      code: 'WALLET_TERMINATED',
      domain: 'WALLET',
      httpStatus: 410,
      retryable: false,
      message: 'Wallet has been terminated',
    },
    ```

    The total error code count stays at 68 (3 renamed, not added/removed).

    **Step 2: Update core/src/index.ts barrel export**

    In the Enums section, rename:
    - `AGENT_STATUSES` -> `WALLET_STATUSES`
    - `type AgentStatus` -> `type WalletStatus`
    - `AgentStatusEnum` -> `WalletStatusEnum`

    In the Schemas section, rename:
    - `AgentSchema` -> `WalletSchema`
    - `type Agent` -> `type Wallet`
    - `CreateAgentRequestSchema` -> `CreateWalletRequestSchema`
    - `type CreateAgentRequest` -> `type CreateWalletRequest`

    **Step 3: Verify TypeScript compilation**
    Run `cd packages/core && npx tsc --noEmit` to verify no compilation errors in the core package itself. Note: downstream packages (daemon, sdk, etc.) WILL have compilation errors because they still reference the old names -- that is expected and will be fixed in Phases 91-93.
  </action>
  <verify>
    - `grep 'AGENT_NOT_FOUND\|AGENT_SUSPENDED\|AGENT_TERMINATED' packages/core/src/errors/error-codes.ts` returns 0 matches
    - `grep 'WALLET_NOT_FOUND' packages/core/src/errors/error-codes.ts` returns a match
    - `grep "domain: 'AGENT'" packages/core/src/errors/error-codes.ts` returns 0 matches
    - `grep "domain: 'WALLET'" packages/core/src/errors/error-codes.ts` returns matches
    - `grep -c 'WALLET_STATUSES\|WalletStatus\|WalletStatusEnum' packages/core/src/index.ts` shows 3+ matches
    - `grep -c 'AGENT_STATUSES\|AgentStatus\b\|AgentStatusEnum' packages/core/src/index.ts` returns 0
    - `grep 'WalletSchema\|CreateWalletRequestSchema' packages/core/src/index.ts` returns matches
    - `cd packages/core && npx tsc --noEmit` succeeds (exit code 0)
  </verify>
  <done>
    - error-codes.ts has WALLET_NOT_FOUND, WALLET_SUSPENDED, WALLET_TERMINATED with domain 'WALLET'
    - ErrorDomain type includes 'WALLET' instead of 'AGENT'
    - index.ts barrel export uses all wallet-prefixed names
    - `tsc --noEmit` passes for @waiaas/core
  </done>
</task>

</tasks>

<verification>
1. No `Agent` prefix types/schemas remain in core source: `grep -r 'AgentSchema\|AgentStatusEnum\|AGENT_STATUSES\|CreateAgentRequest\|AGENT_NOT_FOUND\|AGENT_SUSPENDED\|AGENT_TERMINATED' packages/core/src/ --include='*.ts' -l` (excluding __tests__) returns 0 files
2. `grep -r 'agentId' packages/core/src/schemas/` returns 0 matches (all renamed to walletId)
3. Old files deleted: `ls packages/core/src/enums/agent.ts packages/core/src/schemas/agent.schema.ts 2>&1` shows "No such file"
4. `cd packages/core && npx tsc --noEmit` exits 0
</verification>

<success_criteria>
- WalletSchema, CreateWalletRequestSchema, WalletStatusEnum exist in core
- Agent-prefixed schemas/enums are 0 in packages/core/src/ (excluding tests)
- WALLET_NOT_FOUND, WALLET_SUSPENDED, WALLET_TERMINATED error codes exist
- AGENT_* error codes are 0
- AuditAction has WALLET_CREATED/ACTIVATED/SUSPENDED/TERMINATED
- NotificationEvent has WALLET_SUSPENDED
- Session/Transaction/Policy schemas use walletId
- tsc --noEmit passes for core package
</success_criteria>

<output>
After completion, create `.planning/phases/90-core-types-error-codes/90-01-SUMMARY.md`
</output>
