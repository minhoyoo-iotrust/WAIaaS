---
phase: 167-test-gates
plan: 03
type: execute
wave: 2
depends_on: [167-01, 167-02]
files_modified:
  - packages/cli/src/__tests__/platform/**/*.platform.test.ts
  - packages/daemon/src/__tests__/platform/**/*.platform.test.ts
  - packages/adapters/solana/src/__tests__/chain/**/*.chain.test.ts
  - packages/adapters/evm/src/__tests__/chain/**/*.chain.test.ts
autonomous: true
requirements: [TEST-04, TEST-05]

must_haves:
  truths:
    - "CLI 플랫폼 테스트 32건이 전수 통과한다"
    - "Docker 플랫폼 테스트 18건이 전수 통과한다"
    - "Telegram Bot 플랫폼 테스트 34건이 전수 통과한다"
    - "Solana Local Validator 체인 테스트가 통과한다"
    - "EVM Anvil 체인 테스트가 통과한다"
    - "pnpm turbo run test:platform exit code 0"
    - "pnpm turbo run test:chain exit code 0 (local validator/anvil 환경)"
  artifacts:
    - path: "packages/cli/src/__tests__/platform/"
      provides: "CLI 플랫폼 테스트 5개 파일 (init, e2e-flow, start-stop, signal, status)"
    - path: "packages/daemon/src/__tests__/platform/docker.platform.test.ts"
      provides: "Docker 플랫폼 테스트 18건"
    - path: "packages/daemon/src/__tests__/platform/telegram-bot.platform.test.ts"
      provides: "Telegram Bot 플랫폼 테스트 34건"
    - path: "packages/adapters/solana/src/__tests__/chain/"
      provides: "Solana 체인 테스트 (mock-rpc + local-validator)"
    - path: "packages/adapters/evm/src/__tests__/chain/"
      provides: "EVM 체인 테스트 (anvil)"
  key_links:
    - from: "packages/cli/src/__tests__/platform/"
      to: "packages/cli/src/"
      via: "CLI 명령어 모듈 import"
      pattern: "import.*from.*\\.\\./"
    - from: "packages/daemon/src/__tests__/platform/"
      to: "packages/daemon/src/"
      via: "daemon 서비스 모듈 import"
      pattern: "import.*from.*\\.\\./"
    - from: "packages/adapters/solana/src/__tests__/chain/"
      to: "packages/adapters/solana/src/solana-adapter.ts"
      via: "SolanaAdapter 생성자"
      pattern: "new SolanaAdapter|createSolanaAdapter"
    - from: "packages/adapters/evm/src/__tests__/chain/"
      to: "packages/adapters/evm/src/evm-adapter.ts"
      via: "EvmAdapter 생성자"
      pattern: "new EvmAdapter|createEvmAdapter"
---

<objective>
플랫폼 테스트 84건(CLI 32 + Docker 18 + Telegram 34)과 블록체인 통합 테스트(Solana Local Validator + EVM Anvil)를 전수 통과시킨다.

Purpose: v2.0 릴리스의 배포 대상 플랫폼(CLI, Docker, Telegram) 동작 검증과 실제 블록체인 환경에서의 트랜잭션 처리 검증. 이 테스트들은 release.yml의 platform job과 nightly.yml의 local-validator job에서 실행되며, 릴리스 게이트의 필수 통과 조건이다.
Output: 플랫폼 테스트 84건 전수 통과 + 블록체인 통합 테스트 통과
</objective>

<execution_context>
@/Users/minho.yoo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/minho.yoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.github/workflows/release.yml
@.github/workflows/nightly.yml
@packages/cli/src/__tests__/platform/
@packages/daemon/src/__tests__/platform/
@packages/adapters/solana/src/__tests__/chain/
@packages/adapters/evm/src/__tests__/chain/
</context>

<tasks>

<task type="auto">
  <name>Task 1: 플랫폼 테스트 84건 전수 실행 + 실패 건 수정</name>
  <files>
    packages/cli/src/__tests__/platform/e2e-flow.platform.test.ts
    packages/cli/src/__tests__/platform/init.platform.test.ts
    packages/cli/src/__tests__/platform/start-stop.platform.test.ts
    packages/cli/src/__tests__/platform/signal.platform.test.ts
    packages/cli/src/__tests__/platform/status.platform.test.ts
    packages/daemon/src/__tests__/platform/docker.platform.test.ts
    packages/daemon/src/__tests__/platform/telegram-bot.platform.test.ts
  </files>
  <action>
  1. `pnpm turbo run build` 후 `pnpm turbo run test:platform` 실행
  2. 플랫폼 테스트 3개 카테고리 확인:
     - **CLI (32건)**: init(4), e2e-flow(1), start-stop(17), signal(5), status(5)
     - **Docker (18건)**: Dockerfile 검증, 컨테이너 라이프사이클, 환경변수 주입, 헬스체크
     - **Telegram (34건)**: Bot 명령어 10개 + i18n + 2-Tier 인증 + Long Polling
  3. 실패 건 발생 시:
     - CLI E2E: Pre-existing 3건(E-07~09)은 daemon-harness adapter param 문제 -- 수정 시도
     - Docker: Dockerfile 변경 반영 여부 확인
     - Telegram: Bot API mock 호환성 확인
  4. 각 실패 건의 root cause를 파악하고 테스트 또는 소스 코드를 수정
  5. 전체 플랫폼 테스트 재실행으로 84건 전수 통과 확인

  **Pre-existing 이슈 처리 방침**:
  - CLI E2E E-07~09: daemon-harness의 adapter 파라미터 불일치 문제. 가능한 한 수정하되, 구조적으로 불가능하면 skip 처리하고 이슈 등록
  - lifecycle.test.ts (flaky): 플랫폼 테스트 범위가 아니므로 이 플랜에서는 무시
  - sessions.test.tsx: 플랫폼 테스트 범위가 아니므로 이 플랜에서는 무시
  </action>
  <verify>
  `pnpm turbo run test:platform` exit code 0
  CLI 32건 + Docker 18건 + Telegram 34건 = 84건 전수 통과
  </verify>
  <done>플랫폼 테스트 84건 전수 통과 (CLI 32 + Docker 18 + Telegram 34)</done>
</task>

<task type="auto">
  <name>Task 2: 블록체인 통합 테스트 실행 + 실패 건 수정</name>
  <files>
    packages/adapters/solana/src/__tests__/chain/solana-local-validator.chain.test.ts
    packages/adapters/solana/src/__tests__/chain/mock-rpc.chain.test.ts
    packages/adapters/evm/src/__tests__/chain/evm-anvil.chain.test.ts
  </files>
  <action>
  1. **Solana 체인 테스트 (로컬 환경)**:
     - mock-rpc 테스트 (19건): 외부 의존성 없이 실행 가능 -- `pnpm turbo run test:chain --filter=@waiaas/adapter-solana` 로 mock-rpc 테스트 실행
     - local-validator 테스트 (5건): solana-test-validator 필요 -- CI 전용이므로 로컬에서는 mock-rpc만 검증하고, local-validator는 CI에서 통과하는 구조 확인
  2. **EVM 체인 테스트 (로컬 환경)**:
     - anvil 테스트 (3건): Foundry anvil 필요 -- 로컬에 Foundry가 있으면 실행, 없으면 CI 전용으로 확인
     - sepolia 테스트 (3건): testnet 전용이므로 CI에서만 실행 (continue-on-error)
  3. 로컬에서 실행 가능한 테스트만 직접 실행:
     - `pnpm turbo run test:chain` (mock-rpc + 로컬 환경에서 가능한 것만)
  4. 실패 건 발생 시:
     - adapter API 변경으로 인한 테스트 불일치 → 테스트 업데이트
     - mock 설정 오류 → mock 수정
     - 실제 체인 어댑터 버그 → 소스 코드 수정
  5. CI workflow (nightly.yml local-validator job)와 동일한 테스트가 통과할 수 있는 상태 보장

  **CI에서만 실행되는 테스트**: solana-local-validator (requires solana-test-validator), evm-anvil (requires anvil), solana-devnet (devnet RPC), evm-sepolia (Sepolia RPC)
  이들은 로컬에서 환경이 없으면 CI 실행을 전제로 테스트 코드의 정합성만 확인한다.
  </action>
  <verify>
  `pnpm turbo run test:chain` exit code 0 (mock-rpc 테스트 통과)
  solana-local-validator, evm-anvil 테스트 코드가 빌드 통과 (tsc --noEmit)
  nightly.yml local-validator job 구성이 올바른지 확인
  </verify>
  <done>블록체인 통합 테스트가 mock-rpc 환경에서 통과하고, CI local-validator/anvil 환경에서 통과할 수 있는 상태</done>
</task>

</tasks>

<verification>
- `pnpm turbo run test:platform` → exit code 0, 84건 전수 PASS
- `pnpm turbo run test:chain` → exit code 0 (mock-rpc 통과)
- CI workflow 구조 확인: nightly.yml local-validator + release.yml platform job
</verification>

<success_criteria>
- 플랫폼 테스트 84건(CLI 32 + Docker 18 + Telegram 34)이 전수 통과한다
- 블록체인 통합 테스트가 Solana Local Validator + EVM Anvil 환경에서 통과한다 (mock-rpc 로컬 확인 + CI 구조 보장)
- TEST-04, TEST-05 요구사항 충족
</success_criteria>

<output>
After completion, create `.planning/phases/167-test-gates/167-03-SUMMARY.md`
</output>
