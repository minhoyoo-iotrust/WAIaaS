---
phase: 104-api-skill-files
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/quickstart.skill.md
  - skills/wallet.skill.md
  - skills/transactions.skill.md
autonomous: true

must_haves:
  truths:
    - "quickstart.skill.md loads and an AI agent can follow the workflow: create wallet -> session -> check balance -> send first transfer"
    - "wallet.skill.md covers wallet CRUD, asset queries, owner management, and multi-chain (Solana + EVM) creation"
    - "transactions.skill.md covers all 5 transaction types: TRANSFER, TOKEN_TRANSFER, CONTRACT_CALL, APPROVE, BATCH with curl examples"
    - "Each skill file has YAML frontmatter with name/description/category/tags/version/dispatch"
    - "Each skill file has error handling section with common error codes and recovery hints"
  artifacts:
    - path: "skills/quickstart.skill.md"
      provides: "End-to-end quickstart workflow for first-time API usage"
      contains: "POST /v1/wallets"
    - path: "skills/wallet.skill.md"
      provides: "Wallet CRUD + assets + owner management reference"
      contains: "GET /v1/wallet/assets"
    - path: "skills/transactions.skill.md"
      provides: "5-type transaction reference with all parameters"
      contains: "CONTRACT_CALL"
  key_links:
    - from: "skills/quickstart.skill.md"
      to: "skills/wallet.skill.md"
      via: "cross-reference for detailed wallet operations"
      pattern: "wallet.skill.md"
    - from: "skills/quickstart.skill.md"
      to: "skills/transactions.skill.md"
      via: "cross-reference for transaction types beyond TRANSFER"
      pattern: "transactions.skill.md"
---

<objective>
Create 3 API skill files (quickstart, wallet, transactions) that enable an AI agent to use the WAIaaS REST API immediately upon loading.

Purpose: AI agents (Claude, GPT, etc.) need structured reference files to make API calls without prior knowledge. The existing `how-to-test/waiass-api.skill.md` is outdated (uses old `agents` terminology, missing 5-type transactions, missing token registry, missing settings API). Splitting into focused skill files improves discoverability and reduces context window usage.

Output: 3 skill files in `skills/` directory covering the primary API surface.
</objective>

<execution_context>
@/Users/minho.yoo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/minho.yoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Source of truth for API routes and schemas
@packages/daemon/src/api/routes/index.ts
@packages/daemon/src/api/routes/wallets.ts
@packages/daemon/src/api/routes/wallet.ts
@packages/daemon/src/api/routes/transactions.ts
@packages/daemon/src/api/routes/sessions.ts
@packages/daemon/src/api/routes/tokens.ts
@packages/daemon/src/api/routes/mcp.ts
@packages/daemon/src/api/routes/openapi-schemas.ts
@packages/core/src/schemas/transaction.schema.ts
@packages/core/src/schemas/wallet.schema.ts

# Existing skill file being replaced
@how-to-test/waiass-api.skill.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create quickstart.skill.md with end-to-end workflow</name>
  <files>skills/quickstart.skill.md</files>
  <action>
Create `skills/quickstart.skill.md` with YAML frontmatter and complete quickstart workflow.

**Frontmatter:**
```yaml
name: "WAIaaS Quickstart"
description: "End-to-end quickstart: create wallet, session, check balance, send first transfer"
category: "api"
tags: [wallet, blockchain, solana, ethereum, quickstart, waiass]
version: "1.4.4"
dispatch:
  kind: "tool"
  allowedCommands: ["curl"]
```

**Content structure:**
1. **Overview** - What WAIaaS is (1-2 sentences), base URL `http://localhost:3100`
2. **Authentication Model** - masterAuth (X-Master-Password header) vs sessionAuth (Bearer token), which endpoints use which
3. **Step-by-step Workflow** with numbered sections:
   - Step 1: Health check (`GET /health`)
   - Step 2: Create a wallet (`POST /v1/wallets` with `{name, chain, network}`) -- note chain defaults to "solana", network defaults to "devnet"; for EVM use chain "ethereum" with network "ethereum-mainnet"/"ethereum-sepolia" etc.
   - Step 3: Create a session (`POST /v1/sessions` with `{walletId, ttl}`) -- save the `token` value
   - Step 4: Check balance (`GET /v1/wallet/balance` with Bearer token)
   - Step 5: Check all assets (`GET /v1/wallet/assets` with Bearer token)
   - Step 6: Send first transfer (`POST /v1/transactions/send` with `{type: "TRANSFER", to, amount}`)
   - Step 7: Check transaction status (`GET /v1/transactions/{id}`)
4. **Error Handling** - Error response format (`{code, message, retryable, details, requestId, hint}`), common codes: WALLET_NOT_FOUND (404), SESSION_EXPIRED (401), INSUFFICIENT_BALANCE (400), CHAIN_ERROR (502)
5. **Next Steps** - Cross-references to wallet.skill.md, transactions.skill.md, policies.skill.md, admin.skill.md

Use CORRECT current API:
- Endpoint is `/v1/wallets` (not `/v1/agents`)
- Session body uses `walletId` (not `agentId`)
- Transaction types use discriminatedUnion `type` field
- Balance response has `walletId` field
- masterAuth endpoints (wallet creation, session creation) use `X-Master-Password` header
- sessionAuth endpoints (balance, transactions) use `Authorization: Bearer <token>`

All curl examples must use `localhost:3100` and show proper headers.
  </action>
  <verify>
File exists at skills/quickstart.skill.md. Contains YAML frontmatter block. Contains all 7 workflow steps. Contains `POST /v1/wallets` (not /v1/agents). Contains `walletId` (not agentId). Contains error handling section.
  </verify>
  <done>
quickstart.skill.md enables a fresh AI agent to: create wallet -> create session -> check balance -> send transfer -> check status, with correct v1.4.4 API endpoints and terminology.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create wallet.skill.md and transactions.skill.md with full API coverage</name>
  <files>skills/wallet.skill.md, skills/transactions.skill.md</files>
  <action>
**File 1: `skills/wallet.skill.md`**

Frontmatter: name "WAIaaS Wallet Management", category "api", version "1.4.4", dispatch kind "tool" allowedCommands ["curl"].

Sections:
1. **Wallet CRUD** - All 6 endpoints with full curl examples and parameter descriptions:
   - `POST /v1/wallets` -- create wallet (masterAuth). Params: name (1-100 chars), chain ("solana"|"ethereum", default "solana"), network (Solana: "mainnet"/"devnet"/"testnet"; EVM: "ethereum-mainnet"/"ethereum-sepolia"/"polygon-mainnet"/"arbitrum-mainnet"/"optimism-mainnet"/"base-mainnet"/"bsc-mainnet"/"avalanche-mainnet"/"linea-mainnet"/"scroll-mainnet"/"zksync-mainnet"/"blast-mainnet"/"mantle-mainnet"). Response 201 with id, name, chain, network, publicKey, status, createdAt.
   - `GET /v1/wallets` -- list wallets (masterAuth)
   - `GET /v1/wallets/{id}` -- wallet detail with ownerState (masterAuth)
   - `PUT /v1/wallets/{id}` -- update wallet name (sessionAuth)
   - `DELETE /v1/wallets/{id}` -- terminate wallet (sessionAuth)
   - `PUT /v1/wallets/{id}/owner` -- set owner address (masterAuth)

2. **Wallet Query** (session-scoped, operates on wallet bound to session token):
   - `GET /v1/wallet/address` -- get wallet address
   - `GET /v1/wallet/balance` -- native token balance (SOL/ETH). Note: balance in smallest unit (lamports/wei), divide by 10^decimals for human-readable
   - `GET /v1/wallet/assets` -- all assets (native + SPL/ERC-20 tokens)

3. **Session Management** - 4 endpoints:
   - `POST /v1/sessions` -- create session (masterAuth). Params: walletId, ttl (300-604800 sec)
   - `GET /v1/sessions` -- list active sessions. Query: walletId filter
   - `DELETE /v1/sessions/{id}` -- revoke session
   - `PUT /v1/sessions/{id}/renew` -- renew before expiry

4. **Token Registry** (EVM only, masterAuth):
   - `GET /v1/tokens?network=<network>` -- list tokens (builtin + custom)
   - `POST /v1/tokens` -- add custom token
   - `DELETE /v1/tokens` -- remove custom token

5. **MCP Token Provisioning** (masterAuth):
   - `POST /v1/mcp/tokens` -- one-stop provisioning (session + token file + Claude Desktop config)

6. **Auth Nonce**:
   - `GET /v1/nonce` -- get nonce for owner signature verification (SIWS/SIWE)

7. **Multi-chain Notes** - Solana vs EVM differences (network naming, key types, Token-2022 support)

8. **Error Reference** - Wallet-related error codes

**File 2: `skills/transactions.skill.md`**

Frontmatter: name "WAIaaS Transactions", category "api", version "1.4.4", dispatch kind "tool" allowedCommands ["curl"].

Sections:
1. **Overview** - 5-type discriminatedUnion system, `type` field determines transaction variant
2. **Type 1: TRANSFER** (native SOL/ETH):
   - `POST /v1/transactions/send` with `{type: "TRANSFER", to, amount, memo?}`
   - amount is string of digits in smallest unit (lamports for SOL, wei for ETH)
   - Full curl example
3. **Type 2: TOKEN_TRANSFER** (SPL/ERC-20):
   - Body: `{type: "TOKEN_TRANSFER", to, amount, token: {address, decimals, symbol}, memo?}`
   - Requires ALLOWED_TOKENS policy to whitelist the token first
   - Full curl example
4. **Type 3: CONTRACT_CALL** (arbitrary contract):
   - Body: `{type: "CONTRACT_CALL", to, calldata?, abi?, value?, programId?, instructionData?, accounts?}`
   - EVM fields: calldata (hex), abi (JSON array), value (wei)
   - Solana fields: programId, instructionData (base64), accounts array
   - Requires CONTRACT_WHITELIST policy
   - Full curl example (EVM)
5. **Type 4: APPROVE** (token spending approval):
   - Body: `{type: "APPROVE", spender, token: {address, decimals, symbol}, amount}`
   - Requires APPROVED_SPENDERS policy
   - Full curl example
6. **Type 5: BATCH** (multiple instructions):
   - Body: `{type: "BATCH", instructions: [{to, amount}, {to, amount, token: ...}]}`
   - 2-20 instructions, Solana only (EVM returns BATCH_NOT_SUPPORTED)
   - Full curl example
7. **Transaction Lifecycle**:
   - Status flow: PENDING -> QUEUED -> CONFIRMED or FAILED (or CANCELLED)
   - Tier flow: INSTANT (immediate) / NOTIFY (immediate + notification) / DELAY (cooldown) / APPROVAL (owner approval)
   - `GET /v1/transactions/{id}` -- get transaction detail
   - `GET /v1/transactions` -- list with cursor pagination
   - `GET /v1/transactions/pending` -- pending only
   - `POST /v1/transactions/{id}/cancel` -- cancel delayed/pending
   - `POST /v1/transactions/{id}/approve` -- owner approves (ownerAuth)
   - `POST /v1/transactions/{id}/reject` -- owner rejects (ownerAuth)
8. **Policy Interaction** - How policies affect transactions (spending limits, whitelists, tier assignment)
9. **Error Reference** - Transaction-specific errors (INSUFFICIENT_BALANCE, POLICY_VIOLATION, CHAIN_ERROR, TX_NOT_FOUND)
  </action>
  <verify>
Both files exist. wallet.skill.md covers all wallet/session/token/mcp endpoints. transactions.skill.md covers all 5 transaction types with correct schemas. Both use `walletId` terminology. Both have YAML frontmatter. transactions.skill.md mentions CONTRACT_WHITELIST, ALLOWED_TOKENS, APPROVED_SPENDERS policy prerequisites.
  </verify>
  <done>
wallet.skill.md provides complete reference for wallet management (CRUD, assets, sessions, tokens, MCP). transactions.skill.md provides complete reference for all 5 transaction types with correct parameters, prerequisites, and lifecycle management.
  </done>
</task>

</tasks>

<verification>
1. `ls skills/` shows quickstart.skill.md, wallet.skill.md, transactions.skill.md
2. All 3 files have valid YAML frontmatter with `name`, `description`, `category`, `tags`, `version`, `dispatch` fields
3. grep for "agents" or "agentId" returns 0 hits (must use "wallets"/"walletId")
4. quickstart.skill.md contains numbered workflow steps 1-7
5. transactions.skill.md contains all 5 type sections (TRANSFER, TOKEN_TRANSFER, CONTRACT_CALL, APPROVE, BATCH)
6. wallet.skill.md contains token registry endpoints and MCP provisioning endpoint
</verification>

<success_criteria>
- 3 skill files created in skills/ directory
- SKILL-01 (quickstart), SKILL-02 (wallet), SKILL-03 (transactions) requirements satisfied
- All curl examples use correct v1.4.4 endpoints and terminology
- Each file is self-contained with enough context for an AI agent to make API calls
</success_criteria>

<output>
After completion, create `.planning/phases/104-api-skill-files/104-01-SUMMARY.md`
</output>
