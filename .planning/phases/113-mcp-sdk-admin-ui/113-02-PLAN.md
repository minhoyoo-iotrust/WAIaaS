---
phase: 113-mcp-sdk-admin-ui
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/sdk/src/client.ts
  - packages/sdk/src/types.ts
  - packages/sdk/src/__tests__/client.test.ts
  - python-sdk/waiaas/client.py
  - python-sdk/waiaas/models.py
  - python-sdk/tests/test_client.py
autonomous: true

must_haves:
  truths:
    - "TS SDK getBalance({ network: 'polygon-mainnet' })가 ?network=polygon-mainnet 쿼리로 요청된다"
    - "TS SDK getAssets({ network: 'polygon-mainnet' })가 ?network=polygon-mainnet 쿼리로 요청된다"
    - "TS SDK sendToken({ to, amount, network: 'polygon-mainnet' })가 body에 network 필드를 포함한다"
    - "Python SDK get_balance(network='polygon-mainnet')가 ?network=polygon-mainnet 쿼리로 요청된다"
    - "Python SDK send_token(to=..., amount=..., network='polygon-mainnet')가 body에 network 필드를 포함한다"
    - "network 미지정 시 기존과 동일하게 동작한다 (하위호환)"
  artifacts:
    - path: "packages/sdk/src/client.ts"
      provides: "getBalance/getAssets/sendToken network 옵션"
    - path: "packages/sdk/src/types.ts"
      provides: "BalanceOptions, AssetsOptions 타입 + SendTokenParams.network"
    - path: "python-sdk/waiaas/client.py"
      provides: "get_balance/get_assets/send_token network 파라미터"
  key_links:
    - from: "packages/sdk/src/client.ts"
      to: "GET /v1/wallet/balance?network=X"
      via: "query parameter in getBalance"
      pattern: "network.*query|\\?network="
    - from: "python-sdk/waiaas/client.py"
      to: "GET /v1/wallet/balance"
      via: "params dict with network key"
      pattern: "network.*params"
---

<objective>
TS SDK와 Python SDK의 지갑/트랜잭션 메서드에 network 선택 파라미터를 추가한다.

Purpose: SDK 사용자가 프로그래밍 방식으로 특정 네트워크에서 잔액 조회/트랜잭션 실행을 할 수 있도록 하여, 멀티체인 환경 모델의 프로그래밍 인터페이스를 확장한다.
Output: TS SDK 3개 메서드 + Python SDK 3개 메서드에 network 옵션 추가 + 테스트
</objective>

<execution_context>
@/Users/minho.yoo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/minho.yoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@packages/sdk/src/client.ts
@packages/sdk/src/types.ts
@packages/sdk/src/__tests__/client.test.ts
@python-sdk/waiaas/client.py
@python-sdk/waiaas/models.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: TS SDK network 파라미터 확장 + 테스트</name>
  <files>
    packages/sdk/src/types.ts
    packages/sdk/src/client.ts
    packages/sdk/src/__tests__/client.test.ts
  </files>
  <action>
    **A. types.ts에 새 타입 추가:**

    `SendTokenParams` 인터페이스에 `network?: string;` 필드 추가 (기존 필드들 아래에).

    새로운 옵션 인터페이스 2개 추가:
    ```typescript
    export interface BalanceOptions {
      /** Query balance for a specific network (e.g., 'polygon-mainnet') */
      network?: string;
    }

    export interface AssetsOptions {
      /** Query assets for a specific network (e.g., 'polygon-mainnet') */
      network?: string;
    }
    ```

    **B. client.ts에 getBalance/getAssets 시그니처 변경:**

    `getBalance()` -> `getBalance(options?: BalanceOptions)`:
    ```typescript
    async getBalance(options?: BalanceOptions): Promise<BalanceResponse> {
      const query = new URLSearchParams();
      if (options?.network) query.set('network', options.network);
      const qs = query.toString();
      return withRetry(
        () => this.http.get<BalanceResponse>(
          `/v1/wallet/balance${qs ? `?${qs}` : ''}`,
          this.authHeaders(),
        ),
        this.retryOptions,
      );
    }
    ```

    `getAssets()` -> `getAssets(options?: AssetsOptions)`:
    ```typescript
    async getAssets(options?: AssetsOptions): Promise<AssetsResponse> {
      const query = new URLSearchParams();
      if (options?.network) query.set('network', options.network);
      const qs = query.toString();
      return withRetry(
        () => this.http.get<AssetsResponse>(
          `/v1/wallet/assets${qs ? `?${qs}` : ''}`,
          this.authHeaders(),
        ),
        this.retryOptions,
      );
    }
    ```

    `sendToken(params)`: 이미 `SendTokenParams`를 body로 전달하므로 network 필드가 자동으로 포함됨. 변경 불필요.

    import에 `BalanceOptions`, `AssetsOptions` 추가.

    **C. client.test.ts에 network 테스트 추가:**

    기존 테스트 파일에서 describe('WAIaaSClient') 블록 내에 테스트 추가:

    ```typescript
    it('getBalance passes network query parameter', async () => {
      fetchSpy.mockResolvedValueOnce(mockResponse({ balance: '100', symbol: 'ETH', decimals: 18 }));
      const client = new WAIaaSClient({ baseUrl: 'http://localhost:3000', sessionToken: mockToken });
      await client.getBalance({ network: 'polygon-mainnet' });
      const calledUrl = fetchSpy.mock.calls[0][0] as string;
      expect(calledUrl).toContain('/v1/wallet/balance?network=polygon-mainnet');
    });

    it('getBalance works without network option (backward compat)', async () => {
      fetchSpy.mockResolvedValueOnce(mockResponse({ balance: '100', symbol: 'SOL', decimals: 9 }));
      const client = new WAIaaSClient({ baseUrl: 'http://localhost:3000', sessionToken: mockToken });
      await client.getBalance();
      const calledUrl = fetchSpy.mock.calls[0][0] as string;
      expect(calledUrl).toBe('http://localhost:3000/v1/wallet/balance');
    });

    it('getAssets passes network query parameter', async () => {
      fetchSpy.mockResolvedValueOnce(mockResponse({ assets: [] }));
      const client = new WAIaaSClient({ baseUrl: 'http://localhost:3000', sessionToken: mockToken });
      await client.getAssets({ network: 'ethereum-sepolia' });
      const calledUrl = fetchSpy.mock.calls[0][0] as string;
      expect(calledUrl).toContain('/v1/wallet/assets?network=ethereum-sepolia');
    });

    it('sendToken includes network in body when specified', async () => {
      fetchSpy.mockResolvedValueOnce(mockResponse({ id: 'tx-1', status: 'PENDING' }, 201));
      const client = new WAIaaSClient({ baseUrl: 'http://localhost:3000', sessionToken: mockToken });
      await client.sendToken({ to: 'addr', amount: '100', network: 'polygon-mainnet' });
      const body = JSON.parse(fetchSpy.mock.calls[0][1].body as string);
      expect(body.network).toBe('polygon-mainnet');
    });
    ```

    주의: `fetchSpy`와 `mockResponse` 등 헬퍼는 기존 테스트에 이미 정의되어 있으므로 그대로 사용.
  </action>
  <verify>
    `pnpm --filter @waiaas/sdk build && pnpm --filter @waiaas/sdk test` 빌드 및 테스트 통과 확인.
  </verify>
  <done>
    - getBalance({ network }) / getAssets({ network })가 query string으로 변환됨
    - sendToken({ network })가 body에 network 포함됨
    - 기존 호출 (옵션 없이)이 동일하게 동작
    - 빌드 및 테스트 통과
  </done>
</task>

<task type="auto">
  <name>Task 2: Python SDK network 파라미터 확장 + 테스트</name>
  <files>
    python-sdk/waiaas/models.py
    python-sdk/waiaas/client.py
    python-sdk/tests/test_client.py
  </files>
  <action>
    **A. models.py에 SendTokenRequest network 필드 추가:**

    `SendTokenRequest` 클래스에 `network: Optional[str] = None` 필드 추가 (기존 instructions 아래에).

    **B. client.py의 get_balance/get_assets에 network 파라미터 추가:**

    `get_balance` 시그니처 변경:
    ```python
    async def get_balance(self, *, network: Optional[str] = None) -> WalletBalance:
        """GET /v1/wallet/balance -- Get wallet balance.

        Args:
            network: Query balance for a specific network (e.g., 'polygon-mainnet').
        """
        params = {}
        if network is not None:
            params["network"] = network
        resp = await self._request("GET", "/v1/wallet/balance", params=params or None)
        return WalletBalance.model_validate(resp.json())
    ```

    `get_assets` 시그니처 변경:
    ```python
    async def get_assets(self, *, network: Optional[str] = None) -> WalletAssets:
        """GET /v1/wallet/assets -- Get all assets held by wallet.

        Args:
            network: Query assets for a specific network (e.g., 'polygon-mainnet').
        """
        params = {}
        if network is not None:
            params["network"] = network
        resp = await self._request("GET", "/v1/wallet/assets", params=params or None)
        return WalletAssets.model_validate(resp.json())
    ```

    `send_token`에 network 파라미터 추가:
    ```python
    async def send_token(
        self,
        to: Optional[str] = None,
        amount: Optional[str] = None,
        *,
        memo: Optional[str] = None,
        type: Optional[str] = None,
        token: Optional[dict[str, Any]] = None,
        network: Optional[str] = None,
        **kwargs: Any,
    ) -> TransactionResponse:
    ```
    기존 SendTokenRequest 생성 시 `network=network` 추가:
    ```python
    request = SendTokenRequest(
        to=to, amount=amount, memo=memo, type=type,
        token=token_obj, network=network, **kwargs,
    )
    ```

    **C. test_client.py에 network 테스트 추가:**

    기존 테스트 파일에서 network 관련 테스트 추가. httpx mock 패턴을 따라:

    ```python
    @pytest.mark.asyncio
    async def test_get_balance_with_network(mock_client):
        """get_balance(network='polygon-mainnet') passes ?network= query param."""
        ...
        balance = await client.get_balance(network="polygon-mainnet")
        # Verify the request was made with network query parameter
        assert "network=polygon-mainnet" in str(request.url)

    @pytest.mark.asyncio
    async def test_get_assets_with_network(mock_client):
        """get_assets(network='ethereum-sepolia') passes ?network= query param."""
        ...

    @pytest.mark.asyncio
    async def test_send_token_with_network(mock_client):
        """send_token(network='polygon-mainnet') includes network in body."""
        ...
        result = await client.send_token(to="addr", amount="100", network="polygon-mainnet")
        body = json.loads(request.content)
        assert body["network"] == "polygon-mainnet"
    ```

    주의: 기존 test_client.py의 fixture 패턴을 따른다. httpx_mock 또는 respx 패턴 사용. 테스트 파일을 먼저 읽고 기존 패턴을 파악한 후 작성.
  </action>
  <verify>
    1. `pnpm --filter @waiaas/sdk build && pnpm --filter @waiaas/sdk test` TS SDK 테스트 통과
    2. `cd python-sdk && python -m pytest tests/ -v` Python SDK 테스트 통과 (Python 환경이 없으면 `uv run pytest tests/ -v` 시도)
  </verify>
  <done>
    - Python SDK get_balance(network=), get_assets(network=), send_token(network=) 동작
    - TS SDK와 Python SDK 모두 network 미지정 시 하위호환 유지
    - 양쪽 테스트 통과
  </done>
</task>

</tasks>

<verification>
1. `pnpm --filter @waiaas/sdk build && pnpm --filter @waiaas/sdk test` TS SDK 빌드/테스트 통과
2. Python SDK 테스트 통과 (`python -m pytest tests/ -v` 또는 `uv run pytest tests/ -v`)
3. network 미지정 시 기존 동작 유지 확인 (하위호환 테스트)
</verification>

<success_criteria>
- TS SDK: getBalance/getAssets/sendToken에 network 옵션 지원
- Python SDK: get_balance/get_assets/send_token에 network 파라미터 지원
- 양쪽 하위호환 유지 (기존 호출 방식 동작)
- 모든 테스트 통과
</success_criteria>

<output>
After completion, create `.planning/phases/113-mcp-sdk-admin-ui/113-02-SUMMARY.md`
</output>
