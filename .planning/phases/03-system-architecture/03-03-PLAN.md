---
phase: 03-system-architecture
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - .planning/deliverables/11-security-threat-model.md
  - .planning/deliverables/12-multichain-extension.md
autonomous: true

must_haves:
  truths:
    - "공격 벡터와 대응 방안이 위협 매트릭스로 문서화됨"
    - "키 탈취 대응 메커니즘이 위협 수준별로 정의됨"
    - "Solana에서 EVM으로의 확장 경로가 인터페이스 기반으로 정의됨"
  artifacts:
    - path: ".planning/deliverables/11-security-threat-model.md"
      provides: "보안 위협 모델링 문서"
      contains: "위협 매트릭스, 키 탈취 대응, 내부자 위협 방어"
    - path: ".planning/deliverables/12-multichain-extension.md"
      provides: "멀티체인 확장성 설계"
      contains: "IBlockchainAdapter, EVM 확장 경로"
  key_links:
    - from: "11-security-threat-model.md"
      to: "08-dual-key-architecture.md"
      via: "키 탈취 시나리오 대응"
    - from: "12-multichain-extension.md"
      to: "09-system-components.md"
      via: "IBlockchainAdapter 인터페이스 확장"
---

<objective>
보안 위협 모델링(ARCH-04)과 멀티체인 확장성 설계(ARCH-05)를 작성한다.

Purpose: CONTEXT.md의 "보안 최우선" 원칙에 따라 공격 벡터와 대응 방안을 체계적으로 문서화하고, Solana에서 EVM으로의 확장 경로를 인터페이스 기반으로 설계한다.

Output:
- `.planning/deliverables/11-security-threat-model.md` - ARCH-04 보안 위협 모델링
- `.planning/deliverables/12-multichain-extension.md` - ARCH-05 멀티체인 확장성 설계
</objective>

<execution_context>
@/Users/minho.yoo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/minho.yoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-system-architecture/03-CONTEXT.md
@.planning/phases/03-system-architecture/03-RESEARCH.md
@.planning/phases/03-system-architecture/03-01-SUMMARY.md
@.planning/deliverables/08-dual-key-architecture.md
@.planning/deliverables/09-system-components.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: 보안 위협 모델링 문서 작성 (ARCH-04)</name>
  <files>.planning/deliverables/11-security-threat-model.md</files>
  <action>
03-RESEARCH.md의 Security Threat Model과 CONTEXT.md의 보안 결정을 기반으로 위협 모델링 문서를 작성한다.

**문서 구조:**
1. Executive Summary
2. 보안 원칙
   - 보안 최우선 (사용성보다 보안)
   - 계층적 방어 (Defense in Depth)
   - Fail-safe (장애 시 거부)
   - 최소 권한 원칙
3. 위협 매트릭스 (RESEARCH.md 참조 + 확장)
   | 위협 | 공격 벡터 | 발생 가능성 | 영향도 | 대응 방안 |
   - Agent Key 탈취
   - Owner Key 탈취
   - 정책 우회
   - 네트워크 분리 공격
   - 에이전트 로직 오류
   - 내부자 공격
   - AI 기반 피싱
   - Squads 취약점
   - 서버 침해
   - 데이터베이스 침해
4. 키 탈취 대응 메커니즘 (RESEARCH.md Claude's Discretion 결정)
   - 위협 수준별 4단계 대응 (LOW -> CRITICAL)
   - Agent Key 탈취 시: Owner로 멤버 제거, 새 Agent Key 발급
   - Owner Key 탈취 시: Guardian recovery, time-locked 취소 기회
5. 내부자 위협 방어 (RESEARCH.md Claude's Discretion 결정)
   - 작업 민감도별 보호 수준 테이블
   - KMS Sign: MFA 필수
   - 정책 변경: 2인 승인 + 감사 로그
   - Enclave 이미지 배포: PR 리뷰 + 해시 검증
   - IAM 변경: 관리자 2인 승인
6. 이상 탐지 (RESEARCH.md Claude's Discretion 결정)
   - 규칙 기반 탐지 (ML 없이 시작)
   - 탐지 규칙 예시: 빈도, 한도, 시간대, 화이트리스트
   - Circuit Breaker: 연속 실패 시 자동 정지
   - 알림 연동: Slack, PagerDuty
7. 감사 및 모니터링
   - CloudTrail 불변 감사 로그
   - S3 WORM 저장
   - 실시간 알람 설정
   - 월간 보안 리뷰 절차
8. 복구 절차
   - 침해 탐지 시 대응 플레이북
   - 키 로테이션 절차
   - 긴급 동결 절차
   - 포렌식 보존 절차
9. Mermaid 다이어그램
   - 계층적 방어 구조도
   - 키 탈취 대응 흐름
   - 이상 탐지 -> 대응 흐름

**CONTEXT.md 결정 준수:**
- 보안 최우선 원칙
- Claude's Discretion 항목은 RESEARCH.md 권장사항 적용

**작성 언어:** 한글
  </action>
  <verify>
- 문서가 `.planning/deliverables/11-security-threat-model.md`에 존재
- 위협 매트릭스에 최소 8개 위협이 포함됨
- 키 탈취 대응이 4단계로 정의됨 (LOW/MEDIUM/HIGH/CRITICAL)
- 내부자 위협 방어 테이블이 작업 민감도별로 정리됨
- 이상 탐지 규칙이 구체적으로 정의됨
- 최소 2개의 Mermaid 다이어그램 포함
  </verify>
  <done>
공격 벡터와 대응 방안이 위협 매트릭스로 문서화되고, 키 탈취 대응, 내부자 위협 방어, 이상 탐지가 CONTEXT.md 결정에 따라 상세히 정의됨
  </done>
</task>

<task type="auto">
  <name>Task 2: 멀티체인 확장성 설계 문서 작성 (ARCH-05)</name>
  <files>.planning/deliverables/12-multichain-extension.md</files>
  <action>
03-RESEARCH.md의 Multichain Extension Path를 기반으로 멀티체인 확장성 설계 문서를 작성한다.

**문서 구조:**
1. Executive Summary
2. 확장 전략 개요
   - 공통 인터페이스 기반, 체인별 어댑터 패턴
   - Solana 우선 구현, EVM 확장 경로 정의
3. IBlockchainAdapter 인터페이스 (09-system-components.md 참조)
   - createSmartWallet(ownerKey, agentKey, config)
   - buildTransaction(request)
   - simulateTransaction(tx)
   - submitTransaction(signedTx)
   - getBalance(address, asset?)
4. Solana 어댑터 상세
   - Squads Protocol v4 기반
   - ED25519 서명 (KMS ECC_NIST_EDWARDS25519)
   - Helius RPC 연동
   - 구현 범위: Phase 3 완전 구현
5. EVM 확장 경로
   - 스마트 월렛: ERC-4337 Account Abstraction 또는 Safe (Gnosis Safe)
   - 서명 알고리즘: ECDSA (secp256k1)
   - KMS 키 스펙: ECC_SECG_P256K1
   - 가스비 처리: EIP-2930 access list, EIP-1559 dynamic fee
   - 구현 범위: Phase 3에서 인터페이스만, 추후 구현
6. 체인별 비교 테이블
   | 항목 | Solana | EVM (Ethereum/L2) |
   - 스마트 월렛
   - 서명 알고리즘
   - KMS 키 스펙
   - 가스비
   - Account Abstraction
7. 어댑터 구현 가이드
   - 새 체인 추가 시 구현해야 할 메서드
   - 테스트 체크리스트
   - 체인별 특수 고려사항
8. 공통 도메인 모델
   - Wallet (체인 무관)
   - Transaction (체인별 확장)
   - TransactionResult
   - Policy (체인별 온체인 정책 매핑)
9. 확장 로드맵
   - Phase 3: Solana 완전 구현, EVM 인터페이스 정의
   - 추후: EVM 어댑터 구현 (Ethereum, Polygon, Arbitrum 등)
10. Mermaid 다이어그램
    - 어댑터 패턴 구조도
    - Solana vs EVM 흐름 비교

**참고:** PROJECT.md의 "멀티체인 구현 - 설계 시 확장성만 고려, 초기 구현은 Solana 집중"

**작성 언어:** 한글
  </action>
  <verify>
- 문서가 `.planning/deliverables/12-multichain-extension.md`에 존재
- IBlockchainAdapter 인터페이스가 TypeScript로 정의됨
- Solana 어댑터 상세 설계 포함
- EVM 확장 경로가 명확히 정의됨 (ERC-4337/Safe)
- 체인별 비교 테이블 포함
- 최소 1개의 Mermaid 다이어그램 포함
  </verify>
  <done>
IBlockchainAdapter 인터페이스가 정의되고, Solana 구현 상세와 EVM 확장 경로가 체인별 비교 테이블과 함께 문서화됨
  </done>
</task>

</tasks>

<verification>
Phase 03 Plan 03 완료 검증:
1. `.planning/deliverables/11-security-threat-model.md` 존재 및 ARCH-04 요구사항 충족
2. `.planning/deliverables/12-multichain-extension.md` 존재 및 ARCH-05 요구사항 충족
3. 보안 위협 모델이 CONTEXT.md의 "보안 최우선" 원칙을 반영
4. 멀티체인 설계가 09-system-components.md의 인터페이스와 일관성 유지
</verification>

<success_criteria>
- ARCH-04: 공격 벡터와 대응 방안이 위협 매트릭스로 문서화됨
- ARCH-04: 키 탈취 대응이 위협 수준별로 정의됨
- ARCH-05: Solana에서 EVM으로의 확장 경로가 인터페이스 기반으로 정의됨
- 모든 문서가 한글로 작성됨
</success_criteria>

<output>
After completion, create `.planning/phases/03-system-architecture/03-03-SUMMARY.md`
</output>
