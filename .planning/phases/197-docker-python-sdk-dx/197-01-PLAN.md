---
phase: 197-docker-python-sdk-dx
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - docker-compose.yml
  - docker-compose.build.yml
  - .env.example
autonomous: true
requirements:
  - DOCK-01
  - DOCK-02

must_haves:
  truths:
    - "docker compose up -d pulls GHCR image and starts daemon without local build"
    - ".env.example exists at repo root with MASTER_PASSWORD and RPC URL entries"
    - "Local build users can use docker-compose.build.yml override"
  artifacts:
    - path: "docker-compose.yml"
      provides: "GHCR image reference instead of build context"
      contains: "image: ghcr.io/"
    - path: "docker-compose.build.yml"
      provides: "Local build override for developers"
      contains: "build:"
    - path: ".env.example"
      provides: "Environment variable template for Docker users"
      contains: "WAIAAS_MASTER_PASSWORD"
  key_links:
    - from: "docker-compose.yml"
      to: "ghcr.io/minhoyoo-iotrust/waiaas"
      via: "image field"
      pattern: "image:\\s+ghcr\\.io/"
    - from: "docker-compose.yml"
      to: ".env.example"
      via: "env_file reference"
      pattern: "env_file"
---

<objective>
Docker DX 개선: docker-compose.yml이 GHCR 이미지를 기본으로 사용하고, .env.example이 필수 환경변수를 문서화한다.

Purpose: 신규 Docker 사용자가 `docker compose up -d`만으로 데몬을 바로 실행할 수 있도록. 현재는 `build:` 설정이 기본이라 로컬 빌드가 필요하며 실행까지 수분 이상 소요됨.
Output: docker-compose.yml (image 기반), docker-compose.build.yml (로컬 빌드 오버라이드), .env.example (환경변수 템플릿)
</objective>

<execution_context>
@/Users/minho.yoo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/minho.yoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@docker-compose.yml
@docker-compose.secrets.yml
@docs/deployment.md
@internal/objectives/m25-00-dx-polish.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: docker-compose.yml을 GHCR 이미지 기반으로 전환 + 빌드 오버라이드 분리</name>
  <files>docker-compose.yml, docker-compose.build.yml</files>
  <action>
1. **docker-compose.yml 수정**: `build:` 블록(context + dockerfile)을 제거하고 `image: ghcr.io/minhoyoo-iotrust/waiaas:latest`로 교체. 나머지 설정(container_name, ports, volumes, environment, env_file, restart, healthcheck)은 그대로 유지. 기존 상단 주석의 Usage 섹션은 유지하되, Docker Secrets 주석 블록도 보존.

2. **docker-compose.build.yml 생성**: 로컬 빌드용 오버라이드 파일. 내용:
```yaml
# Local build override for development.
# Usage: docker compose -f docker-compose.yml -f docker-compose.build.yml up -d --build
services:
  daemon:
    build:
      context: .
      dockerfile: Dockerfile
    image: waiaas-daemon:local
```
이 파일은 `docker compose -f docker-compose.yml -f docker-compose.build.yml up -d --build`로 사용.

주의: GitHub repository는 `minhoyoo-iotrust/WAIaaS`이지만, GHCR 이미지 이름은 소문자로 `ghcr.io/minhoyoo-iotrust/waiaas`를 사용한다 (GHCR 정책상 소문자만 허용). 이는 기존 release.yml의 `ghcr.io/${{ github.repository }}`가 자동으로 소문자 변환하는 것과 일치.
  </action>
  <verify>
1. `grep 'image: ghcr.io/' docker-compose.yml` -- GHCR 이미지 참조 존재 확인
2. `grep -c 'build:' docker-compose.yml` -- 0 (build 블록 제거됨)
3. `grep 'build:' docker-compose.build.yml` -- 빌드 오버라이드 존재 확인
4. `docker compose config` -- 유효한 YAML 검증 (docker가 설치된 경우)
  </verify>
  <done>docker-compose.yml이 `image: ghcr.io/minhoyoo-iotrust/waiaas:latest`를 사용하고 build 블록이 없다. docker-compose.build.yml에 로컬 빌드 오버라이드가 존재한다.</done>
</task>

<task type="auto">
  <name>Task 2: .env.example 환경변수 템플릿 생성</name>
  <files>.env.example</files>
  <action>
프로젝트 루트에 `.env.example` 파일 생성. Docker 사용자가 `.env`로 복사하여 사용할 수 있는 환경변수 템플릿.

내용 구성 (docs/deployment.md의 환경변수 목록 기반):

```
# ==============================================================================
# WAIaaS Docker Environment Variables
# Copy to .env and fill in required values:  cp .env.example .env
# ==============================================================================

# --- Required ---

# Master password hash (generate with: waiaas hash-password)
# Or set plaintext password (less secure, for quick testing only):
# WAIAAS_MASTER_PASSWORD=your_password_here
WAIAAS_DAEMON_MASTER_PASSWORD_HASH=

# --- RPC Endpoints ---
# At least one RPC endpoint is required for your target chain.

# Solana
WAIAAS_RPC_SOLANA_MAINNET=https://api.mainnet-beta.solana.com
WAIAAS_RPC_SOLANA_DEVNET=https://api.devnet.solana.com

# EVM (uncomment and set your provider URL)
# WAIAAS_RPC_ETHEREUM_MAINNET=https://eth-mainnet.g.alchemy.com/v2/YOUR_KEY
# WAIAAS_RPC_ETHEREUM_SEPOLIA=https://eth-sepolia.g.alchemy.com/v2/YOUR_KEY
# WAIAAS_RPC_POLYGON_MAINNET=https://polygon-mainnet.g.alchemy.com/v2/YOUR_KEY
# WAIAAS_RPC_BASE_MAINNET=https://base-mainnet.g.alchemy.com/v2/YOUR_KEY

# --- Optional ---

# WAIAAS_DAEMON_PORT=3100
# WAIAAS_DAEMON_LOG_LEVEL=info

# Telegram notifications (optional)
# WAIAAS_NOTIFICATIONS_ENABLED=true
# WAIAAS_NOTIFICATIONS_TELEGRAM_BOT_TOKEN=123456:ABC-DEF...
# WAIAAS_NOTIFICATIONS_TELEGRAM_CHAT_ID=987654321
```

주의: `WAIAAS_DATA_DIR`과 `WAIAAS_DAEMON_HOSTNAME`은 docker-compose.yml에 이미 하드코딩되어 있으므로 .env.example에 포함하지 않는다.
  </action>
  <verify>
1. `test -f .env.example` -- 파일 존재 확인
2. `grep 'WAIAAS_MASTER_PASSWORD' .env.example` -- 필수 환경변수 포함
3. `grep 'WAIAAS_RPC_SOLANA' .env.example` -- RPC URL 포함
4. `grep 'WAIAAS_DAEMON_PORT' .env.example` -- 선택 변수 포함
  </verify>
  <done>.env.example이 프로젝트 루트에 존재하며, MASTER_PASSWORD(필수), RPC URLs(필수), PORT/LOG_LEVEL/Telegram(선택)을 포함한다.</done>
</task>

</tasks>

<verification>
1. `docker compose config 2>&1` -- docker-compose.yml이 유효한 YAML이고 image 필드가 존재
2. `grep -c 'build:' docker-compose.yml` -- 0 (빌드 블록 없음)
3. `grep 'ghcr.io' docker-compose.yml` -- GHCR 이미지 참조 존재
4. `test -f docker-compose.build.yml && grep 'build:' docker-compose.build.yml` -- 빌드 오버라이드 존재
5. `test -f .env.example && grep 'WAIAAS_MASTER_PASSWORD' .env.example` -- 환경변수 템플릿 존재
</verification>

<success_criteria>
- docker-compose.yml의 services.daemon이 `image: ghcr.io/minhoyoo-iotrust/waiaas:latest`를 사용하고 `build:` 블록이 없다
- docker-compose.build.yml이 로컬 빌드 오버라이드를 제공한다
- .env.example이 필수(MASTER_PASSWORD, RPC URLs) + 선택(PORT, LOG_LEVEL, Telegram) 환경변수를 문서화한다
</success_criteria>

<output>
After completion, create `.planning/phases/197-docker-python-sdk-dx/197-01-SUMMARY.md`
</output>
