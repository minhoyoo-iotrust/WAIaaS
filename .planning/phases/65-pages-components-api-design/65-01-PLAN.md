---
phase: 65-pages-components-api-design
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/67-admin-web-ui-spec.md
autonomous: true

must_haves:
  truths:
    - "Dashboard 화면의 위젯 레이아웃, 30초 폴링, 데몬 상태/버전/에이전트 수/세션 수/Kill Switch 표시가 설계 문서에 정의되어 있다"
    - "Agents/Sessions/Policies/Settings 4개 화면의 목록, 폼, 상세, 삭제 등 모든 인터랙션과 데이터 흐름이 설계 문서에 정의되어 있다"
    - "Preact 컴포넌트 트리(App -> Router -> Page -> Section -> Widget)와 preact-iso 해시 라우터 경로 매핑이 정의되어 있다"
    - "CSS Variables 디자인 토큰(색상, 간격, 타이포그래피)과 공통 컴포넌트(Table, Form, Modal, Toast, Button, Badge) 인터페이스가 정의되어 있다"
    - "fetch 래퍼 상세, 68개 에러 코드 -> 사용자 메시지 매핑, 로딩/빈 상태/연결 실패 UX, 폼 검증 방침이 정의되어 있다"
  artifacts:
    - path: "docs/67-admin-web-ui-spec.md"
      provides: "Sections 8-10: page designs, common components, API integration patterns"
      contains: "## 8. 화면 설계"
    - path: "docs/67-admin-web-ui-spec.md"
      provides: "Section 9: common component interfaces and CSS Variables design tokens"
      contains: "## 9. 공통 컴포넌트"
    - path: "docs/67-admin-web-ui-spec.md"
      provides: "Section 10: API integration patterns with error mapping table"
      contains: "## 10. API 연동 패턴"
  key_links:
    - from: "docs/67-admin-web-ui-spec.md section 8"
      to: "packages/daemon/src/api/routes/admin.ts"
      via: "Dashboard/Settings page references actual API endpoints"
      pattern: "GET /v1/admin/status"
    - from: "docs/67-admin-web-ui-spec.md section 8"
      to: "packages/daemon/src/api/routes/agents.ts"
      via: "Agents page references actual CRUD endpoints"
      pattern: "GET/POST /v1/agents"
    - from: "docs/67-admin-web-ui-spec.md section 10"
      to: "packages/core/src/errors/error-codes.ts"
      via: "68 error codes mapped to user-friendly messages"
      pattern: "INVALID_MASTER_PASSWORD"
---

<objective>
Write sections 8, 9, 10 of design doc 67 (67-admin-web-ui-spec.md), completing the Admin Web UI design specification by defining 5 page layouts with data flows, common component interfaces with CSS Variables design tokens, and API integration patterns with the complete error code mapping table.

Purpose: Provide all design decisions needed for v1.3.2 implementation so that a developer can build the Admin Web UI without interpretation or design ambiguity.

Output: docs/67-admin-web-ui-spec.md with sections 8-10 appended to existing sections 1-7.
</objective>

<execution_context>
@/Users/minho.yoo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/minho.yoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Existing design doc (sections 1-7 already written by Phase 64)
@docs/67-admin-web-ui-spec.md

# Phase 64 summary (infra/auth/security foundation)
@.planning/phases/64-infra-auth-security-design/64-01-SUMMARY.md

# Actual API routes (reference for page-API mapping)
@packages/daemon/src/api/routes/admin.ts
@packages/daemon/src/api/routes/agents.ts
@packages/daemon/src/api/routes/sessions.ts
@packages/daemon/src/api/routes/policies.ts

# Error codes (all 68 codes — the error mapping table must cover ALL of these)
@packages/core/src/errors/error-codes.ts

# Existing i18n messages (reference for user-friendly message phrasing)
@packages/core/src/i18n/en.ts

# Schemas (for form field definitions and validation rules)
@packages/core/src/schemas/agent.schema.ts
@packages/core/src/schemas/policy.schema.ts

# Enums (for dropdown options and status display)
@packages/core/src/enums/agent.ts
@packages/core/src/enums/chain.ts
@packages/core/src/enums/policy.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write section 8 — 5 page designs with data flows</name>
  <files>docs/67-admin-web-ui-spec.md</files>
  <action>
READ the existing docs/67-admin-web-ui-spec.md (sections 1-7). Then REMOVE the "후속 섹션 예고" placeholder section at the bottom and APPEND section 8 before the "관련 설계 문서" section.

Section 8 must contain 5 subsections (8.1-8.5), one per page. For each page, define:
- ASCII wireframe layout showing widget/section placement
- Component hierarchy (which components compose the page)
- Data flow (which API endpoints are called, when, how data maps to UI)
- User interactions (click, submit, delete confirm) and their effects
- State management (signals vs local state)

**8.1 Dashboard (PAGE-01)**

Layout: 2-row grid. Top row: 4 stat cards (Version, Uptime, Agents count, Active Sessions count). Bottom row: Kill Switch status badge (NORMAL=green / ACTIVATED=red).

- API: `GET /v1/admin/status` — polled every 30 seconds via `setInterval`
- Response fields → widgets: `version` → Version card, `uptime` → Uptime card (format as "Xd Xh Xm"), `agentCount` → Agents card, `activeSessionCount` → Sessions card, `killSwitchState` → Kill Switch badge
- On mount: fetch immediately, then start 30s interval. On unmount: clear interval.
- Loading state: skeleton cards. Error state: "Cannot connect to daemon" banner with retry button.
- Cleanup on unmount (`useEffect` return).
- Signal: `dashboardData` as local `signal()` per page (not global).

**8.2 Agents (PAGE-02)**

Two modes: List view (default) and Detail view (route param).

List view (`#/agents`):
- Table columns: Name, Chain, Network, Public Key (truncated, copy button), Status (badge), Created
- "Create Agent" button → opens inline form (not modal): name (text, 1-100 chars), chain (select: solana/ethereum), network (select: devnet/testnet/mainnet)
- Row click → navigate to `#/agents/{id}` detail view
- API: `GET /v1/agents` on mount

Detail view (`#/agents/{id}`):
- Read-only fields: ID, Public Key (full, copy button), Chain, Network, Owner Address (if set), Owner State (NONE/GRACE/LOCKED badge), Status, Created, Updated
- Editable: Name (inline edit with pencil icon → text input → Save/Cancel)
- Name edit: `PUT /v1/agents/{id}` with `{ name }` body
- Delete button → confirmation Modal ("Terminate agent {name}? This action cannot be undone.") → `DELETE /v1/agents/{id}`
- After delete: navigate back to `#/agents` list
- API: `GET /v1/agents/{id}` on mount
- Owner fields are read-only in Admin UI (Owner registration requires SIWS/SIWE — out of scope)

Create flow: `POST /v1/agents` → on 201 success: show toast "Agent created", refresh list. On error: show error toast with mapped message.

**8.3 Sessions (PAGE-03)**

Layout: Top section = agent selector dropdown + "Create Session" button. Below = session table.

- Agent dropdown: populated from `GET /v1/agents` (fetch on mount), shows agent name + ID
- Selecting an agent: calls `GET /v1/sessions?agentId={id}`, populates table
- Table columns: ID (truncated), Status (ACTIVE=green / EXPIRED=gray badge), Expires At (formatted), Renewal Count, Created
- Token column: shown only on create (1-time display). After creation, token is NOT re-displayed (security: token is hashed in DB)
- "Create Session" button (disabled if no agent selected) → `POST /v1/sessions` with `{ agentId }` body → 201 response includes `token` field → show Modal with token value + CopyButton. Warning text: "Copy this token now. It will not be shown again."
- Revoke button per row → confirmation Modal → `DELETE /v1/sessions/{id}` → refresh list
- API: `GET /v1/agents` (dropdown), `GET /v1/sessions?agentId=X` (list), `POST /v1/sessions` (create), `DELETE /v1/sessions/{id}` (revoke)

**8.4 Policies (PAGE-04)**

Layout: Top section = "Create Policy" button + optional agent filter dropdown. Below = policy table.

- Table columns: Type (badge), Agent (name or "Global"), Priority, Enabled (toggle icon), Rules (summary text), Created
- Agent filter dropdown: "All" (default) + agent list from `GET /v1/agents`
- Filter selection: `GET /v1/policies?agentId={id}` or `GET /v1/policies` (all)

Create/Edit form (inline panel below table, not modal):
- Type (select: SPENDING_LIMIT, WHITELIST, TIME_RESTRICTION, RATE_LIMIT, ALLOWED_TOKENS, CONTRACT_WHITELIST, METHOD_WHITELIST, APPROVED_SPENDERS, APPROVE_AMOUNT_LIMIT, APPROVE_TIER_OVERRIDE) — immutable on edit
- Agent (select: agent list + "Global (all agents)" option) — immutable on edit
- Priority (number input, integer)
- Enabled (checkbox, default true)
- Rules (dynamic form based on type):
  - SPENDING_LIMIT: instant_max (digit string), notify_max (digit string), delay_max (digit string), delay_seconds (number, optional), approval_timeout (number, optional). Color visualization: INSTANT range 0-instant_max (green), DELAY range instant_max-delay_max (yellow), BLOCKED above delay_max (red)
  - WHITELIST: allowed_addresses (textarea, one address per line)
  - Other types: rules JSON textarea (free-form JSON object)

- Create: `POST /v1/policies` → 201 → toast + refresh list
- Edit: click row → populate form → modify → `PUT /v1/policies/{id}` → 200 → toast + refresh
- Delete: delete button per row → confirmation Modal → `DELETE /v1/policies/{id}` → refresh
- Tier visualization for SPENDING_LIMIT: horizontal bar showing INSTANT (green) / DELAY (yellow) / BLOCKED (red) segments with dollar amounts

**8.5 Settings (PAGE-05)**

Layout: Vertical sections, each a card.

Section 1 — Daemon Status (read-only):
- Version, Uptime, Agent Count, Active Session Count (same data as Dashboard, fetched from `GET /v1/admin/status`)
- No auto-polling (manual refresh button)

Section 2 — Kill Switch:
- Current state display: NORMAL (green badge) or ACTIVATED (red badge)
- State fetched from `GET /v1/admin/kill-switch` (public endpoint, no auth needed — but Admin UI sends auth anyway via global fetch wrapper)
- Toggle button: "Activate Kill Switch" (when NORMAL) or "Recover" (when ACTIVATED)
- Activate: confirmation Modal ("Activate Kill Switch? All operations will be suspended.") → `POST /v1/admin/kill-switch` → refresh state
- Recover: confirmation Modal ("Recover from Kill Switch?") → `POST /v1/admin/recover` → refresh state

Section 3 — JWT Secret Rotation:
- "Rotate JWT Secret" button → confirmation Modal ("Rotate JWT secret? Old tokens will remain valid for 5 minutes.") → `POST /v1/admin/rotate-secret`
- Success: toast "JWT secret rotated"
- Error ROTATION_TOO_RECENT: toast with mapped message

Section 4 — Shutdown:
- "Shutdown Daemon" button (red, dangerous action styling) → confirmation Modal ("Shutdown daemon? This will stop all operations. You will need to restart the daemon process manually.") → `POST /v1/admin/shutdown`
- After shutdown response: show full-screen overlay "Daemon has been shut down. Restart the daemon process to continue." with no action buttons (daemon is gone, API is unreachable)
- Subsequent API calls will fail with connection error → the overlay prevents further interaction

**Component Tree (COMP-01 partial — full tree in section 9):**

For the page-level hierarchy documented in section 8, define the routing:
```
App
├── Login (if !isAuthenticated)
└── Layout (if isAuthenticated)
    ├── Sidebar (nav links: Dashboard, Agents, Sessions, Policies, Settings)
    ├── Header (page title + Logout button)
    └── Router
        ├── #/dashboard → Dashboard
        ├── #/agents → AgentList
        ├── #/agents/:id → AgentDetail
        ├── #/sessions → Sessions
        ├── #/policies → Policies
        ├── #/settings → Settings
        └── default → Dashboard
```

Commit this task with message: `docs(65-01): add design doc 67 section 8 (5 page designs)`
  </action>
  <verify>
Verify section 8 exists in docs/67-admin-web-ui-spec.md with all 5 subsections (8.1-8.5). Check:
- `grep -c "### 8\." docs/67-admin-web-ui-spec.md` returns 5
- Section 8.1 mentions "30초" or "30 seconds" polling
- Section 8.2 mentions `GET /v1/agents` and `DELETE /v1/agents/{id}`
- Section 8.3 mentions token copy and "not be shown again"
- Section 8.4 mentions SPENDING_LIMIT tier visualization (INSTANT/DELAY/BLOCKED colors)
- Section 8.5 mentions shutdown overlay and Kill Switch toggle
  </verify>
  <done>
Section 8 in design doc 67 defines all 5 pages (Dashboard, Agents, Sessions, Policies, Settings) with wireframe layouts, component hierarchies, API endpoint mappings, user interaction flows, and state management. PAGE-01 through PAGE-05 requirements are addressed. The component tree with hash router paths is defined (partial COMP-01).
  </done>
</task>

<task type="auto">
  <name>Task 2: Write sections 9-10 — common components + API integration patterns</name>
  <files>docs/67-admin-web-ui-spec.md</files>
  <action>
READ the current docs/67-admin-web-ui-spec.md (now including section 8 from Task 1). APPEND sections 9 and 10 after section 8 and before "관련 설계 문서".

**Section 9: 공통 컴포넌트 (COMP-01, COMP-02, COMP-03)**

9.1 Preact 컴포넌트 트리 (COMP-01):
Define the complete component tree with file-to-component mapping:
```
App (app.tsx)
├── Login (auth/login.tsx) — when !isAuthenticated
└── Layout (components/layout.tsx) — when isAuthenticated
    ├── Sidebar — nav links with active state
    │   └── NavLink × 5 (Dashboard, Agents, Sessions, Policies, Settings)
    ├── Header — current page title + Logout button
    └── Router (preact-iso)
        ├── #/dashboard → DashboardPage (pages/dashboard.tsx)
        │   ├── StatCard × 4 (version, uptime, agents, sessions)
        │   └── KillSwitchBadge
        ├── #/agents → AgentListPage (pages/agents.tsx)
        │   ├── CreateAgentForm
        │   ├── Table (agents data)
        │   └── CopyButton (per public key)
        ├── #/agents/:id → AgentDetailPage (pages/agents.tsx)
        │   ├── ReadOnlyFieldGroup
        │   ├── InlineEditField (name)
        │   ├── CopyButton (public key)
        │   └── DeleteButton → Modal
        ├── #/sessions → SessionsPage (pages/sessions.tsx)
        │   ├── AgentSelector (dropdown)
        │   ├── CreateSessionButton → Modal (token display)
        │   ├── Table (sessions data)
        │   └── CopyButton (token, one-time)
        ├── #/policies → PoliciesPage (pages/policies.tsx)
        │   ├── AgentFilterDropdown
        │   ├── PolicyForm (create/edit)
        │   │   ├── TypeSelector
        │   │   ├── RulesEditor (dynamic per type)
        │   │   └── TierVisualization (SPENDING_LIMIT only)
        │   ├── Table (policies data)
        │   └── DeleteButton → Modal
        └── #/settings → SettingsPage (pages/settings.tsx)
            ├── DaemonStatusCard
            ├── KillSwitchCard → Modal
            ├── JwtRotationCard → Modal
            └── ShutdownCard → Modal
```

Hash router path mapping table:
| Hash Path | Component | File |
|-----------|-----------|------|
| #/login | Login | auth/login.tsx |
| #/dashboard | DashboardPage | pages/dashboard.tsx |
| #/agents | AgentListPage | pages/agents.tsx |
| #/agents/:id | AgentDetailPage | pages/agents.tsx |
| #/sessions | SessionsPage | pages/sessions.tsx |
| #/policies | PoliciesPage | pages/policies.tsx |
| #/settings | SettingsPage | pages/settings.tsx |

9.2 CSS Variables 디자인 토큰 (COMP-02):
Define the complete token set in `packages/admin/src/styles/global.css`:

Colors (light theme, CSS Variables for future dark mode extensibility):
```css
:root {
  /* Primary */
  --color-primary: #2563eb;
  --color-primary-hover: #1d4ed8;
  --color-primary-light: #eff6ff;

  /* Neutral */
  --color-bg: #ffffff;
  --color-bg-secondary: #f8fafc;
  --color-bg-tertiary: #f1f5f9;
  --color-border: #e2e8f0;
  --color-text: #0f172a;
  --color-text-secondary: #64748b;
  --color-text-muted: #94a3b8;

  /* Status */
  --color-success: #16a34a;
  --color-success-bg: #f0fdf4;
  --color-warning: #d97706;
  --color-warning-bg: #fffbeb;
  --color-danger: #dc2626;
  --color-danger-bg: #fef2f2;
  --color-info: #2563eb;
  --color-info-bg: #eff6ff;

  /* Tier colors (policy visualization) */
  --color-tier-instant: #16a34a;  /* green — INSTANT */
  --color-tier-delay: #d97706;    /* amber — DELAY */
  --color-tier-blocked: #dc2626;  /* red — BLOCKED */

  /* Spacing (4px base) */
  --space-1: 0.25rem;   /* 4px */
  --space-2: 0.5rem;    /* 8px */
  --space-3: 0.75rem;   /* 12px */
  --space-4: 1rem;      /* 16px */
  --space-6: 1.5rem;    /* 24px */
  --space-8: 2rem;      /* 32px */

  /* Typography */
  --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  --font-size-xs: 0.75rem;   /* 12px */
  --font-size-sm: 0.875rem;  /* 14px */
  --font-size-base: 1rem;    /* 16px */
  --font-size-lg: 1.125rem;  /* 18px */
  --font-size-xl: 1.25rem;   /* 20px */
  --font-size-2xl: 1.5rem;   /* 24px */
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 600;
  --font-weight-bold: 700;
  --line-height: 1.5;

  /* Borders */
  --radius-sm: 4px;
  --radius-md: 6px;
  --radius-lg: 8px;
  --radius-full: 9999px;
  --border-width: 1px;

  /* Shadows */
  --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
  --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07);

  /* Layout */
  --sidebar-width: 220px;
  --header-height: 56px;
  --content-max-width: 1200px;
}
```

9.3 공통 컴포넌트 인터페이스 (COMP-02):

For each shared component, define the TypeScript props interface and behavior:

**Table** (`components/table.tsx`):
```typescript
interface Column<T> {
  key: keyof T | string;
  header: string;
  render?: (row: T) => preact.VNode;
  width?: string;
}
interface TableProps<T> {
  columns: Column<T>[];
  data: T[];
  onRowClick?: (row: T) => void;
  emptyMessage?: string;
  loading?: boolean;
}
```
- Renders `<table>` with thead/tbody
- Loading state: skeleton rows (3 placeholder rows)
- Empty state: EmptyState component
- Row click: navigates or opens detail

**Form / FormField** (`components/form.tsx`):
```typescript
interface FormFieldProps {
  label: string;
  name: string;
  type: 'text' | 'number' | 'select' | 'textarea' | 'checkbox';
  value: string | number | boolean;
  onChange: (value: string | number | boolean) => void;
  options?: { value: string; label: string }[];  // for select
  error?: string;
  required?: boolean;
  disabled?: boolean;
  placeholder?: string;
  min?: number;
  max?: number;
}
```
- Each field renders label + input + error message
- Error message shown below input in red when validation fails

**Modal** (`components/modal.tsx`):
```typescript
interface ModalProps {
  open: boolean;
  title: string;
  children: preact.ComponentChildren;
  onConfirm?: () => void;
  onCancel: () => void;
  confirmText?: string;  // default "Confirm"
  cancelText?: string;   // default "Cancel"
  confirmVariant?: 'primary' | 'danger';  // default "primary"
  loading?: boolean;
}
```
- Overlay with centered card
- ESC key closes modal
- Click outside modal closes it
- Confirm button shows loading spinner when `loading=true`

**Toast** (`components/toast.tsx`):
```typescript
type ToastType = 'success' | 'error' | 'info';
interface Toast {
  id: string;
  type: ToastType;
  message: string;
}
// Global toast signal
const toasts = signal<Toast[]>([]);
function showToast(type: ToastType, message: string): void;
```
- Fixed position top-right
- Auto-dismiss after 5 seconds
- Success = green border, Error = red border, Info = blue border
- Multiple toasts stack vertically

**Button** (`components/form.tsx` — exported alongside FormField):
```typescript
interface ButtonProps {
  variant: 'primary' | 'secondary' | 'danger' | 'ghost';
  size?: 'sm' | 'md';  // default 'md'
  loading?: boolean;
  disabled?: boolean;
  onClick?: () => void;
  children: preact.ComponentChildren;
}
```

**Badge** (`components/form.tsx` — exported alongside):
```typescript
interface BadgeProps {
  variant: 'success' | 'warning' | 'danger' | 'info' | 'neutral';
  children: preact.ComponentChildren;
}
```
- Used for: agent status (ACTIVE=success, SUSPENDED=warning, TERMINATED=danger), kill switch state (NORMAL=success, ACTIVATED=danger), session status, owner state (NONE=neutral, GRACE=warning, LOCKED=success), policy type

**CopyButton** (`components/copy-button.tsx`):
```typescript
interface CopyButtonProps {
  value: string;
  label?: string;  // default "Copy"
}
```
- Click: `navigator.clipboard.writeText(value)` → icon changes to checkmark for 2 seconds → reverts
- Fallback for clipboard API failure: select-all in hidden textarea

**EmptyState** (`components/empty-state.tsx`):
```typescript
interface EmptyStateProps {
  title: string;        // e.g., "No agents yet"
  description?: string; // e.g., "Create your first agent to get started"
  actionLabel?: string; // e.g., "Create Agent"
  onAction?: () => void;
}
```
- Centered icon + title + description + optional action button

9.4 폼 유효성 검증 방침 (COMP-03):

**Strategy: Client-side independent validation (NOT reusing server Zod schemas).**

Rationale: packages/admin is a Preact frontend with zero runtime dependency on @waiaas/core. Importing Zod schemas would add Zod to the frontend bundle (~13KB gzip) and create a build-time coupling. Instead, define lightweight validation functions in the admin package that mirror server rules.

Field validation rules (mirroring @waiaas/core schemas):

| Field | Page | Rule | Error Message |
|-------|------|------|---------------|
| Agent name | Agents | 1-100 chars, non-empty after trim | "Name must be 1-100 characters" |
| Chain | Agents | Must be "solana" or "ethereum" | "Select a chain" |
| Network | Agents | Must be "devnet", "testnet", or "mainnet" | "Select a network" |
| Policy type | Policies | Must be one of 10 POLICY_TYPES values | "Select a policy type" |
| Priority | Policies | Integer, any value (default 0) | "Priority must be an integer" |
| instant_max | Policies (SPENDING_LIMIT) | Digit string (regex: /^\d+$/) | "Must be a positive number string" |
| notify_max | Policies (SPENDING_LIMIT) | Digit string | "Must be a positive number string" |
| delay_max | Policies (SPENDING_LIMIT) | Digit string | "Must be a positive number string" |
| allowed_addresses | Policies (WHITELIST) | Non-empty array of non-empty strings | "Enter at least one address" |
| Rules JSON | Policies (other types) | Valid JSON object | "Invalid JSON format" |

Validation timing: On submit (not on blur). Show error messages below each invalid field. Clear errors when user starts editing the field.

Commit this task with message: `docs(65-01): add design doc 67 sections 9-10 (components, API patterns, error mapping)`

**Section 10: API 연동 패턴 (APIC-01, APIC-02, APIC-03)**

10.1 fetch 래퍼 상세 (APIC-01):

Expand on the `apiCall()` design from section 6.4 with full specification:

```typescript
// packages/admin/src/api/client.ts

interface ApiErrorBody {
  code: string;       // WAIaaS error code (e.g., 'AGENT_NOT_FOUND')
  message: string;    // Server error message
}

class ApiError extends Error {
  constructor(
    public status: number,
    public code: string,
    public serverMessage: string,
  ) {
    super(serverMessage);
  }
}

async function apiCall<T>(path: string, options?: RequestInit): Promise<T>;
async function apiGet<T>(path: string): Promise<T>;
async function apiPost<T>(path: string, body: unknown): Promise<T>;
async function apiPut<T>(path: string, body: unknown): Promise<T>;
async function apiDelete<T>(path: string): Promise<T>;
```

Behavior:
- All methods inject `X-Master-Password` header from Auth Store signal
- All methods set `Content-Type: application/json`
- `AbortSignal.timeout(10_000)` (10s timeout)
- 401 response → `logout()` → redirect `#/login`
- Non-200 response → parse body for `code` field → throw `ApiError`
- Network error (fetch throws) → throw `ApiError` with code `'NETWORK_ERROR'`
- Success: parse JSON and return typed result
- Reset inactivity timer on every successful API call (via `resetInactivityTimer()`)

10.2 에러 코드 매핑 (APIC-02):

Define the COMPLETE mapping table for all 68 error codes from `packages/core/src/errors/error-codes.ts`. The Admin UI only encounters a subset of these (masterAuth endpoints don't trigger TX/ACTION/WITHDRAW errors), but the mapping must be complete for robustness.

The mapping table in `packages/admin/src/utils/error-messages.ts`:

```typescript
export const ERROR_MESSAGES: Record<string, string> = {
  // --- AUTH domain (8) ---
  INVALID_TOKEN: 'Invalid authentication token.',
  TOKEN_EXPIRED: 'Authentication token has expired.',
  SESSION_REVOKED: 'Session has been revoked.',
  INVALID_SIGNATURE: 'Invalid cryptographic signature.',
  INVALID_NONCE: 'Invalid or expired nonce.',
  INVALID_MASTER_PASSWORD: 'Invalid master password. Please check and try again.',
  MASTER_PASSWORD_LOCKED: 'Master password locked due to too many failed attempts. Please wait before trying again.',
  SYSTEM_LOCKED: 'System is locked. Kill switch may be active.',

  // --- SESSION domain (8) ---
  SESSION_NOT_FOUND: 'Session not found.',
  SESSION_EXPIRED: 'Session has expired.',
  SESSION_LIMIT_EXCEEDED: 'Maximum session limit reached for this agent.',
  CONSTRAINT_VIOLATED: 'Session constraint violated.',
  RENEWAL_LIMIT_REACHED: 'Session renewal limit reached. Create a new session.',
  SESSION_ABSOLUTE_LIFETIME_EXCEEDED: 'Session has exceeded its absolute lifetime.',
  RENEWAL_TOO_EARLY: 'Session renewal attempted too early. Please wait.',
  SESSION_RENEWAL_MISMATCH: 'Session token mismatch. The session may have been renewed elsewhere.',

  // --- PIPELINE domain (1) ---
  PIPELINE_HALTED: 'Transaction is queued for delay or requires approval.',

  // --- TX domain (20) ---
  INSUFFICIENT_BALANCE: 'Insufficient balance for this transaction.',
  INVALID_ADDRESS: 'Invalid blockchain address format.',
  TX_NOT_FOUND: 'Transaction not found.',
  TX_EXPIRED: 'Transaction has expired.',
  TX_ALREADY_PROCESSED: 'Transaction has already been processed.',
  CHAIN_ERROR: 'Blockchain RPC error. Please try again.',
  SIMULATION_FAILED: 'Transaction simulation failed.',
  TOKEN_NOT_FOUND: 'Token not found.',
  TOKEN_NOT_ALLOWED: 'Token is not allowed by the current policy.',
  INSUFFICIENT_TOKEN_BALANCE: 'Insufficient token balance.',
  CONTRACT_CALL_DISABLED: 'Contract calls are disabled. Configure CONTRACT_WHITELIST to enable.',
  CONTRACT_NOT_WHITELISTED: 'Contract address is not whitelisted.',
  METHOD_NOT_WHITELISTED: 'Contract method is not whitelisted.',
  APPROVE_DISABLED: 'Token approvals are disabled. Configure APPROVED_SPENDERS to enable.',
  SPENDER_NOT_APPROVED: 'Spender address is not in the approved list.',
  APPROVE_AMOUNT_EXCEEDED: 'Approve amount exceeds the configured limit.',
  UNLIMITED_APPROVE_BLOCKED: 'Unlimited token approval is blocked by policy.',
  BATCH_NOT_SUPPORTED: 'Batch transactions are not supported on this chain.',
  BATCH_SIZE_EXCEEDED: 'Batch instruction count exceeds the maximum (20).',
  BATCH_POLICY_VIOLATION: 'Policy violation in batch transaction.',

  // --- POLICY domain (5) ---
  POLICY_NOT_FOUND: 'Policy not found.',
  POLICY_DENIED: 'Transaction denied by policy.',
  SPENDING_LIMIT_EXCEEDED: 'Spending limit exceeded.',
  RATE_LIMIT_EXCEEDED: 'Rate limit exceeded. Please wait before trying again.',
  WHITELIST_DENIED: 'Address is not in the whitelist.',

  // --- OWNER domain (5) ---
  OWNER_ALREADY_CONNECTED: 'Owner wallet is already connected to this agent.',
  OWNER_NOT_CONNECTED: 'No owner wallet connected.',
  OWNER_NOT_FOUND: 'Owner not found.',
  APPROVAL_TIMEOUT: 'Approval request has timed out.',
  APPROVAL_NOT_FOUND: 'Approval request not found.',

  // --- SYSTEM domain (6) ---
  KILL_SWITCH_ACTIVE: 'Kill switch is active. All operations are suspended.',
  KILL_SWITCH_NOT_ACTIVE: 'Kill switch is not currently active.',
  KEYSTORE_LOCKED: 'Keystore is locked. Please try again.',
  CHAIN_NOT_SUPPORTED: 'This blockchain is not supported.',
  SHUTTING_DOWN: 'Server is shutting down.',
  ADAPTER_NOT_AVAILABLE: 'Chain adapter is not available. Please try again.',

  // --- AGENT domain (3) ---
  AGENT_NOT_FOUND: 'Agent not found.',
  AGENT_SUSPENDED: 'Agent is currently suspended.',
  AGENT_TERMINATED: 'Agent has been terminated.',

  // --- WITHDRAW domain (4) ---
  NO_OWNER: 'No owner registered for this agent.',
  WITHDRAW_LOCKED_ONLY: 'Withdrawal requires the owner to be in LOCKED state.',
  SWEEP_TOTAL_FAILURE: 'All sweep operations failed. Please try again.',
  INSUFFICIENT_FOR_FEE: 'Insufficient balance for transaction fee.',

  // --- ACTION domain (7) ---
  ACTION_NOT_FOUND: 'Action not found.',
  ACTION_VALIDATION_FAILED: 'Action input validation failed.',
  ACTION_RESOLVE_FAILED: 'Action resolve failed. External API may be unavailable.',
  ACTION_RETURN_INVALID: 'Action returned an invalid result.',
  ACTION_PLUGIN_LOAD_FAILED: 'Action plugin failed to load.',
  ACTION_NAME_CONFLICT: 'Action name is already registered.',
  ACTION_CHAIN_MISMATCH: 'Action does not support the requested chain.',

  // --- ADMIN domain (1) ---
  ROTATION_TOO_RECENT: 'Secret rotation was performed too recently. Please wait.',
};

// Lookup function with fallback
export function getErrorMessage(code: string): string {
  return ERROR_MESSAGES[code] ?? `An unexpected error occurred (${code}).`;
}
```

10.3 UX 상태 패턴 (APIC-03):

Define 4 standard UX states that every data-fetching component must handle:

| State | Trigger | UI |
|-------|---------|-----|
| Loading | Initial fetch or refresh in progress | Skeleton placeholder (table: 3 gray rows, card: pulsing rectangles) |
| Success | Data loaded, items > 0 | Normal data display |
| Empty | Data loaded, items = 0 | EmptyState component ("No {items} yet" + create action link) |
| Error | Fetch failed or API error | Error banner (red background) with message + "Retry" button |

Connection failure handling:
- fetch throws (network error) → show "Cannot connect to daemon. Is the daemon running?" with Retry button
- Retry button: re-executes the fetch

Shutdown state:
- After `POST /v1/admin/shutdown` succeeds → show full-screen overlay: "Daemon has been shut down" with no interactive elements
- Overlay prevents all further navigation and API calls
- Use a global `daemonShutdown` signal: `const daemonShutdown = signal(false);`
- Auth Guard checks this signal: if true, render shutdown overlay regardless of auth state

10.4 폼 검증 방침 (already defined in 9.4, cross-reference):
Reference section 9.4 for form validation strategy and field-level rules.

10.5 API 엔드포인트 상수 (endpoints.ts):
Define all API paths as constants for type-safe usage:
```typescript
export const API = {
  ADMIN_STATUS: '/v1/admin/status',
  ADMIN_KILL_SWITCH: '/v1/admin/kill-switch',
  ADMIN_RECOVER: '/v1/admin/recover',
  ADMIN_SHUTDOWN: '/v1/admin/shutdown',
  ADMIN_ROTATE_SECRET: '/v1/admin/rotate-secret',
  AGENTS: '/v1/agents',
  AGENT: (id: string) => `/v1/agents/${id}`,
  SESSIONS: '/v1/sessions',
  SESSION: (id: string) => `/v1/sessions/${id}`,
  POLICIES: '/v1/policies',
  POLICY: (id: string) => `/v1/policies/${id}`,
} as const;
```

After writing sections 9-10, also update the "최종 업데이트" line at the bottom and remove the "후속 섹션 예고" section if still present.
  </action>
  <verify>
Verify sections 9 and 10 exist in docs/67-admin-web-ui-spec.md. Check:
- `grep -c "### 9\." docs/67-admin-web-ui-spec.md` returns at least 4 (9.1, 9.2, 9.3, 9.4)
- `grep -c "### 10\." docs/67-admin-web-ui-spec.md` returns at least 4 (10.1, 10.2, 10.3, 10.4+)
- Section 10.2 contains all 68 error code keys: count occurrences of error code entries in the mapping
- `grep "INVALID_MASTER_PASSWORD" docs/67-admin-web-ui-spec.md` shows the admin-relevant mapping
- `grep "ROTATION_TOO_RECENT" docs/67-admin-web-ui-spec.md` confirms last error code is mapped
- `grep "EmptyState" docs/67-admin-web-ui-spec.md` confirms empty state component is defined
- CSS Variables section contains `--color-primary` and `--color-tier-instant`
- "후속 섹션 예고" section is removed
  </verify>
  <done>
Sections 9-10 in design doc 67 define: complete Preact component tree with hash router mapping (COMP-01), CSS Variables design tokens for colors/spacing/typography (COMP-02), 6 common component interfaces (Table, Form, Modal, Toast, CopyButton, EmptyState) with TypeScript props (COMP-02), form validation strategy and field rules (COMP-03), fetch wrapper specification (APIC-01), complete 68 error code mapping table (APIC-02), and 4 UX state patterns including loading/empty/error/shutdown (APIC-03). The design document 67 is now complete with all 10 sections.
  </done>
</task>

</tasks>

<verification>
After both tasks complete, verify the full design document:

1. Section count: `grep "^## " docs/67-admin-web-ui-spec.md` should show 10 numbered sections plus "관련 설계 문서"
2. Requirements coverage:
   - PAGE-01 (Dashboard): section 8.1 with 30s polling and stat widgets
   - PAGE-02 (Agents): section 8.2 with list/detail/create/edit/delete
   - PAGE-03 (Sessions): section 8.3 with agent dropdown, token copy, revoke
   - PAGE-04 (Policies): section 8.4 with tier visualization colors
   - PAGE-05 (Settings): section 8.5 with kill switch, rotate, shutdown
   - COMP-01: sections 8 (routing) + 9.1 (full component tree)
   - COMP-02: section 9.2 (CSS Variables) + 9.3 (component interfaces)
   - COMP-03: section 9.4 (validation strategy + field rules)
   - APIC-01: section 10.1 (fetch wrapper with typed helpers)
   - APIC-02: section 10.2 (68 error codes complete mapping)
   - APIC-03: section 10.3 (loading/empty/error/shutdown UX patterns)
3. Error code count: the mapping table in 10.2 must have exactly 68 entries matching packages/core/src/errors/error-codes.ts
4. No "후속 섹션 예고" section remains
5. "최종 업데이트" line reflects Phase 65 completion
</verification>

<success_criteria>
- docs/67-admin-web-ui-spec.md contains sections 1-10 (all complete)
- All 11 requirements (PAGE-01~05, COMP-01~03, APIC-01~03) are addressed in the design document
- 68 error codes are mapped to user-friendly English messages
- CSS Variables design tokens cover colors, spacing, typography, and tier visualization
- Component interfaces (Table, Form, Modal, Toast, CopyButton, EmptyState, Button, Badge) have TypeScript props defined
- Form validation rules mirror @waiaas/core schema constraints without importing them
- The document is sufficient for a developer to implement the Admin Web UI without design ambiguity
</success_criteria>

<output>
After completion, create `.planning/phases/65-pages-components-api-design/65-01-SUMMARY.md`
</output>
