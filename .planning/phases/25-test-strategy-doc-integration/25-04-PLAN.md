---
phase: 25-test-strategy-doc-integration
plan: 04
type: execute
wave: 2
depends_on: ["25-02"]
files_modified:
  - .planning/deliverables/37-rest-api-complete-spec.md
  - .planning/deliverables/38-sdk-mcp-interface.md
autonomous: true

must_haves:
  truths:
    - "37-rest-api에 discriminatedUnion 요청 스키마, /v1/wallet/assets, /v1/actions/ 엔드포인트가 추가되어 있다"
    - "37-rest-api에 v0.6 에러 코드 20개+가 추가되어 있고 엔드포인트 총수가 갱신되어 있다"
    - "38-sdk-mcp에 MCP Tool Action 변환, MCP_TOOL_MAX=16, SDK Action/Oracle 메서드가 추가되어 있다"
  artifacts:
    - path: ".planning/deliverables/37-rest-api-complete-spec.md"
      provides: "REST API 확장 - discriminatedUnion, /v1/wallet/assets, /v1/actions/, 에러 코드"
      contains: "/v1/actions"
    - path: ".planning/deliverables/38-sdk-mcp-interface.md"
      provides: "SDK/MCP 확장 - Action 변환, MCP_TOOL_MAX=16, Oracle 메서드"
      contains: "MCP_TOOL_MAX"
  key_links:
    - from: ".planning/deliverables/37-rest-api-complete-spec.md"
      to: ".planning/deliverables/27-chain-adapter-interface.md"
      via: "ContractCallRequest, ApproveRequest 타입 참조"
      pattern: "ContractCallRequest"
    - from: ".planning/deliverables/38-sdk-mcp-interface.md"
      to: "docs/62-action-provider-architecture.md"
      via: "ActionDefinition -> MCP Tool 변환 참조"
      pattern: "ActionDefinition"
    - from: ".planning/deliverables/37-rest-api-complete-spec.md"
      to: ".planning/deliverables/45-enum-unified-mapping.md"
      via: "에러 코드 참조"
      pattern: "ErrorCode"
---

<objective>
v0.6 확장의 인터페이스 계층 문서 2개(37-rest-api, 38-sdk-mcp)를 업데이트한다. Plan 25-02에서 업데이트된 SSoT(45-enum, 27-chain-adapter)를 기반으로 REST API 스펙과 SDK/MCP 인터페이스를 일관되게 v0.6에 맞춘다.

Purpose: REST API(37)는 에이전트/외부 클라이언트의 진입점이고, SDK/MCP(38)는 개발자 인터페이스이므로, v0.6에서 추가된 트랜잭션 타입과 Action Provider가 이 문서들에 정확히 반영되어야 한다.
Output: 2개 기존 문서의 v0.6 통합 업데이트
</objective>

<execution_context>
@/Users/minho.yoo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/minho.yoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# SSoT (Plan 25-02에서 업데이트된 상태)
@.planning/deliverables/45-enum-unified-mapping.md
@.planning/deliverables/27-chain-adapter-interface.md

# 수정 대상
@.planning/deliverables/37-rest-api-complete-spec.md
@.planning/deliverables/38-sdk-mcp-interface.md

# v0.6 소스 문서 (변경 항목 참조)
@docs/56-token-transfer-extension-spec.md
@docs/57-asset-query-fee-estimation-spec.md
@docs/58-contract-call-spec.md
@docs/59-approve-management-spec.md
@docs/60-batch-transaction-spec.md
@docs/61-price-oracle-spec.md
@docs/62-action-provider-architecture.md
@docs/63-swap-action-spec.md

# Plan 25-02 SUMMARY (SSoT 변경 사항 참조)
@.planning/phases/25-test-strategy-doc-integration/25-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: 37-rest-api REST API 스펙 v0.6 통합</name>
  <files>.planning/deliverables/37-rest-api-complete-spec.md</files>
  <action>
37-rest-api-complete-spec.md를 인라인 마킹 패턴으로 수정한다.

변경 항목 (~15개, 소스: 56 섹션 9.7, 57 섹션 9.3, 58 섹션 10.6, 59 섹션 10, 60 섹션 8, 61 섹션 9.5, 62 섹션 10.5, 63 섹션 10):

1. **트랜잭션 요청 스키마 확장:**
   - POST /v1/transactions 요청 바디를 discriminatedUnion으로 확장
   - type 필드 기반 분기: TRANSFER | TOKEN_TRANSFER | CONTRACT_CALL | APPROVE | BATCH
   - 각 타입별 Zod 스키마:
     - TRANSFER: 기존 (to, amount, chain)
     - TOKEN_TRANSFER: + token { mint, decimals? } (56)
     - CONTRACT_CALL: + contractAddress, calldata/programId+instructionData+accounts (58)
     - APPROVE: + token, spender, amount (59)
     - BATCH: + instructions[] (60)

2. **신규 엔드포인트:**
   - GET /v1/wallet/assets -- 에이전트 보유 자산 목록 (57 섹션 7)
     - 응답: { assets: AssetInfo[], totalUsdValue?: number }
     - 네이티브 토큰 첫 번째, 잔액 내림차순
   - GET /v1/actions -- Action Provider 목록 + Action 목록 (62 섹션 7)
   - GET /v1/actions/:providerName/:actionName -- Action 상세 + inputSchema (62 섹션 7)
   - POST /v1/actions/:providerName/:actionName/resolve -- Action resolve 실행 (62 섹션 7)
   - POST /v1/actions/:providerName/:actionName/execute -- resolve + 파이프라인 실행 (62 섹션 7)

3. **에러 코드 확장 (v0.6 추가 ~20개):**
   - 토큰 관련: TOKEN_NOT_FOUND, TOKEN_NOT_ALLOWED, INSUFFICIENT_TOKEN_BALANCE (56)
   - 컨트랙트 관련: CONTRACT_NOT_WHITELISTED, METHOD_NOT_WHITELISTED, CONTRACT_CALL_FAILED (58)
   - Approve 관련: APPROVE_LIMIT_EXCEEDED, SPENDER_NOT_APPROVED, UNLIMITED_APPROVE_BLOCKED (59)
   - 배치 관련: BATCH_NOT_SUPPORTED, BATCH_SIZE_EXCEEDED, BATCH_INSTRUCTION_INVALID (60)
   - 오라클 관련: PRICE_UNAVAILABLE, PRICE_STALE (61)
   - Action 관련: ACTION_PROVIDER_NOT_FOUND, ACTION_NOT_FOUND, ACTION_RESOLVE_FAILED, ACTION_VALIDATION_FAILED, ACTION_TIMEOUT, ACTION_CHAIN_MISMATCH, ACTION_PROVIDER_LOAD_FAILED (62)
   - 에러 코드 도메인별 그룹핑 (기존 7-domain -> 확장)

4. **엔드포인트 총수 갱신:**
   - 기존 31개 + /v1/wallet/assets(1) + /v1/actions/(4) = 36개로 갱신
   - 개요 섹션의 총 엔드포인트 수 업데이트

5. **응답 스키마 확장:**
   - GET /v1/transactions/:id 응답에 감사 필드 추가: contract_address, method_signature, spender_address, approved_amount (58)
   - 트랜잭션 목록 응답에 type 필드 추가

기존 구조 유지 + 인라인 마킹 패턴. 기존 섹션 번호를 변경하지 않는다.
  </action>
  <verify>
37-rest-api: grep "discriminatedUnion" 또는 "TOKEN_TRANSFER" -- 5-type 분기 확인
37-rest-api: grep "/v1/wallet/assets" -- 신규 엔드포인트 확인
37-rest-api: grep "/v1/actions" -- Action 엔드포인트 확인
37-rest-api: grep "ACTION_PROVIDER_NOT_FOUND" -- Action 에러 코드 확인
37-rest-api: grep "36" 또는 "36개" -- 엔드포인트 총수 갱신 확인
  </verify>
  <done>
37-rest-api에 discriminatedUnion 5-type 요청 스키마, /v1/wallet/assets + /v1/actions/ 5개 신규 엔드포인트, v0.6 에러 코드 20개+, 엔드포인트 총수 36개가 반영되어 있다.
  </done>
</task>

<task type="auto">
  <name>Task 2: 38-sdk-mcp SDK/MCP 인터페이스 v0.6 통합</name>
  <files>.planning/deliverables/38-sdk-mcp-interface.md</files>
  <action>
38-sdk-mcp-interface.md를 인라인 마킹 패턴으로 수정한다.

변경 항목 (~8개, 소스: 57 섹션 9.4, 58 섹션 10.7, 62 섹션 10.6, 63 섹션 10):

1. **MCP Tool Action 변환 섹션 추가 (62 섹션 7.3):**
   - ActionDefinition -> MCP Tool 자동 변환 메커니즘:
     - action.name -> tool.name (provider_name 접두어)
     - action.description -> tool.description
     - action.inputSchema (Zod) -> tool.inputSchema (JSON Schema)
   - mcpExpose 플래그: ActionDefinition에 mcpExpose: boolean 필드
   - 기존 6개 MCP Tool + Action에서 변환된 Tool = 최대 MCP_TOOL_MAX개

2. **MCP_TOOL_MAX=16 상한 (62 섹션 7.3):**
   - 기존 6개 MCP Tool (create_wallet, get_balance, send_transaction, get_transaction, list_transactions, get_session_info)
   - + Action Tool 최대 10개 = 16개 상한
   - LLM 컨텍스트 오버플로 방지 (62 섹션 7.3 결정)
   - 선착순/우선순위 로드 전략

3. **MCP Resource 확장:**
   - 기존 3개 + actions://list (Action Provider 목록) 추가 가능
   - actions://list는 선택적 (MCP Tool로 이미 노출)

4. **TS SDK 메서드 추가 (62 섹션 10.6):**
   - client.actions.list() -- Action Provider 및 Action 목록 조회
   - client.actions.getAction(provider, action) -- Action 상세 조회
   - client.actions.resolve(provider, action, params) -- Action resolve
   - client.actions.execute(provider, action, params) -- Action resolve + 파이프라인 실행
   - client.wallet.getAssets() -- 보유 자산 목록 (57)
   - client.oracle.getPrice(token) -- 가격 조회 (선택적, 61)

5. **Python SDK 메서드 추가:**
   - client.actions.list(), resolve(), execute() -- TS SDK와 동일 패턴
   - client.wallet.get_assets() -- snake_case 컨벤션

6. **SDK 트랜잭션 메서드 확장:**
   - client.transactions.create() 요청에 type 필드 추가 (discriminatedUnion)
   - 타입별 헬퍼 메서드 (선택적):
     - client.transactions.sendToken() -- TOKEN_TRANSFER 단축
     - client.transactions.contractCall() -- CONTRACT_CALL 단축
     - client.transactions.approve() -- APPROVE 단축
     - client.transactions.batch() -- BATCH 단축

7. **에러 타입 확장:**
   - SDK 에러 클래스에 v0.6 에러 코드 반영 (ACTION_*, TOKEN_*, CONTRACT_* 등)

기존 구조 유지 + 인라인 마킹 패턴. 기존 섹션 번호를 변경하지 않는다.
  </action>
  <verify>
38-sdk-mcp: grep "MCP_TOOL_MAX" -- 16개 상한 확인
38-sdk-mcp: grep "ActionDefinition" 또는 "mcpExpose" -- Action 변환 확인
38-sdk-mcp: grep "actions.list" 또는 "actions.resolve" -- SDK 메서드 확인
38-sdk-mcp: grep "getAssets" 또는 "get_assets" -- 자산 조회 SDK 확인
38-sdk-mcp: grep "sendToken\|contractCall" -- 단축 메서드 확인
  </verify>
  <done>
38-sdk-mcp에 MCP Tool Action 변환(ActionDefinition -> MCP Tool), MCP_TOOL_MAX=16, SDK actions/wallet/oracle 메서드, 트랜잭션 타입별 단축 메서드가 반영되어 있다.
  </done>
</task>

</tasks>

<verification>
1. 37-rest-api에 discriminatedUnion 요청 스키마, 5개 신규 엔드포인트, 20개+ 에러 코드가 반영되어 있다
2. 38-sdk-mcp에 MCP Tool Action 변환, MCP_TOOL_MAX=16, SDK 메서드 6개+가 반영되어 있다
3. 2개 문서 모두 기존 섹션 구조가 유지되고 인라인 마킹 패턴이 사용되었다
4. 37-rest-api의 에러 코드가 45-enum의 코드와 일치한다
</verification>

<success_criteria>
- INTEG-01 완전 충족: 8/8 문서에 v0.6 확장 반영 (25-02에서 3개, 25-03에서 3개, 25-04에서 2개)
- 37-rest-api 엔드포인트 총수가 36개로 갱신되어 있다
- 38-sdk-mcp의 MCP Tool 상한이 16개로 명시되어 있다
</success_criteria>

<output>
After completion, create `.planning/phases/25-test-strategy-doc-integration/25-04-SUMMARY.md`
</output>
