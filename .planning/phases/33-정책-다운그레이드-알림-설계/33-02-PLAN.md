---
phase: 33-ì •ì±…-ë‹¤ìš´ê·¸ë ˆì´ë“œ-ì•Œë¦¼-ì„¤ê³„
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/deliverables/35-notification-architecture.md
autonomous: true

must_haves:
  truths:
    - "TX_DOWNGRADED_DELAY ì´ë²¤íŠ¸ê°€ NotificationEventTypeì— ì¶”ê°€ë˜ì–´ ê¸°ì¡´ TX_DELAY_QUEUEDì™€ ë¶„ë¦¬ë˜ì–´ ìˆë‹¤"
    - "ë‹¤ìš´ê·¸ë ˆì´ë“œ ì•Œë¦¼ í…œí”Œë¦¿ì— Owner ë“±ë¡ CLI ì•ˆë‚´ ë©”ì‹œì§€(waiaas agent set-owner)ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤"
    - "Telegram/Discord/ntfy.sh 3ì±„ë„ì˜ ë‹¤ìš´ê·¸ë ˆì´ë“œ ì•Œë¦¼ í…œí”Œë¦¿ì´ ì±„ë„ë³„ ì œì•½ì— ë§ê²Œ ëª…ì„¸ë˜ì–´ ìˆë‹¤"
    - "Owner ìˆëŠ” ì—ì´ì „íŠ¸ì˜ APPROVAL ëŒ€ê¸° ì•Œë¦¼ì— [ìŠ¹ì¸]/[ê±°ë¶€] ë²„íŠ¼ì´ ì±„ë„ë³„ë¡œ ëª…ì„¸ë˜ì–´ ìˆë‹¤"
    - "Discord Webhookì€ Button ë¯¸ì§€ì›ì´ë¯€ë¡œ Embed footerì— ìŠ¹ì¸ URLì„ ì•ˆë‚´í•˜ëŠ” ë°©ì‹ì´ ëª…ì„¸ë˜ì–´ ìˆë‹¤"
  artifacts:
    - path: ".planning/deliverables/35-notification-architecture.md"
      provides: "TX_DOWNGRADED_DELAY ì´ë²¤íŠ¸, ë‹¤ìš´ê·¸ë ˆì´ë“œ ì•Œë¦¼ í…œí”Œë¦¿ 3ì±„ë„, APPROVAL [ìŠ¹ì¸]/[ê±°ë¶€] ë²„íŠ¼ 3ì±„ë„"
      contains: "TX_DOWNGRADED_DELAY"
  key_links:
    - from: "Stage 4 (downgraded === true)"
      to: "NotificationService.notify(TX_DOWNGRADED_DELAY)"
      via: "ì•Œë¦¼ ì´ë²¤íŠ¸ ë¶„ê¸°"
      pattern: "TX_DOWNGRADED_DELAY"
    - from: "Stage 4 (tier === APPROVAL, LOCKED)"
      to: "NotificationService.notify(TX_APPROVAL_REQUEST)"
      via: "APPROVAL ìŠ¹ì¸ ìš”ì²­ ì•Œë¦¼"
      pattern: "TX_APPROVAL_REQUEST.*ìŠ¹ì¸.*ê±°ë¶€"
    - from: "Telegram InlineKeyboardMarkup"
      to: "ìŠ¹ì¸ URL (127.0.0.1:3100)"
      via: "url ê¸°ë°˜ ë²„íŠ¼"
      pattern: "inline_keyboard.*url.*approve"
---

<objective>
TX_DOWNGRADED_DELAY ì•Œë¦¼ ì´ë²¤íŠ¸ë¥¼ ì¶”ê°€í•˜ê³ , ì±„ë„ë³„(Telegram/Discord/ntfy.sh) ë‹¤ìš´ê·¸ë ˆì´ë“œ ì•Œë¦¼ í…œí”Œë¦¿ì— Owner ë“±ë¡ CLI ì•ˆë‚´ë¥¼ í¬í•¨ì‹œí‚¤ë©°, APPROVAL ëŒ€ê¸° ì•Œë¦¼ì˜ [ìŠ¹ì¸]/[ê±°ë¶€] ë²„íŠ¼ì„ ì±„ë„ë³„ ì œì•½ì— ë§ê²Œ ëª…ì„¸í•œë‹¤.

Purpose: ë‹¤ìš´ê·¸ë ˆì´ë“œëœ ê±°ë˜ì˜ ì•Œë¦¼ì´ ê¸°ì¡´ DELAY ì•Œë¦¼ê³¼ ëª…í™•íˆ êµ¬ë¶„ë˜ì–´ Owner ë“±ë¡ì„ ìì—°ìŠ¤ëŸ½ê²Œ ìœ ë„í•˜ê³ , Ownerê°€ ìˆëŠ” ì—ì´ì „íŠ¸ì˜ APPROVAL ê±°ë˜ì— ëŒ€í•´ ì‹ ì†í•œ ìŠ¹ì¸/ê±°ë¶€ê°€ ê°€ëŠ¥í•œ ì•Œë¦¼ UXë¥¼ í™•ì •í•œë‹¤.
Output: 35-notification-architecture.mdì— TX_DOWNGRADED_DELAY ì´ë²¤íŠ¸ + 3ì±„ë„ ë‹¤ìš´ê·¸ë ˆì´ë“œ í…œí”Œë¦¿ + 3ì±„ë„ APPROVAL ìŠ¹ì¸/ê±°ë¶€ ë²„íŠ¼ì´ ì¶”ê°€ëœë‹¤.
</objective>

<execution_context>
@/Users/minho.yoo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/minho.yoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/deliverables/35-notification-architecture.md
@.planning/deliverables/33-time-lock-approval-mechanism.md
@.planning/phases/33-ì •ì±…-ë‹¤ìš´ê·¸ë ˆì´ë“œ-ì•Œë¦¼-ì„¤ê³„/33-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: TX_DOWNGRADED_DELAY ì´ë²¤íŠ¸ ì¶”ê°€ + ì±„ë„ë³„ ë‹¤ìš´ê·¸ë ˆì´ë“œ ì•Œë¦¼ í…œí”Œë¦¿ ì„¤ê³„</name>
  <files>.planning/deliverables/35-notification-architecture.md</files>
  <action>
35-notification-architecture.mdì— ë‹¤ìŒ ë‚´ìš©ì„ ì¶”ê°€í•œë‹¤. ê¸°ì¡´ ì„¹ì…˜ êµ¬ì¡°ë¥¼ íŒŒì•…í•˜ì—¬ ì ì ˆí•œ ìœ„ì¹˜ì— ì‚½ì…í•œë‹¤.

**1. NotificationEventTypeì— TX_DOWNGRADED_DELAY ì¶”ê°€ (15 -> 16ê°œ)**

ê¸°ì¡´ NotificationEventType enum/ëª©ë¡ì— TX_DOWNGRADED_DELAYë¥¼ ì¶”ê°€:
```typescript
// ê¸°ì¡´ 15ê°œ + 1ê°œ ì¶”ê°€
type NotificationEventType =
  | 'TX_NOTIFY'
  | 'TX_DELAY_QUEUED'
  | 'TX_DELAY_EXECUTED'
  | 'TX_APPROVAL_REQUEST'
  | 'TX_APPROVAL_EXPIRED'
  | 'TX_CONFIRMED'
  | 'TX_FAILED'
  | 'TX_DOWNGRADED_DELAY'      // [v0.8] APPROVAL -> DELAY ë‹¤ìš´ê·¸ë ˆì´ë“œ
  | 'KILL_SWITCH_ACTIVATED'
  | 'KILL_SWITCH_RECOVERED'
  | 'AUTO_STOP_TRIGGERED'
  | 'SESSION_CREATED'
  | 'SESSION_REVOKED'
  | 'SESSION_RENEWED'
  | 'SESSION_RENEWAL_REJECTED'
  | 'DAILY_SUMMARY'
```

**2. ì´ë²¤íŠ¸-ì‹¬ê°ë„ ë§¤í•‘ í…Œì´ë¸”ì— TX_DOWNGRADED_DELAY ì¶”ê°€**

ê¸°ì¡´ ì´ë²¤íŠ¸ë³„ ì‹¬ê°ë„ ë§¤í•‘ í…Œì´ë¸”ì— í–‰ ì¶”ê°€:

| ì´ë²¤íŠ¸ | ì‹¬ê°ë„ | ì„¤ëª… |
|--------|--------|------|
| TX_DOWNGRADED_DELAY | INFO | APPROVAL -> DELAY ë‹¤ìš´ê·¸ë ˆì´ë“œë¨ (Owner ë¯¸ë“±ë¡/ë¯¸ê²€ì¦) |

**3. ì•Œë¦¼ í˜¸ì¶œ í¬ì¸íŠ¸ í…Œì´ë¸”ì— TX_DOWNGRADED_DELAY ì¶”ê°€**

ê¸°ì¡´ ì•Œë¦¼ í˜¸ì¶œ í¬ì¸íŠ¸ í…Œì´ë¸”ì— í–‰ ì¶”ê°€:

| ì´ë²¤íŠ¸ | í˜¸ì¶œ ìœ„ì¹˜ | ì¡°ê±´ |
|--------|-----------|------|
| TX_DOWNGRADED_DELAY | Stage 4 QUEUED ì „ì´ í›„ | decision.downgraded === true |

ê¸°ì¡´ TX_DELAY_QUEUED í–‰ì„ ìˆ˜ì •í•˜ì—¬ ì¡°ê±´ ëª…ì‹œ:

| ì´ë²¤íŠ¸ | í˜¸ì¶œ ìœ„ì¹˜ | ì¡°ê±´ |
|--------|-----------|------|
| TX_DELAY_QUEUED | Stage 4 QUEUED ì „ì´ í›„ | decision.tier === 'DELAY' && !decision.downgraded |

**4. TX_DOWNGRADED_DELAY vs TX_DELAY_QUEUED ì°¨ì´ì  ëª…ì‹œ**

ì‹ ê·œ ì„¹ì…˜ ë˜ëŠ” ê¸°ì¡´ í…œí”Œë¦¿ ì„¹ì…˜ ë‚´ì— ì°¨ì´ì  í…Œì´ë¸” ì¶”ê°€:

| í•­ëª© | TX_DELAY_QUEUED | TX_DOWNGRADED_DELAY |
|------|-----------------|---------------------|
| ë°œìƒ ì¡°ê±´ | ì •ìƒ DELAY í‹°ì–´ í‰ê°€ | APPROVAL -> DELAY ë‹¤ìš´ê·¸ë ˆì´ë“œ |
| ë©”ì‹œì§€ í†¤ | ì •ë³´ ì œê³µ (ëŒ€ê¸° ì¤‘) | ì•ˆë‚´ + í–‰ë™ ìœ ë„ (Owner ë“±ë¡) |
| Owner ë“±ë¡ ì•ˆë‚´ | ë¯¸í¬í•¨ | í¬í•¨ (`waiaas agent set-owner` ëª…ë ¹ì–´) |
| ì›ë˜ í‹°ì–´ í‘œì‹œ | ë¯¸í¬í•¨ | í¬í•¨ (APPROVAL -> DELAY ì „í™˜ ì‚¬ìœ ) |

**5. ì±„ë„ë³„ TX_DOWNGRADED_DELAY ì•Œë¦¼ í…œí”Œë¦¿**

**Telegram (MarkdownV2):**
ê¸°ì¡´ ì•Œë¦¼ í…œí”Œë¦¿ íŒ¨í„´(35-notification 3.3, 11)ì„ ë”°ë¼ MarkdownV2 í¬ë§·ìœ¼ë¡œ ì‘ì„±:
```
â„¹ï¸ *ëŒ€ì•¡ ê±°ë˜ ëŒ€ê¸° ì¤‘ \(ë‹¤ìš´ê·¸ë ˆì´ë“œ\)*

Agent "{agentName}"ì˜ {amount} {symbol} \(â‰ˆ ${usdAmount}\) ì „ì†¡ì´
DELAY íì— ëŒ€ê¸°í•©ë‹ˆë‹¤\.
ìˆ˜ì‹ : {shortenedAddress}
ì‹¤í–‰ ì˜ˆì •: {delaySeconds/60}ë¶„ í›„

ì›ë˜ í‹°ì–´: APPROVAL â†’ DELAYë¡œ ìë™ ì „í™˜
\(Owner ë¯¸ë“±ë¡ ì—ì´ì „íŠ¸\)

ğŸ’¡ *Owner ì§€ê°‘ì„ ë“±ë¡í•˜ë©´ ëŒ€ì•¡ ê±°ë˜ì—*
   *ìŠ¹ì¸ ì •ì±…ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤\.*
   `waiaas agent set\-owner {agentName} <address>`

TX: {shortTxId} \| Agent: {shortAgentId}

_{timestamp}_
```

**Discord (Embed JSON):**
```json
{
  "embeds": [{
    "title": "â„¹ï¸ ëŒ€ì•¡ ê±°ë˜ ëŒ€ê¸° ì¤‘ (ë‹¤ìš´ê·¸ë ˆì´ë“œ)",
    "color": 3447003,
    "description": "Agent \"{agentName}\"ì˜ {amount} {symbol} (â‰ˆ ${usdAmount}) ì „ì†¡ì´\nDELAY íì— ëŒ€ê¸°í•©ë‹ˆë‹¤.",
    "fields": [
      { "name": "ìˆ˜ì‹ ", "value": "{shortenedAddress}", "inline": true },
      { "name": "ì‹¤í–‰ ì˜ˆì •", "value": "{delaySeconds/60}ë¶„ í›„", "inline": true },
      { "name": "ë‹¤ìš´ê·¸ë ˆì´ë“œ", "value": "APPROVAL â†’ DELAY (Owner ë¯¸ë“±ë¡)", "inline": false },
      { "name": "ğŸ’¡ Owner ë“±ë¡ ì•ˆë‚´", "value": "`waiaas agent set-owner {agentName} <address>`\nOwner ì§€ê°‘ì„ ë“±ë¡í•˜ë©´ ëŒ€ì•¡ ê±°ë˜ì— ìŠ¹ì¸ ì •ì±…ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.", "inline": false }
    ],
    "footer": { "text": "TX: {shortTxId} | Agent: {shortAgentId}" },
    "timestamp": "{iso8601}"
  }]
}
```

**ntfy.sh:**
```
Title: ëŒ€ì•¡ ê±°ë˜ ëŒ€ê¸° ì¤‘ (APPROVAL â†’ DELAY ë‹¤ìš´ê·¸ë ˆì´ë“œ)
Priority: default (3)
Tags: information_source, arrow_down
Actions: view, ëŒ€ì‹œë³´ë“œ, http://127.0.0.1:3100/dashboard
Body:
Agent "{agentName}" {amount} {symbol} (â‰ˆ ${usdAmount})
ìˆ˜ì‹ : {shortenedAddress}
ì‹¤í–‰: {delaySeconds/60}ë¶„ í›„
ì›ë˜ í‹°ì–´: APPROVAL â†’ DELAY (Owner ë¯¸ë“±ë¡)

Owner ë“±ë¡: waiaas agent set-owner {agentName} <address>
TX: {shortTxId} | Agent: {shortAgentId}
```
  </action>
  <verify>
35-notification-architecture.mdì—ì„œ ë‹¤ìŒì„ í™•ì¸:
1. "TX_DOWNGRADED_DELAY" ë¬¸ìì—´ì´ NotificationEventType ëª©ë¡ì— í¬í•¨ë˜ì–´ ìˆë‹¤
2. ì´ë²¤íŠ¸-ì‹¬ê°ë„ ë§¤í•‘ì— TX_DOWNGRADED_DELAY = INFOê°€ ìˆë‹¤
3. ì•Œë¦¼ í˜¸ì¶œ í¬ì¸íŠ¸ì— TX_DOWNGRADED_DELAYì˜ ì¡°ê±´(decision.downgraded === true)ì´ ìˆë‹¤
4. Telegram í…œí”Œë¦¿ì— "waiaas agent set-owner"ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤
5. Discord í…œí”Œë¦¿ì— "APPROVAL.*DELAY" íŒ¨í„´ê³¼ Owner ë“±ë¡ ì•ˆë‚´ê°€ ìˆë‹¤
6. ntfy.sh í…œí”Œë¦¿ì— "waiaas agent set-owner"ê°€ í¬í•¨ë˜ì–´ ìˆë‹¤
7. TX_DELAY_QUEUED vs TX_DOWNGRADED_DELAY ì°¨ì´ì ì´ ëª…ì‹œë˜ì–´ ìˆë‹¤
  </verify>
  <done>
TX_DOWNGRADED_DELAY ì´ë²¤íŠ¸ê°€ 3ê³³(enum, ì‹¬ê°ë„ ë§¤í•‘, í˜¸ì¶œ í¬ì¸íŠ¸)ì— ì¼ê´€ë˜ê²Œ ì¶”ê°€ë˜ì–´ ìˆê³ , 3ì±„ë„(Telegram/Discord/ntfy.sh) ë‹¤ìš´ê·¸ë ˆì´ë“œ ì•Œë¦¼ í…œí”Œë¦¿ì— Owner ë“±ë¡ CLI ì•ˆë‚´ê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë©°, TX_DELAY_QUEUEDì™€ì˜ ì°¨ì´ì ì´ ëª…í™•í•˜ê²Œ ê¸°ìˆ ë˜ì–´ ìˆë‹¤.
  </done>
</task>

<task type="auto">
  <name>Task 2: APPROVAL ëŒ€ê¸° ì•Œë¦¼ [ìŠ¹ì¸]/[ê±°ë¶€] ë²„íŠ¼ ì±„ë„ë³„ ëª…ì„¸</name>
  <files>.planning/deliverables/35-notification-architecture.md</files>
  <action>
35-notification-architecture.mdì— ë‹¤ìŒ ë‚´ìš©ì„ ì¶”ê°€í•œë‹¤.

**1. TX_APPROVAL_REQUEST ì•Œë¦¼ v0.8 í™•ì¥ -- [ìŠ¹ì¸]/[ê±°ë¶€] ë²„íŠ¼ ëª…ì„¸**

ê¸°ì¡´ TX_APPROVAL_REQUEST ì•Œë¦¼ í…œí”Œë¦¿ ê·¼ì²˜ì— v0.8 í™•ì¥ìœ¼ë¡œ ì±„ë„ë³„ ìŠ¹ì¸/ê±°ë¶€ ë²„íŠ¼ì„ ì¶”ê°€í•œë‹¤.

ì „ì œ ì¡°ê±´: TX_APPROVAL_REQUESTëŠ” OwnerState === LOCKEDì¸ ì—ì´ì „íŠ¸ì—ì„œë§Œ ë°œìƒí•œë‹¤ (Step 9.5ì—ì„œ NONE/GRACEëŠ” ë‹¤ìš´ê·¸ë ˆì´ë“œë¨).

ìŠ¹ì¸/ê±°ë¶€ URL íŒ¨í„´ (ê¸°ì¡´ 35-notification 12.3 ì°¸ì¡°):
```
ìŠ¹ì¸: http://127.0.0.1:3100/v1/owner/approvals/{approvalId}/approve?nonce={nonce}
ê±°ë¶€: http://127.0.0.1:3100/v1/owner/approvals/{approvalId}/reject?nonce={nonce}
```

ì£¼ì˜: ì´ URLì€ ìŠ¹ì¸ ëŒ€ì‹œë³´ë“œ í˜ì´ì§€(Tauri/ë¸Œë¼ìš°ì €)ë¡œ ì´ë™í•˜ëŠ” ë§í¬ì´ë‹¤. ë²„íŠ¼ í´ë¦­ë§Œìœ¼ë¡œ ìŠ¹ì¸ì´ ì™„ë£Œë˜ì§€ ì•ŠëŠ”ë‹¤ -- ownerAuth(SIWS/SIWE ì„œëª…)ê°€ í•„ìš”í•˜ë¯€ë¡œ ë³„ë„ ì¸ì¦ ê³¼ì •ì´ í•„ìˆ˜ì´ë‹¤.

**Telegram (InlineKeyboardMarkup):**

```
âš ï¸ *ê±°ë˜ ìŠ¹ì¸ ìš”ì²­*

Agent "{agentName}"ì´ {amount} {symbol} \(â‰ˆ ${usdAmount}\) ì „ì†¡ì„ ìš”ì²­í–ˆìŠµë‹ˆë‹¤\.
ìˆ˜ì‹ : {shortenedAddress}
íƒ€ì„ì•„ì›ƒ: {approvalTimeoutSeconds/60}ë¶„

TX: {shortTxId} \| Agent: {shortAgentId}

_{timestamp}_
```

InlineKeyboardMarkup (url ê¸°ë°˜ -- callback ì•„ë‹˜):
```json
{
  "reply_markup": {
    "inline_keyboard": [[
      { "text": "âœ… ìŠ¹ì¸", "url": "http://127.0.0.1:3100/v1/owner/approvals/{approvalId}/approve?nonce={nonce}" },
      { "text": "âŒ ê±°ë¶€", "url": "http://127.0.0.1:3100/v1/owner/approvals/{approvalId}/reject?nonce={nonce}" }
    ]]
  }
}
```

ì„¤ê³„ ê²°ì •:
- `url` ê¸°ë°˜ ë²„íŠ¼ ì‚¬ìš© (callback_data ì•„ë‹˜): ìŠ¹ì¸ ì‹œ ownerAuth(SIWS/SIWE ì„œëª…)ê°€ í•„ìš”í•˜ë¯€ë¡œ Telegram callbackë§Œìœ¼ë¡œëŠ” ìŠ¹ì¸ ë¶ˆê°€. ë¸Œë¼ìš°ì €/Tauri ìŠ¹ì¸ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™
- ë²„íŠ¼ í´ë¦­ -> ìŠ¹ì¸ ëŒ€ì‹œë³´ë“œ ì—´ë¦¼ -> Ownerê°€ SIWS/SIWE ì„œëª…ìœ¼ë¡œ ì¸ì¦ -> ìŠ¹ì¸ ì™„ë£Œ

**Discord (Embed + footer URL):**

Discord Webhookì€ Interactive Components(Button)ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤. Discord Bot Tokenì´ ìˆì–´ì•¼ ë²„íŠ¼ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. í˜„ì¬ ì„¤ê³„ëŠ” Webhook ì „ìš©ì´ë¯€ë¡œ Embed footerì— ìŠ¹ì¸ URLì„ í…ìŠ¤íŠ¸ë¡œ ì•ˆë‚´í•œë‹¤.

```json
{
  "embeds": [{
    "title": "âš ï¸ ê±°ë˜ ìŠ¹ì¸ ìš”ì²­",
    "color": 16776960,
    "description": "Agent \"{agentName}\"ì´ {amount} {symbol} (â‰ˆ ${usdAmount}) ì „ì†¡ì„ ìš”ì²­í–ˆìŠµë‹ˆë‹¤.",
    "fields": [
      { "name": "ìˆ˜ì‹ ", "value": "{shortenedAddress}", "inline": true },
      { "name": "íƒ€ì„ì•„ì›ƒ", "value": "{approvalTimeoutSeconds/60}ë¶„", "inline": true },
      { "name": "ğŸ“‹ ìŠ¹ì¸/ê±°ë¶€", "value": "[âœ… ìŠ¹ì¸]({approveUrl}) | [âŒ ê±°ë¶€]({rejectUrl})\nâš ï¸ ë§í¬ í´ë¦­ í›„ Owner ì„œëª…ì´ í•„ìš”í•©ë‹ˆë‹¤.", "inline": false }
    ],
    "footer": { "text": "TX: {shortTxId} | Agent: {shortAgentId}" },
    "timestamp": "{iso8601}"
  }]
}
```

ì„¤ê³„ ê²°ì •:
- Embed descriptionì˜ markdown ë§í¬ë¡œ ìŠ¹ì¸/ê±°ë¶€ URL ì•ˆë‚´
- footerì— "ë§í¬ í´ë¦­ í›„ Owner ì„œëª… í•„ìš”" ì£¼ì˜ì‚¬í•­ í‘œê¸°
- Discord Bot ì „í™˜ ì‹œ Button Componentë¡œ ì—…ê·¸ë ˆì´ë“œ ê°€ëŠ¥ (í–¥í›„ í™•ì¥)

**ntfy.sh (Actions í—¤ë”):**

```
Title: ê±°ë˜ ìŠ¹ì¸ ìš”ì²­ - {amount} {symbol}
Priority: high (4)
Tags: warning, money_with_wings
Actions: view, âœ… ìŠ¹ì¸ ëŒ€ì‹œë³´ë“œ, {approveUrl}; view, âŒ ê±°ë¶€, {rejectUrl}
Body:
Agent "{agentName}" {amount} {symbol} (â‰ˆ ${usdAmount})
ìˆ˜ì‹ : {shortenedAddress}
íƒ€ì„ì•„ì›ƒ: {approvalTimeoutSeconds/60}ë¶„
âš ï¸ ìŠ¹ì¸/ê±°ë¶€ ë²„íŠ¼ í´ë¦­ í›„ Owner ì„œëª…ì´ í•„ìš”í•©ë‹ˆë‹¤.
TX: {shortTxId} | Agent: {shortAgentId}
```

ì„¤ê³„ ê²°ì •:
- ntfy.sh ActionsëŠ” `view` íƒ€ì…ìœ¼ë¡œ ë¸Œë¼ìš°ì €ì—ì„œ URLì„ ì—´ë„ë¡ ì„¤ì •
- `http` íƒ€ì…(ì§ì ‘ API í˜¸ì¶œ)ì€ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ: ownerAuth ì„œëª… ì—†ì´ HTTP í˜¸ì¶œë§Œìœ¼ë¡œ ìŠ¹ì¸ ë¶ˆê°€
- Priority: high (4)ë¡œ ì„¤ì •í•˜ì—¬ ì¦‰ê° ì£¼ì˜ í™˜ê¸°

**2. TX_APPROVAL_REQUEST í˜¸ì¶œ í¬ì¸íŠ¸ v0.8 ê°±ì‹ **

ê¸°ì¡´ ì•Œë¦¼ í˜¸ì¶œ í¬ì¸íŠ¸ í…Œì´ë¸”ì—ì„œ TX_APPROVAL_REQUESTì˜ ì¡°ê±´ì„ v0.8ì— ë§ê²Œ ê°±ì‹ :

| ì´ë²¤íŠ¸ | í˜¸ì¶œ ìœ„ì¹˜ | ì¡°ê±´ |
|--------|-----------|------|
| TX_APPROVAL_REQUEST | Stage 4 APPROVAL íì‰ í›„ | decision.tier === 'APPROVAL' && !decision.downgraded (= OwnerState LOCKEDë§Œ) |

v0.8ì—ì„œ TX_APPROVAL_REQUESTëŠ” OwnerState === LOCKEDì¸ ì—ì´ì „íŠ¸ì—ì„œë§Œ ë°œìƒí•œë‹¤:
- NONE: APPROVALì´ DELAYë¡œ ë‹¤ìš´ê·¸ë ˆì´ë“œë¨ -> TX_DOWNGRADED_DELAY
- GRACE: APPROVALì´ DELAYë¡œ ë‹¤ìš´ê·¸ë ˆì´ë“œë¨ -> TX_DOWNGRADED_DELAY
- LOCKED: APPROVAL ì •ìƒ ì²˜ë¦¬ -> TX_APPROVAL_REQUEST

**3. ìŠ¹ì¸/ê±°ë¶€ URL ë³´ì•ˆ ê³ ë ¤ì‚¬í•­**

ì‹ ê·œ ì„¹ì…˜ ë˜ëŠ” ê¸°ì¡´ ë³´ì•ˆ ì„¹ì…˜ì— ì¶”ê°€:
- nonceëŠ” 1íšŒìš© í† í°ìœ¼ë¡œ URL ì¬ì‚¬ìš© ë°©ì§€ (ê¸°ì¡´ ì„¤ê³„ ìœ ì§€)
- URLì€ localhost(127.0.0.1:3100)ë¡œ ì™¸ë¶€ ë…¸ì¶œ ì—†ìŒ
- ìŠ¹ì¸ ëŒ€ì‹œë³´ë“œ ì ‘ê·¼ ì‹œ ownerAuth(SIWS/SIWE) ì„œëª… í•„ìˆ˜ -- ë²„íŠ¼ í´ë¦­ë§Œìœ¼ë¡œ ìŠ¹ì¸ ë¶ˆê°€
- Telegram url ê¸°ë°˜ InlineKeyboardëŠ” callback_dataì™€ ë‹¬ë¦¬ ì„œë²„ ì‚¬ì´ë“œ ê²€ì¦ì´ ë¶ˆê°€í•˜ë¯€ë¡œ, ëŒ€ì‹œë³´ë“œì—ì„œ ownerAuthë¡œ ì¸ì¦
  </action>
  <verify>
35-notification-architecture.mdì—ì„œ ë‹¤ìŒì„ í™•ì¸:
1. Telegram InlineKeyboardMarkupì— "ìŠ¹ì¸" + "ê±°ë¶€" url ë²„íŠ¼ì´ ëª…ì„¸ë˜ì–´ ìˆë‹¤
2. Discordì— Embed markdown ë§í¬ë¡œ ìŠ¹ì¸/ê±°ë¶€ URLì´ ì•ˆë‚´ë˜ì–´ ìˆë‹¤
3. "Webhook.*Button.*ë¯¸ì§€ì›" ë˜ëŠ” ìœ ì‚¬í•œ Discord ì œì•½ ì„¤ëª…ì´ ìˆë‹¤
4. ntfy.shì— Actions view íƒ€ì…ìœ¼ë¡œ ìŠ¹ì¸/ê±°ë¶€ê°€ ëª…ì„¸ë˜ì–´ ìˆë‹¤
5. TX_APPROVAL_REQUEST í˜¸ì¶œ ì¡°ê±´ì— "!decision.downgraded" ë˜ëŠ” "LOCKEDë§Œ" ì´ ëª…ì„¸ë˜ì–´ ìˆë‹¤
6. "ownerAuth.*ì„œëª….*í•„ìˆ˜" ë˜ëŠ” ìœ ì‚¬í•œ ë³´ì•ˆ ì£¼ì˜ì‚¬í•­ì´ ìˆë‹¤
  </verify>
  <done>
3ì±„ë„(Telegram/Discord/ntfy.sh)ì˜ APPROVAL ëŒ€ê¸° ì•Œë¦¼ì— [ìŠ¹ì¸]/[ê±°ë¶€] ë²„íŠ¼ì´ ì±„ë„ë³„ ì œì•½ì— ë§ê²Œ ëª…ì„¸ë˜ì–´ ìˆê³ , Discord Webhook Button ë¯¸ì§€ì›ì´ ëª…ì‹œë˜ë©°, ownerAuth ì„œëª… í•„ìˆ˜ ë³´ì•ˆ ì£¼ì˜ì‚¬í•­ì´ ê¸°ìˆ ë˜ì–´ ìˆë‹¤.
  </done>
</task>

</tasks>

<verification>
Phase 33 Plan 02 ì „ì²´ ê²€ì¦:
1. `grep -c "TX_DOWNGRADED_DELAY" .planning/deliverables/35-notification-architecture.md` -- 5íšŒ ì´ìƒ ë“±ì¥ (enum, ë§¤í•‘, í˜¸ì¶œí¬ì¸íŠ¸, ì°¨ì´ì , í…œí”Œë¦¿)
2. `grep "waiaas agent set-owner" .planning/deliverables/35-notification-architecture.md` -- Owner ë“±ë¡ ì•ˆë‚´ê°€ í…œí”Œë¦¿ì— í¬í•¨
3. `grep "inline_keyboard" .planning/deliverables/35-notification-architecture.md` -- Telegram ë²„íŠ¼ì´ ëª…ì„¸ë¨
4. `grep "Webhook.*Button" .planning/deliverables/35-notification-architecture.md` -- Discord Webhook ì œì•½ì´ ëª…ì‹œë¨
5. `grep "Actions.*view" .planning/deliverables/35-notification-architecture.md` -- ntfy.sh Actionsê°€ ëª…ì„¸ë¨
6. `grep "ownerAuth" .planning/deliverables/35-notification-architecture.md` -- ì„œëª… í•„ìˆ˜ ì£¼ì˜ì‚¬í•­ì´ ëª…ì„¸ë¨
</verification>

<success_criteria>
- NOTIF-01 ì¶©ì¡±: APPROVAL->DELAY ë‹¤ìš´ê·¸ë ˆì´ë“œ ì•Œë¦¼ì— Owner ë“±ë¡ ì•ˆë‚´ ë©”ì‹œì§€ê°€ í¬í•¨ë¨
- NOTIF-02 ì¶©ì¡±: Owner ìˆëŠ” ì—ì´ì „íŠ¸ì˜ APPROVAL ëŒ€ê¸° ì•Œë¦¼ì— [ìŠ¹ì¸]/[ê±°ë¶€] ë²„íŠ¼ì´ í‘œì‹œë¨
- TX_DOWNGRADED_DELAY ì´ë²¤íŠ¸ê°€ enum, ì‹¬ê°ë„ ë§¤í•‘, í˜¸ì¶œ í¬ì¸íŠ¸ 3ê³³ì— ì¼ê´€ë˜ê²Œ ì¶”ê°€ë¨
- 3ì±„ë„(Telegram/Discord/ntfy.sh) ë‹¤ìš´ê·¸ë ˆì´ë“œ í…œí”Œë¦¿ì´ ê° ì±„ë„ ì œì•½ì— ë§ê²Œ ì‘ì„±ë¨
- 3ì±„ë„(Telegram/Discord/ntfy.sh) APPROVAL ìŠ¹ì¸/ê±°ë¶€ ë²„íŠ¼ì´ ê° ì±„ë„ ì œì•½ì— ë§ê²Œ ëª…ì„¸ë¨
- Discord Webhook Button ë¯¸ì§€ì›ì´ ëª…ì‹œì ìœ¼ë¡œ ê¸°ìˆ ë˜ì–´ ì„¤ê³„ì í˜¼ë™ ë°©ì§€
</success_criteria>

<output>
After completion, create `.planning/phases/33-ì •ì±…-ë‹¤ìš´ê·¸ë ˆì´ë“œ-ì•Œë¦¼-ì„¤ê³„/33-02-SUMMARY.md`
</output>
