---
phase: 68-dashboard-agents-sessions
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/admin/src/pages/dashboard.tsx
  - packages/admin/src/styles/global.css
autonomous: true

must_haves:
  truths:
    - "Dashboard displays daemon version, uptime, agent count, active session count, and kill switch state in stat cards"
    - "Dashboard data refreshes automatically every 30 seconds"
    - "Dashboard shows loading skeleton while data is being fetched"
    - "Dashboard shows error banner with Retry button when API call fails"
  artifacts:
    - path: "packages/admin/src/pages/dashboard.tsx"
      provides: "Dashboard page with stat cards and 30s polling"
      min_lines: 80
    - path: "packages/admin/src/styles/global.css"
      provides: "CSS for stat-card grid, skeleton loading, error banner"
      contains: ".stat-card"
  key_links:
    - from: "packages/admin/src/pages/dashboard.tsx"
      to: "/v1/admin/status"
      via: "apiGet with 30s setInterval polling"
      pattern: "apiGet.*ADMIN_STATUS"
---

<objective>
Implement the Dashboard page replacing the placeholder with a real stat card grid that fetches daemon status from GET /v1/admin/status and displays Version, Uptime, Agents, Active Sessions, and Kill Switch state. Data auto-refreshes every 30 seconds with loading and error states.

Purpose: First page users see after login -- immediate visibility into daemon health and key metrics.
Output: Working Dashboard page with live data, 30s polling, loading skeleton, and error recovery.
</objective>

<execution_context>
@/Users/minho.yoo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/minho.yoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/67-auth-api-client-components/67-01-SUMMARY.md
@.planning/phases/67-auth-api-client-components/67-02-SUMMARY.md
@packages/admin/src/api/client.ts
@packages/admin/src/api/endpoints.ts
@packages/admin/src/utils/format.ts
@packages/admin/src/components/form.tsx
@packages/admin/src/styles/global.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement Dashboard page with stat cards and 30s polling</name>
  <files>
    packages/admin/src/pages/dashboard.tsx
    packages/admin/src/styles/global.css
  </files>
  <action>
Replace the placeholder Dashboard page with a full implementation.

**Dashboard page (packages/admin/src/pages/dashboard.tsx):**

1. Import `useSignal` from `@preact/signals`, `useEffect` from `preact/hooks`, `apiGet` + `ApiError` from `../api/client`, `API` from `../api/endpoints`, `formatUptime` from `../utils/format`, `Badge` from `../components/form`, `showToast` from `../components/toast`.

2. Define the `AdminStatus` interface matching the daemon response:
```typescript
interface AdminStatus {
  status: string;
  version: string;
  uptime: number;
  agentCount: number;
  activeSessionCount: number;
  killSwitchState: string;
  adminTimeout: number;
  timestamp: number;
}
```

3. Use page-local signals (NOT global state). Use `useSignal` for:
   - `data: AdminStatus | null` (initially null)
   - `loading: boolean` (initially true)
   - `error: string | null` (initially null)

4. Create a `fetchStatus` async function that:
   - Sets loading.value = true, error.value = null
   - Calls `apiGet<AdminStatus>(API.ADMIN_STATUS)`
   - On success: sets data.value = result, loading.value = false
   - On error: if ApiError, uses `getErrorMessage(err.code)` from `../utils/error-messages`; otherwise generic message. Sets error.value = message, loading.value = false.

5. In `useEffect` (empty deps []):
   - Call `fetchStatus()` immediately
   - Set up `const interval = setInterval(fetchStatus, 30_000)`
   - Return cleanup: `clearInterval(interval)`

6. Render structure:
```
<div class="page">
  {error.value && (
    <div class="dashboard-error">
      <span>{error.value}</span>
      <Button variant="secondary" size="sm" onClick={fetchStatus}>Retry</Button>
    </div>
  )}
  <div class="stat-grid">
    <StatCard label="Version" value={data.value?.version ?? '—'} loading={loading.value && !data.value} />
    <StatCard label="Uptime" value={data.value ? formatUptime(data.value.uptime) : '—'} loading={loading.value && !data.value} />
    <StatCard label="Agents" value={data.value?.agentCount?.toString() ?? '—'} loading={loading.value && !data.value} />
    <StatCard label="Active Sessions" value={data.value?.activeSessionCount?.toString() ?? '—'} loading={loading.value && !data.value} />
  </div>
  <div class="stat-grid" style={{ marginTop: 'var(--space-4)' }}>
    <StatCard
      label="Kill Switch"
      value={data.value?.killSwitchState === 'ACTIVATED' ? 'ACTIVATED' : 'NORMAL'}
      loading={loading.value && !data.value}
      badge={data.value ? (data.value.killSwitchState === 'ACTIVATED' ? 'danger' : 'success') : undefined}
    />
    <StatCard label="Status" value={data.value?.status ?? '—'} loading={loading.value && !data.value} />
  </div>
</div>
```

7. Create a local `StatCard` component (not exported, defined in same file):
```typescript
function StatCard({ label, value, loading, badge }: {
  label: string; value: string; loading?: boolean; badge?: 'success' | 'danger'
}) {
  return (
    <div class="stat-card">
      <div class="stat-label">{label}</div>
      {loading ? (
        <div class="stat-skeleton" />
      ) : badge ? (
        <Badge variant={badge}>{value}</Badge>
      ) : (
        <div class="stat-value">{value}</div>
      )}
    </div>
  );
}
```

**Key behaviors:**
- On initial load, show skeleton cards (loading = true, data = null)
- After first successful fetch, subsequent fetches during polling do NOT show loading skeleton (loading.value is true but data.value is not null, so `loading && !data` is false) -- this prevents flickering during refresh
- Error banner shows at top of page, does NOT replace cards (cards show stale data if available)
- Only show skeleton on very first load when no data exists yet

**CSS additions (packages/admin/src/styles/global.css):**

Append these classes at the end of the file:

```css
/* Dashboard */
.stat-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--space-4);
}

.stat-card {
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  padding: var(--space-4) var(--space-6);
  box-shadow: var(--shadow-sm);
}

.stat-label {
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: var(--space-2);
}

.stat-value {
  font-size: var(--font-size-2xl);
  font-weight: var(--font-weight-bold);
  color: var(--color-text);
}

.stat-skeleton {
  height: 2rem;
  background: var(--color-bg-tertiary);
  border-radius: var(--radius-md);
  animation: pulse 1.5s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.dashboard-error {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-3) var(--space-4);
  background: var(--color-danger-bg);
  color: var(--color-danger);
  border: 1px solid var(--color-danger);
  border-radius: var(--radius-md);
  margin-bottom: var(--space-4);
  font-size: var(--font-size-sm);
}
```
  </action>
  <verify>
1. Run `cd /Users/minho.yoo/dev/wallet/WAIaaS && pnpm --filter @waiaas/admin build` -- should succeed with no errors
2. Verify dashboard.tsx exports a default function component
3. Verify dashboard.tsx imports apiGet and API.ADMIN_STATUS
4. Verify dashboard.tsx contains setInterval with 30000ms interval
5. Verify dashboard.tsx contains clearInterval cleanup in useEffect return
6. Verify global.css contains .stat-grid, .stat-card, .stat-skeleton, .dashboard-error classes
  </verify>
  <done>
Dashboard page renders stat cards (Version, Uptime, Agents, Active Sessions, Kill Switch, Status) from GET /v1/admin/status data. 30-second polling auto-refreshes data. Loading skeleton shows on initial load. Error banner with Retry button shows on API failure. Build succeeds.
  </done>
</task>

</tasks>

<verification>
1. `pnpm --filter @waiaas/admin build` passes
2. Dashboard page file is >80 lines with real implementation (not placeholder)
3. CSS file contains dashboard-specific classes
4. No TypeScript errors in the admin package
</verification>

<success_criteria>
- Dashboard page displays 6 stat cards from live daemon status data
- 30-second auto-refresh interval with cleanup
- Loading skeleton on first fetch, no flicker on subsequent polls
- Error banner with Retry button on API failure
- Build passes with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/68-dashboard-agents-sessions/68-01-SUMMARY.md`
</output>
