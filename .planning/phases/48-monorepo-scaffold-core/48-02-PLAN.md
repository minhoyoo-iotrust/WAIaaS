---
phase: 48-monorepo-scaffold-core
plan: 02
type: tdd
wave: 2
depends_on: ["48-01"]
files_modified:
  - packages/core/src/enums/index.ts
  - packages/core/src/enums/chain.ts
  - packages/core/src/enums/agent.ts
  - packages/core/src/enums/transaction.ts
  - packages/core/src/enums/policy.ts
  - packages/core/src/enums/session.ts
  - packages/core/src/enums/notification.ts
  - packages/core/src/enums/audit.ts
  - packages/core/src/enums/system.ts
  - packages/core/src/enums/owner.ts
  - packages/core/src/schemas/agent.schema.ts
  - packages/core/src/schemas/session.schema.ts
  - packages/core/src/schemas/transaction.schema.ts
  - packages/core/src/schemas/policy.schema.ts
  - packages/core/src/schemas/config.schema.ts
  - packages/core/src/schemas/index.ts
  - packages/core/src/errors/error-codes.ts
  - packages/core/src/errors/base-error.ts
  - packages/core/src/errors/index.ts
  - packages/core/src/index.ts
  - packages/core/src/__tests__/enums.test.ts
  - packages/core/src/__tests__/schemas.test.ts
  - packages/core/src/__tests__/errors.test.ts
autonomous: true

must_haves:
  truths:
    - "12개 Enum이 as const 배열 -> Zod literal union 파이프라인으로 정의되고, 타입 추론이 동작한다"
    - "Agent, Session, Transaction, Policy, Config에 대한 Zod SSoT 스키마에서 TypeScript 타입이 자동 파생된다"
    - "66개 에러 코드가 ERROR_CODES 매트릭스에 정의되고, WAIaaSError를 throw/catch하면 code와 httpStatus를 조회할 수 있다"
    - "Enum 값과 Zod 스키마가 일치하는지 검증하는 단위 테스트가 통과한다"
  artifacts:
    - path: "packages/core/src/enums/index.ts"
      provides: "12 Enum 통합 export"
      exports: ["CHAIN_TYPES", "NETWORK_TYPES", "AGENT_STATUSES", "TRANSACTION_STATUSES", "TRANSACTION_TYPES", "POLICY_TYPES", "POLICY_TIERS", "SESSION_STATUSES", "NOTIFICATION_EVENT_TYPES", "AUDIT_ACTIONS", "KILL_SWITCH_STATES", "OWNER_STATES"]
    - path: "packages/core/src/errors/error-codes.ts"
      provides: "66개 에러 코드 통합 매트릭스"
      contains: "ERROR_CODES"
    - path: "packages/core/src/errors/base-error.ts"
      provides: "WAIaaSError 베이스 클래스"
      exports: ["WAIaaSError"]
    - path: "packages/core/src/schemas/agent.schema.ts"
      provides: "Agent Zod SSoT 스키마"
      contains: "AgentSchema"
    - path: "packages/core/src/__tests__/enums.test.ts"
      provides: "Enum SSoT 검증 단위 테스트"
      contains: "describe"
  key_links:
    - from: "packages/core/src/enums/*.ts"
      to: "packages/core/src/schemas/*.ts"
      via: "Zod enum import from enum files"
      pattern: "import.*Enum.*from.*enums"
    - from: "packages/core/src/errors/base-error.ts"
      to: "packages/core/src/errors/error-codes.ts"
      via: "WAIaaSError references ERROR_CODES for httpStatus lookup"
      pattern: "ERROR_CODES"
    - from: "packages/core/src/index.ts"
      to: "packages/core/src/enums/index.ts"
      via: "re-export"
      pattern: "export.*from.*enums"
---

<objective>
@waiaas/core에 12개 Enum SSoT, 5개 도메인 Zod 스키마, 66개 에러 코드 매트릭스, WAIaaSError 클래스를 TDD로 구현한다.

Purpose: 모든 다운스트림 패키지(daemon, adapter-solana, cli)가 공유하는 도메인 모델의 근간. Enum 값 불일치, 에러 코드 누락을 단위 테스트로 방지.
Output: 12 Enum 파일, 5 Zod 스키마 파일, error-codes.ts + base-error.ts, 테스트 3파일
</objective>

<execution_context>
@/Users/minho.yoo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/minho.yoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/48-monorepo-scaffold-core/48-01-SUMMARY.md
@.planning/deliverables/45-enum-unified-mapping.md (12 Enum SSoT 정의)
@.planning/deliverables/37-rest-api-complete-spec.md (SS10.12 에러 코드 통합 매트릭스)
@.planning/deliverables/25-sqlite-schema.md (테이블 스키마 -> Zod 스키마 파생)
@.planning/deliverables/27-chain-adapter-interface.md (공통 타입 정의)
@objectives/v1.1-core-infrastructure.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: 12 Enum SSoT 정의 + Zod 스키마 5개 + 에러 코드 66개</name>
  <files>
    packages/core/src/enums/chain.ts
    packages/core/src/enums/agent.ts
    packages/core/src/enums/transaction.ts
    packages/core/src/enums/policy.ts
    packages/core/src/enums/session.ts
    packages/core/src/enums/notification.ts
    packages/core/src/enums/audit.ts
    packages/core/src/enums/system.ts
    packages/core/src/enums/owner.ts
    packages/core/src/enums/index.ts
    packages/core/src/schemas/agent.schema.ts
    packages/core/src/schemas/session.schema.ts
    packages/core/src/schemas/transaction.schema.ts
    packages/core/src/schemas/policy.schema.ts
    packages/core/src/schemas/config.schema.ts
    packages/core/src/schemas/index.ts
    packages/core/src/errors/error-codes.ts
    packages/core/src/errors/base-error.ts
    packages/core/src/errors/index.ts
    packages/core/src/index.ts
  </files>
  <action>
**A. 12 Enum SSoT 파일 (packages/core/src/enums/)**

SSoT 파이프라인: `as const` 배열 -> TypeScript 타입 (typeof array[number]) -> Zod enum (z.enum(array)) -> (Phase 49에서) Drizzle CHECK

각 enum 파일에서 `as const` 배열, TypeScript 타입, Zod enum을 모두 export한다. 설계 문서 45-enum-unified-mapping.md의 값과 정확히 일치해야 한다.

**chain.ts:**
```typescript
import { z } from 'zod';
export const CHAIN_TYPES = ['solana', 'ethereum'] as const;
export type ChainType = typeof CHAIN_TYPES[number];
export const ChainTypeEnum = z.enum(CHAIN_TYPES);

export const NETWORK_TYPES = ['mainnet', 'devnet', 'testnet'] as const;
export type NetworkType = typeof NETWORK_TYPES[number];
export const NetworkTypeEnum = z.enum(NETWORK_TYPES);
```

**agent.ts:**
```typescript
export const AGENT_STATUSES = ['CREATING', 'ACTIVE', 'SUSPENDED', 'TERMINATING', 'TERMINATED'] as const;
export type AgentStatus = typeof AGENT_STATUSES[number];
export const AgentStatusEnum = z.enum(AGENT_STATUSES);
```

**transaction.ts:**
```typescript
export const TRANSACTION_STATUSES = ['PENDING', 'QUEUED', 'EXECUTING', 'SUBMITTED', 'CONFIRMED', 'FAILED', 'CANCELLED', 'EXPIRED'] as const;
// 주의: PARTIAL_FAILURE는 v0.10에서 추가되었으나 v1.1 초기 구현에서는 제외. Phase 50 파이프라인에서 필요시 추가.
export type TransactionStatus = typeof TRANSACTION_STATUSES[number];
export const TransactionStatusEnum = z.enum(TRANSACTION_STATUSES);

export const TRANSACTION_TYPES = ['TRANSFER', 'TOKEN_TRANSFER', 'CONTRACT_CALL', 'APPROVE', 'BATCH'] as const;
export type TransactionType = typeof TRANSACTION_TYPES[number];
export const TransactionTypeEnum = z.enum(TRANSACTION_TYPES);
```

**policy.ts:**
```typescript
export const POLICY_TYPES = [
  'SPENDING_LIMIT', 'WHITELIST', 'TIME_RESTRICTION', 'RATE_LIMIT',
  'ALLOWED_TOKENS', 'CONTRACT_WHITELIST', 'METHOD_WHITELIST',
  'APPROVED_SPENDERS', 'APPROVE_AMOUNT_LIMIT', 'APPROVE_TIER_OVERRIDE',
] as const;
export type PolicyType = typeof POLICY_TYPES[number];
export const PolicyTypeEnum = z.enum(POLICY_TYPES);

export const POLICY_TIERS = ['INSTANT', 'NOTIFY', 'DELAY', 'APPROVAL'] as const;
export type PolicyTier = typeof POLICY_TIERS[number];
export const PolicyTierEnum = z.enum(POLICY_TIERS);
```

**session.ts:**
```typescript
// 세션 상태. 45-enum에는 명시적 SessionStatus가 없지만 REQUIREMENTS CORE-01에서 요구.
// sessions 테이블은 expires_at 기반이지만, 런타임 상태 표현을 위해 정의.
export const SESSION_STATUSES = ['ACTIVE', 'EXPIRED', 'REVOKED'] as const;
export type SessionStatus = typeof SESSION_STATUSES[number];
export const SessionStatusEnum = z.enum(SESSION_STATUSES);
```

**notification.ts:**
```typescript
// NotificationEventType: 35-notification-architecture에서 정의된 이벤트 유형
export const NOTIFICATION_EVENT_TYPES = [
  'TX_REQUESTED', 'TX_QUEUED', 'TX_SUBMITTED', 'TX_CONFIRMED', 'TX_FAILED', 'TX_CANCELLED',
  'TX_DOWNGRADED_DELAY',
  'POLICY_VIOLATION', 'AGENT_SUSPENDED',
  'KILL_SWITCH_ACTIVATED', 'KILL_SWITCH_RECOVERED',
  'SESSION_EXPIRING_SOON', 'SESSION_EXPIRED',
  'OWNER_SET', 'OWNER_REMOVED', 'OWNER_VERIFIED',
] as const;
export type NotificationEventType = typeof NOTIFICATION_EVENT_TYPES[number];
export const NotificationEventTypeEnum = z.enum(NOTIFICATION_EVENT_TYPES);
```

**audit.ts:**
```typescript
// AuditAction: 25-sqlite-schema 섹션 2.8 AuditLogEventType에서 정의
export const AUDIT_ACTIONS = [
  'AGENT_CREATED', 'AGENT_ACTIVATED', 'AGENT_SUSPENDED', 'AGENT_TERMINATED',
  'SESSION_ISSUED', 'SESSION_REVOKED', 'SESSION_EXPIRED',
  'TX_REQUESTED', 'TX_QUEUED', 'TX_SUBMITTED', 'TX_CONFIRMED', 'TX_FAILED', 'TX_CANCELLED',
  'POLICY_VIOLATION', 'POLICY_UPDATED',
  'KEYSTORE_UNLOCKED', 'KEYSTORE_LOCKED', 'KEY_ROTATED',
  'KILL_SWITCH_ACTIVATED',
  'DAEMON_STARTED', 'DAEMON_STOPPED',
  'AUTH_FAILED', 'RATE_LIMIT_EXCEEDED',
] as const;
export type AuditAction = typeof AUDIT_ACTIONS[number];
export const AuditActionEnum = z.enum(AUDIT_ACTIONS);
```

**system.ts:**
```typescript
export const KILL_SWITCH_STATES = ['NORMAL', 'ACTIVATED', 'RECOVERING'] as const;
export type KillSwitchState = typeof KILL_SWITCH_STATES[number];
export const KillSwitchStateEnum = z.enum(KILL_SWITCH_STATES);
```

**owner.ts:**
```typescript
// OwnerState: 런타임 파생 상태 (DB 비저장). 25-sqlite SS4.12.1
export const OWNER_STATES = ['NONE', 'GRACE', 'LOCKED'] as const;
export type OwnerState = typeof OWNER_STATES[number];
export const OwnerStateEnum = z.enum(OWNER_STATES);
```

**enums/index.ts:** 모든 enum 파일에서 re-export.

**B. 5개 도메인 Zod SSoT 스키마 (packages/core/src/schemas/)**

각 스키마 파일에서 Zod 스키마를 정의하고, `z.infer`로 TypeScript 타입을 자동 파생한다. 이 스키마들은 v1.1에서 필요한 최소 필드만 포함하되, 설계 문서(25-sqlite)의 필드를 반영한다.

**agent.schema.ts:**
```typescript
import { z } from 'zod';
import { ChainTypeEnum, NetworkTypeEnum, AgentStatusEnum, OwnerStateEnum } from '../enums/index.js';

export const AgentSchema = z.object({
  id: z.string().uuid(),
  name: z.string().min(1).max(100),
  chain: ChainTypeEnum,
  network: NetworkTypeEnum,
  publicKey: z.string(),
  status: AgentStatusEnum,
  ownerAddress: z.string().nullable(),
  ownerVerified: z.boolean(),
  createdAt: z.number().int(),
  updatedAt: z.number().int(),
});
export type Agent = z.infer<typeof AgentSchema>;

export const CreateAgentRequestSchema = z.object({
  name: z.string().min(1).max(100),
  chain: ChainTypeEnum.default('solana'),
  network: NetworkTypeEnum.default('devnet'),
});
export type CreateAgentRequest = z.infer<typeof CreateAgentRequestSchema>;
```

**session.schema.ts:**
```typescript
export const SessionSchema = z.object({
  id: z.string().uuid(),
  agentId: z.string().uuid(),
  tokenHash: z.string(),
  constraints: z.record(z.unknown()).nullable(),
  renewalCount: z.number().int().min(0),
  maxRenewals: z.number().int(),
  expiresAt: z.number().int(),
  absoluteExpiresAt: z.number().int(),
  createdAt: z.number().int(),
  updatedAt: z.number().int(),
});
export type Session = z.infer<typeof SessionSchema>;
```

**transaction.schema.ts:**
```typescript
export const TransactionSchema = z.object({
  id: z.string().uuid(),
  agentId: z.string().uuid(),
  sessionId: z.string().uuid().nullable(),
  type: TransactionTypeEnum,
  status: TransactionStatusEnum,
  tier: PolicyTierEnum.nullable(),
  chain: ChainTypeEnum,
  fromAddress: z.string(),
  toAddress: z.string(),
  amount: z.string(), // bigint as string for JSON/SQLite
  txHash: z.string().nullable(),
  errorMessage: z.string().nullable(),
  metadata: z.record(z.unknown()).nullable(),
  createdAt: z.number().int(),
  updatedAt: z.number().int(),
});
export type Transaction = z.infer<typeof TransactionSchema>;

export const SendTransactionRequestSchema = z.object({
  to: z.string().min(1),
  amount: z.string().regex(/^\d+$/, 'amount must be a numeric string (lamports)'),
  memo: z.string().max(256).optional(),
});
export type SendTransactionRequest = z.infer<typeof SendTransactionRequestSchema>;
```

**policy.schema.ts:**
```typescript
export const PolicySchema = z.object({
  id: z.string().uuid(),
  agentId: z.string().uuid(),
  type: PolicyTypeEnum,
  ruleConfig: z.record(z.unknown()),
  enabled: z.boolean(),
  createdAt: z.number().int(),
  updatedAt: z.number().int(),
});
export type Policy = z.infer<typeof PolicySchema>;
```

**config.schema.ts:**
17개 평탄화 키의 Zod 스키마. 24-monorepo-data-directory 섹션 3 참조:
```typescript
export const ConfigSchema = z.object({
  server_port: z.number().int().min(1).max(65535).default(3100),
  server_host: z.string().default('127.0.0.1'),
  data_dir: z.string().default('~/.waiaas'),
  log_level: z.enum(['debug', 'info', 'warn', 'error']).default('info'),
  session_default_ttl: z.number().int().min(60).default(3600),
  session_max_ttl: z.number().int().min(300).default(86400),
  session_max_renewals: z.number().int().min(0).default(24),
  session_absolute_lifetime: z.number().int().min(3600).default(604800),
  security_master_password_max_attempts: z.number().int().min(1).default(5),
  security_master_password_lockout_duration: z.number().int().min(60).default(1800),
  security_auto_stop_enabled: z.boolean().default(true),
  rpc_solana_mainnet: z.string().url().default('https://api.mainnet-beta.solana.com'),
  rpc_solana_devnet: z.string().url().default('https://api.devnet.solana.com'),
  rpc_solana_testnet: z.string().url().default('https://api.testnet.solana.com'),
  policy_default_tier: PolicyTierEnum.default('INSTANT'),
  notification_channels: z.array(z.enum(['TELEGRAM', 'DISCORD', 'NTFY'])).default([]),
  kill_switch_recovery_timeout: z.number().int().min(60).default(86400),
});
export type Config = z.infer<typeof ConfigSchema>;
```

**schemas/index.ts:** 모든 스키마 파일에서 re-export.

**C. 에러 코드 매트릭스 66개 (packages/core/src/errors/)**

**error-codes.ts:**
37-rest-api SS10.12에서 정의된 66개 에러 코드를 단일 매트릭스로 정의:

```typescript
export type ErrorDomain = 'AUTH' | 'SESSION' | 'TX' | 'POLICY' | 'OWNER' | 'SYSTEM' | 'AGENT' | 'WITHDRAW' | 'ACTION' | 'ADMIN';

export interface ErrorCodeEntry {
  code: string;
  domain: ErrorDomain;
  httpStatus: number;
  retryable: boolean;
  message: string; // 기본 영문 메시지 (i18n key로도 사용)
}

export const ERROR_CODES = { ... } as const satisfies Record<string, ErrorCodeEntry>;
```

66개 에러 코드를 모두 포함한다. SS10.12 매트릭스의 에러코드, 도메인, HTTP, retryable 값을 정확히 반영. message 필드는 영문 기본 메시지.

**base-error.ts:**
```typescript
export class WAIaaSError extends Error {
  readonly code: string;
  readonly httpStatus: number;
  readonly retryable: boolean;
  readonly details?: Record<string, unknown>;
  readonly requestId?: string;

  constructor(code: keyof typeof ERROR_CODES, options?: {
    message?: string;
    details?: Record<string, unknown>;
    requestId?: string;
    cause?: Error;
  }) {
    const entry = ERROR_CODES[code];
    super(options?.message ?? entry.message);
    this.name = 'WAIaaSError';
    this.code = code;
    this.httpStatus = entry.httpStatus;
    this.retryable = entry.retryable;
    this.details = options?.details;
    this.requestId = options?.requestId;
    if (options?.cause) this.cause = options.cause;
  }

  toJSON() {
    return {
      code: this.code,
      message: this.message,
      details: this.details,
      requestId: this.requestId,
      retryable: this.retryable,
    };
  }
}
```

**errors/index.ts:** ERROR_CODES, WAIaaSError, ErrorDomain, ErrorCodeEntry re-export.

**D. packages/core/src/index.ts 업데이트:**
enums, schemas, errors 모듈에서 모든 public API를 re-export.

**TDD 적용:** 먼저 테스트를 작성하고(RED), 그 다음 구현체를 작성한다(GREEN).
  </action>
  <verify>
`pnpm --filter @waiaas/core test` -- 테스트 통과.
`pnpm build` -- 전 패키지 빌드 성공.
`pnpm lint` -- 린트 에러 0.
  </verify>
  <done>12 Enum SSoT + 5 Zod 스키마 + 66 에러 코드 + WAIaaSError 클래스가 구현되고, 검증 테스트가 통과한다.</done>
</task>

<task type="auto">
  <name>Task 2: Enum/스키마/에러 단위 테스트 (RED -> GREEN)</name>
  <files>
    packages/core/src/__tests__/enums.test.ts
    packages/core/src/__tests__/schemas.test.ts
    packages/core/src/__tests__/errors.test.ts
  </files>
  <action>
TDD: 테스트를 먼저 작성하고, Task 1의 구현이 테스트를 만족하는지 검증한다. (실제 실행 시 Task 1과 2를 RED->GREEN 사이클로 번갈아 진행)

**enums.test.ts:**
```typescript
import { describe, it, expect } from 'vitest';
import {
  CHAIN_TYPES, ChainTypeEnum,
  NETWORK_TYPES, NetworkTypeEnum,
  AGENT_STATUSES, AgentStatusEnum,
  TRANSACTION_STATUSES, TransactionStatusEnum,
  TRANSACTION_TYPES, TransactionTypeEnum,
  POLICY_TYPES, PolicyTypeEnum,
  POLICY_TIERS, PolicyTierEnum,
  SESSION_STATUSES, SessionStatusEnum,
  NOTIFICATION_EVENT_TYPES, NotificationEventTypeEnum,
  AUDIT_ACTIONS, AuditActionEnum,
  KILL_SWITCH_STATES, KillSwitchStateEnum,
  OWNER_STATES, OwnerStateEnum,
} from '../index.js';

describe('Enum SSoT', () => {
  // 12 Enum 값 개수 검증
  it('ChainType은 2개 값을 가진다', () => {
    expect(CHAIN_TYPES).toHaveLength(2);
    expect(CHAIN_TYPES).toContain('solana');
    expect(CHAIN_TYPES).toContain('ethereum');
  });

  it('NetworkType은 3개 값을 가진다', () => {
    expect(NETWORK_TYPES).toHaveLength(3);
  });

  it('AgentStatus는 5개 값을 가진다', () => {
    expect(AGENT_STATUSES).toHaveLength(5);
  });

  it('TransactionStatus는 8개 값을 가진다', () => {
    expect(TRANSACTION_STATUSES).toHaveLength(8);
  });

  it('TransactionType은 5개 값을 가진다', () => {
    expect(TRANSACTION_TYPES).toHaveLength(5);
  });

  it('PolicyType은 10개 값을 가진다', () => {
    expect(POLICY_TYPES).toHaveLength(10);
  });

  it('PolicyTier는 4개 값을 가진다', () => {
    expect(POLICY_TIERS).toHaveLength(4);
  });

  it('SessionStatus는 3개 값을 가진다', () => {
    expect(SESSION_STATUSES).toHaveLength(3);
  });

  it('KillSwitchState는 3개 값을 가진다', () => {
    expect(KILL_SWITCH_STATES).toHaveLength(3);
  });

  it('OwnerState는 3개 값을 가진다', () => {
    expect(OWNER_STATES).toHaveLength(3);
  });

  // Zod enum과 as const 배열 일치 검증
  it('Zod enum 옵션이 as const 배열과 일치한다', () => {
    expect(ChainTypeEnum.options).toEqual([...CHAIN_TYPES]);
    expect(NetworkTypeEnum.options).toEqual([...NETWORK_TYPES]);
    expect(AgentStatusEnum.options).toEqual([...AGENT_STATUSES]);
    expect(TransactionStatusEnum.options).toEqual([...TRANSACTION_STATUSES]);
    expect(TransactionTypeEnum.options).toEqual([...TRANSACTION_TYPES]);
    expect(PolicyTypeEnum.options).toEqual([...POLICY_TYPES]);
    expect(PolicyTierEnum.options).toEqual([...POLICY_TIERS]);
    expect(SessionStatusEnum.options).toEqual([...SESSION_STATUSES]);
    expect(KillSwitchStateEnum.options).toEqual([...KILL_SWITCH_STATES]);
    expect(OwnerStateEnum.options).toEqual([...OWNER_STATES]);
  });

  // 유효한 값 Zod parse 성공
  it('유효한 ChainType을 Zod가 파싱한다', () => {
    expect(ChainTypeEnum.parse('solana')).toBe('solana');
    expect(ChainTypeEnum.parse('ethereum')).toBe('ethereum');
  });

  // 유효하지 않은 값 Zod parse 실패
  it('유효하지 않은 ChainType을 Zod가 거부한다', () => {
    expect(() => ChainTypeEnum.parse('bitcoin')).toThrow();
  });
});
```

**schemas.test.ts:**
```typescript
import { describe, it, expect } from 'vitest';
import { AgentSchema, CreateAgentRequestSchema, TransactionSchema, SendTransactionRequestSchema, PolicySchema, SessionSchema, ConfigSchema } from '../index.js';

describe('Zod SSoT Schemas', () => {
  describe('CreateAgentRequestSchema', () => {
    it('최소 필드로 파싱 성공', () => {
      const result = CreateAgentRequestSchema.parse({ name: 'test-agent' });
      expect(result.name).toBe('test-agent');
      expect(result.chain).toBe('solana'); // default
      expect(result.network).toBe('devnet'); // default
    });

    it('빈 이름을 거부', () => {
      expect(() => CreateAgentRequestSchema.parse({ name: '' })).toThrow();
    });
  });

  describe('SendTransactionRequestSchema', () => {
    it('유효한 전송 요청 파싱', () => {
      const result = SendTransactionRequestSchema.parse({
        to: 'So11111111111111111111111111111112',
        amount: '1000000000',
      });
      expect(result.to).toBeDefined();
      expect(result.amount).toBe('1000000000');
    });

    it('음수 금액 거부', () => {
      expect(() => SendTransactionRequestSchema.parse({
        to: 'addr', amount: '-100',
      })).toThrow();
    });
  });

  describe('ConfigSchema', () => {
    it('기본값으로 빈 객체 파싱', () => {
      const result = ConfigSchema.parse({});
      expect(result.server_port).toBe(3100);
      expect(result.server_host).toBe('127.0.0.1');
      expect(result.log_level).toBe('info');
    });

    it('포트 범위 초과 거부', () => {
      expect(() => ConfigSchema.parse({ server_port: 99999 })).toThrow();
    });
  });

  describe('AgentSchema', () => {
    it('Agent 스키마에서 타입이 파생된다', () => {
      // 컴파일 타임 검증 (타입 추론이 동작하는지)
      const agent = AgentSchema.parse({
        id: '01912345-6789-7abc-8def-0123456789ab',
        name: 'test',
        chain: 'solana',
        network: 'devnet',
        publicKey: 'abc123',
        status: 'ACTIVE',
        ownerAddress: null,
        ownerVerified: false,
        createdAt: 1700000000,
        updatedAt: 1700000000,
      });
      expect(agent.status).toBe('ACTIVE');
    });
  });
});
```

**errors.test.ts:**
```typescript
import { describe, it, expect } from 'vitest';
import { WAIaaSError, ERROR_CODES } from '../index.js';

describe('에러 코드 매트릭스', () => {
  it('66개 에러 코드가 정의되어 있다', () => {
    expect(Object.keys(ERROR_CODES)).toHaveLength(66);
  });

  it('모든 에러 코드에 필수 필드가 있다', () => {
    for (const [key, entry] of Object.entries(ERROR_CODES)) {
      expect(entry.code).toBe(key);
      expect(entry.domain).toBeDefined();
      expect(entry.httpStatus).toBeGreaterThanOrEqual(400);
      expect(entry.httpStatus).toBeLessThan(600);
      expect(typeof entry.retryable).toBe('boolean');
      expect(entry.message).toBeTruthy();
    }
  });

  it('주요 도메인이 모두 포함되어 있다', () => {
    const domains = new Set(Object.values(ERROR_CODES).map(e => e.domain));
    expect(domains).toContain('AUTH');
    expect(domains).toContain('SESSION');
    expect(domains).toContain('TX');
    expect(domains).toContain('POLICY');
    expect(domains).toContain('OWNER');
    expect(domains).toContain('SYSTEM');
    expect(domains).toContain('AGENT');
    expect(domains).toContain('WITHDRAW');
    expect(domains).toContain('ACTION');
    expect(domains).toContain('ADMIN');
  });
});

describe('WAIaaSError', () => {
  it('에러 코드로 생성하면 httpStatus를 자동으로 설정한다', () => {
    const err = new WAIaaSError('AGENT_NOT_FOUND');
    expect(err.code).toBe('AGENT_NOT_FOUND');
    expect(err.httpStatus).toBe(404);
    expect(err.retryable).toBe(false);
    expect(err.name).toBe('WAIaaSError');
    expect(err instanceof Error).toBe(true);
  });

  it('커스텀 메시지를 지원한다', () => {
    const err = new WAIaaSError('INSUFFICIENT_BALANCE', {
      message: '잔액 부족: 100 lamports',
      details: { currentBalance: '100' },
    });
    expect(err.message).toBe('잔액 부족: 100 lamports');
    expect(err.details).toEqual({ currentBalance: '100' });
  });

  it('toJSON()이 에러 응답 포맷을 반환한다', () => {
    const err = new WAIaaSError('CHAIN_ERROR', {
      requestId: 'req_abc123',
    });
    const json = err.toJSON();
    expect(json.code).toBe('CHAIN_ERROR');
    expect(json.retryable).toBe(true);
    expect(json.requestId).toBe('req_abc123');
    expect(json).not.toHaveProperty('httpStatus'); // httpStatus는 toJSON에 미포함 (HTTP 레벨에서 설정)
  });

  it('CHAIN_ERROR는 retryable=true이다', () => {
    const err = new WAIaaSError('CHAIN_ERROR');
    expect(err.retryable).toBe(true);
  });

  it('cause 체인을 지원한다', () => {
    const cause = new Error('RPC timeout');
    const err = new WAIaaSError('CHAIN_ERROR', { cause });
    expect(err.cause).toBe(cause);
  });
});
```
  </action>
  <verify>
`pnpm --filter @waiaas/core test` -- 모든 테스트 통과.
테스트 수: enums.test.ts 12개+, schemas.test.ts 5개+, errors.test.ts 6개+ = 총 23개+ 테스트.
`pnpm build` -- 빌드 성공.
  </verify>
  <done>12 Enum SSoT 값 일치 검증, Zod 스키마 파싱 검증, 66개 에러 코드 완전성 검증, WAIaaSError throw/catch 검증이 모두 통과한다.</done>
</task>

</tasks>

<verification>
1. `pnpm --filter @waiaas/core test` -- 23개+ 단위 테스트 전체 통과
2. `pnpm build` -- core 패키지 빌드 성공, dist/에 모든 .js + .d.ts 산출물 존재
3. `pnpm lint` -- 린트 에러 0
4. `Object.keys(ERROR_CODES).length === 66` -- 에러 코드 66개 확인
5. 12개 Enum 배열과 Zod enum 옵션이 1:1 일치
</verification>

<success_criteria>
- CORE-01: 12개 Enum이 as const -> Zod literal union 파이프라인으로 정의됨
- CORE-02: Agent, Session, Transaction, Policy, Config Zod SSoT 스키마 + 타입 자동 파생
- CORE-03: 66개 에러 코드 통합 매트릭스 + WAIaaSError throw/catch + code/httpStatus 조회
- 단위 테스트 23개+ 통과
</success_criteria>

<output>
After completion, create `.planning/phases/48-monorepo-scaffold-core/48-02-SUMMARY.md`
</output>
