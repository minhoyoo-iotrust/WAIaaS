---
phase: 48-monorepo-scaffold-core
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .nvmrc
  - .node-version
  - package.json
  - pnpm-workspace.yaml
  - turbo.json
  - tsconfig.base.json
  - eslint.config.js
  - .prettierrc.json
  - .prettierignore
  - vitest.workspace.ts
  - packages/core/package.json
  - packages/core/tsconfig.json
  - packages/core/src/index.ts
  - packages/daemon/package.json
  - packages/daemon/tsconfig.json
  - packages/daemon/src/index.ts
  - packages/adapters/solana/package.json
  - packages/adapters/solana/tsconfig.json
  - packages/adapters/solana/src/index.ts
  - packages/cli/package.json
  - packages/cli/tsconfig.json
  - packages/cli/src/index.ts
  - packages/cli/bin/waiaas
autonomous: true

must_haves:
  truths:
    - "`pnpm install` 루트에서 성공하고 4개 패키지가 워크스페이스에 인식된다"
    - "`pnpm build` 루트에서 실행하면 Turborepo가 의존 순서대로 4개 패키지를 빌드한다"
    - "`pnpm lint` 루트에서 ESLint flat config + Prettier로 전 패키지를 린트한다"
    - "`pnpm test` 루트에서 Vitest workspace로 전 패키지 테스트를 실행한다 (0 tests, 0 failures)"
    - "`.nvmrc`에 22 LTS 버전이 명시되고, 모든 패키지가 ESM(type: module)으로 설정된다"
  artifacts:
    - path: "pnpm-workspace.yaml"
      provides: "pnpm workspace 패키지 목록"
      contains: "packages/"
    - path: "turbo.json"
      provides: "Turborepo 파이프라인 설정"
      contains: "build"
    - path: "tsconfig.base.json"
      provides: "공유 TypeScript 설정"
      contains: "compilerOptions"
    - path: "eslint.config.js"
      provides: "ESLint flat config (typescript-eslint)"
      contains: "eslint"
    - path: "vitest.workspace.ts"
      provides: "Vitest workspace 설정"
      contains: "defineWorkspace"
    - path: "packages/core/package.json"
      provides: "@waiaas/core 패키지 정의"
      contains: "@waiaas/core"
    - path: "packages/daemon/package.json"
      provides: "@waiaas/daemon 패키지 정의"
      contains: "@waiaas/daemon"
    - path: "packages/adapters/solana/package.json"
      provides: "@waiaas/adapter-solana 패키지 정의"
      contains: "@waiaas/adapter-solana"
    - path: "packages/cli/package.json"
      provides: "@waiaas/cli 패키지 정의"
      contains: "@waiaas/cli"
  key_links:
    - from: "turbo.json"
      to: "packages/*/package.json"
      via: "Turborepo pipeline reads package.json scripts"
      pattern: "build.*tsc"
    - from: "packages/*/tsconfig.json"
      to: "tsconfig.base.json"
      via: "extends field"
      pattern: "extends.*tsconfig\\.base"
    - from: "vitest.workspace.ts"
      to: "packages/*"
      via: "workspace glob pattern"
      pattern: "packages/\\*"
---

<objective>
pnpm workspace + Turborepo 기반 모노레포 스캐폴드를 생성하고, 4개 패키지(core, daemon, adapter-solana, cli)의 빌드-테스트-린트 파이프라인을 구성한다.

Purpose: 이후 모든 Phase(49-51)의 코드가 작성될 기반 인프라. 모든 패키지가 공유 설정을 따르고, 루트에서 한 명령어로 전체 빌드/테스트/린트가 가능해야 한다.
Output: 모노레포 루트 설정 파일들 + 4개 패키지 셸(빈 index.ts + package.json + tsconfig.json)
</objective>

<execution_context>
@/Users/minho.yoo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/minho.yoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/deliverables/24-monorepo-data-directory.md (섹션 1: 모노레포 패키지 구조)
@objectives/v1.1-core-infrastructure.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: 모노레포 루트 설정 (pnpm workspace, Turborepo, tsconfig, Node.js 22)</name>
  <files>
    .nvmrc
    .node-version
    package.json
    pnpm-workspace.yaml
    turbo.json
    tsconfig.base.json
  </files>
  <action>
1. `.nvmrc` 생성: `22` (Node.js 22 LTS). `.node-version`도 동일 값으로 생성 (fnm/volta 호환).

2. 루트 `package.json` 생성:
   - `"name": "waiaas"`, `"private": true`, `"type": "module"`
   - `"packageManager": "pnpm@9.15.4"` (또는 최신 pnpm 9.x)
   - `engines: { "node": ">=22.0.0" }`
   - devDependencies: `turborepo`, `typescript` (^5.7), `eslint` (^9), `@eslint/js`, `typescript-eslint` (^8), `eslint-config-prettier`, `prettier`, `vitest` (^3 또는 ^2), `@vitest/coverage-v8`, `zod` (^3.24)
   - scripts:
     - `"build": "turbo build"`
     - `"test": "turbo test"`
     - `"lint": "turbo lint"`
     - `"typecheck": "turbo typecheck"`
     - `"clean": "turbo clean"`
     - `"format": "prettier --write ."`
     - `"format:check": "prettier --check ."`

3. `pnpm-workspace.yaml` 생성:
   ```yaml
   packages:
     - "packages/*"
     - "packages/adapters/*"
   ```

4. `turbo.json` 생성:
   ```json
   {
     "$schema": "https://turbo.build/schema.json",
     "tasks": {
       "build": {
         "dependsOn": ["^build"],
         "outputs": ["dist/**"]
       },
       "test": {
         "dependsOn": ["build"],
         "outputs": []
       },
       "lint": {
         "outputs": []
       },
       "typecheck": {
         "dependsOn": ["^build"],
         "outputs": []
       },
       "clean": {
         "cache": false
       }
     }
   }
   ```

5. `tsconfig.base.json` 생성:
   ```json
   {
     "compilerOptions": {
       "target": "ES2022",
       "module": "NodeNext",
       "moduleResolution": "NodeNext",
       "lib": ["ES2022"],
       "declaration": true,
       "declarationMap": true,
       "sourceMap": true,
       "outDir": "dist",
       "rootDir": "src",
       "strict": true,
       "esModuleInterop": true,
       "skipLibCheck": true,
       "forceConsistentCasingInFileNames": true,
       "resolveJsonModule": true,
       "isolatedModules": true,
       "verbatimModuleSyntax": true,
       "noUncheckedIndexedAccess": true,
       "noUnusedLocals": true,
       "noUnusedParameters": true
     },
     "exclude": ["node_modules", "dist"]
   }
   ```

주의: `module: "NodeNext"` + `moduleResolution: "NodeNext"` + `verbatimModuleSyntax: true`는 ESM 필수 조합. import에 `.js` 확장자를 명시해야 한다.
  </action>
  <verify>
`ls -la .nvmrc package.json pnpm-workspace.yaml turbo.json tsconfig.base.json` -- 모든 파일 존재 확인.
`cat .nvmrc` -- `22` 출력.
`cat package.json | grep '"type"'` -- `"module"` 확인.
  </verify>
  <done>루트 모노레포 설정 파일 6개 생성. Node.js 22 LTS, ESM, pnpm workspace, Turborepo 파이프라인 설정 완료.</done>
</task>

<task type="auto">
  <name>Task 2: ESLint flat config + Prettier + Vitest workspace + 4개 패키지 셸 생성</name>
  <files>
    eslint.config.js
    .prettierrc.json
    .prettierignore
    vitest.workspace.ts
    packages/core/package.json
    packages/core/tsconfig.json
    packages/core/src/index.ts
    packages/daemon/package.json
    packages/daemon/tsconfig.json
    packages/daemon/src/index.ts
    packages/adapters/solana/package.json
    packages/adapters/solana/tsconfig.json
    packages/adapters/solana/src/index.ts
    packages/cli/package.json
    packages/cli/tsconfig.json
    packages/cli/src/index.ts
    packages/cli/bin/waiaas
  </files>
  <action>
1. `eslint.config.js` 생성 (ESLint 9 flat config):
   ```js
   import eslint from '@eslint/js';
   import tseslint from 'typescript-eslint';
   import eslintConfigPrettier from 'eslint-config-prettier';

   export default tseslint.config(
     eslint.configs.recommended,
     ...tseslint.configs.recommended,
     eslintConfigPrettier,
     {
       ignores: ['**/dist/**', '**/node_modules/**', '**/*.js', '!eslint.config.js'],
     },
     {
       rules: {
         '@typescript-eslint/no-unused-vars': ['error', { argsIgnorePattern: '^_' }],
         '@typescript-eslint/explicit-function-return-type': 'off',
         '@typescript-eslint/no-explicit-any': 'warn',
       },
     },
   );
   ```

2. `.prettierrc.json` 생성:
   ```json
   {
     "semi": true,
     "singleQuote": true,
     "trailingComma": "all",
     "printWidth": 100,
     "tabWidth": 2
   }
   ```

3. `.prettierignore` 생성:
   ```
   dist
   node_modules
   pnpm-lock.yaml
   .turbo
   coverage
   ```

4. `vitest.workspace.ts` 생성:
   ```ts
   import { defineWorkspace } from 'vitest/config';

   export default defineWorkspace([
     'packages/*/vitest.config.ts',
     'packages/adapters/*/vitest.config.ts',
   ]);
   ```

5. **4개 패키지 셸 생성.** 각 패키지에 package.json, tsconfig.json, src/index.ts를 생성한다.

**packages/core:**
- `package.json`: name `@waiaas/core`, version `0.0.0`, type `module`, main `dist/index.js`, types `dist/index.d.ts`, exports `{ ".": { "import": "./dist/index.js", "types": "./dist/index.d.ts" } }`, scripts: build (`tsc -p tsconfig.json`), test (`vitest run`), lint (`eslint src/`), typecheck (`tsc --noEmit`), clean (`rm -rf dist`). dependencies: `zod` (workspace:*로 루트에서 hoist). files: `["dist"]`.
- `tsconfig.json`: extends `../../tsconfig.base.json`, compilerOptions.outDir `dist`, compilerOptions.rootDir `src`, include `["src"]`.
- `src/index.ts`: `// @waiaas/core - shared types, schemas, errors, interfaces` 주석 + `export {};`로 빈 ESM 모듈.
- `vitest.config.ts`: `import { defineConfig } from 'vitest/config'; export default defineConfig({ test: { globals: true } });`

**packages/daemon:**
- `package.json`: name `@waiaas/daemon`, version `0.0.0`, type `module`, main `dist/index.js`, types `dist/index.d.ts`, scripts 동일 패턴. dependencies: `@waiaas/core` (`workspace:*`). files: `["dist"]`.
- `tsconfig.json`: extends `../../tsconfig.base.json`, references: `[{ "path": "../core" }]`, include `["src"]`.
- `src/index.ts`: `// @waiaas/daemon` 주석 + `export {};`.
- `vitest.config.ts`: 동일 패턴.

**packages/adapters/solana:**
- `package.json`: name `@waiaas/adapter-solana`, version `0.0.0`, type `module`, main `dist/index.js`, types `dist/index.d.ts`, scripts 동일. dependencies: `@waiaas/core` (`workspace:*`). files: `["dist"]`.
- `tsconfig.json`: extends `../../../tsconfig.base.json`, references: `[{ "path": "../../core" }]`, include `["src"]`.
- `src/index.ts`: `// @waiaas/adapter-solana` 주석 + `export {};`.
- `vitest.config.ts`: 동일 패턴.

**packages/cli:**
- `package.json`: name `@waiaas/cli`, version `0.0.0`, type `module`, bin `{ "waiaas": "./bin/waiaas" }`, main `dist/index.js`, scripts 동일. dependencies: `@waiaas/core` (`workspace:*`), `@waiaas/daemon` (`workspace:*`). files: `["dist", "bin"]`.
- `tsconfig.json`: extends `../../tsconfig.base.json`, references: `[{ "path": "../core" }, { "path": "../daemon" }]`, include `["src"]`.
- `src/index.ts`: `// @waiaas/cli` 주석 + `export {};`.
- `bin/waiaas`: `#!/usr/bin/env node\nimport '../dist/index.js';` (ES module shebang 스크립트). chmod 755.
- `vitest.config.ts`: 동일 패턴.

6. zod를 @waiaas/core의 dependency로 추가 (루트에도 devDependencies에 있지만, core가 실제 런타임 의존):
   - core의 package.json: `"dependencies": { "zod": "^3.24.0" }`

7. `pnpm install` 실행하여 lockfile 생성.

8. `pnpm build && pnpm test && pnpm lint` 실행하여 전체 파이프라인 검증.
  </action>
  <verify>
`pnpm install` 성공 (exit 0).
`pnpm build` 성공 -- 4개 패키지 dist/ 디렉토리에 index.js + index.d.ts 생성 확인.
`pnpm test` 성공 (0 tests, 모든 패키지에서 에러 없이 종료).
`pnpm lint` 성공 (린트 에러 0).
`ls packages/core/dist/index.js packages/daemon/dist/index.js packages/adapters/solana/dist/index.js packages/cli/dist/index.js` -- 모든 빌드 산출물 존재.
`cat packages/core/package.json | grep '"type"'` -- `"module"` 확인.
  </verify>
  <done>ESLint flat config, Prettier, Vitest workspace 설정 완료. 4개 패키지(core, daemon, adapter-solana, cli)의 셸이 생성되고 pnpm install + build + test + lint가 루트에서 한 번에 성공한다. 모든 패키지가 ESM으로 빌드된다.</done>
</task>

</tasks>

<verification>
1. `pnpm install && pnpm build && pnpm test && pnpm lint` 루트에서 한 번에 성공한다.
2. 4개 패키지 모두 dist/index.js + dist/index.d.ts가 생성된다.
3. .nvmrc에 22가 명시되어 있다.
4. 모든 package.json에 "type": "module"이 설정되어 있다.
5. turbo.json에 build -> test 의존이 있고, ^build로 워크스페이스 의존성 순서가 보장된다.
</verification>

<success_criteria>
- MONO-01: pnpm workspace + Turborepo로 4개 패키지가 빌드-테스트-린트 파이프라인으로 연결됨
- MONO-02: tsconfig.base.json, ESLint flat config + Prettier, Vitest workspace 설정이 모든 패키지에 적용됨
- MONO-03: .nvmrc(22 LTS), 각 패키지 ESM 빌드 확인
</success_criteria>

<output>
After completion, create `.planning/phases/48-monorepo-scaffold-core/48-01-SUMMARY.md`
</output>
