# Plan 215-02: incoming_transactions 테이블 스키마 + 중복 방지 + 보존 정책 + 마이그레이션 명세

## Goal
수신 트랜잭션 저장을 위한 DB 스키마, 중복 방지 전략, 데이터 보존 정책, 마이그레이션 전략을 설계 문서로 정의한다.

## Requirements
- DATA-01: incoming_transactions 테이블 스키마 완성
- DATA-02: tx_hash UNIQUE 제약 중복 삽입 방지 전략 정의
- DATA-03: retention_days 기반 자동 삭제 스케줄러 설계
- DATA-04: 메모리 큐 + 배치 flush 패턴 설계 (SQLite 단일 라이터 보호)

## Tasks
1. incoming_transactions 테이블 DDL 정의 (컬럼, 인덱스, CHECK 제약)
2. wallets 테이블 monitor_incoming 컬럼 추가 명세
3. tx_hash UNIQUE + ON CONFLICT IGNORE 중복 방지 전략 명세
4. retention_days 기반 자동 삭제 BackgroundWorkers 스케줄러 설계
5. 메모리 큐 → 배치 INSERT flush 패턴 설계
6. v21 마이그레이션 전략 (ALTER TABLE + CREATE TABLE)
7. 커서 저장 전략 (last_processed_signature / last_processed_block)

## Success Criteria
- DDL이 모든 필수 컬럼과 인덱스를 포함
- 중복 방지 전략이 WebSocket + 폴링 동시 수신 시나리오를 커버
- 보존 정책이 BackgroundWorkers 패턴과 일관
- v21 마이그레이션이 기존 패턴과 동일한 구조

## Output
설계 문서 76 섹션 2: DB 스키마 + 데이터 레이어 명세
