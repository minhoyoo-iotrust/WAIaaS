---
phase: 46-ext-release-objectives
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - objectives/v1.5-defi-price-oracle.md
  - objectives/v1.6-desktop-telegram-docker.md
autonomous: true

must_haves:
  truths:
    - "v1.5 objective 문서가 설계 문서 61-63을 참조하고, IPriceOracle(교차 검증 인라인 + 가격 나이 3단계) + IActionProvider(resolve-then-execute) + Jupiter Swap 구현 범위를 정의하며, USD 기준 정책 평가 E2E 시나리오를 포함한다"
    - "v1.6 objective 문서가 설계 문서 36/39-40을 참조하고, Tauri 8화면 + Telegram Bot + Kill Switch + Docker 구현 범위를 정의하며, [HUMAN] 항목이 5~8건 명시된다"
    - "두 문서 모두 부록 구조(목표, 구현 대상 설계 문서, 산출물, 기술 결정 사항, E2E 검증 시나리오, 의존, 리스크)를 갖추고, 각 E2E 시나리오에 [L0]~[L3] 또는 [HUMAN] 태그가 부여된다"
    - "두 문서 모두 리스크 섹션에서 알려진 기술적 위험을 최소 2건 이상 식별한다"
  artifacts:
    - path: "objectives/v1.5-defi-price-oracle.md"
      provides: "v1.5 DeFi + 가격 오라클 마일스톤 objective"
      contains: "## 목표"
    - path: "objectives/v1.6-desktop-telegram-docker.md"
      provides: "v1.6 Desktop + Telegram + Docker 마일스톤 objective"
      contains: "## 목표"
  key_links:
    - from: "objectives/v1.5-defi-price-oracle.md"
      to: "objectives/v1.0-implementation-planning.md"
      via: "v1.5 섹션 확장"
      pattern: "v1\\.5.*DeFi.*오라클"
    - from: "objectives/v1.6-desktop-telegram-docker.md"
      to: "objectives/v1.0-implementation-planning.md"
      via: "v1.6 섹션 확장"
      pattern: "v1\\.6.*Desktop.*Telegram"
---

<objective>
v1.5(DeFi + 가격 오라클)과 v1.6(Desktop + Telegram Bot + Docker) 마일스톤의 objective 문서 2개를 생성한다.

Purpose: v1.5는 USD 기준 정책 평가와 DeFi 프로토콜(Jupiter Swap) 통합 범위를, v1.6은 Owner 클라이언트(Desktop/Telegram)와 Kill Switch/Docker 배포 범위를 정의하여, 구현 시 해석 여지를 제거한다.
Output: objectives/v1.5-defi-price-oracle.md, objectives/v1.6-desktop-telegram-docker.md
</objective>

<execution_context>
@/Users/minho.yoo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/minho.yoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@objectives/v1.0-implementation-planning.md

설계 문서 참조 (v1.5 대상):
@docs/61-price-oracle-spec.md
@docs/62-action-provider-architecture.md
@docs/63-swap-action-spec.md

설계 문서 참조 (v1.6 대상):
@.planning/deliverables/36-killswitch-autostop-evm.md
@.planning/deliverables/39-tauri-desktop-architecture.md
@.planning/deliverables/40-telegram-bot-docker.md

v0.10 설계 결정 참조:
@objectives/v0.10-pre-implementation-design-completion.md

기존 objective 문서 (패턴 참조):
@objectives/v1.4-token-contract-extension.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: v1.5 DeFi + 가격 오라클 objective 문서 생성</name>
  <files>objectives/v1.5-defi-price-oracle.md</files>
  <action>
objectives/v1.0-implementation-planning.md의 "v1.5 — DeFi + 가격 오라클" 섹션을 기반으로, 부록 템플릿 구조에 맞는 완전한 objective 문서를 생성한다. 한글로 작성한다. objectives/v1.4-token-contract-extension.md의 구조와 깊이를 참고하여 동일 수준으로 작성한다.

**1. 목표:** "USD 기준 정책 평가가 동작하고, Action Provider로 Jupiter Swap 등 DeFi 프로토콜을 에이전트가 사용할 수 있는 상태"

**2. 구현 대상 설계 문서:** 아래 설계 문서를 읽고 각각의 구현 범위(전체/부분)를 테이블로 정리한다:
- 61 (price-oracle-spec) — 전체: IPriceOracle 인터페이스, CoinGecko 구현체, 5분 TTL 캐시, 가격 나이 3단계(FRESH/AGING/STALE>30분), 교차 검증 인라인, OracleChain(CoinGecko→Pyth→Chainlink fallback)
- 62 (action-provider-architecture) — 전체: IActionProvider 인터페이스, resolve-then-execute 패턴, ActionDefinition Zod 스키마, ActionProviderRegistry(플러그인 발견/로드/검증, ~/.waiaas/actions/), MCP Tool 자동 매핑(16개 상한)
- 63 (swap-action-spec) — 전체: Jupiter Swap Action Provider, Quote API → /swap-instructions → ContractCallRequest 변환, 슬리피지 50/500bps 기본값, Jito MEV 보호

v0.10 설계를 반드시 반영한다:
- OPER-03: Oracle 교차 검증 인라인 + 가격 나이 3단계 FRESH/AGING/STALE

각 문서에서 v1.5에서 구현할 구체적 범위와 v1.5에서 구현하지 않는 범위를 상세히 기술한다.

**3. 산출물:** v1.0-implementation-planning.md의 산출물 테이블을 확장한다:
- IPriceOracle: 인터페이스 + CoinGeckoOracle 구현체, getPrice(tokenSymbol) → PriceResult, 5분 TTL 캐시, 가격 나이 3단계(FRESH<5분/AGING<30분/STALE>30분), 교차 검증 인라인(편차>5%→STALE 격하)
- OracleChain: CoinGecko → Pyth → Chainlink fallback 체인, 장애 시 다음 소스, 모든 소스 실패 시 정책 평가 거부
- USD 정책: resolveEffectiveAmountUsd(), 5개 TransactionType(TRANSFER/TOKEN_TRANSFER/CONTRACT_CALL/APPROVE/BATCH) 모두 USD 기준 평가, DatabasePolicyEngine USD 임계값 확장
- IActionProvider: resolve(params) → ActionPlan, execute(plan) → TransactionRequest, ActionDefinition Zod 스키마(name/description/parameters/chain)
- ActionProviderRegistry: 플러그인 발견/로드/검증, ~/.waiaas/actions/ 디렉토리 스캔, 유효성 검증(Zod 스키마 파싱 성공), 등록/해제 API
- MCP Tool 변환: ActionDefinition → MCP Tool 자동 매핑, 16개 도구 상한, 동적 도구 등록/해제
- Jupiter Swap: Quote API 호출 → slippage 적용 → /swap-instructions → ContractCallRequest 변환, SOL/USDC 등 토큰 페어
- 슬리피지/MEV: 기본 50bps(일반)/500bps(고변동), Jito MEV 보호(tip amount 설정), 슬리피지 정책 제한

각 컴포넌트의 주요 인터페이스와 핵심 메서드를 기술한다. 파일/모듈 구조를 나열한다.

**4. 기술 결정 사항:**
- CoinGecko API: 무료 티어 vs Pro 키 (rate limit 고려)
- Pyth Oracle: on-chain vs Hermes HTTP API 선택
- Chainlink: EVM only vs Solana 지원 범위
- Jupiter API: v6 Quote API 호출 방식 (fetch vs SDK)
- Action Provider 플러그인 포맷: ESM dynamic import vs CommonJS require
- MCP Tool 상한 16개 초과 시 우선순위 전략
- 슬리피지 기본값 config.toml 위치
- 가격 캐시 구현: 인메모리 Map vs LRU cache

**5. E2E 검증 시나리오:** v1.0-implementation-planning.md의 E2E 섹션을 확장한다. v1.5는 [HUMAN] 1건이다. 시나리오를 더 세분화한다:
- 5 USDC 전송 → mock oracle USD $5 평가 → INSTANT 티어 → 즉시 실행 [L0]
- 500 USDC 전송 → mock oracle USD $500 평가 → APPROVAL 티어 [L0]
- SOL 전송 → USD 환산 → 금액별 정책 티어 분류 검증 [L0]
- CoinGecko 장애 → Pyth fallback → 정상 가격 반환 [L0] (mock)
- 모든 소스 장애 → 정책 평가 거부 → ORACLE_UNAVAILABLE 에러 [L0]
- 가격 나이 FRESH → 정상 평가 [L0]
- 가격 나이 AGING → 경고 로그 + 정상 평가 [L0]
- 가격 나이 STALE(>30분) → 정책 평가 거부 또는 강등 [L0]
- 교차 검증: 두 소스 편차 >5% → STALE 격하 [L0]
- Action: jupiter-swap resolve → ActionPlan 반환 [L0] (Jupiter API mock)
- Action: jupiter-swap execute → ContractCallRequest 생성 → 파이프라인 실행 [L0] (mock)
- ActionProviderRegistry: 커스텀 플러그인 로드 → 도구 목록 추가 [L0] (테스트 플러그인)
- ActionProviderRegistry: 유효하지 않은 플러그인 → 로드 거부 + 에러 로그 [L0]
- MCP: ActionDefinition → waiaas_jupiter_swap 도구 자동 노출 [L0]
- MCP: 16개 초과 Action → 상한 적용 확인 [L0]
- 슬리피지: 기본 50bps 적용 확인, config 오버라이드 적용 [L0]
- Jito MEV 보호: tip 포함 트랜잭션 빌드 확인 [L0] (mock)
- [HUMAN] Jupiter API 실 호출 Devnet 검증 (외부 API 실 동작 확인)

**6. 의존:** v1.4 (토큰 + 컨트랙트 확장)

**7. 리스크:**
- CoinGecko API rate limit (무료 티어 10-30 req/min) — 캐시 TTL 5분으로 완화
- Jupiter API 버전 변경 (v6 → v7 마이그레이션 가능성) — API 래퍼로 추상화
- Pyth/Chainlink 온체인 데이터 접근 비용 — Hermes HTTP API 우선, 온체인 fallback
- Action Provider 플러그인 보안 (임의 코드 실행) — 샌드박스 없이 허용 목록 기반 검증
- MCP Tool 16개 상한 시 우선순위 충돌 — config 기반 우선순위 설정
- 교차 검증 인라인 편차 임계값 튜닝 — 5% 기본, config 오버라이드 가능

**작성 규칙:**
- 한글로 작성
- v0.10 설계 결정(OPER-03 Oracle 교차 검증)을 반드시 반영
- 설계 문서 번호와 이름을 정확히 기재
- 각 E2E 시나리오에 자동화 수준 태그 필수
- v1.4에서 이미 구현된 부분(ContractCallRequest, 파이프라인 Stage 5)과 v1.5에서 새로 추가하는 부분(USD 정책, Action Provider)을 구분
  </action>
  <verify>
- objectives/v1.5-defi-price-oracle.md 파일이 존재한다
- 문서에 "## 목표", "## 구현 대상 설계 문서", "## 산출물", "## 기술 결정 사항", "## E2E 검증 시나리오", "## 의존", "## 리스크" 7개 섹션이 모두 존재한다
- 구현 대상 설계 문서 테이블에 3개 문서(61, 62, 63)가 나열된다
- E2E 검증 시나리오에 [L0] 태그가 부여되고, [HUMAN] 항목이 1건이다
- USD 기준 정책 평가 E2E 시나리오가 포함된다
- 리스크 섹션에 최소 2건 이상 기술적 위험이 식별된다
  </verify>
  <done>objectives/v1.5-defi-price-oracle.md가 부록 구조를 완전히 갖추고, 3개 설계 문서의 구현 범위(전체)가 명시되며, 18개 이상 E2E 검증 시나리오에 자동화 수준 태그가 부여되고, v0.10 OPER-03 교차 검증 + 가격 나이 3단계 시나리오가 포함된 상태</done>
</task>

<task type="auto">
  <name>Task 2: v1.6 Desktop + Telegram Bot + Docker objective 문서 생성</name>
  <files>objectives/v1.6-desktop-telegram-docker.md</files>
  <action>
objectives/v1.0-implementation-planning.md의 "v1.6 — Desktop + Telegram Bot + Docker" 섹션을 기반으로, 부록 템플릿 구조에 맞는 완전한 objective 문서를 생성한다. 한글로 작성한다.

**1. 목표:** "Owner가 데스크톱 앱이나 Telegram으로 거래를 관리하고, Docker로 원클릭 배포가 가능한 상태"

**2. 구현 대상 설계 문서:** 아래 설계 문서를 읽고 각각의 구현 범위를 테이블로 정리한다:
- 39 (tauri-desktop-architecture) — 전체: Tauri 2 + React 18 + TailwindCSS 4, 8 화면(Dashboard, 거래 목록, 거래 상세, 에이전트 관리, 정책 관리, 세션 관리, 설정, Kill Switch), Sidecar(Node.js SEA), 시스템 트레이(3색 상태), Setup Wizard 5단계, WalletConnect(@reown/appkit)
- 40 (telegram-bot-docker) — 전체: Telegram Bot(Long Polling, 2-Tier auth, 인라인 키보드, 8개 명령어), Docker(Multi-stage Dockerfile, compose, named volume, non-root UID 1001, health check)
- 36 (killswitch-autostop-evm) — 부분: Kill Switch 3-state(ACTIVE/SUSPENDED/LOCKED) 6-step cascade + dual-auth 복구 + AutoStop Engine 5 규칙. EVM 어댑터 부분은 v1.4에서 이미 구현.

v0.10 설계를 반드시 반영한다:
- CONC-03: Kill Switch 4전이 CAS ACID 패턴 (ACTIVE→SUSPENDED, SUSPENDED→LOCKED, SUSPENDED→ACTIVE, LOCKED→ACTIVE)

각 문서에서 v1.6에서 구현할 구체적 범위와 구현하지 않는 범위를 상세히 기술한다.

**3. 산출물:** v1.0-implementation-planning.md의 산출물 테이블을 확장한다:
- Desktop App: Tauri 2 + React 18 + TailwindCSS 4, 8 화면 (각 화면별 주요 UI 컴포넌트와 API 연동 설명)
- Sidecar: Node.js SEA 바이너리, waiaas-daemon sidecar 프로세스, crash detection(max 3회 재시작), 35초 graceful 종료(SIGTERM→30초 대기→SIGKILL)
- 시스템 트레이: 3색 상태 아이콘(정상=녹색/대기=주황/긴급=빨강), 컨텍스트 메뉴(대시보드 열기/로그 보기/종료)
- Setup Wizard: 5단계(마스터 패스워드 설정→체인 선택→에이전트 생성→Owner 연결→완료)
- WalletConnect: @reown/appkit Tauri 통합, QR 코드 페어링, SIWS/SIWE 서명 요청
- Telegram Bot: Long Polling 구현, 2-Tier auth(관리자/읽기전용), 8개 명령어(/start, /status, /pending, /approve, /reject, /killswitch, /agents, /help), 인라인 키보드 UI
- Kill Switch: KillSwitchService — 3-state 상태 머신(ACTIVE/SUSPENDED/LOCKED), 6-step cascade(세션 무효화→거래 중단→에이전트 정지→API 503→알림→감사 로그), dual-auth 복구(Owner서명 + Master패스워드), 4전이 CAS ACID 패턴
- AutoStop Engine: AutoStopService — 5 규칙(DAILY_SPENDING_LIMIT, CONSECUTIVE_FAILURES, UNUSUAL_ACTIVITY, IDLE_TIMEOUT, MANUAL_TRIGGER), 이벤트 기반 트리거
- Docker: Multi-stage Dockerfile(builder→runner), docker-compose.yml(daemon+volume+health), named volume(~/.waiaas 데이터 영속), non-root UID 1001, HEALTHCHECK 설정

각 컴포넌트의 주요 파일/모듈 구조를 나열한다.

**4. 기술 결정 사항:**
- Tauri 2 + React 18 번들러: Vite (확정 — Tauri 기본)
- TailwindCSS 4 설정: JIT 모드 + 커스텀 디자인 토큰
- WalletConnect: @reown/appkit Tauri 바인딩 호환성 검증
- Telegram Bot 라이브러리: telegraf vs grammy vs node-telegram-bot-api
- Docker base 이미지: node:22-slim vs node:22-alpine
- Sidecar Node.js SEA 빌드: esbuild single-file → node --experimental-sea-config
- Kill Switch CAS 구현: SQLite BEGIN IMMEDIATE + UPDATE WHERE state = expected
- AutoStop 규칙 저장: config.toml vs DB policies 테이블

**5. E2E 검증 시나리오:** v1.0-implementation-planning.md의 E2E 섹션을 확장한다. v1.6은 [HUMAN] 5~8건이다:
- Docker: docker compose up → health check → SDK 거래 성공 [L1]
- Docker: named volume 영속성 — restart 후 데이터 유지 [L1]
- Docker: non-root UID 1001 — 프로세스 권한 확인 [L0]
- Kill Switch cascade: ACTIVE→SUSPENDED → 세션 무효화 + 거래 중단 + API 503 [L0]
- Kill Switch SUSPENDED→LOCKED → 복구 불가 상태 [L0]
- Kill Switch 복구: dual-auth(Owner서명 + Master패스워드) → ACTIVE 전환 [L0]
- Kill Switch CAS 동시성: 두 요청 동시 전이 → 하나만 성공 [L0]
- AutoStop: DAILY_SPENDING_LIMIT 초과 → 에이전트 자동 정지 [L0]
- AutoStop: CONSECUTIVE_FAILURES(5회) → 에이전트 자동 정지 [L0]
- Sidecar: 데몬 프로세스 crash → 자동 재시작 (max 3회) [L1]
- Sidecar: 35초 graceful 종료 → SIGTERM + WAL 체크포인트 [L1]
- Telegram Bot: /status → 데몬 상태 + 에이전트 요약 반환 [L0] (mock bot)
- Telegram Bot: /pending → 대기 중 거래 목록 반환 [L0] (mock bot)
- Telegram Bot: /approve {txId} → 거래 승인 + 상태 전이 [L0] (mock bot)
- Telegram Bot: 2-Tier auth — 관리자 승인, 읽기전용 조회만 가능 [L0]
- [HUMAN] Desktop: Setup Wizard 5단계 UX 적합성 (화면 전환, 입력 검증, 에러 표시)
- [HUMAN] Desktop: Dashboard 레이아웃 + 데이터 표시 정확성 (잔액, 거래, 에이전트)
- [HUMAN] Desktop: APPROVAL 거래 알림 → Owner 서명 → 승인 UI 흐름
- [HUMAN] Desktop: 시스템 트레이 3색 상태 아이콘 표시 + 컨텍스트 메뉴 동작
- [HUMAN] Desktop: Kill Switch 긴급 정지 UI → 확인 대화상자 → cascade 결과
- [HUMAN] Telegram: /pending → 인라인 키보드 → Approve/Reject 대화 흐름 자연스러움
- [HUMAN] Telegram: /killswitch → 확인 요청 → 실행 → 결과 알림 대화 흐름

**6. 의존:** v1.5 (DeFi + 가격 오라클)

**7. 리스크:**
- Node.js SEA + native addon(sodium-native, better-sqlite3) 크로스 플랫폼 호환성 (v0.7 prebuildify 전략 설계 완료, 구현 시 스파이크 필요)
- Tauri 2 + React 18 + @reown/appkit 호환성 (Tauri WebView 환경에서 WalletConnect 동작 미검증)
- Telegram Bot API Long Polling 안정성 (네트워크 단절 시 재연결 로직)
- Desktop UI/UX 수동 검증 비용 — 8화면 × 다중 상태 조합으로 [HUMAN] 항목 집중
- Docker image 크기 (native addon 포함 시 이미지 크기 증가) — multi-stage 빌드로 완화
- Kill Switch CAS 패턴 SQLite 성능 (BEGIN IMMEDIATE 잠금 범위)

**작성 규칙:**
- 한글로 작성
- v0.10 설계 결정(CONC-03 Kill Switch 4전이 CAS ACID)을 반드시 반영
- 설계 문서 번호와 이름을 정확히 기재
- 각 E2E 시나리오에 자동화 수준 태그 필수
- v1.4/v1.5에서 이미 구현된 부분과 v1.6에서 새로 추가하는 부분을 구분
- [HUMAN] 항목은 5~8건 범위 내에서 UI/UX 관련만 지정
  </action>
  <verify>
- objectives/v1.6-desktop-telegram-docker.md 파일이 존재한다
- 문서에 7개 섹션(목표, 구현 대상 설계 문서, 산출물, 기술 결정 사항, E2E 검증 시나리오, 의존, 리스크)이 모두 존재한다
- 구현 대상 설계 문서 테이블에 3개 문서(39, 40, 36)가 나열된다
- E2E 검증 시나리오에 [L0]/[L1] 태그가 부여되고, [HUMAN] 항목이 5~8건이다
- Kill Switch 4전이 CAS ACID 패턴 시나리오가 포함된다
- 리스크 섹션에 최소 2건 이상 기술적 위험이 식별된다
  </verify>
  <done>objectives/v1.6-desktop-telegram-docker.md가 부록 구조를 완전히 갖추고, 3개 설계 문서의 구현 범위가 명시되며, 22개 이상 E2E 검증 시나리오(15+ 자동화 + 5~8 [HUMAN])에 자동화 수준 태그가 부여되고, v0.10 CONC-03 Kill Switch CAS 패턴 시나리오가 포함된 상태</done>
</task>

</tasks>

<verification>
1. objectives/v1.5-defi-price-oracle.md 존재 + 7개 섹션 구조 확인
2. objectives/v1.6-desktop-telegram-docker.md 존재 + 7개 섹션 구조 확인
3. 두 문서 모두 설계 문서 테이블에 전체/부분 구분이 명시되어 있음
4. 모든 E2E 검증 시나리오에 [L0]~[L3] 또는 [HUMAN] 태그가 부여됨
5. v1.5의 [HUMAN] 1건 (Jupiter API Devnet 실 호출), v1.6의 [HUMAN] 5~8건 (Desktop/Telegram UI)
6. v1.5에 USD 기준 정책 평가 + 교차 검증 + 가격 나이 E2E 시나리오 포함
7. v1.6에 Kill Switch 4전이 CAS ACID 패턴 시나리오 포함
8. 두 문서 모두 리스크 섹션에 최소 2건 이상 기술적 위험 식별
</verification>

<success_criteria>
- objectives/v1.5-defi-price-oracle.md: 설계 문서 3개 참조, 컴포넌트 8개 산출물, E2E 18개+ 시나리오, [HUMAN] 1건, USD 정책 + Oracle fallback + 가격 나이 시나리오 포함
- objectives/v1.6-desktop-telegram-docker.md: 설계 문서 3개 참조, 컴포넌트 9개 산출물, E2E 22개+ 시나리오, [HUMAN] 5~8건, Kill Switch CAS + Docker + Sidecar 시나리오 포함
- 두 문서 모두 부록 구조(7개 섹션) 완전 준수 + 리스크 각 2건 이상
</success_criteria>

<output>
After completion, create `.planning/phases/46-ext-release-objectives/46-01-SUMMARY.md`
</output>
