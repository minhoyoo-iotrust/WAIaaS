# Milestone v0.3: 설계 논리 일관성 확보

**Status:** SHIPPED 2026-02-06
**Phases:** 10-13
**Total Plans:** 8

## Overview

v0.1(리서치 & 기획)과 v0.2(Self-Hosted 설계) 전체 산출물 40건을 크로스체크하여, 구현 단계 진입 전에 설계 문서 간 논리적 모순을 해소한다. Enum/상태값, 설정 스펙, API 스키마, 수치 기준을 단일 진실 소스(Single Source of Truth)로 통일한다.

**산출물:** 수정된 설계 문서, v0.1→v0.2 변경 매핑 문서, Enum/상태값 통합 대응표, 구현 노트

## Phases

### Phase 10: v0.1 잔재 정리

**Goal**: v0.2에서 대체된 v0.1 설계에 SUPERSEDED 표기를 추가하고, 변경 매핑 문서를 작성하여 잘못된 참조를 방지한다.
**Depends on**: v0.2 완료 (40개 설계 문서 분석)
**Requirements**: LEGACY-01, LEGACY-02, LEGACY-03, LEGACY-04, LEGACY-05, LEGACY-06, LEGACY-07, LEGACY-08, LEGACY-09
**Plans**: 2 plans

Plans:
- [x] 10-01-PLAN.md — v0.1 → v0.2 변경 매핑 문서 작성 + SUPERSEDED 표기 추가
- [x] 10-02-PLAN.md — 인터페이스명/에러코드/에스컬레이션 모델 대응표 작성

**Details:**
- 41-v01-v02-mapping.md: 40개 문서 간 대체/계승 관계 매핑
- 6개 v0.1 문서에 ADR 표준 SUPERSEDED 표기 (03, 09, 10, 15, 18, 19)
- 42-interface-mapping.md: IBlockchainAdapter → IChainAdapter 19메서드 대응표
- 43-error-code-mapping.md: RFC 9457 46개 → v0.2 36개 에러코드 매핑
- 44-escalation-mapping.md: 4단계 에스컬레이션 → 4-tier 정책 대응표

**Success Criteria:**
1. v0.1 → v0.2 변경 매핑 문서가 작성됨
2. v0.1 문서 중 v0.2에서 대체된 항목에 SUPERSEDED 표기 추가됨
3. IBlockchainAdapter → IChainAdapter 참조가 모든 문서에서 수정됨
4. v0.1의 Squads 메서드, RFC 9457 에러 코드, 4단계 에스컬레이션이 v0.2 대체 항목으로 매핑됨
5. 구현 시 참조해야 할 문서가 명확히 구분됨

---

### Phase 11: CRITICAL 의사결정 확정

**Goal**: 시스템의 기본 동작에 영향을 미치는 CRITICAL 모순 4건을 단일 값으로 확정하고 해당 설계 문서에 반영한다.
**Depends on**: Phase 10 (v0.1 잔재 정리 완료)
**Requirements**: CRIT-01, CRIT-02, CRIT-03, CRIT-04
**Plans**: 1 plan

Plans:
- [x] 11-01-PLAN.md — CRITICAL 4건 의사결정 확정 및 문서 반영 (C1, C2, C3, C8)

**Details:**
- CRIT-01: 기본 포트 3100 통일 (24-monorepo, 28-daemon 수정)
- CRIT-02: TransactionStatus 8개 SSoT + 클라이언트 표시 가이드 (37-rest-api)
- CRIT-03: WAIAAS_DAEMON_HOSTNAME 오버라이드 z.union 설계 (29-api, 24-monorepo, 40-telegram)
- CRIT-04: 자금 충전 Owner→Agent 직접 전송 문서화 (37-rest-api)

**Success Criteria:**
1. 기본 포트가 3100으로 통일됨
2. 트랜잭션 상태 Enum이 통일됨
3. Docker 바인딩 전략이 확정됨
4. 자금 충전 모델이 문서화됨

---

### Phase 12: HIGH 스키마/수치 통일

**Goal**: 문서 간 충돌하는 Enum, 수치, 스키마를 하나로 통일하고 config.toml 누락 설정을 추가한다.
**Depends on**: Phase 11 (CRITICAL 확정 완료)
**Requirements**: ENUM-01~04, CONF-01~05, API-01~06
**Plans**: 3 plans

Plans:
- [x] 12-01-PLAN.md — Enum/상태값 통합 대응표 작성 + SQLite CHECK 일치 검증
- [x] 12-02-PLAN.md — config.toml 누락 설정 추가 (jwt_secret, 임계값, 쿨다운 등)
- [x] 12-03-PLAN.md — REST API ↔ API Framework 스펙 통일 (CORS, Health, Rate Limiter, ownerAuth)

**Details:**
- 12-01: 9개 Enum 통합 대응표(45-enum-unified-mapping.md), AgentStatus 5개/PolicyType 4개 DB-REST 통일
- 12-02: session_ttl 86400, jwt_secret, nonce_cache, auto_stop, kill_switch, policy_defaults, rate_limit 3-level 추가
- 12-03: CORS tauri://localhost+X-Master-Password, Health healthy/unhealthy 통일, ownerAuth 9단계, memo 이중 검증

**Success Criteria:**
1. 모든 Enum/상태값이 SQLite CHECK 제약과 1:1로 대응하는 통합표 존재
2. 세션 TTL 24h, jwt_secret 필드가 config.toml에 추가됨
3. 연속 실패 임계값, Nonce 캐시 크기, Kill Switch 쿨다운이 config.toml에 설정화됨
4. 메모 길이 제한(200자/256 bytes)이 통일됨
5. REST API와 API Framework 간 CORS, Health, Rate Limiter, SuccessResponse가 일치
6. ownerAuth 미들웨어 상세가 REST API 스펙에 정의됨

---

### Phase 13: MEDIUM 구현 노트

**Goal**: 구현 시 주의해야 할 MEDIUM 사항 11건을 해당 v0.2 설계 문서에 "구현 노트" 섹션으로 추가한다.
**Depends on**: Phase 12 (HIGH 통일 완료)
**Requirements**: NOTE-01~11
**Plans**: 2 plans

Plans:
- [x] 13-01-PLAN.md — 단위 변환/매핑/패리티 구현 노트 (NOTE-01, 02, 03, 04, 08, 09, 10, 11)
- [x] 13-02-PLAN.md — 통합/인증/배포 구현 노트 (NOTE-05, 06, 07)

**Details:**
- 13-01: BalanceInfo 변환 규칙, 알림 채널-정책 연동, MCP 31개 패리티 매트릭스, SDK 36개 에러 타입, Docker shutdown 검증, 에이전트 상태 매핑, Python snake_case, 커서 페이지네이션
- 13-02: Tauri IPC+HTTP 에러 분류표, Setup Wizard vs CLI init 역할 분담, Telegram SIWS 대체(TELEGRAM_PRE_APPROVED)

**Success Criteria:**
1. BalanceInfo.amount lamports/SOL 변환 규칙 문서화
2. MCP 6개 도구 ↔ REST 31개 엔드포인트 기능 패리티 매트릭스 존재
3. SDK 에러 타입 매핑 전략 정의
4. 11개 구현 노트가 8개 설계 문서에 추가됨

---

## Milestone Summary

**Key Decisions:**

- 기본 포트 3100 확정 (3000/3001/8080 충돌 회피)
- hostname z.union 허용 (기본 127.0.0.1, Docker 0.0.0.0), WAIAAS_DAEMON_HOSTNAME 환경변수
- TransactionStatus DB 8개 SSoT + 클라이언트 상태+tier 조합 표시
- 자금 충전: Owner 외부 지갑 → Agent 직접 전송 (API 전용 엔드포인트 없음)
- session_ttl 86400 (24h) 통일, jwt_secret Zod min(32)
- rate_limit 3-level (global 100, session 300, tx 10 RPM)
- config.toml 중첩 섹션 (security.auto_stop, policy_defaults, kill_switch)
- Enum SSoT: DB CHECK = Drizzle ORM = Zod = TypeScript 1:1 대응
- CORS: tauri://localhost + X-Master-Password + X-RateLimit-* expose
- Health: healthy/degraded/unhealthy 통일
- ownerAuth 라우트 레벨 미들웨어, 9단계 순서
- memo 200자 + Solana 256 bytes 이중 검증
- MCP 미커버 24개는 "의도적" (보안 원칙)
- SDK 에러: 단일 WAIaaSError + code 필드, 서브클래스 불필요
- Telegram Tier 2: TELEGRAM_PRE_APPROVED 패턴 (SIWS는 Desktop/CLI 필수)

**Issues Resolved:**

- v0.1→v0.2 잔재 6개 문서 SUPERSEDED 처리
- 포트 3000/3100 충돌 해소
- Docker 127.0.0.1 바인딩 문제 해소
- TransactionStatus 14개→8개 혼선 해소
- AgentStatus REST-DB 불일치 해소 (KILL_SWITCH→SUSPENDED+reason)
- PolicyType Phase 6→Phase 8 변경 미반영 해소
- config.toml 11개 누락 설정 추가
- CORS/Health/Rate Limiter 양쪽 문서 불일치 해소

**Issues Deferred:** None

**Technical Debt Incurred:** None — 설계 일관성 확보 마일스톤으로 기술 부채 미발생

---

_For current project status, see .planning/ROADMAP.md_
