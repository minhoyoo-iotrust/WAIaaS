---
phase: 228-rest-api-sdk-mcp
plan: 02
type: execute
wave: 2
depends_on: ["228-01"]
files_modified:
  - packages/sdk/src/types.ts
  - packages/sdk/src/client.ts
  - packages/sdk/src/index.ts
  - python-sdk/waiaas/models.py
  - python-sdk/waiaas/client.py
autonomous: true
requirements:
  - API-04
  - API-05

must_haves:
  truths:
    - "TypeScript SDK listIncomingTransactions() returns IncomingTransactionListResponse with cursor pagination and filter params"
    - "TypeScript SDK getIncomingTransactionSummary() returns IncomingTransactionSummaryResponse with period param"
    - "Python SDK list_incoming_transactions() returns IncomingTransactionList with cursor pagination and filter params"
    - "Python SDK get_incoming_transaction_summary() returns IncomingTransactionSummary with period param"
  artifacts:
    - path: "packages/sdk/src/types.ts"
      provides: "TypeScript types for incoming TX list/summary responses and params"
      contains: "IncomingTransactionListResponse"
    - path: "packages/sdk/src/client.ts"
      provides: "Two new SDK methods for incoming transactions"
      contains: "listIncomingTransactions"
    - path: "python-sdk/waiaas/models.py"
      provides: "Pydantic models for incoming TX responses"
      contains: "IncomingTransactionList"
    - path: "python-sdk/waiaas/client.py"
      provides: "Two new Python SDK methods for incoming transactions"
      contains: "list_incoming_transactions"
  key_links:
    - from: "packages/sdk/src/client.ts"
      to: "GET /v1/wallet/incoming"
      via: "HTTP GET with URLSearchParams"
      pattern: "/v1/wallet/incoming"
    - from: "python-sdk/waiaas/client.py"
      to: "GET /v1/wallet/incoming"
      via: "httpx GET with params dict"
      pattern: "/v1/wallet/incoming"
---

<objective>
Add incoming transaction query methods to both the TypeScript and Python SDKs. Each SDK gets two new methods: one for listing incoming transactions (with pagination and filters) and one for getting period-based summaries.

Purpose: Enable programmatic access to incoming transaction data from both TypeScript and Python agent applications.
Output: Updated SDK type definitions, client methods, and Pydantic models.
</objective>

<execution_context>
@/Users/minho.yoo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/minho.yoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/228-rest-api-sdk-mcp/228-RESEARCH.md
@.planning/phases/228-rest-api-sdk-mcp/228-01-SUMMARY.md

# SDK source files
@packages/sdk/src/client.ts
@packages/sdk/src/types.ts
@packages/sdk/src/internal/http.ts
@packages/sdk/src/index.ts

# Python SDK source files
@python-sdk/waiaas/client.py
@python-sdk/waiaas/models.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add incoming TX types and methods to TypeScript SDK</name>
  <files>
    packages/sdk/src/types.ts
    packages/sdk/src/client.ts
    packages/sdk/src/index.ts
  </files>
  <action>
1. **Add types to packages/sdk/src/types.ts** (append before the final export or at end):

   a. `IncomingTransactionItem` interface:
      ```typescript
      export interface IncomingTransactionItem {
        id: string;
        txHash: string;
        walletId: string;
        fromAddress: string;
        amount: string;
        tokenAddress: string | null;
        chain: string;
        network: string;
        status: string;  // 'DETECTED' | 'CONFIRMED'
        blockNumber: number | null;
        detectedAt: number;
        confirmedAt: number | null;
        suspicious: boolean;
      }
      ```

   b. `IncomingTransactionListResponse` interface:
      ```typescript
      export interface IncomingTransactionListResponse {
        data: IncomingTransactionItem[];
        nextCursor: string | null;
        hasMore: boolean;
      }
      ```

   c. `ListIncomingTransactionsParams` interface:
      ```typescript
      export interface ListIncomingTransactionsParams {
        cursor?: string;
        limit?: number;
        chain?: string;
        network?: string;
        status?: 'DETECTED' | 'CONFIRMED';
        token?: string;
        fromAddress?: string;
        since?: number;
        until?: number;
        walletId?: string;
      }
      ```

   d. `IncomingSummaryEntry` interface:
      ```typescript
      export interface IncomingSummaryEntry {
        date: string;
        totalCount: number;
        totalAmountNative: string;
        totalAmountUsd: number | null;
        suspiciousCount: number;
      }
      ```

   e. `IncomingTransactionSummaryResponse` interface:
      ```typescript
      export interface IncomingTransactionSummaryResponse {
        period: string;
        entries: IncomingSummaryEntry[];
      }
      ```

   f. `GetIncomingTransactionSummaryParams` interface:
      ```typescript
      export interface GetIncomingTransactionSummaryParams {
        period?: 'daily' | 'weekly' | 'monthly';
        chain?: string;
        network?: string;
        since?: number;
        until?: number;
        walletId?: string;
      }
      ```

2. **Add methods to packages/sdk/src/client.ts:**

   a. Add imports for the new types at the top import block from `'./types.js'`:
      `IncomingTransactionListResponse`, `ListIncomingTransactionsParams`,
      `IncomingTransactionSummaryResponse`, `GetIncomingTransactionSummaryParams`

   b. Add `listIncomingTransactions` method to `WAIaaSClient` class (add in the "Wallet queries" section, or create a new "Incoming transactions" section):
      ```typescript
      async listIncomingTransactions(
        params?: ListIncomingTransactionsParams,
      ): Promise<IncomingTransactionListResponse> {
        const query = new URLSearchParams();
        if (params?.cursor) query.set('cursor', params.cursor);
        if (params?.limit) query.set('limit', String(params.limit));
        if (params?.chain) query.set('chain', params.chain);
        if (params?.network) query.set('network', params.network);
        if (params?.status) query.set('status', params.status);
        if (params?.token) query.set('token', params.token);
        if (params?.fromAddress) query.set('from_address', params.fromAddress);
        if (params?.since) query.set('since', String(params.since));
        if (params?.until) query.set('until', String(params.until));
        if (params?.walletId) query.set('wallet_id', params.walletId);
        const qs = query.toString();
        return withRetry(
          () => this.http.get<IncomingTransactionListResponse>(
            `/v1/wallet/incoming${qs ? `?${qs}` : ''}`,
            this.authHeaders(),
          ),
          this.retryOptions,
        );
      }
      ```

   c. Add `getIncomingTransactionSummary` method:
      ```typescript
      async getIncomingTransactionSummary(
        params?: GetIncomingTransactionSummaryParams,
      ): Promise<IncomingTransactionSummaryResponse> {
        const query = new URLSearchParams();
        if (params?.period) query.set('period', params.period);
        if (params?.chain) query.set('chain', params.chain);
        if (params?.network) query.set('network', params.network);
        if (params?.since) query.set('since', String(params.since));
        if (params?.until) query.set('until', String(params.until));
        if (params?.walletId) query.set('wallet_id', params.walletId);
        const qs = query.toString();
        return withRetry(
          () => this.http.get<IncomingTransactionSummaryResponse>(
            `/v1/wallet/incoming/summary${qs ? `?${qs}` : ''}`,
            this.authHeaders(),
          ),
          this.retryOptions,
        );
      }
      ```

3. **Update packages/sdk/src/index.ts** to re-export the new types:
   - Ensure `IncomingTransactionItem`, `IncomingTransactionListResponse`, `ListIncomingTransactionsParams`, `IncomingSummaryEntry`, `IncomingTransactionSummaryResponse`, `GetIncomingTransactionSummaryParams` are exported.
   - Check existing pattern: if index.ts does `export * from './types.js'` then no changes needed. If it exports selectively, add the new types.

4. **Update the JSDoc comment** at the top of client.ts to mention the new methods in the method list (add `listIncomingTransactions(), getIncomingTransactionSummary()` and update the method count from 19 to 21).
  </action>
  <verify>
    - `pnpm turbo run typecheck --filter=@waiaas/sdk` passes
    - `pnpm turbo run lint --filter=@waiaas/sdk` passes
    - The new types are exported from the package
    - The new methods exist on WAIaaSClient class
  </verify>
  <done>
    TypeScript SDK has listIncomingTransactions() and getIncomingTransactionSummary() methods with full type safety.
    All 6 new types exported from @waiaas/sdk.
    Client JSDoc updated to reflect 21 methods.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add incoming TX models and methods to Python SDK</name>
  <files>
    python-sdk/waiaas/models.py
    python-sdk/waiaas/client.py
  </files>
  <action>
1. **Add Pydantic models to python-sdk/waiaas/models.py** (append at end):

   a. `IncomingTransactionItem` model:
      ```python
      class IncomingTransactionItem(BaseModel):
          """A single incoming transaction."""
          id: str
          tx_hash: str = Field(alias="txHash")
          wallet_id: str = Field(alias="walletId")
          from_address: str = Field(alias="fromAddress")
          amount: str
          token_address: Optional[str] = Field(default=None, alias="tokenAddress")
          chain: str
          network: str
          status: str
          block_number: Optional[int] = Field(default=None, alias="blockNumber")
          detected_at: int = Field(alias="detectedAt")
          confirmed_at: Optional[int] = Field(default=None, alias="confirmedAt")
          suspicious: bool = False
          model_config = ConfigDict(populate_by_name=True)
      ```

   b. `IncomingTransactionList` model:
      ```python
      class IncomingTransactionList(BaseModel):
          """Paginated list of incoming transactions."""
          data: list[IncomingTransactionItem]
          next_cursor: Optional[str] = Field(default=None, alias="nextCursor")
          has_more: bool = Field(alias="hasMore")
          model_config = ConfigDict(populate_by_name=True)
      ```

   c. `IncomingSummaryEntry` model:
      ```python
      class IncomingSummaryEntry(BaseModel):
          """A single period entry in the incoming transaction summary."""
          date: str
          total_count: int = Field(alias="totalCount")
          total_amount_native: str = Field(alias="totalAmountNative")
          total_amount_usd: Optional[float] = Field(default=None, alias="totalAmountUsd")
          suspicious_count: int = Field(alias="suspiciousCount")
          model_config = ConfigDict(populate_by_name=True)
      ```

   d. `IncomingTransactionSummary` model:
      ```python
      class IncomingTransactionSummary(BaseModel):
          """Period-based incoming transaction summary."""
          period: str
          entries: list[IncomingSummaryEntry]
          model_config = ConfigDict(populate_by_name=True)
      ```

   Note: Check if `ConfigDict` is already imported. If the existing models use `model_config = {"populate_by_name": True}` dict literal instead of `ConfigDict`, use the same pattern for consistency.

2. **Add methods to python-sdk/waiaas/client.py:**

   a. Add imports for new models at the top:
      `IncomingTransactionList`, `IncomingTransactionSummary`

   b. Add `list_incoming_transactions` method in the "Wallet API" or new "Incoming Transactions" section:
      ```python
      async def list_incoming_transactions(
          self,
          *,
          limit: int = 20,
          cursor: Optional[str] = None,
          chain: Optional[str] = None,
          network: Optional[str] = None,
          status: Optional[str] = None,
          token: Optional[str] = None,
          from_address: Optional[str] = None,
          since: Optional[int] = None,
          until: Optional[int] = None,
          wallet_id: Optional[str] = None,
      ) -> IncomingTransactionList:
          """GET /v1/wallet/incoming -- List incoming transactions.

          Args:
              limit: Max transactions to return (1-100, default 20).
              cursor: Pagination cursor from previous response.
              chain: Filter by chain ('solana' or 'ethereum').
              network: Filter by network.
              status: Filter by status ('DETECTED' or 'CONFIRMED'). Default: 'CONFIRMED'.
              token: Filter by token address.
              from_address: Filter by sender address.
              since: Filter transactions detected after this epoch (seconds).
              until: Filter transactions detected before this epoch (seconds).
              wallet_id: Target wallet ID (multi-wallet sessions).
          """
          params: dict[str, Any] = {"limit": limit}
          if cursor is not None:
              params["cursor"] = cursor
          if chain is not None:
              params["chain"] = chain
          if network is not None:
              params["network"] = network
          if status is not None:
              params["status"] = status
          if token is not None:
              params["token"] = token
          if from_address is not None:
              params["from_address"] = from_address
          if since is not None:
              params["since"] = since
          if until is not None:
              params["until"] = until
          if wallet_id is not None:
              params["wallet_id"] = wallet_id
          resp = await self._request("GET", "/v1/wallet/incoming", params=params)
          return IncomingTransactionList.model_validate(resp.json())
      ```

   c. Add `get_incoming_transaction_summary` method:
      ```python
      async def get_incoming_transaction_summary(
          self,
          *,
          period: str = "daily",
          chain: Optional[str] = None,
          network: Optional[str] = None,
          since: Optional[int] = None,
          until: Optional[int] = None,
          wallet_id: Optional[str] = None,
      ) -> IncomingTransactionSummary:
          """GET /v1/wallet/incoming/summary -- Get incoming transaction summary.

          Args:
              period: Aggregation period ('daily', 'weekly', or 'monthly'). Default: 'daily'.
              chain: Filter by chain.
              network: Filter by network.
              since: Filter start epoch (seconds).
              until: Filter end epoch (seconds).
              wallet_id: Target wallet ID (multi-wallet sessions).
          """
          params: dict[str, Any] = {"period": period}
          if chain is not None:
              params["chain"] = chain
          if network is not None:
              params["network"] = network
          if since is not None:
              params["since"] = since
          if until is not None:
              params["until"] = until
          if wallet_id is not None:
              params["wallet_id"] = wallet_id
          resp = await self._request("GET", "/v1/wallet/incoming/summary", params=params)
          return IncomingTransactionSummary.model_validate(resp.json())
      ```
  </action>
  <verify>
    - `pnpm turbo run typecheck --filter=@waiaas/sdk` passes (TS SDK)
    - Python models have proper Field aliases and model_config
    - Python client methods follow the existing pattern (_request + model_validate)
    - Run `cd python-sdk && python -c "from waiaas.models import IncomingTransactionList, IncomingTransactionSummary; print('OK')"` to verify import works
  </verify>
  <done>
    Python SDK has list_incoming_transactions() and get_incoming_transaction_summary() with Pydantic models.
    Both SDKs follow existing patterns (URLSearchParams/params dict, retry wrappers, typed responses).
  </done>
</task>

</tasks>

<verification>
1. `pnpm turbo run typecheck --filter=@waiaas/sdk` — zero type errors
2. `pnpm turbo run lint --filter=@waiaas/sdk` — zero lint warnings
3. Python imports work: `from waiaas.models import IncomingTransactionList, IncomingTransactionSummary`
4. TypeScript SDK exports 6 new types from package entry point
5. Both SDKs have 2 new methods each matching the API endpoints from Plan 228-01
</verification>

<success_criteria>
- TypeScript SDK WAIaaSClient has listIncomingTransactions() and getIncomingTransactionSummary() methods
- Python SDK WAIaaSClient has list_incoming_transactions() and get_incoming_transaction_summary() methods
- All types/models match the API response schemas from 228-01
- Filter params and pagination fully supported in both SDKs
- Both SDKs compile/import without errors
</success_criteria>

<output>
After completion, create `.planning/phases/228-rest-api-sdk-mcp/228-02-SUMMARY.md`
</output>
