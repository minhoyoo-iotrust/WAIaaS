# Requirements Archive: WAIaaS v1.5.1

**Defined:** 2026-02-15
**Archived:** 2026-02-15
**Status:** All 39 v1 requirements satisfied

## v1 Requirements (All Complete)

### Core Infrastructure (X4CORE) — Phase 130

- [x] **X4CORE-01**: @x402/core 의존성 추가 + PaymentRequirements/PaymentPayload Zod 스키마 import로 x402 v2 타입 시스템 구축
- [x] **X4CORE-02**: TransactionType에 X402_PAYMENT 6번째 타입 추가 (기존 discriminatedUnion과 별도, DB 기록용)
- [x] **X4CORE-03**: PolicyType에 X402_ALLOWED_DOMAINS 12번째 타입 추가
- [x] **X4CORE-04**: CAIP-2 → WAIaaS NetworkType 매핑 테이블 정의 (eip155:1 → ethereum-mainnet 등 8개)
- [x] **X4CORE-05**: X402FetchRequest/Response Zod 스키마 정의 (url, method, headers, body → status, headers, body, payment)
- [x] **X4CORE-06**: DB 마이그레이션 v12 — transactions CHECK 제약에 X402_PAYMENT 추가, policies type에 X402_ALLOWED_DOMAINS 추가
- [x] **X4CORE-07**: x402 전용 에러 코드 8개 정의

### Security (X4SEC) — Phase 131

- [x] **X4SEC-01**: SSRF 가드 — DNS 사전 해석 + 사설 IP/localhost/링크 로컬/loopback 차단
- [x] **X4SEC-02**: SSRF 가드 — IPv4-mapped IPv6, 옥탈, 16진수 우회 벡터 차단
- [x] **X4SEC-03**: SSRF 가드 — 리다이렉트 매 hop에서 대상 IP 재검증 (최대 3회 리다이렉트)
- [x] **X4SEC-04**: SSRF 가드 — HTTPS 강제, HTTP URL 거부
- [x] **X4SEC-05**: 도메인 검증 — URL 정규화

### x402 Handler (X4HAND) — Phase 131

- [x] **X4HAND-01**: HTTP 402 응답 파싱 — PAYMENT-REQUIRED 헤더에서 PaymentRequirements 추출 + Zod 검증
- [x] **X4HAND-02**: (scheme, network) 쌍 자동 선택
- [x] **X4HAND-03**: 비-402 응답 패스스루
- [x] **X4HAND-04**: 결제 서명 재요청
- [x] **X4HAND-05**: 재시도 제한 — 결제 후 다시 402 수신 시 X402_PAYMENT_REJECTED 에러
- [x] **X4HAND-06**: 결제 실패 에러 처리

### Payment Signing (X4SIGN) — Phase 131

- [x] **X4SIGN-01**: EVM EIP-3009 transferWithAuthorization 서명
- [x] **X4SIGN-02**: Solana SPL TransferChecked 부분 서명
- [x] **X4SIGN-03**: 키 관리 패턴 — 키스토어 복호화 → 서명 → sodium_memzero 해제
- [x] **X4SIGN-04**: EIP-3009 validBefore 5분 설정 + nonce 랜덤 생성

### Policy Integration (X4POL) — Phase 132

- [x] **X4POL-01**: X402_ALLOWED_DOMAINS 정책 평가 — 기본 거부, 도메인 화이트리스트 매칭
- [x] **X4POL-02**: 와일드카드 도메인 매칭 — dot-boundary 엄격 검증
- [x] **X4POL-03**: 기존 SPENDING_LIMIT 4-tier 평가 통합
- [x] **X4POL-04**: USDC $1 직접 환산 + 기타 토큰 IPriceOracle USD 환산
- [x] **X4POL-05**: DELAY 티어 — request_timeout 내 대기, 초과 시 거부
- [x] **X4POL-06**: APPROVAL 티어 — 즉시 거부
- [x] **X4POL-07**: reserved_amount 누적에 x402 결제 포함 — TOCTOU 방지
- [x] **X4POL-08**: Kill Switch 활성 시 x402 결제 포함 모든 거래 차단

### API + Config (X4API) — Phase 132

- [x] **X4API-01**: POST /v1/x402/fetch 엔드포인트 — sessionAuth 보호
- [x] **X4API-02**: x402 결제 내역 transactions 테이블 기록 — type=X402_PAYMENT
- [x] **X4API-03**: config.toml [x402] 섹션 — enabled, request_timeout
- [x] **X4API-04**: 기존 알림 트리거 연동

### DX Integration (X4DX) — Phase 133

- [x] **X4DX-01**: TS SDK WAIaaSClient.x402Fetch(url, options?)
- [x] **X4DX-02**: Python SDK WAIaaSClient.x402_fetch(url, options?)
- [x] **X4DX-03**: MCP x402_fetch 도구
- [x] **X4DX-04**: x402.skill.md 스킬 파일 + MCP 스킬 리소스 등록
- [x] **X4DX-05**: transactions.skill.md x402 결제 내역 조회 반영

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| X4CORE-01~07 | Phase 130 | Done |
| X4SEC-01~05 | Phase 131 | Done |
| X4HAND-01~06 | Phase 131 | Done |
| X4SIGN-01~04 | Phase 131 | Done |
| X4POL-01~08 | Phase 132 | Done |
| X4API-01~04 | Phase 132 | Done |
| X4DX-01~05 | Phase 133 | Done |

**Coverage:** 39/39 requirements satisfied (100%)

---
*Requirements archived: 2026-02-15*
