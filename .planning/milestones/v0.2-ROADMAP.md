# Milestone v0.2: Self-Hosted Secure Wallet Design

**Status:** SHIPPED 2026-02-05
**Phases:** 6-9
**Total Plans:** 16

## Overview

중앙 서버 없이 사용자가 직접 설치하여 운영하는 에이전트 지갑 시스템의 상세 설계를 완성한다. 체인 무관 3계층 보안 모델의 프로토콜, 데이터 모델, 인터페이스를 구현 가능한 수준으로 정의한다.

**산출물:** 17개 상세 설계 문서 (Markdown), ~32,000 lines

## Phases

### Phase 6: Core Architecture Design

**Goal**: Self-Hosted 데몬의 기반 아키텍처를 설계한다 — 모노레포 패키지 구조, 암호화 키스토어 파일 포맷/프로토콜, SQLite 스키마, 데몬 라이프사이클, 체인 추상화 인터페이스를 구현 가능한 수준으로 정의한다.

**Depends on**: v0.1 Research & Design (설계 문서 활용, 특히 ARCH-01~05)
**Requirements**: KEYS-01, KEYS-02, KEYS-03, KEYS-04, CHAIN-01, CLI-01, CLI-02, CLI-03, CLI-04, API-01, API-06
**Plans**: 5 plans

**Success Criteria:**
1. 암호화 키스토어 파일 포맷이 바이트 수준으로 정의됨
2. SQLite 스키마가 테이블/인덱스/마이그레이션 수준으로 정의됨
3. 데몬 라이프사이클이 시퀀스 다이어그램으로 문서화됨
4. ChainAdapter 인터페이스가 TypeScript 타입 정의 수준으로 설계됨
5. 모노레포 패키지 구조와 `~/.waiaas/` 데이터 디렉토리 레이아웃이 확정됨

Plans:
- [x] 06-01-PLAN.md — 모노레포 구조 + 데이터 디렉토리 + SQLite 스키마 설계
- [x] 06-02-PLAN.md — 암호화 키스토어 스펙 설계 (파일 포맷, 키 파생, 메모리 안전성 프로토콜)
- [x] 06-03-PLAN.md — ChainAdapter 인터페이스 설계 + Solana/EVM 어댑터 명세
- [x] 06-04-PLAN.md — 데몬 라이프사이클 + CLI 커맨드 설계 (init/start/stop/status)
- [x] 06-05-PLAN.md — Hono API 프레임워크 설계 + localhost 보안 + Zod/OpenAPI 통합 설계

**Deliverables:** CORE-01~CORE-06 (24-29.md)

---

### Phase 7: Session & Transaction Protocol Design

**Goal**: 에이전트 세션 인증 프로토콜과 거래 처리 파이프라인을 상세 설계한다 — JWT 토큰 구조, SIWS/SIWE 승인 플로우, 세션 제약 모델, 거래 6단계 파이프라인, Solana 어댑터 상세를 정의한다.

**Depends on**: Phase 6 (키스토어 스펙, API 프레임워크, ChainAdapter 인터페이스)
**Requirements**: SESS-01, SESS-02, SESS-03, SESS-04, SESS-05, API-02, API-03, API-04, CHAIN-02
**Plans**: 3 plans

**Success Criteria:**
1. 세션 토큰 프로토콜이 완전히 정의됨
2. 세션 제약 모델이 데이터 모델 수준으로 정의됨
3. 거래 처리 파이프라인 6단계가 시퀀스 다이어그램으로 문서화됨
4. Solana Adapter가 @solana/kit 3.x 기반으로 상세 설계됨
5. 세션/거래 API 엔드포인트가 요청/응답 스키마 수준으로 설계됨

Plans:
- [x] 07-01-PLAN.md — 세션 토큰 프로토콜 설계 (JWT 구조, SIWS/SIWE 플로우, 제약 모델, 수명주기, sessionAuth 미들웨어)
- [x] 07-02-PLAN.md — Solana Adapter 상세 설계 (@solana/kit pipe API, 13개 메서드 구현, 에러 매핑)
- [x] 07-03-PLAN.md — 거래 처리 파이프라인 6단계 설계 + 세션/거래/지갑 API 엔드포인트 Zod 스펙

**Deliverables:** SESS-PROTO, CHAIN-SOL, TX-PIPE (30-32.md)

---

### Phase 8: Security Layers Design

**Goal**: 3계층 보안의 핵심인 시간 지연/승인 메커니즘, 멀티 채널 알림 아키텍처, Owner 지갑 연결 플로우, Kill Switch 프로토콜을 상세 설계한다.

**Depends on**: Phase 7 (세션 프로토콜, 거래 파이프라인)
**Requirements**: LOCK-01, LOCK-02, LOCK-03, LOCK-04, NOTI-01, NOTI-02, NOTI-03, NOTI-04, NOTI-05, OWNR-01, OWNR-02, OWNR-03, API-05, CHAIN-03
**Plans**: 4 plans

**Success Criteria:**
1. 4-티어 시간 지연 메커니즘이 상태 머신으로 정의됨
2. Owner 지갑 연결 플로우가 시퀀스 다이어그램으로 문서화됨
3. 멀티 채널 알림 아키텍처가 설계됨
4. Kill Switch 프로토콜이 캐스케이드 순서로 정의됨
5. 자동 정지 규칙 엔진 스펙이 정의됨

Plans:
- [x] 08-01-PLAN.md — 시간 지연 + 승인 메커니즘 설계 (DatabasePolicyEngine, 4-티어 상태 머신, DELAY/APPROVAL 플로우, TOCTOU 방지)
- [x] 08-02-PLAN.md — Owner 지갑 연결 플로우 설계 (WalletConnect v2 Reown, ownerAuth 미들웨어, Owner 전용 API)
- [x] 08-03-PLAN.md — 멀티 채널 알림 아키텍처 설계 (INotificationChannel, Telegram/Discord/ntfy.sh, 전달 추적, 폴백)
- [x] 08-04-PLAN.md — Kill Switch 프로토콜 + 자동 정지 규칙 엔진 + EVM Adapter stub 설계

**Deliverables:** LOCK-MECH, OWNR-CONN, NOTI-ARCH, KILL-AUTO-EVM (33-36.md)

---

### Phase 9: Integration & Client Interface Design

**Goal**: 외부 통합 인터페이스(REST API, SDK, MCP)와 사용자 클라이언트(Desktop 앱, Telegram 봇, Docker)의 상세 설계를 완성한다.

**Depends on**: Phase 8 (3계층 보안 설계 완성)
**Requirements**: MCP-01, MCP-02, SDK-01, SDK-02, DESK-01, DESK-02, DESK-03, DESK-04, DOCK-01, TGBOT-01, TGBOT-02
**Plans**: 4 plans

**Success Criteria:**
1. REST API 전체 스펙이 완성됨
2. TypeScript SDK + Python SDK 인터페이스가 메서드 시그니처 수준으로 설계됨
3. MCP Server 도구/리소스가 정의됨
4. Tauri Desktop 앱 아키텍처가 설계됨
5. Telegram 인터랙티브 봇 명령/인라인 키보드 설계 + Docker 배포 스펙이 정의됨

Plans:
- [x] 09-01-PLAN.md — REST API 완전 스펙 + Owner 전용 API + 에러 코드 체계 + OpenAPI 3.0 구조
- [x] 09-02-PLAN.md — TypeScript/Python SDK 인터페이스 + MCP Server 도구/리소스/전송 설계
- [x] 09-03-PLAN.md — Tauri Desktop 앱 아키텍처 + Sidecar + 시스템 트레이 + UI 8화면 플로우
- [x] 09-04-PLAN.md — Telegram 인터랙티브 봇 (2-tier 승인 모델) + Docker 배포 스펙

**Deliverables:** REST-API, SDK-MCP, TAURI-DESK, TGBOT-DOCKER (37-40.md)

---

## Milestone Summary

**Key Decisions:**
- Cloud-First → Self-Hosted-First pivot (no AWS/central server dependency)
- Chain-agnostic 3-layer security (Session Auth → Time-Lock/Approval → Monitoring/Kill Switch)
- Tech stack: Hono 4.x, Drizzle ORM + SQLite, sodium-native, jose (JWT), Tauri 2.x
- JWT HS256 sessions with SIWS/SIWE Owner auth, per-request signatures for Owner operations
- DatabasePolicyEngine with 4-tier thresholds (INSTANT/NOTIFY/DELAY/APPROVAL)
- WalletConnect v2 via Reown for Owner wallet connection
- Kill Switch 3-state cascade with dual-auth recovery
- MCP 6 tools + 3 resources, stdio transport
- Tauri 2.x Sidecar with Node.js SEA
- Telegram Bot Long Polling with 2-Tier auth model
- Docker named volume + non-root 1001

**Issues Resolved:**
- WalletConnect v2 → Reown rebranding handled in Phase 8
- Tauri WebView WebHID compatibility → solved with WalletConnect QR
- MCP auth model → WAIAAS_SESSION_TOKEN env var
- SQLite schema extensions across phases → migration path documented

**Issues Deferred:**
- Node.js SEA + native addon cross-compilation (v0.3 spike)
- EVM Adapter full implementation (v0.3)
- Streamable HTTP MCP transport (v0.3)
- SPL token support (v0.3)

**Technical Debt:**
- CORE-02 schema lacks Phase 8 extensions (reserved_amount, notification_channels changes, system_state table)
- EvmAdapterStub throws for all 13 methods (intentional, v0.3)

---

_For current project status, see .planning/ROADMAP.md_
_Archived: 2026-02-05_
