# Requirements Archive: v0.6 블록체인 기능 확장 설계

**Archived:** 2026-02-08
**Status:** ✅ SHIPPED

This is the archived requirements specification for v0.6.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

# Requirements: WAIaaS v0.6 블록체인 기능 확장 설계

**Defined:** 2026-02-07
**Core Value:** AI 에이전트가 안전하고 자율적으로 온체인 거래를 수행할 수 있어야 한다 — 동시에 에이전트 주인이 자금 통제권을 유지하면서.

## v0.6 Requirements

네이티브 토큰 전송에 한정된 IChainAdapter와 트랜잭션 파이프라인을 확장하여, SPL/ERC-20 토큰 전송, 자산 조회, 임의 컨트랙트 호출, DeFi 액션 추상화까지 설계 수준에서 정의한다.

### 토큰 확장 (TOKEN)

- [x] **TOKEN-01**: TransferRequest에 token 필드를 추가하여 SPL/ERC-20 토큰 전송을 설계한다 (하위 호환: undefined = 네이티브) — ✓ docs/56
- [x] **TOKEN-02**: ALLOWED_TOKENS 정책 규칙을 설계한다 (에이전트별 토큰 민트/컨트랙트 화이트리스트, 미등록 토큰 거부) — ✓ docs/56
- [x] **TOKEN-03**: getAssets() 인터페이스를 복원하고 AssetInfo 스키마를 확정한다 (Solana getTokenAccountsByOwner, EVM 프로바이더별 방식) — ✓ docs/57
- [x] **TOKEN-04**: 토큰 전송 수수료 추정을 확장 설계한다 (Solana ATA 생성 비용, EVM ERC-20 gas 추정) — ✓ docs/57
- [x] **TOKEN-05**: SPL/ERC-20 토큰 전송의 테스트 레벨/Mock/보안 시나리오를 정의한다 — ✓ docs/57

### 컨트랙트 호출 (CONTRACT)

- [x] **CONTRACT-01**: ContractCallRequest 인터페이스를 설계한다 (EVM calldata, Solana programId+instructionData+accounts) — ✓ docs/58
- [x] **CONTRACT-02**: CONTRACT_WHITELIST, METHOD_WHITELIST 정책 규칙을 설계한다 (기본 전면 거부, opt-in 화이트리스트) — ✓ docs/58
- [x] **CONTRACT-03**: 파이프라인 Stage 1 type 분기(TRANSFER/CONTRACT_CALL)와 Stage 2 세션 제약(allowedContracts) 확장을 설계한다 — ✓ docs/58
- [x] **CONTRACT-04**: transactions 테이블 type Enum 확장(CONTRACT_CALL, APPROVE, BATCH)과 감사 컬럼(contract_address, method_signature)을 설계한다 — ✓ docs/58
- [x] **CONTRACT-05**: 임의 컨트랙트 호출의 테스트 레벨/Mock/보안 시나리오를 정의한다 (악성 calldata, 미허용 method signature 등) — ✓ docs/58

### 토큰 승인 (APPROVE)

- [x] **APPROVE-01**: ApproveRequest를 독립 타입으로 설계한다 (ContractCall과 분리 — 권한 위임은 별도 정책 카테고리) — ✓ docs/59
- [x] **APPROVE-02**: APPROVED_SPENDERS, APPROVE_AMOUNT_LIMIT, APPROVE_TIER_OVERRIDE 정책 규칙을 설계한다 (무제한 approve 차단) — ✓ docs/59
- [x] **APPROVE-03**: 토큰 Approve의 테스트 레벨/Mock/보안 시나리오를 정의한다 (무제한 approve, 미허용 spender 등) — ✓ docs/59

### 배치 트랜잭션 (BATCH)

- [x] **BATCH-01**: BatchRequest 및 InstructionRequest 인터페이스를 설계한다 (Solana 원자적 배치, EVM 미지원 분기) — ✓ docs/60
- [x] **BATCH-02**: 배치 정책 평가 규칙을 설계한다 (금액 합산 티어 결정, All-or-Nothing 정책 위반 처리) — ✓ docs/60
- [x] **BATCH-03**: 멀티 instruction 배치의 테스트 레벨/Mock/보안 시나리오를 정의한다 (배치 크기 제한, 부분 위반 등) — ✓ docs/60

### 가격 오라클 (ORACLE)

- [x] **ORACLE-01**: IPriceOracle 인터페이스를 설계한다 (CoinGecko/Pyth/Chainlink 구현 옵션, PriceInfo 스키마) — ✓ docs/61
- [x] **ORACLE-02**: 오라클 캐싱 전략(5분 TTL)과 fallback 동작(stale 허용 vs 거부)을 설계한다 — ✓ docs/61
- [x] **ORACLE-03**: USD 기준 정책 평가 확장을 설계한다 (기존 네이티브 금액 기준 → USD 금액 기준 티어 분류) — ✓ docs/61
- [x] **ORACLE-04**: 가격 오라클의 테스트 레벨/Mock/보안 시나리오를 정의한다 (가격 조작, 오라클 장애 등) — ✓ docs/61

### Action Provider (ACTION)

- [x] **ACTION-01**: IActionProvider 인터페이스를 설계한다 (resolve-then-execute 패턴, ActionDefinition Zod 스키마) — ✓ docs/62
- [x] **ACTION-02**: ActionDefinition → MCP Tool 자동 변환 메커니즘을 설계한다 (name/description/inputSchema 매핑) — ✓ docs/62
- [x] **ACTION-03**: Action Provider 플러그인 로드 메커니즘을 설계한다 (~/.waiaas/actions/ 디렉토리, 보안 경계) — ✓ docs/62
- [x] **ACTION-04**: Jupiter Swap Action Provider를 상세 설계한다 (quote API → ContractCallRequest 변환, 슬리피지, MEV 보호) — ✓ docs/63
- [x] **ACTION-05**: Action Provider의 테스트 레벨/Mock/보안 시나리오를 정의한다 (악성 플러그인, 슬리피지 조작 등) — ✓ docs/62, docs/63

### 테스트 전략 통합 (TEST)

- [x] **TEST-01**: v0.4 테스트 프레임워크에 새 Mock 경계 5개를 추가 설계한다 (Aggregator, 가격 API, 온체인 오라클, IPriceOracle, IActionProvider) — ✓ docs/64
- [x] **TEST-02**: EVM 로컬 테스트 환경(Hardhat/Anvil)을 설계에 포함한다 (ERC-20 배포, Uniswap fork) — ✓ docs/64
- [x] **TEST-03**: 확장 패키지(@waiaas/actions 등)를 포함하여 커버리지 기준을 재설정한다 — ✓ docs/64

### 기존 문서 통합 (INTEG)

- [x] **INTEG-01**: 기존 설계 문서 8개에 v0.6 확장을 반영한다 (27, 25, 31, 33, 32, 37, 38, 45) — ✓ Phase 25 plans 02-04
- [x] **INTEG-02**: TransactionType, PolicyType 등 Enum 확장을 v0.3 SSoT 체계(45-enum)에 통합한다 — ✓ Phase 25 plan 02

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| TOKEN-01 | Phase 22 | ✓ Complete |
| TOKEN-02 | Phase 22 | ✓ Complete |
| TOKEN-03 | Phase 22 | ✓ Complete |
| TOKEN-04 | Phase 22 | ✓ Complete |
| TOKEN-05 | Phase 22 | ✓ Complete |
| CONTRACT-01 | Phase 23 | ✓ Complete |
| CONTRACT-02 | Phase 23 | ✓ Complete |
| CONTRACT-03 | Phase 23 | ✓ Complete |
| CONTRACT-04 | Phase 23 | ✓ Complete |
| CONTRACT-05 | Phase 23 | ✓ Complete |
| APPROVE-01 | Phase 23 | ✓ Complete |
| APPROVE-02 | Phase 23 | ✓ Complete |
| APPROVE-03 | Phase 23 | ✓ Complete |
| BATCH-01 | Phase 23 | ✓ Complete |
| BATCH-02 | Phase 23 | ✓ Complete |
| BATCH-03 | Phase 23 | ✓ Complete |
| ORACLE-01 | Phase 24 | ✓ Complete |
| ORACLE-02 | Phase 24 | ✓ Complete |
| ORACLE-03 | Phase 24 | ✓ Complete |
| ORACLE-04 | Phase 24 | ✓ Complete |
| ACTION-01 | Phase 24 | ✓ Complete |
| ACTION-02 | Phase 24 | ✓ Complete |
| ACTION-03 | Phase 24 | ✓ Complete |
| ACTION-04 | Phase 24 | ✓ Complete |
| ACTION-05 | Phase 24 | ✓ Complete |
| TEST-01 | Phase 25 | ✓ Complete |
| TEST-02 | Phase 25 | ✓ Complete |
| TEST-03 | Phase 25 | ✓ Complete |
| INTEG-01 | Phase 25 | ✓ Complete |
| INTEG-02 | Phase 25 | ✓ Complete |

---

## Milestone Summary

**Shipped:** 30 of 30 v0.6 requirements
**Adjusted:** None — all requirements delivered as originally specified
**Dropped:** None

---
*Archived: 2026-02-08 as part of v0.6 milestone completion*
