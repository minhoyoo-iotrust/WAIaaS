# Milestone v0.5: 인증 모델 재설계 + DX 개선

**Status:** ✅ SHIPPED 2026-02-07
**Phases:** 19-21
**Total Plans:** 9

## Overview

v0.2에서 설계한 인증 모델을 masterAuth/ownerAuth/sessionAuth 3-tier로 재분리하고, Owner 주소를 시스템 전역에서 에이전트별 속성으로 이동하며, 세션 낙관적 갱신 프로토콜을 추가하고, CLI 개발자 경험을 개선한다. 기존 설계 문서 11개를 수정하고 신규 스펙 문서 4개를 추가하는 설계 마일스톤이다. 24개 요구사항을 3개 페이즈에 걸쳐 순차적으로 해결한다.

## Phases

### Phase 19: 인증 모델 + Owner 주소 재설계

**Goal**: masterAuth/ownerAuth/sessionAuth 3-tier 인증 수단의 책임이 분리되고, Owner 주소가 에이전트별 속성으로 이동하여, 모든 엔드포인트의 인증 맵이 재배치된 상태
**Depends on**: Nothing (v0.5 첫 페이즈)
**Plans**: 3 plans

Plans:
- [x] 19-01: 3-tier 인증 모델 정의 + 31 엔드포인트 인증 맵 + 보안 비다운그레이드 검증
- [x] 19-02: Owner 주소 에이전트 귀속 (agents.owner_address NOT NULL) + wallet_connections + config.toml
- [x] 19-03: 기존 설계 문서 반영 (34-owner-wallet-connection.md + 37-rest-api-complete-spec.md)

**Details:**
- 신규: 52-auth-model-redesign.md (masterAuth/ownerAuth/sessionAuth 3-tier 정의)
- 수정 (대규모): 34-owner-wallet-connection.md
- 수정 (중규모): 25-sqlite-schema.md, 37-rest-api-complete-spec.md
- 수정 (소규모): 24-monorepo-data-directory.md
- Requirements: AUTH-01~05, OWNR-01~06

### Phase 20: 세션 갱신 프로토콜

**Goal**: 에이전트가 sessionAuth만으로 세션을 갱신할 수 있고, 안전 장치 5종과 Owner 사후 거부 메커니즘이 정의된 상태
**Depends on**: Phase 19
**Plans**: 2 plans

Plans:
- [x] 20-01: 핵심 프로토콜 정의 (53-session-renewal-protocol.md 신규) + 30-session-token-protocol.md 수명주기 확장
- [x] 20-02: 기존 설계 문서 반영 (25-sqlite-schema.md + 37-rest-api-complete-spec.md + 35-notification-architecture.md)

**Details:**
- 신규: 53-session-renewal-protocol.md
- 수정 (대규모): 30-session-token-protocol.md
- 수정 (중규모): 25-sqlite-schema.md, 37-rest-api-complete-spec.md, 35-notification-architecture.md
- Requirements: SESS-01~05

### Phase 21: DX 개선 + 설계 문서 통합

**Goal**: 에이전트 개발자가 init부터 첫 거래까지 최소 마찰로 도달할 수 있는 CLI 플로우가 재설계되고, v0.5 전체 변경이 기존 11개 설계 문서에 반영된 상태
**Depends on**: Phase 19, Phase 20
**Plans**: 4 plans

Plans:
- [x] 21-01: CLI 플로우 재설계 문서 신규 작성 (54-cli-flow-redesign.md: DX-01~05)
- [x] 21-02: DX 개선 스펙 문서 신규 작성 (55-dx-improvement-spec.md: DX-06~08)
- [x] 21-03: 중규모 기존 문서 수정 (28, 37, 40: v0.5 CLI/인증/hint 반영)
- [x] 21-04: 소규모 기존 문서 수정 + 참조 노트 + 통합 일관성 검증 (24, 29, 38, 39, 33, 36)

**Details:**
- 신규: 54-cli-flow-redesign.md, 55-dx-improvement-spec.md
- 수정 (중규모): 28-daemon-lifecycle-cli.md, 37-rest-api-complete-spec.md, 40-telegram-bot-docker.md
- 수정 (소규모): 24-monorepo-data-directory.md, 29-api-framework-design.md, 38-sdk-mcp-interface.md, 39-tauri-desktop-architecture.md, 33-time-lock-approval-mechanism.md, 36-killswitch-autostop-evm.md
- Requirements: DX-01~08

---

## Milestone Summary

**Key Decisions:**
- masterAuth 암묵적/명시적 이중 모드: 데몬 구동=인증 완료(implicit), X-Master-Password 헤더(explicit)
- ownerAuth 정확히 2곳: approve_tx, recover — OwnerSignaturePayload action 7→2개 축소
- Owner 주소 에이전트별 귀속 (agents.owner_address NOT NULL) — 멀티Owner/멀티체인 자연 지원
- WalletConnect 선택적 편의 기능 전환 — CLI 수동 서명으로 모든 기능 동작
- 세션 낙관적 갱신 패턴 — maxRenewals 30, 총 수명 30일, 50% 시점 갱신, 토큰 로테이션
- CLI init 4단계→2단계 간소화 — --quickstart 단일 커맨드, --dev 모드
- MCP 옵션 B(별도 stdio) 채택 — Host 호환성 + sessionAuth 보장
- hint 필드 backward-compatible 확장 — 31/40 에러 매핑 (78%)
- authRouter 단일 디스패처로 기존 3개 인증 미들웨어 통합

**Issues Resolved:**
- v0.2 ownerAuth 과도 적용 문제 (Owner 서명이 불필요한 엔드포인트에서 제거)
- Owner 주소 시스템 전역 단일 모델의 멀티에이전트 비호환 문제
- 세션 만료 시 에이전트 서비스 중단 문제 (자체 갱신으로 해결)
- WalletConnect 필수 의존으로 인한 초기 설정 마찰
- CLI 초기 설정 시 과도한 단계 수 (4→2단계 간소화)

**Issues Deferred:**
- POST /v1/agents 엔드포인트 상세 명세 (구현 시 반영)
- 37-rest-api Error Codes에서 hint 필드 명시적 참조 (hint는 optional, 위임 링크 존재)

**Technical Debt Incurred:**
- None (2건 LOW impact 항목은 구현 시 자연 해소 예상)

---

_For current project status, see .planning/ROADMAP.md_
