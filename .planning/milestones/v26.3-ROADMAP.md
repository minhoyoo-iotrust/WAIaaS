# Milestone v26.3: Push Relay Server

**Status:** SHIPPED 2026-02-20
**Phases:** 207-209
**Total Plans:** 8

## Overview

ntfy 토픽을 구독하여 지갑 개발사의 기존 푸시 인프라(Pushwoosh, FCM)로 변환/전달하는 경량 중계 서버를 구현하여, ntfy SDK를 앱에 직접 내장할 수 없는 지갑 개발사가 기존 푸시 파이프라인만으로 서명 요청과 알림을 수신할 수 있는 상태.

## Phases

### Phase 207: 데몬 SignRequest 인코딩 통일

**Goal**: 데몬의 NtfySigningChannel이 WalletNotificationChannel과 동일한 base64url 인코딩 패턴으로 SignRequest를 publish하여, Relay 파서가 단일 로직으로 서명 요청과 알림을 모두 처리할 수 있는 상태
**Depends on**: Nothing (first phase)
**Requirements**: ENCODE-01, ENCODE-02, ENCODE-03
**Plans**: 1 plan

Plans:
- [x] 207-01: NtfySigningChannel base64url 인코딩 변경 + wallet-sdk 호환성 검증

### Phase 208: Push Relay Server 구현

**Goal**: @waiaas/push-relay 패키지가 ntfy 토픽을 SSE로 구독하고, 수신한 서명 요청/알림을 Pushwoosh 또는 FCM으로 변환/전달하며, 지갑 앱이 Device Registry API로 푸시 토큰을 등록/해제할 수 있는 상태
**Depends on**: Phase 207
**Requirements**: SUB-01~04, PUSH-01~07, REG-01~05, INFRA-05, INFRA-06
**Plans**: 5 plans

Plans:
- [x] 208-01: 패키지 스캐폴딩 + config.toml 로딩 + Zod 검증
- [x] 208-02: ntfy SSE Subscriber + 메시지 파서
- [x] 208-03: IPushProvider + PushwooshProvider + FcmProvider
- [x] 208-04: Device Token Registry (SQLite + REST API + API Key 인증)
- [x] 208-05: 통합 연결 + Graceful Shutdown + E2E 테스트

### Phase 209: 배포 인프라

**Goal**: @waiaas/push-relay가 npm OIDC Trusted Publishing으로 발행되고, waiaas/push-relay Docker 이미지가 빌드되며, release-please와 CI/CD 파이프라인에 통합되어 기존 릴리스 프로세스로 자동 배포되는 상태
**Depends on**: Phase 208
**Requirements**: INFRA-01, INFRA-02, INFRA-03, INFRA-04
**Plans**: 2 plans

Plans:
- [x] 209-01: npm 패키지 빌드 + Docker 이미지 + release-please 등록
- [x] 209-02: release.yml CI/CD 파이프라인 통합

---

## Milestone Summary

**Key Decisions:**

- 3-phase 구조 (인코딩 통일 → Relay 구현 → 배포 인프라) — 의존성 순 배치
- INFRA-05(config), INFRA-06(shutdown)은 Relay 핵심 기능이므로 Phase 208에 배치
- INFRA-01~04(npm, Docker, release-please, CI)는 배포 전용이므로 Phase 209로 분리
- push-relay는 별도 Dockerfile로 독립 Docker 이미지 (daemon과 분리)

**Issues Resolved:**

- #117: Admin UI 정책 기본값 체크박스 dirty/value 키 불일치 수정
- #118: 에이전트 연동 가이드를 docs/guides/ 폴더로 이동 + README 링크 추가

**Issues Deferred:**

None.

**Technical Debt Incurred:**

None.

---

_For current project status, see .planning/ROADMAP.md_
