# Milestone v0.6: 블록체인 기능 확장 설계

**Status:** ✅ SHIPPED 2026-02-08
**Phases:** 22-25
**Total Plans:** 11

## Overview

네이티브 토큰(SOL/ETH) 전송에 한정된 IChainAdapter와 트랜잭션 파이프라인을 4단계에 걸쳐 확장 설계한다. Phase 22에서 SPL/ERC-20 토큰 전송과 자산 조회의 기초를 놓고, Phase 23에서 임의 컨트랙트 호출/Approve/배치 트랜잭션 타입을 확장하며, Phase 24에서 가격 오라클과 Action Provider 추상화 레이어를 설계하고, Phase 25에서 전체 확장 기능의 테스트 전략을 통합하고 기존 설계 문서 8개에 v0.6 변경을 반영한다. 모든 산출물은 설계 문서이며 코드 구현은 포함하지 않는다.

## Phases

### Phase 22: 토큰 확장 설계

**Goal**: 에이전트가 네이티브 토큰뿐 아니라 SPL/ERC-20 토큰을 전송하고, 보유 자산을 조회하며, 에이전트별 허용 토큰 정책이 적용되는 상태를 설계한다
**Depends on**: 없음 (v0.6 첫 번째 페이즈)
**Requirements**: TOKEN-01, TOKEN-02, TOKEN-03, TOKEN-04, TOKEN-05
**Plans**: 2 plans

Plans:
- [x] 22-01-PLAN.md — TransferRequest.token 확장, SPL/ERC-20 빌드 로직, ALLOWED_TOKENS 정책, 파이프라인 통합 (CHAIN-EXT-01)
- [x] 22-02-PLAN.md — getAssets() 인터페이스, 수수료 추정 확장, 테스트 시나리오 (CHAIN-EXT-02)

**Deliverables:**
- CHAIN-EXT-01: 토큰 전송 확장 스펙 (docs/56-token-transfer-extension-spec.md)
- CHAIN-EXT-02: 자산 조회 스펙 (docs/57-asset-query-fee-estimation-spec.md)

**Completed:** 2026-02-07

### Phase 23: 트랜잭션 타입 확장 설계

**Goal**: 에이전트가 임의 스마트 컨트랙트를 호출하고, 토큰 Approve를 독립 정책으로 관리하며, 복수 인스트럭션을 원자적 배치로 실행하는 트랜잭션 타입을 설계한다
**Depends on**: Phase 22 (TransferRequest.token 확장, Enum 확장 기반)
**Requirements**: CONTRACT-01~05, APPROVE-01~03, BATCH-01~03
**Plans**: 3 plans

Plans:
- [x] 23-01-PLAN.md — ContractCallRequest 인터페이스, CONTRACT_WHITELIST/METHOD_WHITELIST 정책, 파이프라인/DB/REST 크로스커팅 확장 (CHAIN-EXT-03)
- [x] 23-02-PLAN.md — ApproveRequest 독립 타입, APPROVED_SPENDERS/APPROVE_AMOUNT_LIMIT/APPROVE_TIER_OVERRIDE 정책, EVM race condition 자동 처리 (CHAIN-EXT-04)
- [x] 23-03-PLAN.md — BatchRequest/InstructionRequest, Solana 원자적 배치, 배치 정책 합산 평가, EVM 미지원 분기 (CHAIN-EXT-05)

**Deliverables:**
- CHAIN-EXT-03: 컨트랙트 호출 스펙 (docs/58-contract-call-spec.md)
- CHAIN-EXT-04: Approve 관리 스펙 (docs/59-approve-management-spec.md)
- CHAIN-EXT-05: 배치 트랜잭션 스펙 (docs/60-batch-transaction-spec.md)

**Completed:** 2026-02-08

### Phase 24: 상위 추상화 레이어 설계

**Goal**: 토큰 종류 무관하게 USD 금액 기준으로 정책을 평가하는 가격 오라클을 설계하고, DeFi 프로토콜 지식을 어댑터에서 분리하여 resolve-then-execute 패턴의 Action Provider 아키텍처와 첫 번째 구현체(Jupiter Swap)를 설계한다
**Depends on**: Phase 23 (ContractCallRequest 타입, 파이프라인 확장 기반)
**Requirements**: ORACLE-01~04, ACTION-01~05
**Plans**: 2 plans

Plans:
- [x] 24-01-PLAN.md — 가격 오라클 스펙: IPriceOracle 인터페이스, CoinGecko/Pyth/Chainlink 구현체, 캐싱/fallback, USD 기준 정책 평가 확장 (CHAIN-EXT-06)
- [x] 24-02-PLAN.md — Action Provider 아키텍처 + Swap Action: IActionProvider, MCP 변환, 플러그인 로드, Jupiter Swap 상세 설계 (CHAIN-EXT-07, CHAIN-EXT-08)

**Deliverables:**
- CHAIN-EXT-06: 가격 오라클 스펙 (docs/61-price-oracle-spec.md)
- CHAIN-EXT-07: Action Provider 아키텍처 (docs/62-action-provider-architecture.md)
- CHAIN-EXT-08: Swap Action 상세 설계 (docs/63-swap-action-spec.md)

**Completed:** 2026-02-08

### Phase 25: 테스트 전략 통합 + 기존 문서 반영

**Goal**: Phase 22-24에서 설계한 모든 확장 기능의 테스트 전략을 v0.4 프레임워크에 통합하고, 기존 설계 문서 8개에 v0.6 변경사항을 반영하여 문서 간 일관성을 확보한다
**Depends on**: Phase 24 (전체 확장 기능 설계 완료 후)
**Requirements**: TEST-01~03, INTEG-01~02
**Plans**: 4 plans

Plans:
- [x] 25-01-PLAN.md — CHAIN-EXT-09 확장 기능 테스트 전략: Mock 경계 5개, EVM Hardhat 환경, 커버리지 재설정, 148개 테스트 시나리오 통합 (TEST-01, TEST-02, TEST-03)
- [x] 25-02-PLAN.md — SSoT 문서 v0.6 통합: 45-enum, 27-chain-adapter, 25-sqlite (INTEG-02 + INTEG-01 일부)
- [x] 25-03-PLAN.md — 기능 계층 문서 v0.6 통합: 33-time-lock, 32-pipeline, 31-solana (INTEG-01 일부)
- [x] 25-04-PLAN.md — 인터페이스 계층 문서 v0.6 통합: 37-rest-api, 38-sdk-mcp (INTEG-01 일부)

**Deliverables:**
- CHAIN-EXT-09: 확장 기능 테스트 전략 (docs/64-extension-test-strategy.md)
- 기존 설계 문서 8개 v0.6 반영: 27, 25, 31, 33, 32, 37, 38, 45

**Completed:** 2026-02-08

---

## Milestone Summary

**Key Decisions:**

- IChainAdapter 저수준 유지 — 어댑터는 실행 엔진, DeFi 지식은 Action Provider에 분리
- resolve-then-execute 패턴 — Action Provider가 요청 생성 → 파이프라인이 정책 평가 후 실행
- 임의 컨트랙트 기본 거부 — CONTRACT_WHITELIST 비어있으면 모든 호출 거부 (opt-in)
- approve 독립 정책 카테고리 — 권한 위임은 전송보다 위험, 별도 정책 규칙 필요
- USD 기준 정책 평가 — 토큰 종류 무관하게 달러 금액으로 티어 분류

**Issues Resolved:**

- IChainAdapter 네이티브 토큰 전용 제한 → 17 메서드로 확장 (getAssets, buildContractCall, buildApprove, buildBatch)
- Phase 22-23 과도기(0n) 해소 → USD 기준 정책 평가로 전환
- TransactionType/PolicyType Enum SSoT 갱신 → 45-enum 통합

**Issues Deferred:**

- 실제 코드 구현 (설계 마일스톤)
- 크로스체인 브릿지 통합
- NFT/Staking/Lending Action Provider
- Account Abstraction / Smart Wallet

**Technical Debt Incurred:**

없음 (0 tech debt items per audit)

---

_For current project status, see .planning/ROADMAP.md_
