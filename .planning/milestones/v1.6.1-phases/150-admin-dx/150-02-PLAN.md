---
phase: 150-admin-dx
plan: 02
type: execute
wave: 2
depends_on: ["150-01"]
files_modified:
  - packages/mcp/src/api-client.ts
  - packages/mcp/src/tools/wc-connect.ts
  - packages/mcp/src/tools/wc-status.ts
  - packages/mcp/src/tools/wc-disconnect.ts
  - packages/mcp/src/server.ts
  - packages/sdk/src/client.ts
  - packages/sdk/src/types.ts
  - packages/sdk/src/index.ts
  - python-sdk/waiaas/client.py
  - python-sdk/waiaas/models.py
  - python-sdk/waiaas/__init__.py
  - skills/wallet.skill.md
autonomous: true

must_haves:
  truths:
    - "MCP wc_connect tool starts WC pairing and returns URI + QR code"
    - "MCP wc_status tool returns current WC session info"
    - "MCP wc_disconnect tool disconnects WC session"
    - "TypeScript SDK wcConnect/wcStatus/wcDisconnect methods work with sessionAuth"
    - "Python SDK wc_connect/wc_status/wc_disconnect methods work with sessionAuth"
    - "Skill file documents WC REST endpoints, MCP tools, and SDK methods"
  artifacts:
    - path: "packages/mcp/src/api-client.ts"
      provides: "ApiClient.delete() method"
      contains: "delete"
    - path: "packages/mcp/src/tools/wc-connect.ts"
      provides: "wc_connect MCP tool"
      exports: ["registerWcConnect"]
    - path: "packages/mcp/src/tools/wc-status.ts"
      provides: "wc_status MCP tool"
      exports: ["registerWcStatus"]
    - path: "packages/mcp/src/tools/wc-disconnect.ts"
      provides: "wc_disconnect MCP tool"
      exports: ["registerWcDisconnect"]
    - path: "packages/mcp/src/server.ts"
      provides: "18 tools registered (15 + 3 WC)"
      contains: "registerWcConnect"
    - path: "packages/sdk/src/client.ts"
      provides: "wcConnect, wcStatus, wcDisconnect methods"
      contains: "wcConnect"
    - path: "packages/sdk/src/types.ts"
      provides: "WcPairingResponse, WcSessionResponse, WcDisconnectResponse types"
      contains: "WcPairingResponse"
    - path: "python-sdk/waiaas/client.py"
      provides: "wc_connect, wc_status, wc_disconnect methods"
      contains: "wc_connect"
    - path: "python-sdk/waiaas/models.py"
      provides: "WcPairingResponse, WcSessionInfo, WcDisconnectResponse models"
      contains: "WcPairingResponse"
    - path: "skills/wallet.skill.md"
      provides: "WalletConnect section with API/MCP/SDK docs"
      contains: "WalletConnect"
  key_links:
    - from: "packages/mcp/src/tools/wc-connect.ts"
      to: "/v1/wallet/wc/pair"
      via: "apiClient.post"
      pattern: "apiClient\\.post.*wallet/wc/pair"
    - from: "packages/mcp/src/tools/wc-disconnect.ts"
      to: "/v1/wallet/wc/session"
      via: "apiClient.delete"
      pattern: "apiClient\\.delete.*wallet/wc/session"
    - from: "packages/sdk/src/client.ts"
      to: "/v1/wallet/wc/*"
      via: "this.http.post/get/delete"
      pattern: "http\\.(post|get|delete).*wallet/wc"
    - from: "python-sdk/waiaas/client.py"
      to: "/v1/wallet/wc/*"
      via: "self._request"
      pattern: "_request.*wallet/wc"
---

<objective>
MCP WC 도구 3개 + TypeScript/Python SDK WC 메서드 + Skill 파일 업데이트

Purpose: AI 에이전트(MCP), TypeScript/Python 개발자(SDK), 그리고 AI 에이전트 참조(Skill 파일) 모든 인터페이스에서 WalletConnect 세션 관리가 가능하게 한다.
Output: 3 MCP tools, 3 TS SDK methods, 3 Python SDK methods, skill file WC section
</objective>

<execution_context>
@/Users/minho.yoo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/minho.yoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/150-admin-dx/150-RESEARCH.md
@.planning/phases/150-admin-dx/150-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: MCP ApiClient.delete() + 3 WC tools</name>
  <files>
    packages/mcp/src/api-client.ts
    packages/mcp/src/tools/wc-connect.ts
    packages/mcp/src/tools/wc-status.ts
    packages/mcp/src/tools/wc-disconnect.ts
    packages/mcp/src/server.ts
  </files>
  <action>
**api-client.ts:**

Add `delete` method to ApiClient class (after `put` method, line ~175):

```typescript
async delete<T>(path: string): Promise<ApiResult<T>> {
  return this.request<T>('DELETE', path);
}
```

The private `request` method already handles any HTTP method -- just needs a public `delete` wrapper.

**wc-connect.ts (NEW):**

Follow x402-fetch.ts pattern exactly:

```typescript
import { z } from 'zod';
import type { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';
import { type ApiClient, toToolResult } from '../api-client.js';
import { type WalletContext, withWalletPrefix } from '../server.js';

export function registerWcConnect(
  server: McpServer,
  apiClient: ApiClient,
  walletContext?: WalletContext,
): void {
  server.tool(
    'wc_connect',
    withWalletPrefix(
      'Start WalletConnect pairing. Returns a WC URI that the wallet owner can use to connect their external wallet (MetaMask, Phantom, etc). Share the URI with the user -- they can paste it into their wallet app.',
      walletContext?.walletName,
    ),
    {},
    async () => {
      const result = await apiClient.post('/v1/wallet/wc/pair', {});
      return toToolResult(result);
    },
  );
}
```

Note: Return full response including `uri`, `qrCode`, `expiresAt`. The AI agent should share the `uri` with the user (per research Pitfall 6). The `qrCode` is base64 for HTML rendering contexts.

**wc-status.ts (NEW):**

```typescript
export function registerWcStatus(
  server: McpServer,
  apiClient: ApiClient,
  walletContext?: WalletContext,
): void {
  server.tool(
    'wc_status',
    withWalletPrefix(
      'Get WalletConnect session status. Returns session info (peer wallet, chain, expiry) or error if no active session.',
      walletContext?.walletName,
    ),
    {},
    async () => {
      const result = await apiClient.get('/v1/wallet/wc/session');
      return toToolResult(result);
    },
  );
}
```

**wc-disconnect.ts (NEW):**

```typescript
export function registerWcDisconnect(
  server: McpServer,
  apiClient: ApiClient,
  walletContext?: WalletContext,
): void {
  server.tool(
    'wc_disconnect',
    withWalletPrefix(
      'Disconnect the active WalletConnect session. After disconnecting, a new pairing must be initiated to reconnect.',
      walletContext?.walletName,
    ),
    {},
    async () => {
      const result = await apiClient.delete('/v1/wallet/wc/session');
      return toToolResult(result);
    },
  );
}
```

**server.ts:**

1. Add imports: `import { registerWcConnect } from './tools/wc-connect.js';` (and wc-status, wc-disconnect)
2. Register after x402Fetch (line ~73): `registerWcConnect(server, apiClient, walletContext);` `registerWcStatus(server, apiClient, walletContext);` `registerWcDisconnect(server, apiClient, walletContext);`
3. Update comment: `// Register 18 tools` (was 15)
4. Update JSDoc: `createMcpServer: factory that creates an MCP server with 18 tools`
  </action>
  <verify>
`pnpm build --filter=@waiaas/mcp` succeeds. `pnpm test --filter=@waiaas/mcp` passes (if tests exist). Check that server.ts imports and registers all 18 tools.
  </verify>
  <done>
MCP ApiClient has delete() method. 3 WC tools (wc_connect, wc_status, wc_disconnect) registered in MCP server, calling session-scoped `/v1/wallet/wc/*` endpoints.
  </done>
</task>

<task type="auto">
  <name>Task 2: TypeScript SDK + Python SDK WC methods + Skill 파일</name>
  <files>
    packages/sdk/src/client.ts
    packages/sdk/src/types.ts
    packages/sdk/src/index.ts
    python-sdk/waiaas/client.py
    python-sdk/waiaas/models.py
    python-sdk/waiaas/__init__.py
    skills/wallet.skill.md
  </files>
  <action>
**TypeScript SDK -- types.ts:**

Add after the X402 types section:

```typescript
// ---------------------------------------------------------------------------
// WalletConnect Responses
// ---------------------------------------------------------------------------

export interface WcPairingResponse {
  uri: string;
  qrCode: string;
  expiresAt: number;
}

export interface WcSessionResponse {
  walletId: string;
  topic: string;
  peerName: string | null;
  peerUrl: string | null;
  chainId: string;
  ownerAddress: string;
  expiry: number;
  createdAt: number;
}

export interface WcDisconnectResponse {
  disconnected: boolean;
}
```

**TypeScript SDK -- client.ts:**

Add 3 methods after x402Fetch (following existing withRetry + this.http.verb pattern):

```typescript
async wcConnect(): Promise<WcPairingResponse> {
  return withRetry(
    () => this.http.post<WcPairingResponse>('/v1/wallet/wc/pair', {}, this.authHeaders()),
    this.retryOptions,
  );
}

async wcStatus(): Promise<WcSessionResponse> {
  return withRetry(
    () => this.http.get<WcSessionResponse>('/v1/wallet/wc/session', this.authHeaders()),
    this.retryOptions,
  );
}

async wcDisconnect(): Promise<WcDisconnectResponse> {
  return withRetry(
    () => this.http.delete<WcDisconnectResponse>('/v1/wallet/wc/session', this.authHeaders()),
    this.retryOptions,
  );
}
```

Import `WcPairingResponse`, `WcSessionResponse`, `WcDisconnectResponse` from types.ts.
Update JSDoc at top: add wcConnect/wcStatus/wcDisconnect to the method list comment.

**TypeScript SDK -- index.ts:**

Add to the type export list:
```typescript
WcPairingResponse,
WcSessionResponse,
WcDisconnectResponse,
```

**Python SDK -- models.py:**

Add after X402 models section:

```python
# ---------------------------------------------------------------------------
# WalletConnect models
# ---------------------------------------------------------------------------

class WcPairingResponse(BaseModel):
    uri: str
    qr_code: str = Field(alias="qrCode")
    expires_at: int = Field(alias="expiresAt")

    model_config = {"populate_by_name": True}


class WcSessionInfo(BaseModel):
    wallet_id: str = Field(alias="walletId")
    topic: str
    peer_name: Optional[str] = Field(None, alias="peerName")
    peer_url: Optional[str] = Field(None, alias="peerUrl")
    chain_id: str = Field(alias="chainId")
    owner_address: str = Field(alias="ownerAddress")
    expiry: int
    created_at: int = Field(alias="createdAt")

    model_config = {"populate_by_name": True}


class WcDisconnectResponse(BaseModel):
    disconnected: bool
```

**Python SDK -- client.py:**

Add 3 methods after x402_fetch:

```python
async def wc_connect(self) -> WcPairingResponse:
    """Start WalletConnect pairing. POST /v1/wallet/wc/pair"""
    resp = await self._request("POST", "/v1/wallet/wc/pair")
    return WcPairingResponse.model_validate(resp.json())

async def wc_status(self) -> WcSessionInfo:
    """Get WalletConnect session status. GET /v1/wallet/wc/session"""
    resp = await self._request("GET", "/v1/wallet/wc/session")
    return WcSessionInfo.model_validate(resp.json())

async def wc_disconnect(self) -> WcDisconnectResponse:
    """Disconnect WalletConnect session. DELETE /v1/wallet/wc/session"""
    resp = await self._request("DELETE", "/v1/wallet/wc/session")
    return WcDisconnectResponse.model_validate(resp.json())
```

Import the 3 new models at the top of client.py.

**Python SDK -- __init__.py:**

Add imports: `WcPairingResponse`, `WcSessionInfo`, `WcDisconnectResponse` from `waiaas.models`.
Add to `__all__` list.

**Skill file -- skills/wallet.skill.md:**

Add a new section "## WalletConnect Session Management" at the end (before any closing markers), covering:

1. **REST API endpoints** (sessionAuth):
   - `POST /v1/wallet/wc/pair` -- Start WC pairing (returns URI + QR code)
   - `GET /v1/wallet/wc/session` -- Get WC session info
   - `DELETE /v1/wallet/wc/session` -- Disconnect WC session
   - `GET /v1/wallet/wc/pair/status` -- Poll pairing status

2. **Admin REST API endpoints** (masterAuth):
   - `POST /v1/wallets/{id}/wc/pair`
   - `GET /v1/wallets/{id}/wc/session`
   - `DELETE /v1/wallets/{id}/wc/session`
   - `GET /v1/wallets/{id}/wc/pair/status`

3. **MCP Tools**: `wc_connect`, `wc_status`, `wc_disconnect`

4. **SDK Methods**: TypeScript `wcConnect()`, `wcStatus()`, `wcDisconnect()` / Python `wc_connect()`, `wc_status()`, `wc_disconnect()`

Include curl examples for the session-scoped endpoints. Update version in frontmatter to "1.6.1".
  </action>
  <verify>
`pnpm build --filter=@waiaas/sdk` succeeds. `pnpm build --filter=@waiaas/mcp` succeeds. `python -c "from waiaas.models import WcPairingResponse, WcSessionInfo, WcDisconnectResponse"` succeeds. Skill file contains WalletConnect section.
  </verify>
  <done>
TypeScript SDK has wcConnect/wcStatus/wcDisconnect methods with typed responses. Python SDK has wc_connect/wc_status/wc_disconnect methods with Pydantic models. Skill file documents all WC endpoints, MCP tools, and SDK methods.
  </done>
</task>

</tasks>

<verification>
1. `pnpm build` -- full monorepo build succeeds
2. `pnpm test` -- all tests pass, no regressions
3. MCP server registers 18 tools (verify in server.ts)
4. TypeScript SDK exports 3 new WC types (verify in index.ts)
5. Python SDK imports succeed: `from waiaas import WcPairingResponse, WcSessionInfo, WcDisconnectResponse`
6. Skill file version updated to 1.6.1 with WC section
</verification>

<success_criteria>
- 3 MCP tools (wc_connect, wc_status, wc_disconnect) call session-scoped endpoints
- TypeScript SDK has 3 new methods + 3 new response types
- Python SDK has 3 new methods + 3 new Pydantic models
- Skill file documents WC across all interfaces (REST, MCP, SDK)
- Full build and tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/150-admin-dx/150-02-SUMMARY.md`
</output>
