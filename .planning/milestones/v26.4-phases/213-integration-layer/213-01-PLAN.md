---
phase: 213-integration-layer
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/sdk/src/client.ts
  - packages/sdk/src/types.ts
  - packages/sdk/src/index.ts
  - packages/sdk/src/__tests__/client.test.ts
  - python-sdk/waiaas/client.py
  - python-sdk/waiaas/models.py
  - python-sdk/tests/test_client.py
autonomous: true
requirements: [INTG-01]

must_haves:
  truths:
    - "SDK createSession({ walletIds }) 호출로 멀티 지갑 세션을 생성할 수 있다"
    - "SDK getConnectInfo() 호출로 자기 발견 정보를 조회할 수 있다"
    - "Python SDK get_connect_info() 메서드가 ConnectInfo 모델을 반환한다"
    - "기존 SDK API (getBalance, sendToken 등)가 무변경으로 동작한다"
  artifacts:
    - path: "packages/sdk/src/client.ts"
      provides: "createSession + getConnectInfo methods"
      contains: "createSession"
    - path: "packages/sdk/src/types.ts"
      provides: "CreateSessionParams + ConnectInfoResponse types"
      contains: "ConnectInfoResponse"
    - path: "python-sdk/waiaas/client.py"
      provides: "get_connect_info method"
      contains: "get_connect_info"
    - path: "python-sdk/waiaas/models.py"
      provides: "ConnectInfo model"
      contains: "ConnectInfo"
  key_links:
    - from: "packages/sdk/src/client.ts"
      to: "/v1/connect-info"
      via: "HTTP GET with auth headers"
      pattern: "get.*connect-info"
    - from: "packages/sdk/src/client.ts"
      to: "/v1/sessions"
      via: "HTTP POST with master password"
      pattern: "post.*sessions"
---

<objective>
SDK에 멀티 지갑 세션 생성(createSession)과 자기 발견(getConnectInfo) 메서드를 추가하고, Python SDK에도 동기화한다.

Purpose: 에이전트가 프로그래밍 방식으로 멀티 지갑 세션을 생성하고 자기 발견 정보를 조회할 수 있게 한다.
Output: TypeScript SDK에 2개 메서드, Python SDK에 1개 메서드 + 모델 추가
</objective>

<execution_context>
@/Users/minho.yoo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/minho.yoo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/212-connect-info-endpoint/212-01-SUMMARY.md

@packages/sdk/src/client.ts
@packages/sdk/src/types.ts
@packages/sdk/src/index.ts
@python-sdk/waiaas/client.py
@python-sdk/waiaas/models.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: TypeScript SDK -- createSession + getConnectInfo 메서드 추가</name>
  <files>
    packages/sdk/src/client.ts
    packages/sdk/src/types.ts
    packages/sdk/src/index.ts
  </files>
  <action>
**types.ts에 새 타입 추가:**

1. `CreateSessionParams` 인터페이스:
   - `walletIds?: string[]` -- 멀티 지갑 세션용 (복수)
   - `walletId?: string` -- 하위 호환 (단수)
   - `defaultWalletId?: string` -- 기본 지갑 지정 (선택)
   - `expiresIn?: number` -- 만료 시간 (초)
   - `constraints?: Record<string, unknown>` -- 세션 제약
   - `source?: 'api' | 'mcp'` -- 소스 표시

2. `CreateSessionResponse` 인터페이스:
   - `id: string`
   - `token: string`
   - `expiresAt: number`
   - `walletId: string` -- 기본 지갑 (하위 호환)
   - `wallets: Array<{ id: string; name: string; isDefault: boolean }>`

3. `ConnectInfoResponse` 인터페이스 (daemon connect-info 엔드포인트 응답 미러링):
   - `session: { id: string; expiresAt: number; source: string }`
   - `wallets: Array<{ id: string; name: string; chain: string; environment: string; defaultNetwork: string; address: string; isDefault: boolean; policies: Array<{ type: string; rules: Record<string, unknown> }> }>`
   - `capabilities: string[]`
   - `daemon: { version: string; baseUrl: string }`
   - `prompt: string`

4. index.ts에서 새 타입 export 추가: `CreateSessionParams`, `CreateSessionResponse`, `ConnectInfoResponse`

**client.ts에 메서드 추가:**

1. `createSession(params: CreateSessionParams, masterPassword: string): Promise<CreateSessionResponse>` 메서드:
   - POST /v1/sessions에 `{ walletIds?, walletId?, defaultWalletId?, expiresIn?, constraints?, source? }` 전송
   - masterPassword를 `X-Master-Password` 헤더로 전달
   - 내부적으로 `this.http.post()` 사용하되, authHeaders 대신 masterPassword 헤더 사용
   - 성공 시 자동으로 `this.sessionToken`과 `this.sessionId`를 결과값으로 업데이트
   - withRetry 래핑

2. `getConnectInfo(): Promise<ConnectInfoResponse>` 메서드:
   - GET /v1/connect-info에 sessionAuth 헤더로 요청
   - `this.authHeaders()` 사용
   - withRetry 래핑

**주의:** createSession은 masterAuth가 필요하므로 기존 authHeaders()와 다른 헤더를 사용해야 한다. 내부 헬퍼 `masterHeaders(password)` private 메서드를 추가하여 `{ 'X-Master-Password': password }` 반환.
  </action>
  <verify>
    `cd /Users/minho.yoo/dev/wallet/WAIaaS && pnpm turbo run typecheck --filter=@waiaas/sdk` 성공
  </verify>
  <done>
    SDK client.ts에 createSession/getConnectInfo 메서드가 존재하고, types.ts에 3개 타입이 정의되며, typecheck가 통과한다.
  </done>
</task>

<task type="auto">
  <name>Task 2: Python SDK -- get_connect_info 메서드 + ConnectInfo 모델 추가</name>
  <files>
    python-sdk/waiaas/models.py
    python-sdk/waiaas/client.py
  </files>
  <action>
**models.py에 추가:**

1. `ConnectInfoWallet` 모델:
   - `id: str`
   - `name: str`
   - `chain: str`
   - `environment: str`
   - `default_network: str = Field(alias="defaultNetwork")`
   - `address: str`
   - `is_default: bool = Field(alias="isDefault")`
   - `policies: list[dict[str, Any]]`
   - `model_config = {"populate_by_name": True}`

2. `ConnectInfoSession` 모델:
   - `id: str`
   - `expires_at: int = Field(alias="expiresAt")`
   - `source: str`
   - `model_config = {"populate_by_name": True}`

3. `ConnectInfoDaemon` 모델:
   - `version: str`
   - `base_url: str = Field(alias="baseUrl")`
   - `model_config = {"populate_by_name": True}`

4. `ConnectInfo` 모델:
   - `session: ConnectInfoSession`
   - `wallets: list[ConnectInfoWallet]`
   - `capabilities: list[str]`
   - `daemon: ConnectInfoDaemon`
   - `prompt: str`
   - `model_config = {"populate_by_name": True}`

**client.py에 추가:**

1. models.py import에 `ConnectInfo` 추가
2. Wallet API 섹션 뒤에 Discovery API 섹션 추가:
```python
async def get_connect_info(self) -> ConnectInfo:
    """GET /v1/connect-info -- Get self-discovery info for this session.

    Returns wallets, policies, capabilities, and AI-ready prompt.
    Requires only session token (no master password).
    """
    resp = await self._request("GET", "/v1/connect-info")
    return ConnectInfo.model_validate(resp.json())
```

**주의:** Python SDK는 sessionAuth 전용이므로 createSession은 추가하지 않는다 (masterAuth 필요). get_connect_info만 추가.
  </action>
  <verify>
    `cd /Users/minho.yoo/dev/wallet/WAIaaS/python-sdk && python -c "from waiaas.models import ConnectInfo; from waiaas.client import WAIaaSClient; print('OK')"` 성공
  </verify>
  <done>
    Python SDK에 ConnectInfo 모델과 get_connect_info 메서드가 존재하고, import가 성공한다.
  </done>
</task>

</tasks>

<verification>
1. `pnpm turbo run typecheck --filter=@waiaas/sdk` 통과
2. `pnpm turbo run lint --filter=@waiaas/sdk` 통과
3. Python SDK import 검증: `cd python-sdk && python -c "from waiaas.models import ConnectInfo; print('OK')"`
4. 기존 SDK 테스트가 깨지지 않음: `pnpm turbo run test --filter=@waiaas/sdk`
</verification>

<success_criteria>
- TypeScript SDK에 createSession(params, masterPassword)과 getConnectInfo() 2개 메서드 추가됨
- CreateSessionParams, CreateSessionResponse, ConnectInfoResponse 타입이 export됨
- Python SDK에 get_connect_info() 메서드와 ConnectInfo 모델이 추가됨
- 기존 SDK API가 무변경으로 동작함 (하위 호환)
</success_criteria>

<output>
After completion, create `.planning/phases/213-integration-layer/213-01-SUMMARY.md`
</output>
