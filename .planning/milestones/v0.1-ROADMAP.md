# Milestone v0.1: Research & Design

**Status:** SHIPPED 2026-02-05
**Phases:** 1-5
**Total Plans:** 15

## Overview

이 마일스톤은 AI 에이전트용 지갑 서비스의 설계 문서를 완성합니다. 기술 스택 결정부터 시작하여 커스터디 모델 분석, 시스템 아키텍처 설계, 소유자-에이전트 관계 모델, 그리고 최종 API 스펙까지 순차적으로 진행합니다. 모든 산출물은 구현 마일스톤의 기반이 되는 설계 문서입니다.

## Phases

### Phase 1: 기술 스택 결정

**Goal**: 프로젝트 전체에서 사용할 기술 스택을 확정하여 이후 모든 설계의 기반을 마련한다
**Depends on**: 없음 (첫 번째 페이즈)
**Requirements**: TECH-01, TECH-02, TECH-03
**Plans**: 2 plans

Plans:

- [x] 01-01: 권장 기술 스택(TECH-01) 및 Solana 개발 환경(TECH-02) 문서 작성
- [x] 01-02: 데이터베이스 및 캐싱 전략(TECH-03) 문서 작성

**Completed:** 2026-02-04

**Key decisions:**
- TypeScript 5.x + Node.js 22 LTS 언어/런타임
- Fastify 5.x 백엔드 프레임워크 (Express 대비 2.7배 성능)
- pnpm 9.x + Turborepo 2.x 모노레포
- @solana/kit 3.x 권장, Helius RPC
- PostgreSQL 15+ + Prisma 6.x + Redis + ioredis

### Phase 2: 커스터디 모델 분석

**Goal**: AI 에이전트 지갑에 최적화된 커스터디 모델을 분석하고 권장 방식을 제안한다
**Depends on**: Phase 1
**Requirements**: CUST-01, CUST-02, CUST-03, CUST-04
**Plans**: 3 plans

Plans:

- [x] 02-01: 커스터디 모델 비교(CUST-01) 및 프로바이더 비교표(CUST-03) 작성
- [x] 02-02: AI 에이전트 특화 커스터디 고려사항(CUST-02) 도출
- [x] 02-03: 권장 커스터디 모델 제안서(CUST-04) 및 Turnkey 결정 철회 반영

**Completed:** 2026-02-04

**Key decisions:**
- AWS KMS + Nitro Enclaves + Squads Protocol 하이브리드 아키텍처 최종 확정
- 외부 WaaS 프로바이더 배제, 직접 구축 방향 확정
- 5년 기준 36% 비용 절감 (직접 구축 ~$57,600 vs 프로바이더 ~$90,000)
- Phase 1 Turnkey 결정 철회

### Phase 3: 시스템 아키텍처 설계

**Goal**: 전체 시스템 구조와 보안 모델을 설계하여 구현의 청사진을 완성한다
**Depends on**: Phase 2
**Requirements**: ARCH-01, ARCH-02, ARCH-03, ARCH-04, ARCH-05
**Plans**: 3 plans

Plans:

- [x] 03-01: Dual Key 아키텍처 상세 설계(ARCH-01) 및 시스템 컴포넌트 다이어그램(ARCH-02)
- [x] 03-02: 트랜잭션 데이터 흐름 다이어그램(ARCH-03)
- [x] 03-03: 보안 위협 모델링(ARCH-04) 및 멀티체인 확장성 설계(ARCH-05)

**Completed:** 2026-02-04

**Key decisions:**
- Owner Key IAM Role 기반 접근, Agent Key Enclave 내부 생성
- 키 로테이션: Agent Key 90일, Owner Key 연 1회
- 모놀리식 + IKeyManagementService 인터페이스 추상화
- 3중 정책 검증 레이어 (서버 → Enclave → Squads 온체인)
- Fail-safe 원칙, 규칙 기반 이상 탐지, Circuit Breaker
- IBlockchainAdapter 인터페이스로 멀티체인 추상화

### Phase 4: 소유자-에이전트 관계 모델

**Goal**: 소유자와 에이전트 간의 자금 흐름, 권한 관리, 비상 절차를 정의한다
**Depends on**: Phase 3
**Requirements**: REL-01, REL-02, REL-03, REL-04, REL-05
**Plans**: 3 plans

Plans:

- [x] 04-01: 자금 충전 프로세스(REL-01) 및 자금 회수 프로세스(REL-02) 설계
- [x] 04-02: 에이전트 생명주기 관리 및 키 관리(REL-03) 설계
- [x] 04-03: 비상 자금 회수 메커니즘(REL-04) 및 멀티 에이전트 관리 모델(REL-05) 설계

**Completed:** 2026-02-05

**Key decisions:**
- Budget Pool 기반 자금 충전, 3-Layer 예산 한도
- 에이전트 5단계 상태 모델, Drain-then-Rotate 키 로테이션
- 비상 회수: 자동 SUSPENDED까지만, 자금 이동은 소유자 수동 판단
- Hub-and-Spoke 멀티 에이전트 구조, GlobalBudgetLimit

### Phase 5: API 및 통합 설계

**Goal**: 외부 개발자와 에이전트 프레임워크가 사용할 인터페이스를 완성한다
**Depends on**: Phase 3, Phase 4
**Requirements**: API-01, API-02, API-03, API-04, API-05, API-06
**Plans**: 4 plans

Plans:

- [x] 05-01: 에이전트 인증 모델(API-02) 및 권한/정책 모델(API-03) 설계
- [x] 05-02: 에러 코드 및 처리 규격(API-04) 정의
- [x] 05-03: OpenAPI 3.0 REST API 스펙(API-01) 설계
- [x] 05-04: SDK 인터페이스(API-05) 및 MCP 통합 스펙(API-06) 설계

**Completed:** 2026-02-05

**Key decisions:**
- API Key Primary 인증, OAuth 2.1 Secondary, MCP Authorization 이중 경로
- RBAC 4역할 + ABAC 4정책 속성 하이브리드
- 33개 REST 엔드포인트, 46개 에러 코드, 31개 SDK 메서드, 9개 MCP Tools
- Zod SSoT: Zod → TypeScript types + OpenAPI schema + runtime validation
- 트랜잭션 202 Accepted 비동기 패턴

---

## Milestone Summary

**Key Decisions:**

- AWS KMS + Nitro Enclaves + Squads Protocol 하이브리드 아키텍처 확정
- 외부 WaaS 프로바이더 배제, 직접 구축 방향
- Dual Key (Owner Key + Agent Key) 분리 아키텍처
- TypeScript + Fastify + PostgreSQL + Redis 기술 스택
- 3중 정책 검증 레이어 (서버 → Enclave → Squads)
- Budget Pool 기반 자금 관리 + Hub-and-Spoke 멀티 에이전트
- API Key Primary 인증 + Zod SSoT + 비동기 트랜잭션 패턴

**Issues Resolved:**

- Phase 1 Turnkey 선택 → Phase 2에서 직접 구축으로 변경 (비용 36% 절감)
- 커스터디 모델 선정 불확실성 → 하이브리드 아키텍처로 해결

**Issues Deferred:**

- Squads v4 동적 threshold → 서버 레벨 금액 기반 라우팅으로 구현
- 다중 리전 배포 시 PCR 관리 자동화
- configAuthority vault 직접 접근 범위 → 구현 시 Devnet 테스트로 확인

**Technical Debt Incurred:**

- 없음 (설계 마일스톤으로 코드 부채 없음, 위 이슈는 구현 시 해결 필요)

---

_For current project status, see .planning/ROADMAP.md_
