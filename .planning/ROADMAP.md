# Roadmap: WAIaaS

## Milestones

- ✅ **v0.1-v2.0** -- Phases 1-173 (shipped 2026-02-05 ~ 2026-02-18) -- See milestones/ archive
- ✅ **v2.2 테스트 커버리지 강화** -- Phases 178-181 (shipped 2026-02-18)
- ✅ **v2.3 Admin UI 기능별 메뉴 재구성** -- Phases 182-187 (shipped 2026-02-18)
- ✅ **v2.4 npm Trusted Publishing 전환** -- Phases 188-190 (shipped 2026-02-19)
- ✅ **v2.4.1 Admin UI 테스트 커버리지 복원** -- Phases 191-193 (shipped 2026-02-19)
- ✅ **v2.5 DX 품질 개선** -- Phases 194-197 (shipped 2026-02-19)
- ✅ **v2.6 Wallet SDK 설계** -- Phases 198-201 (shipped 2026-02-20)
- ✅ **v2.6.1 WAIaaS Wallet Signing SDK** -- Phases 202-205 (shipped 2026-02-20)
- ✅ **v2.7 지갑 앱 알림 채널** -- Phase 206 (shipped 2026-02-20)
- ✅ **v26.3 Push Relay Server** -- Phases 207-209 (shipped 2026-02-20)
- ✅ **v26.4 멀티 지갑 세션 + 에이전트 자기 발견** -- Phases 210-214 (shipped 2026-02-21)
- ✅ **v27.0 수신 트랜잭션 모니터링 설계** -- Phases 215-223 (shipped 2026-02-21)
- [ ] **v27.1 수신 트랜잭션 모니터링 구현** -- Phases 224-229 (in progress)

## Phases

<details>
<summary>✅ v0.1-v2.0 (Phases 1-173) -- SHIPPED 2026-02-18</summary>

See `.planning/milestones/` for archived phase details (v0.1-ROADMAP.md through v2.0-ROADMAP.md).

</details>

<details>
<summary>✅ v2.2 테스트 커버리지 강화 (Phases 178-181) -- SHIPPED 2026-02-18</summary>

- [x] Phase 178: adapter-solana 브랜치 커버리지 (2/2 plans) -- completed 2026-02-18
- [x] Phase 179: admin 함수 커버리지 (2/2 plans) -- completed 2026-02-18
- [x] Phase 180: CLI 라인/구문 커버리지 (1/1 plan) -- completed 2026-02-18
- [x] Phase 181: 임계값 검증 및 복원 (1/1 plan) -- completed 2026-02-18

See `.planning/milestones/v2.2-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v2.3 Admin UI 기능별 메뉴 재구성 (Phases 182-187) -- SHIPPED 2026-02-18</summary>

- [x] Phase 182: UI 공용 컴포넌트 (2/2 plans) -- completed 2026-02-18
- [x] Phase 183: 메뉴 재구성 + 신규 페이지 (3/3 plans) -- completed 2026-02-18
- [x] Phase 184: Settings 분산 배치 (2/2 plans) -- completed 2026-02-18
- [x] Phase 185: UX 강화 (2/2 plans) -- completed 2026-02-18
- [x] Phase 186: 마무리 (1/1 plan) -- completed 2026-02-18
- [x] Phase 187: 감사 갭 수정 (1/1 plan) -- completed 2026-02-18

See `.planning/milestones/v2.3-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v2.4 npm Trusted Publishing 전환 (Phases 188-190) -- SHIPPED 2026-02-19</summary>

- [x] Phase 188: 사전 준비 (1/1 plan) -- completed 2026-02-19
- [x] Phase 189: OIDC 전환 (2/2 plans) -- completed 2026-02-19
- [x] Phase 190: 검증 및 정리 (1/1 plan) -- completed 2026-02-19

See `.planning/milestones/v2.4-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v2.4.1 Admin UI 테스트 커버리지 복원 (Phases 191-193) -- SHIPPED 2026-02-19</summary>

- [x] Phase 191: Security + WalletConnect 페이지 테스트 (2/2 plans) -- completed 2026-02-19
- [x] Phase 192: System 페이지 테스트 (1/1 plan) -- completed 2026-02-19
- [x] Phase 193: 공용 컴포넌트 + 기존 페이지 개선 + 임계값 복원 (2/2 plans) -- completed 2026-02-19

See `.planning/milestones/v2.4.1-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v2.5 DX 품질 개선 (Phases 194-197) -- SHIPPED 2026-02-19</summary>

- [x] Phase 194: CLI + 데몬 시작 DX (2/2 plans) -- completed 2026-02-19
- [x] Phase 195: Quickstart + MCP DX (2/2 plans) -- completed 2026-02-19
- [x] Phase 196: README + SDK 문서 정합성 (2/2 plans) -- completed 2026-02-19
- [x] Phase 197: Docker + Python SDK DX (2/2 plans) -- completed 2026-02-19

See `.planning/milestones/v2.5-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v2.6 Wallet SDK 설계 (Phases 198-201) -- SHIPPED 2026-02-20</summary>

- [x] Phase 198: Signing Protocol v1 설계 (2/2 plans) -- completed 2026-02-19
- [x] Phase 199: Wallet SDK + 데몬 컴포넌트 설계 (2/2 plans) -- completed 2026-02-19
- [x] Phase 200: 알림 채널 + Push Relay Server 설계 (2/2 plans) -- completed 2026-02-19
- [x] Phase 201: 기존 설계 문서 갱신 + 교차 검증 (1/1 plan) -- completed 2026-02-20

See `.planning/milestones/v2.6-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v2.6.1 WAIaaS Wallet Signing SDK (Phases 202-205) -- SHIPPED 2026-02-20</summary>

- [x] Phase 202: 서명 프로토콜 + 데몬 인프라 + SDK 패키지 + ntfy 채널 (4/4 plans) -- completed 2026-02-20
- [x] Phase 203: Telegram 채널 + 채널 라우팅 + REST API + Admin UI (4/4 plans) -- completed 2026-02-20
- [x] Phase 204: Signing SDK 데몬 라이프사이클 연결 (2/2 plans) -- completed 2026-02-20
- [x] Phase 205: Admin Settings API + Skills 동기화 (3/3 plans) -- completed 2026-02-20

See `.planning/milestones/v2.6.1-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v2.7 지갑 앱 알림 채널 (Phase 206) -- SHIPPED 2026-02-20</summary>

- [x] Phase 206: 지갑 앱 알림 사이드 채널 (4/4 plans) -- completed 2026-02-20

See `.planning/milestones/v2.7-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v26.3 Push Relay Server (Phases 207-209) -- SHIPPED 2026-02-20</summary>

- [x] Phase 207: 데몬 SignRequest 인코딩 통일 (1/1 plan) -- completed 2026-02-20
- [x] Phase 208: Push Relay Server 구현 (5/5 plans) -- completed 2026-02-20
- [x] Phase 209: 배포 인프라 (2/2 plans) -- completed 2026-02-20

See `.planning/milestones/v26.3-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v26.4 멀티 지갑 세션 + 에이전트 자기 발견 (Phases 210-214) -- SHIPPED 2026-02-21</summary>

- [x] Phase 210: 세션 모델 재구조화 (3/3 plans) -- completed 2026-02-20
- [x] Phase 211: API 레이어 지갑 선택 (3/3 plans) -- completed 2026-02-20
- [x] Phase 212: 자기 발견 엔드포인트 (2/2 plans) -- completed 2026-02-20
- [x] Phase 213: 통합 레이어 (4/4 plans) -- completed 2026-02-20
- [x] Phase 214: 검증 보고서 + SDK 타입 수정 (3/3 plans) -- completed 2026-02-21

See `.planning/milestones/v26.4-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v27.0 수신 트랜잭션 모니터링 설계 (Phases 215-223) -- SHIPPED 2026-02-21</summary>

- [x] Phase 215: IChainSubscriber 인터페이스 + DB 스키마 설계 (2/2 plans) -- completed 2026-02-21
- [x] Phase 216: Solana 수신 감지 전략 설계 (1/1 plan) -- completed 2026-02-21
- [x] Phase 217: EVM 수신 감지 전략 설계 (1/1 plan) -- completed 2026-02-21
- [x] Phase 218: WebSocket 연결 관리 + 폴링 폴백 설계 (2/2 plans) -- completed 2026-02-21
- [x] Phase 219: 알림 이벤트 + 의심 입금 감지 설계 (2/2 plans) -- completed 2026-02-21
- [x] Phase 220: REST API + SDK/MCP 명세 설계 (2/2 plans) -- completed 2026-02-21
- [x] Phase 221: 설정 구조 + 설계 통합 검증 (2/2 plans) -- completed 2026-02-21
- [x] Phase 222: 설계 문서 Critical/High 불일치 수정 (2/2 plans) -- completed 2026-02-21
- [x] Phase 223: 알림 명세 보완 + 문서 정합성 (2/2 plans) -- completed 2026-02-21

See `.planning/milestones/v27.0-ROADMAP.md` for full details.

</details>

### v27.1 수신 트랜잭션 모니터링 구현 (In Progress)

**Milestone Goal:** v27.0에서 설계한 수신 트랜잭션 모니터링(doc 76, ITM-01~ITM-05)을 구현하여, 에이전트 지갑으로 들어오는 입금을 실시간 감지/저장/알림하는 상태 달성.

**Phase Numbering:**
- Integer phases (224, 225, ...): Planned milestone work
- Decimal phases (224.1, 224.2): Urgent insertions (marked with INSERTED)

- [x] **Phase 224: Core Types + DB Foundation** - IChainSubscriber 인터페이스, 타입 시스템, DB v21 마이그레이션 (completed 2026-02-21)
- [x] **Phase 225: Chain Subscriber Implementations** - SolanaIncomingSubscriber + EvmIncomingSubscriber 체인별 감지 구현 (completed 2026-02-21)
- [x] **Phase 226: Monitor Service + Resilience** - IncomingTxQueue, SubscriptionMultiplexer, IncomingTxMonitorService, 안전 규칙, 라이프사이클 (completed 2026-02-21)
- [x] **Phase 227: Config + Settings + Notifications** - config.toml [incoming] 섹션, SettingsService, HotReload, i18n 메시지 템플릿 (completed 2026-02-21)
- [x] **Phase 228: REST API + SDK + MCP** - 조회 API, TypeScript/Python SDK 메서드, MCP 도구, 스킬 파일 (completed 2026-02-21)
- [ ] **Phase 229: Integration Testing** - E2E 통합 테스트 (T-01~T-17, S-01~S-04), 6대 피트폴 검증

## Phase Details

### Phase 224: Core Types + DB Foundation
**Goal**: 모든 후속 단계가 의존하는 타입 시스템과 DB 스키마가 존재하여, 구독자와 서비스 코드가 컴파일되고 테스트 데이터를 삽입할 수 있는 상태
**Depends on**: Nothing (first phase of v27.1)
**Requirements**: SUB-01, STO-01
**Success Criteria** (what must be TRUE):
  1. IChainSubscriber 6-method 인터페이스가 @waiaas/core에 정의되어 있고, adapter-solana/adapter-evm에서 import하여 implements할 수 있다
  2. DB v21 마이그레이션이 실행되면 incoming_transactions 테이블(12 컬럼, 4 인덱스), incoming_tx_cursors 테이블, wallets.monitor_incoming 컬럼이 생성된다
  3. IncomingTransaction Zod 스키마와 IncomingTxStatus enum이 @waiaas/core에서 export되어 다른 패키지에서 사용할 수 있다
  4. pushSchema DDL, Drizzle 스키마, 마이그레이션 체인 테스트가 모두 통과한다
**Plans**: 2 plans

Plans:
- [ ] 224-01-PLAN.md -- IChainSubscriber 6-method interface + IncomingTxStatus enum + Zod SSoT schema + EventBus event types in @waiaas/core
- [ ] 224-02-PLAN.md -- DB v21 migration (incoming_transactions + incoming_tx_cursors + wallets.monitor_incoming) + Drizzle schema + migration chain tests

### Phase 225: Chain Subscriber Implementations
**Goal**: Solana와 EVM 체인에서 지갑 주소로 들어오는 입금(네이티브 + 토큰)을 감지하는 구독자가 동작하여, mock RPC 환경에서 수신 트랜잭션을 콜백으로 전달할 수 있는 상태
**Depends on**: Phase 224
**Requirements**: SUB-02, SUB-03, SUB-04, SUB-07
**Success Criteria** (what must be TRUE):
  1. SolanaIncomingSubscriber가 logsSubscribe WebSocket 구독으로 SOL/SPL/Token-2022 수신을 감지하고, getTransaction(jsonParsed)로 파싱하여 onTransaction 콜백을 호출한다
  2. EvmIncomingSubscriber가 getLogs 폴링으로 ERC-20 Transfer 이벤트를, getBlock 폴링으로 네이티브 ETH 수신을 감지하여 onTransaction 콜백을 호출한다
  3. WebSocket 연결 실패 시 3-state 연결 머신(WS_ACTIVE/POLLING_FALLBACK/RECONNECTING)이 자동으로 폴링 모드로 전환한다
  4. Solana 60초 하트비트(getSlot RPC)가 10분 비활성 타임아웃을 방지한다
**Plans**: 3 plans

Plans:
- [ ] 225-01-PLAN.md -- SolanaIncomingSubscriber + incoming-tx-parser + SolanaHeartbeat + tests
- [ ] 225-02-PLAN.md -- EvmIncomingSubscriber (getLogs + getBlock polling) + tests
- [ ] 225-03-PLAN.md -- 3-state connection machine (ConnectionState + calculateDelay + reconnectLoop) + tests

### Phase 226: Monitor Service + Resilience
**Goal**: IncomingTxMonitorService가 구독자들을 조율하여 수신 트랜잭션을 메모리 큐에 수집, 배치 flush로 DB에 저장, 의심 입금을 감지하고, KillSwitch 상태에 따라 알림을 제어하는 상태
**Depends on**: Phase 225
**Requirements**: SUB-05, SUB-06, STO-02, STO-03, STO-04, STO-05, EVT-01, EVT-03, EVT-04, EVT-05, CFG-04
**Success Criteria** (what must be TRUE):
  1. IncomingTxQueue가 Map 기반 중복 제거로 수신 트랜잭션을 수집하고, BackgroundWorkers 5초 배치 flush로 DB에 INSERT하며, ON CONFLICT DO NOTHING으로 중복을 방지한다
  2. SubscriptionMultiplexer가 동일 chain:network 조합의 WebSocket 연결을 공유하며, 연결 끊김 시 지수 백오프(1s->60s + jitter)로 재연결하고, 3회 실패 후 폴링 폴백한다
  3. 재연결 후 incoming_tx_cursors 테이블의 커서 기준으로 blind gap recovery가 실행되어 끊어진 동안의 트랜잭션을 복구한다
  4. DustAttackRule/UnknownTokenRule/LargeAmountRule 3개 안전 규칙이 의심 입금을 감지하면 transaction:incoming:suspicious 이벤트가 발생하고, KillSwitch SUSPENDED/LOCKED 상태에서는 알림이 억제되지만 DB 기록은 유지된다
  5. 데몬 종료 시 IncomingTxMonitorService.stop()이 큐의 미처리 트랜잭션을 최종 flush하고, 보존 정책 워커가 incoming_retention_days 초과 레코드를 자동 삭제한다
**Plans**: 4 plans

Plans:
- [ ] 226-01-PLAN.md -- IncomingTxQueue (Map dedup + batch flush + ON CONFLICT DO NOTHING)
- [ ] 226-02-PLAN.md -- SubscriptionMultiplexer (connection sharing + reconnection + polling fallback)
- [ ] 226-03-PLAN.md -- Gap recovery + confirmation upgrade worker + retention policy worker
- [ ] 226-04-PLAN.md -- IncomingTxMonitorService orchestrator + 3 safety rules + DaemonLifecycle Step 4c-9

### Phase 227: Config + Settings + Notifications
**Goal**: 운영자가 config.toml [incoming] 섹션과 Admin Settings로 모니터링을 구성하고, 수신 트랜잭션 알림이 한국어/영어 템플릿으로 전달되는 상태
**Depends on**: Phase 224
**Requirements**: CFG-01, CFG-02, CFG-03, CFG-05, EVT-02, EVT-06
**Success Criteria** (what must be TRUE):
  1. config.toml에 [incoming] 섹션 7키(enabled, mode, poll_interval, retention_days, suspicious_dust_usd, suspicious_amount_multiplier, wss_url)가 Zod 스키마로 검증되고, WAIAAS_INCOMING_* 환경 변수로 오버라이드 가능하다
  2. SettingsService에 'incoming' 카테고리 7키가 등록되어 Admin Settings UI에서 런타임 변경 가능하고, HotReloadOrchestrator가 변경 시 모니터 서비스를 재시작한다
  3. NotificationEventType에 TX_INCOMING/TX_INCOMING_SUSPICIOUS가 추가되어 총 30개 타입이 되고, en/ko i18n 메시지 템플릿이 정의되어 4채널(Telegram/Discord/ntfy/Slack)로 전달된다
**Plans**: 2 plans

Plans:
- [ ] 227-01-PLAN.md -- config.toml [incoming] Zod schema + KNOWN_SECTIONS + env var mapping + config-loader tests + CFG-02/CFG-03 verification
- [ ] 227-02-PLAN.md -- NotificationEventType TX_INCOMING/TX_INCOMING_SUSPICIOUS + en/ko i18n templates + BROADCAST_EVENTS + monitor service fix + Admin UI IncomingSettings

### Phase 228: REST API + SDK + MCP
**Goal**: 에이전트와 사용자가 REST API, TypeScript/Python SDK, MCP 도구를 통해 수신 트랜잭션 내역을 조회하고, 지갑별 모니터링을 활성화/비활성화할 수 있는 상태
**Depends on**: Phase 226, Phase 227
**Requirements**: API-01, API-02, API-03, API-04, API-05, API-06, API-07
**Success Criteria** (what must be TRUE):
  1. GET /v1/wallet/incoming이 커서 페이지네이션과 chain/network/status/token 필터로 수신 트랜잭션 목록을 반환하며, 기본 필터가 status=CONFIRMED이다
  2. GET /v1/wallet/incoming/summary가 기간별(daily/weekly/monthly) 수신 총액을 USD 환산 포함하여 반환한다
  3. PATCH /v1/wallet/:id에 monitorIncoming 필드를 전달하면 지갑별 모니터링이 토글되고, syncSubscriptions()가 비동기로 실행된다
  4. TypeScript SDK의 listIncomingTransactions()/getIncomingTransactionSummary()와 Python SDK의 list_incoming_transactions()/get_incoming_transaction_summary()가 API를 호출하여 결과를 반환한다
  5. MCP에 list-incoming-transactions/get-incoming-summary 2개 도구가 추가되어 총 22+ 도구가 되고, wallet.skill.md에 수신 트랜잭션 섹션이 추가된다
**Plans**: 3 plans

Plans:
- [ ] 228-01-PLAN.md -- REST API endpoints (GET /v1/wallet/incoming + GET /v1/wallet/incoming/summary + PATCH /v1/wallets/:id monitorIncoming) with OpenAPI schemas
- [ ] 228-02-PLAN.md -- TypeScript SDK (listIncomingTransactions + getIncomingTransactionSummary) + Python SDK (list_incoming_transactions + get_incoming_transaction_summary)
- [ ] 228-03-PLAN.md -- MCP tools (list_incoming_transactions + get_incoming_summary) + wallet.skill.md update

### Phase 229: Integration Testing
**Goal**: 수신 트랜잭션 모니터링 전체 파이프라인이 E2E로 검증되어, 6대 피트폴(WebSocket 리스너 누수, SQLite 이벤트 루프 고갈, 미확정 TX 소비, 중복 이벤트, 셧다운 데이터 손실, EVM reorg)이 모두 테스트로 방어되는 상태
**Depends on**: Phase 228
**Requirements**: (cross-cutting validation of all requirements)
**Success Criteria** (what must be TRUE):
  1. WebSocket 연결을 10회 반복 연결/해제해도 리스너 수가 일정하게 유지된다 (C-01 검증)
  2. 큐에 10개 트랜잭션을 넣고 stop()을 호출하면 10개 모두 DB에 기록된다 (C-05 검증)
  3. 50-블록 갭을 시뮬레이션하면 gap recovery가 누락된 모든 트랜잭션을 복구한다
  4. KillSwitch를 SUSPENDED로 설정하고 TX를 flush하면 DB에는 기록되지만 EventBus 이벤트는 발생하지 않는다 (M-03 검증)
  5. 50개 더스트 TX를 연속 전송해도 알림이 5개 이하로 제한된다 (M-07 검증)
**Plans**: TBD

Plans:
- [ ] 229-01: 핵심 피트폴 E2E 테스트 (C-01, C-02, C-04, C-05, C-06)
- [ ] 229-02: 보안 + 복원력 E2E 테스트 (gap recovery, KillSwitch, 알림 쿨다운)

## Progress

**Execution Order:**
Phases execute in numeric order: 224 -> 225 -> 226 -> 227 -> 228 -> 229
Note: Phase 227 depends only on Phase 224 and can logically run in parallel with Phases 225-226.

| Phase | Milestone | Plans Complete | Status | Completed |
|-------|-----------|----------------|--------|-----------|
| 1-173 | v0.1-v2.0 | -- | Complete | 2026-02-18 |
| 178-181 | v2.2 | 6/6 | Complete | 2026-02-18 |
| 182-187 | v2.3 | 11/11 | Complete | 2026-02-18 |
| 188-190 | v2.4 | 4/4 | Complete | 2026-02-19 |
| 191-193 | v2.4.1 | 5/5 | Complete | 2026-02-19 |
| 194-197 | v2.5 | 8/8 | Complete | 2026-02-19 |
| 198-201 | v2.6 | 7/7 | Complete | 2026-02-20 |
| 202-205 | v2.6.1 | 13/13 | Complete | 2026-02-20 |
| 206 | v2.7 | 4/4 | Complete | 2026-02-20 |
| 207-209 | v26.3 | 8/8 | Complete | 2026-02-20 |
| 210-214 | v26.4 | 15/15 | Complete | 2026-02-21 |
| 215-223 | v27.0 | 16/16 | Complete | 2026-02-21 |
| 224. Core Types + DB | 2/2 | Complete    | 2026-02-21 | - |
| 225. Chain Subscribers | 3/3 | Complete    | 2026-02-21 | - |
| 226. Monitor Service | 4/4 | Complete   | 2026-02-21 | - |
| 227. Config + Notifications | 2/2 | Complete   | 2026-02-21 | - |
| 228. REST API + SDK + MCP | 3/3 | Complete   | 2026-02-21 | - |
| 229. Integration Testing | v27.1 | 0/2 | Not started | - |
