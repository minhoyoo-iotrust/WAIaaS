# Roadmap: WAIaaS

## Milestones

- ✅ **v0.1-v2.0** — Phases 1-173 (shipped 2026-02-05 ~ 2026-02-18) — See milestones/ archive
- ✅ **v2.2 테스트 커버리지 강화** — Phases 178-181 (shipped 2026-02-18)
- ✅ **v2.3 Admin UI 기능별 메뉴 재구성** — Phases 182-187 (shipped 2026-02-18)
- ✅ **v2.4 npm Trusted Publishing 전환** — Phases 188-190 (shipped 2026-02-19)
- ✅ **v2.4.1 Admin UI 테스트 커버리지 복원** — Phases 191-193 (shipped 2026-02-19)
- ✅ **v2.5 DX 품질 개선** — Phases 194-197 (shipped 2026-02-19)
- ✅ **v2.6 Wallet SDK 설계** — Phases 198-201 (shipped 2026-02-20)
- ✅ **v2.6.1 WAIaaS Wallet Signing SDK** — Phases 202-205 (shipped 2026-02-20)
- ✅ **v2.7 지갑 앱 알림 채널** — Phase 206 (shipped 2026-02-20)
- ✅ **v26.3 Push Relay Server** — Phases 207-209 (shipped 2026-02-20)
- ✅ **v26.4 멀티 지갑 세션 + 에이전트 자기 발견** — Phases 210-214 (shipped 2026-02-21)

## Phases

<details>
<summary>✅ v0.1-v2.0 (Phases 1-173) — SHIPPED 2026-02-18</summary>

See `.planning/milestones/` for archived phase details (v0.1-ROADMAP.md through v2.0-ROADMAP.md).

</details>

<details>
<summary>✅ v2.2 테스트 커버리지 강화 (Phases 178-181) — SHIPPED 2026-02-18</summary>

- [x] Phase 178: adapter-solana 브랜치 커버리지 (2/2 plans) — completed 2026-02-18
- [x] Phase 179: admin 함수 커버리지 (2/2 plans) — completed 2026-02-18
- [x] Phase 180: CLI 라인/구문 커버리지 (1/1 plan) — completed 2026-02-18
- [x] Phase 181: 임계값 검증 및 복원 (1/1 plan) — completed 2026-02-18

See `.planning/milestones/v2.2-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v2.3 Admin UI 기능별 메뉴 재구성 (Phases 182-187) — SHIPPED 2026-02-18</summary>

- [x] Phase 182: UI 공용 컴포넌트 (2/2 plans) — completed 2026-02-18
- [x] Phase 183: 메뉴 재구성 + 신규 페이지 (3/3 plans) — completed 2026-02-18
- [x] Phase 184: Settings 분산 배치 (2/2 plans) — completed 2026-02-18
- [x] Phase 185: UX 강화 (2/2 plans) — completed 2026-02-18
- [x] Phase 186: 마무리 (1/1 plan) — completed 2026-02-18
- [x] Phase 187: 감사 갭 수정 (1/1 plan) — completed 2026-02-18

See `.planning/milestones/v2.3-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v2.4 npm Trusted Publishing 전환 (Phases 188-190) — SHIPPED 2026-02-19</summary>

- [x] Phase 188: 사전 준비 (1/1 plan) — completed 2026-02-19
- [x] Phase 189: OIDC 전환 (2/2 plans) — completed 2026-02-19
- [x] Phase 190: 검증 및 정리 (1/1 plan) — completed 2026-02-19

See `.planning/milestones/v2.4-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v2.4.1 Admin UI 테스트 커버리지 복원 (Phases 191-193) — SHIPPED 2026-02-19</summary>

- [x] Phase 191: Security + WalletConnect 페이지 테스트 (2/2 plans) — completed 2026-02-19
- [x] Phase 192: System 페이지 테스트 (1/1 plan) — completed 2026-02-19
- [x] Phase 193: 공용 컴포넌트 + 기존 페이지 개선 + 임계값 복원 (2/2 plans) — completed 2026-02-19

See `.planning/milestones/v2.4.1-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v2.5 DX 품질 개선 (Phases 194-197) — SHIPPED 2026-02-19</summary>

- [x] Phase 194: CLI + 데몬 시작 DX (2/2 plans) — completed 2026-02-19
- [x] Phase 195: Quickstart + MCP DX (2/2 plans) — completed 2026-02-19
- [x] Phase 196: README + SDK 문서 정합성 (2/2 plans) — completed 2026-02-19
- [x] Phase 197: Docker + Python SDK DX (2/2 plans) — completed 2026-02-19

See `.planning/milestones/v2.5-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v2.6 Wallet SDK 설계 (Phases 198-201) — SHIPPED 2026-02-20</summary>

- [x] Phase 198: Signing Protocol v1 설계 (2/2 plans) — completed 2026-02-19
- [x] Phase 199: Wallet SDK + 데몬 컴포넌트 설계 (2/2 plans) — completed 2026-02-19
- [x] Phase 200: 알림 채널 + Push Relay Server 설계 (2/2 plans) — completed 2026-02-19
- [x] Phase 201: 기존 설계 문서 갱신 + 교차 검증 (1/1 plan) — completed 2026-02-20

See `.planning/milestones/v2.6-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v2.6.1 WAIaaS Wallet Signing SDK (Phases 202-205) — SHIPPED 2026-02-20</summary>

- [x] Phase 202: 서명 프로토콜 + 데몬 인프라 + SDK 패키지 + ntfy 채널 (4/4 plans) — completed 2026-02-20
- [x] Phase 203: Telegram 채널 + 채널 라우팅 + REST API + Admin UI (4/4 plans) — completed 2026-02-20
- [x] Phase 204: Signing SDK 데몬 라이프사이클 연결 (2/2 plans) — completed 2026-02-20
- [x] Phase 205: Admin Settings API + Skills 동기화 (3/3 plans) — completed 2026-02-20

See `.planning/milestones/v2.6.1-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v2.7 지갑 앱 알림 채널 (Phase 206) — SHIPPED 2026-02-20</summary>

- [x] Phase 206: 지갑 앱 알림 사이드 채널 (4/4 plans) — completed 2026-02-20

See `.planning/milestones/v2.7-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v26.3 Push Relay Server (Phases 207-209) — SHIPPED 2026-02-20</summary>

- [x] Phase 207: 데몬 SignRequest 인코딩 통일 (1/1 plan) — completed 2026-02-20
- [x] Phase 208: Push Relay Server 구현 (5/5 plans) — completed 2026-02-20
- [x] Phase 209: 배포 인프라 (2/2 plans) — completed 2026-02-20

See `.planning/milestones/v26.3-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v26.4 멀티 지갑 세션 + 에이전트 자기 발견 (Phases 210-214) — SHIPPED 2026-02-21</summary>

- [x] Phase 210: 세션 모델 재구조화 (3/3 plans) — completed 2026-02-20
- [x] Phase 211: API 레이어 지갑 선택 (3/3 plans) — completed 2026-02-20
- [x] Phase 212: 자기 발견 엔드포인트 (2/2 plans) — completed 2026-02-20
- [x] Phase 213: 통합 레이어 (4/4 plans) — completed 2026-02-20
- [x] Phase 214: 검증 보고서 + SDK 타입 수정 (3/3 plans) — completed 2026-02-21

See `.planning/milestones/v26.4-ROADMAP.md` for full details.

</details>

### v27.0 수신 트랜잭션 모니터링 설계

**Milestone Goal:** 지갑으로 들어오는 수신 트랜잭션을 실시간 감지/기록/알림하는 인프라를 설계 수준에서 정의

- [x] **Phase 215: IChainSubscriber 인터페이스 + DB 스키마 설계** - 모니터링 핵심 인터페이스와 데이터 모델 정의
- [x] **Phase 216: Solana 수신 감지 전략 설계** - SolanaSubscriber의 구독/파싱/ATA 전략 명세
- [x] **Phase 217: EVM 수신 감지 전략 설계** - EvmSubscriber의 폴링/이벤트 파싱 전략 명세
- [x] **Phase 218: WebSocket 연결 관리 + 폴링 폴백 설계** - 재연결, 멀티플렉서, 블라인드 구간 복구 명세
- [x] **Phase 219: 알림 이벤트 + 의심 입금 감지 설계** - 2개 이벤트 타입, 감지 규칙, i18n 메시지 명세
- [x] **Phase 220: REST API + SDK/MCP 명세 설계** - 수신 이력 조회 엔드포인트, SDK/MCP 도구 명세
- [x] **Phase 221: 설정 구조 + 설계 통합 검증** - config.toml [incoming] 섹션, 지갑별 opt-in, 교차 검증
- [x] **Phase 222: 설계 문서 Critical/High 불일치 수정** - GAP-1~4 + FLOW-2 수정으로 구현 전 설계 완결성 확보 (completed 2026-02-21)
- [ ] **Phase 223: 알림 명세 보완 + 문서 정합성** - NOTIFY-1, getDecimals, doc 31, skills/ 보완

## Phase Details

### Phase 215: IChainSubscriber 인터페이스 + DB 스키마 설계
**Goal**: 모든 체인 구독자가 구현할 공통 인터페이스와 수신 트랜잭션 저장 데이터 모델이 정의됨
**Depends on**: Nothing (첫 번째 phase — 하위 모든 phase가 이 인터페이스와 스키마에 의존)
**Requirements**: MON-01, DATA-01, DATA-02, DATA-03, DATA-04
**Success Criteria** (what must be TRUE):
  1. IChainSubscriber 인터페이스가 subscribe/unsubscribe/subscribedAddresses/destroy 4개 메서드와 IncomingTransaction 타입을 포함하여 Solana/EVM 양쪽 구현 가능한 수준으로 정의됨
  2. incoming_transactions 테이블 DDL이 id, tx_hash, wallet_id, from_address, amount, token_address, chain, status(DETECTED/CONFIRMED), confirmed_at 컬럼과 인덱스를 포함하여 완성됨
  3. tx_hash UNIQUE 제약 + ON CONFLICT IGNORE 중복 방지 전략이 명세됨
  4. retention_days 기반 자동 삭제 스케줄러와 v21 마이그레이션 전략이 정의됨
**Plans**: TBD

Plans:
- [x] 215-01: IChainSubscriber 인터페이스 + IncomingTransaction 타입 정의
- [x] 215-02: incoming_transactions 테이블 스키마 + 중복 방지 + 보존 정책 + 마이그레이션 명세

### Phase 216: Solana 수신 감지 전략 설계
**Goal**: SolanaIncomingSubscriber가 SOL + SPL 토큰(Token-2022 포함) 수신을 빠짐없이 감지하는 전략이 정의됨
**Depends on**: Phase 215 (IChainSubscriber 인터페이스)
**Requirements**: MON-02, MON-08
**Success Criteria** (what must be TRUE):
  1. logsSubscribe(mentions) + getTransaction(jsonParsed) 조합으로 SOL 네이티브 전송과 SPL 토큰 전송을 모두 파싱하는 알고리즘이 preBalances/postBalances, preTokenBalances/postTokenBalances 기반으로 정의됨
  2. 기존 ATA 구독 + 신규 ATA 생성 감지를 포함하는 2레벨 구독 설계가 Token-2022 Program ID까지 포함하여 완성됨
  3. getSignaturesForAddress 폴링 폴백의 커서 관리 전략과 confirmed/finalized 2단계 commitment 정책이 명세됨
**Plans**: TBD

Plans:
- [x] 216-01: SolanaIncomingSubscriber 구독 전략 + TX 파싱 알고리즘 + ATA 감지 명세

### Phase 217: EVM 수신 감지 전략 설계
**Goal**: EvmIncomingSubscriber가 네이티브 ETH + ERC-20 토큰 수신을 빠짐없이 감지하는 전략이 정의됨
**Depends on**: Phase 215 (IChainSubscriber 인터페이스)
**Requirements**: MON-03
**Success Criteria** (what must be TRUE):
  1. eth_subscribe(logs) Transfer 이벤트 필터로 ERC-20 수신을 감지하고, watchBlocks(includeTransactions:true) + to-주소 필터로 네이티브 ETH 수신을 감지하는 이중 전략이 정의됨
  2. getLogs 폴링 폴백의 fromBlock/toBlock 커서 관리와 12초 BackgroundWorkers 간격이 명세됨
  3. token_registry 화이트리스트 필터로 Transfer 이벤트 오탐을 방지하는 전략이 포함됨
**Plans**: TBD

Plans:
- [x] 217-01: EvmIncomingSubscriber 감지 전략 + ETH/ERC-20 파싱 + 폴링 명세

### Phase 218: WebSocket 연결 관리 + 폴링 폴백 설계
**Goal**: Solana/EVM 공통 WebSocket 재연결, 연결 공유, 블라인드 구간 복구 전략이 정의됨
**Depends on**: Phase 216, Phase 217 (체인별 구독 전략 확정 후 공통 관리 계층 통합)
**Requirements**: MON-04, MON-05, MON-06, MON-07, MON-09
**Success Criteria** (what must be TRUE):
  1. WebSocket 연결 실패 시 폴링 폴백 자동 전환 + WebSocket 복구 시 자동 복귀 전략이 상태 머신으로 정의됨
  2. 지수 백오프 재연결(1s-2s-4s-...-60s + jitter), heartbeat(60초 ping), 연결 상태 모니터링이 명세됨
  3. 같은 체인의 여러 지갑이 하나의 WebSocket 연결을 공유하는 멀티플렉서와 Map<walletId, unsubscribeFn> 구독 레지스트리가 정의됨
  4. 런타임 지갑 추가/삭제/활성화/비활성화에 따른 동적 구독 관리가 커버됨
  5. 재연결 시 마지막 처리 커서 이후 갭 보상 폴링으로 블라인드 구간 TX 유실을 방지하는 전략이 명세됨
**Plans**: TBD

Plans:
- [x] 218-01: 폴링 폴백 전환 상태 머신 + 재연결 백오프 + heartbeat 명세
- [x] 218-02: WebSocket 멀티플렉서 + 구독 레지스트리 + 동적 관리 + 블라인드 구간 복구 명세

### Phase 219: 알림 이벤트 + 의심 입금 감지 설계
**Goal**: 수신 TX 감지 시 기존 알림 인프라를 통해 Owner/에이전트에 통보하고 의심 입금을 식별하는 체계가 정의됨
**Depends on**: Phase 215 (IncomingTransaction 타입)
**Requirements**: EVT-01, EVT-02, EVT-03, EVT-04, EVT-05
**Success Criteria** (what must be TRUE):
  1. INCOMING_TX_DETECTED 이벤트 스키마가 walletId, txHash, from, amount, token, chain 페이로드를 포함하여 정의됨
  2. INCOMING_TX_SUSPICIOUS 이벤트 스키마가 의심 사유(dust/unknownToken/largeAmount) 필드를 포함하여 정의됨
  3. 기존 4채널(Telegram/Discord/ntfy/Slack) + WalletNotificationChannel 연동 명세가 이벤트 카테고리 확장을 포함하여 정의됨
  4. IIncomingSafetyRule 인터페이스가 dust attack, 미등록 토큰, 대량 입금 3개 규칙을 포함하고 i18n 메시지 템플릿(en/ko)이 정의됨
**Plans**: TBD

Plans:
- [x] 219-01: INCOMING_TX_DETECTED/SUSPICIOUS 이벤트 스키마 + 알림 채널 연동 명세
- [x] 219-02: IIncomingSafetyRule 인터페이스 + 감지 규칙 3종 + i18n 메시지 템플릿

### Phase 220: REST API + SDK/MCP 명세 설계
**Goal**: 수신 이력 조회를 위한 REST API, SDK 메서드, MCP 도구가 명세됨
**Depends on**: Phase 215 (DB 스키마), Phase 219 (이벤트 스키마)
**Requirements**: API-01, API-02, API-03, API-04, API-05
**Success Criteria** (what must be TRUE):
  1. GET /v1/wallet/incoming 엔드포인트가 cursor pagination, 필터(from_address, token, since/until, chain)를 포함하여 OpenAPI 수준으로 명세됨
  2. IncomingTransactionQuerySchema, IncomingTransactionResponseSchema가 Zod SSoT로 정의됨
  3. SDK listIncomingTransactions 메서드가 TS/Python 인터페이스로, MCP list_incoming_transactions 도구가 도구 스키마로 정의됨
  4. GET /v1/wallet/incoming/summary 집계 엔드포인트가 일별/주별/월별 수신 합계 스키마로 정의됨
**Plans**: TBD

Plans:
- [x] 220-01: REST API 엔드포인트 스키마 + Zod SSoT 명세
- [x] 220-02: SDK/MCP 인터페이스 + summary 집계 엔드포인트 명세

### Phase 221: 설정 구조 + 설계 통합 검증
**Goal**: config.toml [incoming] 섹션과 지갑별 opt-in 설정이 정의되고, 전체 설계가 기존 코드베이스와 충돌 없이 통합됨
**Depends on**: Phase 215-220 (모든 설계 완료 후 통합 검증)
**Requirements**: CFG-01, CFG-02, CFG-03, VER-01, VER-02, VER-03
**Success Criteria** (what must be TRUE):
  1. config.toml [incoming] 섹션 6개 키(enabled, mode, poll_interval, retention_days, suspicious_dust_usd, suspicious_amount_multiplier)가 기존 평탄화 원칙에 맞게 정의됨
  2. wallets 테이블 monitor_incoming 컬럼 추가와 API 필드 확장이 명세되고, 환경변수 매핑(WAIAAS_INCOMING_*)이 기존 패턴과 일관됨
  3. 기존 설계 문서 9개(25/27/28/29/31/35/37/38/75) 영향 분석이 변경 범위와 함께 문서화됨
  4. 17개 핵심 검증 시나리오(T-01~T-17) + 4개 보안 시나리오(S-01~S-04)가 설계 문서에 명시됨
  5. Zod SSoT 파이프라인, config.toml 평탄화 원칙, 에러 코드 체계와의 충돌이 없음이 교차 검증됨
**Plans**: TBD

Plans:
- [x] 221-01: config.toml [incoming] 섹션 + 지갑별 opt-in + 환경변수 매핑 명세
- [x] 221-02: 기존 설계 문서 영향 분석 + 검증 시나리오 + 교차 검증 체크리스트

### Phase 222: 설계 문서 Critical/High 불일치 수정
**Goal**: 감사에서 발견된 Critical/High 설계 불일치 4건을 수정하여 구현 전 설계 완결성 확보
**Depends on**: Phase 221 (통합 검증 완료 후 불일치 수정)
**Requirements**: Gap closure (MON-01, MON-03, MON-04, API-05 관련 설계 내부 일관성)
**Gap Closure**: GAP-1, GAP-2, GAP-3, GAP-4, FLOW-2
**Success Criteria** (what must be TRUE):
  1. IChainSubscriber에 connect()/waitForDisconnect() 메서드가 추가되거나 reconnectLoop 시그니처가 일관되게 변경됨
  2. incoming-tx-poll-evm, incoming-tx-poll-solana BackgroundWorker가 §8.9 DaemonLifecycle Step 6에 등록됨
  3. Summary SQL의 incoming_tx_suspicious 테이블 참조가 is_suspicious 컬럼으로 대체됨 (§2.1, §2.7, §7.6 일관)
  4. eventBus.emit('transaction:incoming') 이벤트 타입이 IncomingTxEvent와 일치하게 통일됨
  5. FLOW-2 (WebSocket 실패 → 폴링 폴백) E2E 흐름이 완성됨
**Plans**: 2 plans

Plans:
- [ ] 222-01-PLAN.md — IChainSubscriber 인터페이스 connect()/waitForDisconnect() 추가 + eventBus 타입 통일 (GAP-1, GAP-4)
- [ ] 222-02-PLAN.md — 폴링 BackgroundWorker 등록 + is_suspicious 컬럼 + FLOW-2 E2E 완성 (GAP-2, GAP-3, FLOW-2)

### Phase 223: 알림 명세 보완 + 문서 정합성
**Goal**: Medium/Low 설계 보완 4건을 수정하여 구현 마일스톤 진입 준비 완료
**Depends on**: Phase 222 (Critical/High 수정 후 나머지 보완)
**Requirements**: Gap closure (EVT-02, EVT-05, VER-01 관련 명세 보완)
**Gap Closure**: NOTIFY-1, getDecimals, doc 31 PATCH, skills/
**Success Criteria** (what must be TRUE):
  1. SUSPICIOUS 이벤트 priority:high 라우팅 메커니즘이 NotificationService.notify() 호출 시 priority 전달 방법으로 명세됨
  2. getDecimals() 헬퍼 함수가 DustAttackRule, LargeAmountRule에서 사용 가능한 수준으로 정의됨
  3. §8.6 doc 31 영향 분석에 PATCH /v1/wallet/:id 변경이 추가됨
  4. skills/ 파일 업데이트 요구사항(wallet.skill.md, transactions.skill.md)이 명시됨
**Plans**: TBD

Plans:
- [ ] 223-01: SUSPICIOUS priority 라우팅 + getDecimals() 헬퍼 명세
- [ ] 223-02: doc 31 PATCH 영향 분석 추가 + skills/ 업데이트 요구사항 명시

## Progress

**Execution Order:**
Phases execute in numeric order: 215 -> 216 -> 217 -> 218 -> 219 -> 220 -> 221 -> 222 -> 223

| Phase | Milestone | Plans Complete | Status | Completed |
|-------|-----------|----------------|--------|-----------|
| 1-173 | v0.1-v2.0 | -- | Complete | 2026-02-18 |
| 178-181 | v2.2 | 6/6 | Complete | 2026-02-18 |
| 182-187 | v2.3 | 11/11 | Complete | 2026-02-18 |
| 188-190 | v2.4 | 4/4 | Complete | 2026-02-19 |
| 191-193 | v2.4.1 | 5/5 | Complete | 2026-02-19 |
| 194-197 | v2.5 | 8/8 | Complete | 2026-02-19 |
| 198-201 | v2.6 | 7/7 | Complete | 2026-02-20 |
| 202-205 | v2.6.1 | 13/13 | Complete | 2026-02-20 |
| 206 | v2.7 | 4/4 | Complete | 2026-02-20 |
| 207-209 | v26.3 | 8/8 | Complete | 2026-02-20 |
| 210-214 | v26.4 | 15/15 | Complete | 2026-02-21 |
| 215. IChainSubscriber + DB 스키마 | v27.0 | 2/2 | Complete | 2026-02-21 |
| 216. Solana 감지 전략 | v27.0 | 1/1 | Complete | 2026-02-21 |
| 217. EVM 감지 전략 | v27.0 | 1/1 | Complete | 2026-02-21 |
| 218. WebSocket 관리 + 폴백 | v27.0 | 2/2 | Complete | 2026-02-21 |
| 219. 알림 이벤트 + 의심 감지 | v27.0 | 2/2 | Complete | 2026-02-21 |
| 220. REST API + SDK/MCP | v27.0 | 2/2 | Complete | 2026-02-21 |
| 221. 설정 + 통합 검증 | v27.0 | 2/2 | Complete | 2026-02-21 |
| 222. 설계 Critical/High 수정 | 2/2 | Complete   | 2026-02-21 | — |
| 223. 알림 명세 + 문서 정합성 | v27.0 | 0/2 | Pending | — |
