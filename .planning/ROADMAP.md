# Roadmap: WAIaaS

## Milestones

- ✅ **v0.1-v2.0** -- Phases 1-173 (shipped 2026-02-05 ~ 2026-02-18) -- See milestones/ archive
- ✅ **v2.2 테스트 커버리지 강화** -- Phases 178-181 (shipped 2026-02-18)
- ✅ **v2.3 Admin UI 기능별 메뉴 재구성** -- Phases 182-187 (shipped 2026-02-18)
- ✅ **v2.4 npm Trusted Publishing 전환** -- Phases 188-190 (shipped 2026-02-19)
- ✅ **v2.4.1 Admin UI 테스트 커버리지 복원** -- Phases 191-193 (shipped 2026-02-19)
- ✅ **v2.5 DX 품질 개선** -- Phases 194-197 (shipped 2026-02-19)
- ✅ **v2.6 Wallet SDK 설계** -- Phases 198-201 (shipped 2026-02-20)
- ✅ **v2.6.1 WAIaaS Wallet Signing SDK** -- Phases 202-205 (shipped 2026-02-20)
- ✅ **v2.7 지갑 앱 알림 채널** -- Phase 206 (shipped 2026-02-20)
- ✅ **v26.3 Push Relay Server** -- Phases 207-209 (shipped 2026-02-20)
- ✅ **v26.4 멀티 지갑 세션 + 에이전트 자기 발견** -- Phases 210-214 (shipped 2026-02-21)
- ✅ **v27.0 수신 트랜잭션 모니터링 설계** -- Phases 215-223 (shipped 2026-02-21)
- ✅ **v27.1 수신 트랜잭션 모니터링 구현** -- Phases 224-230 (shipped 2026-02-22)
- [ ] **v27.2 CAIP-19 자산 식별 표준** -- Phases 231-234 (in progress)

## Phases

<details>
<summary>✅ v0.1-v2.0 (Phases 1-173) -- SHIPPED 2026-02-18</summary>

See `.planning/milestones/` for archived phase details (v0.1-ROADMAP.md through v2.0-ROADMAP.md).

</details>

<details>
<summary>✅ v2.2 테스트 커버리지 강화 (Phases 178-181) -- SHIPPED 2026-02-18</summary>

- [x] Phase 178: adapter-solana 브랜치 커버리지 (2/2 plans) -- completed 2026-02-18
- [x] Phase 179: admin 함수 커버리지 (2/2 plans) -- completed 2026-02-18
- [x] Phase 180: CLI 라인/구문 커버리지 (1/1 plan) -- completed 2026-02-18
- [x] Phase 181: 임계값 검증 및 복원 (1/1 plan) -- completed 2026-02-18

See `.planning/milestones/v2.2-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v2.3 Admin UI 기능별 메뉴 재구성 (Phases 182-187) -- SHIPPED 2026-02-18</summary>

- [x] Phase 182: UI 공용 컴포넌트 (2/2 plans) -- completed 2026-02-18
- [x] Phase 183: 메뉴 재구성 + 신규 페이지 (3/3 plans) -- completed 2026-02-18
- [x] Phase 184: Settings 분산 배치 (2/2 plans) -- completed 2026-02-18
- [x] Phase 185: UX 강화 (2/2 plans) -- completed 2026-02-18
- [x] Phase 186: 마무리 (1/1 plan) -- completed 2026-02-18
- [x] Phase 187: 감사 갭 수정 (1/1 plan) -- completed 2026-02-18

See `.planning/milestones/v2.3-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v2.4 npm Trusted Publishing 전환 (Phases 188-190) -- SHIPPED 2026-02-19</summary>

- [x] Phase 188: 사전 준비 (1/1 plan) -- completed 2026-02-19
- [x] Phase 189: OIDC 전환 (2/2 plans) -- completed 2026-02-19
- [x] Phase 190: 검증 및 정리 (1/1 plan) -- completed 2026-02-19

See `.planning/milestones/v2.4-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v2.4.1 Admin UI 테스트 커버리지 복원 (Phases 191-193) -- SHIPPED 2026-02-19</summary>

- [x] Phase 191: Security + WalletConnect 페이지 테스트 (2/2 plans) -- completed 2026-02-19
- [x] Phase 192: System 페이지 테스트 (1/1 plan) -- completed 2026-02-19
- [x] Phase 193: 공용 컴포넌트 + 기존 페이지 개선 + 임계값 복원 (2/2 plans) -- completed 2026-02-19

See `.planning/milestones/v2.4.1-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v2.5 DX 품질 개선 (Phases 194-197) -- SHIPPED 2026-02-19</summary>

- [x] Phase 194: CLI + 데몬 시작 DX (2/2 plans) -- completed 2026-02-19
- [x] Phase 195: Quickstart + MCP DX (2/2 plans) -- completed 2026-02-19
- [x] Phase 196: README + SDK 문서 정합성 (2/2 plans) -- completed 2026-02-19
- [x] Phase 197: Docker + Python SDK DX (2/2 plans) -- completed 2026-02-19

See `.planning/milestones/v2.5-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v2.6 Wallet SDK 설계 (Phases 198-201) -- SHIPPED 2026-02-20</summary>

- [x] Phase 198: Signing Protocol v1 설계 (2/2 plans) -- completed 2026-02-19
- [x] Phase 199: Wallet SDK + 데몬 컴포넌트 설계 (2/2 plans) -- completed 2026-02-19
- [x] Phase 200: 알림 채널 + Push Relay Server 설계 (2/2 plans) -- completed 2026-02-19
- [x] Phase 201: 기존 설계 문서 갱신 + 교차 검증 (1/1 plan) -- completed 2026-02-20

See `.planning/milestones/v2.6-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v2.6.1 WAIaaS Wallet Signing SDK (Phases 202-205) -- SHIPPED 2026-02-20</summary>

- [x] Phase 202: 서명 프로토콜 + 데몬 인프라 + SDK 패키지 + ntfy 채널 (4/4 plans) -- completed 2026-02-20
- [x] Phase 203: Telegram 채널 + 채널 라우팅 + REST API + Admin UI (4/4 plans) -- completed 2026-02-20
- [x] Phase 204: Signing SDK 데몬 라이프사이클 연결 (2/2 plans) -- completed 2026-02-20
- [x] Phase 205: Admin Settings API + Skills 동기화 (3/3 plans) -- completed 2026-02-20

See `.planning/milestones/v2.6.1-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v2.7 지갑 앱 알림 채널 (Phase 206) -- SHIPPED 2026-02-20</summary>

- [x] Phase 206: 지갑 앱 알림 사이드 채널 (4/4 plans) -- completed 2026-02-20

See `.planning/milestones/v2.7-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v26.3 Push Relay Server (Phases 207-209) -- SHIPPED 2026-02-20</summary>

- [x] Phase 207: 데몬 SignRequest 인코딩 통일 (1/1 plan) -- completed 2026-02-20
- [x] Phase 208: Push Relay Server 구현 (5/5 plans) -- completed 2026-02-20
- [x] Phase 209: 배포 인프라 (2/2 plans) -- completed 2026-02-20

See `.planning/milestones/v26.3-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v26.4 멀티 지갑 세션 + 에이전트 자기 발견 (Phases 210-214) -- SHIPPED 2026-02-21</summary>

- [x] Phase 210: 세션 모델 재구조화 (3/3 plans) -- completed 2026-02-20
- [x] Phase 211: API 레이어 지갑 선택 (3/3 plans) -- completed 2026-02-20
- [x] Phase 212: 자기 발견 엔드포인트 (2/2 plans) -- completed 2026-02-20
- [x] Phase 213: 통합 레이어 (4/4 plans) -- completed 2026-02-20
- [x] Phase 214: 검증 보고서 + SDK 타입 수정 (3/3 plans) -- completed 2026-02-21

See `.planning/milestones/v26.4-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v27.0 수신 트랜잭션 모니터링 설계 (Phases 215-223) -- SHIPPED 2026-02-21</summary>

- [x] Phase 215: IChainSubscriber 인터페이스 + DB 스키마 설계 (2/2 plans) -- completed 2026-02-21
- [x] Phase 216: Solana 수신 감지 전략 설계 (1/1 plan) -- completed 2026-02-21
- [x] Phase 217: EVM 수신 감지 전략 설계 (1/1 plan) -- completed 2026-02-21
- [x] Phase 218: WebSocket 연결 관리 + 폴링 폴백 설계 (2/2 plans) -- completed 2026-02-21
- [x] Phase 219: 알림 이벤트 + 의심 입금 감지 설계 (2/2 plans) -- completed 2026-02-21
- [x] Phase 220: REST API + SDK/MCP 명세 설계 (2/2 plans) -- completed 2026-02-21
- [x] Phase 221: 설정 구조 + 설계 통합 검증 (2/2 plans) -- completed 2026-02-21
- [x] Phase 222: 설계 문서 Critical/High 불일치 수정 (2/2 plans) -- completed 2026-02-21
- [x] Phase 223: 알림 명세 보완 + 문서 정합성 (2/2 plans) -- completed 2026-02-21

See `.planning/milestones/v27.0-ROADMAP.md` for full details.

</details>

<details>
<summary>✅ v27.1 수신 트랜잭션 모니터링 구현 (Phases 224-230) -- SHIPPED 2026-02-22</summary>

- [x] Phase 224: Core Types + DB Foundation (2/2 plans) -- completed 2026-02-21
- [x] Phase 225: Chain Subscriber Implementations (3/3 plans) -- completed 2026-02-21
- [x] Phase 226: Monitor Service + Resilience (4/4 plans) -- completed 2026-02-21
- [x] Phase 227: Config + Settings + Notifications (2/2 plans) -- completed 2026-02-21
- [x] Phase 228: REST API + SDK + MCP (3/3 plans) -- completed 2026-02-21
- [x] Phase 229: Integration Testing (2/2 plans) -- completed 2026-02-21
- [x] Phase 230: Integration Wiring Fixes (2/2 plans) -- completed 2026-02-21

See `.planning/milestones/v27.1-ROADMAP.md` for full details.

</details>

### v27.2 CAIP-19 자산 식별 표준 (In Progress)

**Milestone Goal:** WAIaaS 전체 코드베이스의 토큰/자산 식별 체계를 CAIP-19 표준으로 통일하여, 모든 ActionProvider와 외부 인터페이스가 체인/네트워크/자산을 하나의 식별자로 표현할 수 있는 상태. 모든 변경은 additive(하위 호환)이며 기존 address-only 경로는 그대로 유지된다.

**Phase Numbering:**
- Integer phases (231, 232, 233, 234): Planned milestone work
- Decimal phases (231.1, 231.2): Urgent insertions (marked with INSERTED)

- [x] **Phase 231: Core CAIP Module + Network Map** - CAIP-2/19 파서, 13-네트워크 양방향 맵, TokenRef 확장, x402 통합 (completed 2026-02-22)
- [ ] **Phase 232: Oracle L2 Support + Cache Key Migration** - 가격 오라클 CAIP-19 캐시 키, CoinGecko L2 플랫폼 매핑, Pyth 키 원자적 전환
- [ ] **Phase 233: DB Migration + Schema + Policy** - DB v22 asset_id 컬럼, 토큰 레지스트리 backfill, 트랜잭션/정책 스키마 assetId 확장
- [ ] **Phase 234: MCP + SDK + Skills Integration** - MCP 도구 assetId 파라미터, TS/Python SDK 타입, 스킬 파일 문서화

## Phase Details

### Phase 231: Core CAIP Module + Network Map
**Goal**: 모든 후속 Phase의 기반이 되는 CAIP-2/19 파싱/포맷팅 모듈과 NetworkType 양방향 맵이 존재하여, 코드베이스 어디서든 표준 자산 식별자를 생성/검증할 수 있는 상태
**Depends on**: Nothing (first phase of v27.2)
**Requirements**: CAIP-01, CAIP-02, CAIP-03, CAIP-04, CAIP-05, CAIP-06, CAIP-07, CAIP-08, CAIP-09, CAIP-10, TOKN-01
**Success Criteria** (what must be TRUE):
  1. User can import parseCaip2/formatCaip2/parseCaip19/formatCaip19 from packages/core and round-trip any valid CAIP string without data loss
  2. User can convert any of the 13 WAIaaS NetworkType values to CAIP-2 chain ID and back via networkToCaip2/caip2ToNetwork
  3. User can generate native asset IDs (slip44:60 for ETH, slip44:501 for SOL, slip44:966 for POL) and token asset IDs (erc20 for EVM, token for Solana) via nativeAssetId/tokenAssetId helpers
  4. x402.types.ts CAIP2_TO_NETWORK import works unchanged (backward-compatible re-export from caip/ module)
  5. TokenRef Zod schema accepts optional assetId (CAIP-19 string) and network (NetworkType) fields without breaking existing consumers
**Plans**: 2 plans

Plans:
- [x] 231-01-PLAN.md — CAIP-2/19 파서, 포매터, Zod 스키마 TDD 구현
- [ ] 231-02-PLAN.md — 13-네트워크 양방향 맵 + asset helpers + x402/WC 통합 + TokenRef 확장

### Phase 232: Oracle L2 Support + Cache Key Migration
**Goal**: 가격 오라클이 CAIP-19 기반 캐시 키를 사용하여 L2 네트워크(Polygon, Arbitrum, Optimism, Base) 토큰 가격을 정확히 조회할 수 있는 상태
**Depends on**: Phase 231
**Requirements**: ORCL-01, ORCL-02, ORCL-03, ORCL-04
**Success Criteria** (what must be TRUE):
  1. Price oracle cache key가 CAIP-19 형식(예: eip155:137/erc20:0x...)을 사용하며, 동일 주소의 Ethereum USDC와 Polygon USDC가 별도 캐시 엔트리로 구분된다
  2. CoinGecko를 통해 Polygon, Arbitrum, Optimism, Base 메인넷의 ERC-20 토큰 가격을 조회할 수 있다
  3. PYTH_FEED_IDS 키가 CAIP-19 형식으로 업데이트되어 기존 Pyth 가격 피드가 정상 동작한다
  4. 데몬 재시작 후 새로운 캐시 키 형식이 자동 적용된다 (인메모리 캐시이므로 데이터 마이그레이션 불필요)
**Plans**: 2 plans

Plans:
- [ ] 232-01-PLAN.md — buildCacheKey CAIP-19 전환 + CoinGecko L2 플랫폼 맵 확장 + PYTH_FEED_IDS 원자적 키 전환 + 전체 oracle 호출자 시그니처 마이그레이션
- [ ] 232-02-PLAN.md — Oracle 테스트 CAIP-19 기대값 갱신 + L2 가격 조회 테스트 + 파이프라인 network 전파

### Phase 233: DB Migration + Schema + Policy
**Goal**: token_registry DB 테이블에 CAIP-19 asset_id가 저장되고, 트랜잭션 요청과 정책 규칙이 assetId 필드를 지원하여, 동일 주소의 다른 체인 토큰을 정책 수준에서 구분할 수 있는 상태
**Depends on**: Phase 231
**Requirements**: TOKN-02, TOKN-03, TOKN-04, TXSC-01, TXSC-02, TXSC-03, PLCY-01, PLCY-02, PLCY-03, PLCY-04
**Success Criteria** (what must be TRUE):
  1. DB v22 마이그레이션 후 token_registry의 모든 기존 레코드에 올바른 CAIP-19 asset_id가 자동 채워져 있다
  2. Token API 응답(GET /v1/tokens 등)에 assetId 필드가 포함된다
  3. 트랜잭션 요청에 assetId를 포함하면 address가 자동 추출되고, assetId와 address가 동시 제공될 때 cross-validation이 수행된다
  4. ALLOWED_TOKENS 정책에 assetId를 사용할 수 있으며, 4가지 매칭 시나리오(assetId<->assetId, assetId<->legacy, legacy<->assetId, legacy<->legacy) 모두 정확히 동작한다
  5. 기존 assetId 없는 트랜잭션과 정책이 변경 없이 동일하게 동작한다 (하위 호환)
**Plans**: TBD

Plans:
- [ ] 233-01: DB v22 마이그레이션 + token_registry asset_id backfill + API 응답
- [ ] 233-02: TokenInfoSchema assetId 확장 + Stage 1 추출/검증
- [ ] 233-03: ALLOWED_TOKENS 정책 assetId 지원 + 4-scenario 평가 매트릭스

### Phase 234: MCP + SDK + Skills Integration
**Goal**: AI 에이전트가 MCP 도구, TypeScript/Python SDK, 스킬 파일을 통해 CAIP-19 assetId로 토큰을 식별하고 트랜잭션을 요청할 수 있는 상태
**Depends on**: Phase 231, Phase 233
**Requirements**: MCPS-01, MCPS-02, MCPS-03, MCPS-04, SKIL-01, SKIL-02
**Success Criteria** (what must be TRUE):
  1. MCP 도구(send_token, approve_token 등)에 optional assetId 파라미터를 전달하면 해당 토큰으로 트랜잭션이 생성된다
  2. MCP 도구 description에 CAIP-19 assetId 형식과 사용법이 문서화되어 AI 에이전트가 형식을 이해할 수 있다
  3. TypeScript SDK 타입(AssetInfo, TokenInfo 등)에 optional assetId 필드가 포함된다
  4. Python SDK 모델에 optional assetId 필드가 포함된다
  5. Skills 파일(transactions, policies, quickstart)에 CAIP-19 자산 식별 개념과 사용 예제가 문서화된다
**Plans**: TBD

Plans:
- [ ] 234-01: MCP 도구 assetId 파라미터 + description 업데이트
- [ ] 234-02: TS/Python SDK 타입 + Skills 파일 문서화

## Progress

**Execution Order:**
Phases execute in numeric order: 231 -> 232 -> 233 -> 234
(Note: Phase 232 and 233 both depend only on 231. Phase 234 depends on 231 + 233.)

| Phase | Milestone | Plans Complete | Status | Completed |
|-------|-----------|----------------|--------|-----------|
| 1-173 | v0.1-v2.0 | -- | Complete | 2026-02-18 |
| 178-181 | v2.2 | 6/6 | Complete | 2026-02-18 |
| 182-187 | v2.3 | 11/11 | Complete | 2026-02-18 |
| 188-190 | v2.4 | 4/4 | Complete | 2026-02-19 |
| 191-193 | v2.4.1 | 5/5 | Complete | 2026-02-19 |
| 194-197 | v2.5 | 8/8 | Complete | 2026-02-19 |
| 198-201 | v2.6 | 7/7 | Complete | 2026-02-20 |
| 202-205 | v2.6.1 | 13/13 | Complete | 2026-02-20 |
| 206 | v2.7 | 4/4 | Complete | 2026-02-20 |
| 207-209 | v26.3 | 8/8 | Complete | 2026-02-20 |
| 210-214 | v26.4 | 15/15 | Complete | 2026-02-21 |
| 215-223 | v27.0 | 16/16 | Complete | 2026-02-21 |
| 224-230 | v27.1 | 18/18 | Complete | 2026-02-22 |
| 231 | 2/2 | Complete    | 2026-02-22 | - |
| 232 | v27.2 | 0/2 | Not started | - |
| 233 | v27.2 | 0/3 | Not started | - |
| 234 | v27.2 | 0/2 | Not started | - |
